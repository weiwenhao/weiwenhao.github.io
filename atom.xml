<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>weiwenhao</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://beian.miit.gov.cn/"/>
  <updated>2019-12-09T04:32:11.000Z</updated>
  <id>http://beian.miit.gov.cn/</id>
  
  <author>
    <name>ç²¤ICPå¤‡18153286</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç¨‹åºå‘˜çš„é”®ç›˜ä½¿ç”¨æŒ‡å—</title>
    <link href="http://beian.miit.gov.cn/posts/programmer-keyboard-usage-guide.html"/>
    <id>http://beian.miit.gov.cn/posts/programmer-keyboard-usage-guide.html</id>
    <published>2019-01-24T03:11:09.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>å·¥æ¬²å–„å…¶äº‹,å¿…å…ˆåˆ©å…¶å™¨. é”®ç›˜ä¾¿æ˜¯å…¶ä¸­çš„é‡è¦çš„ä¸€ç¯,é«˜æ•ˆçš„ä½¿ç”¨é”®ç›˜å¯ä»¥å¸¦æ¥ä¼˜é›…é«˜æ•ˆçš„æ—¥å¸¸ä½¿ç”¨åŠç¼–ç ,ç”šè‡³èƒ½å¤Ÿä¿æŠ¤å¥½ä½ çš„æ‰‹æŒ‡.</p><p>äºæ˜¯æˆ‘ä¾¿æ”¶é›†äº†ä¸€äº›è¾ƒä¸ºé€šç”¨å¹¶ä¸”ä¸é”™çš„é”®ç›˜ä½¿ç”¨å®è·µ,å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯å‚è€ƒä¸€äº›é”®ç›˜çš„å†å²è®¾è®¡,ç¨‹åºå‘˜çš„ç¼–ç å®è·µ,ä»¥åŠä¸€äº›é”®ç›˜çš„ä½¿ç”¨æ ‡å‡†,å¦‚é”®ç›˜ä½¿ç”¨æ ‡å‡†æŒ‡æ³•ç­‰.</p><p>ç»è¿‡è¿™ä¸€å¹´çš„ä½¿ç”¨,å‘ç°å¾ˆå¤šå®è·µç¡®å®ä¼šè®©ç¼–ç æ›´åŠ çš„ä¼˜é›…é«˜æ•ˆ,é‚åˆ†äº«å‡ºæ¥.ä¸‹é¢çš„æ–‡ç« è¾ƒä¸ºç®€çŸ­,åªæœ‰å‡ æ¡ç¨‹åºå‘˜é—´è¾ƒä¸ºé€šç”¨çš„åšæ³•,å¹¶ç»™å‡ºäº†è¿™ä¹ˆåšçš„ç†ç”±. </p><a id="more"></a><blockquote><p>ä¸€äº›æˆ‘ä¸ªäººçš„é”®ç›˜ä½¿ç”¨ä¹ æƒ¯å°±ä¸é˜è¿°äº†~</p></blockquote><h4 id="å°Šé‡ä½ çš„æ“ä½œç³»ç»Ÿ"><a href="#å°Šé‡ä½ çš„æ“ä½œç³»ç»Ÿ" class="headerlink" title="å°Šé‡ä½ çš„æ“ä½œç³»ç»Ÿ"></a>å°Šé‡ä½ çš„æ“ä½œç³»ç»Ÿ</h4><p>å¦‚æœä½ ä½¿ç”¨äº†macç›¸å…³çš„ç”µè„‘å¹¶å¤–æ¥äº†éè‹¹æœé”®ç›˜,éœ€è¦æ³¨æ„ä¸€ä¸‹ commandé”®å’Œoptionçš„ä½ç½®. æ›´ä¸ºæ ‡å‡†ä¸”ä¹ æƒ¯çš„æ–¹å¼åº”è¯¥æ˜¯ altè®¾ç½®ä¸ºcommandé”®,winè®¾ç½®ä¸ºoptioné”®. </p><p>è®¾ç½®çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•,ç‚¹å‡»<strong>é”®ç›˜ -&gt; ä¿®é¥°é”®</strong> è¿›è¡Œè®¾ç½®å³å¯.</p><p><img src="http://asset.eienao.com/20190117095146.png" alt></p><blockquote><p>å®é™…ä¸Š,æˆ‘è®¤ä¸ºmac osçš„è®¾è®¡ç›¸æ¯”äºwindows/linux åœ¨è¿™ç‚¹ä¸Šæ›´åŠ åˆç†</p></blockquote><h4 id="æŠ›å¼ƒCapsé”®"><a href="#æŠ›å¼ƒCapsé”®" class="headerlink" title="æŠ›å¼ƒCapsé”®"></a>æŠ›å¼ƒCapsé”®</h4><p>capsæ—¢å¤§å°å†™é”å®šé”®,ç›¸ä¿¡å¾ˆå¤šäººå·²ç»å¾ˆå°‘å»æŒ‰è¿™ä¸ªé”®äº†,å¦‚æœä½ è¿˜å¯¹å®ƒæ‹æ‹ä¸èˆ,é‚£ä¹ˆä½ éœ€è¦ç»ƒä¹ ä½¿ç”¨shifté”®æ¥è¿›è¡Œå¤§å°å†™çš„è½¬æ¢. </p><blockquote><p>æ¨èä¸€ä¸ªç»ƒä¹ æ‰“å­—çš„ç½‘ç«™ <a href="https://www.typingclub.com" target="_blank" rel="noopener">https://www.typingclub.com</a></p><p>å¦‚æœæ•´ä¸ªå•è¯éœ€è¦å¤§å†™çš„è¯,æˆ‘é€šå¸¸ä¼šå…ˆé”®å…¥å°å†™,ç„¶åä½¿ç”¨ideçš„å¤§å°å†™è½¬æ¢åŠŸèƒ½å¯¹æ•´ä¸ªå•è¯è¿›è¡Œè½¬æ¢(é€‚ç”¨äºå¸¸é‡çš„é”®å…¥), å¯¹äºvimåªè¦<code>gUaw</code>å³å¯å°†æ•´ä¸ªå•è¯åˆ‡æ¢ä¸ºå¤§å†™,å¯¹äºjetbrainsç³»åˆ—ide,é€‰ä¸­å•è¯åæŒ‰ä½<code>command + shift + u</code> å³å¯è¿›è¡Œå¤§å°å†™çš„è½¬æ¢</p><p>åœ¨window/linuxä¸Š command å³ ctrlé”®</p></blockquote><h4 id="ä½¿ç”¨ä¸¤ä¾§çš„Shifté”®"><a href="#ä½¿ç”¨ä¸¤ä¾§çš„Shifté”®" class="headerlink" title="ä½¿ç”¨ä¸¤ä¾§çš„Shifté”®"></a>ä½¿ç”¨ä¸¤ä¾§çš„Shifté”®</h4><p>è€ƒè™‘åˆ°ä½ å¯èƒ½ä¸ä¼šç‚¹å¼€ä¸Šé¢çš„æ‰“å­—ç½‘ç«™,æˆ‘ç€é‡ä»‹ç»ä¸€ä¸‹shifté”®. ç¨å¾®æ³¨æ„ä¸€ä¸‹ä½ å°±ä¼šå‘ç° shifté”®çš„ä½¿ç”¨é¢‘ç‡éå¸¸çš„é«˜, å°¤å…¶æ˜¯phpç¨‹åºå‘˜æ»¡å±çš„$,å¦‚æœä½ è¿˜ä½¿ç”¨shiftåˆ‡æ¢å¤§å°å†™,é‚£ä¹ˆä½ çš„å·¦æ‰‹å°æŒ‡çš„è´Ÿæ‹…å…¶å®å·²ç»éå¸¸å¤§äº†</p><p>æ­£ç¡®çš„åšæ³•æ˜¯</p><p>é”®å…¥<code>A</code>æ—¶, æ ‡å‡†æŒ‡æ³•çš„ä½¿ç”¨åº”è¯¥æ˜¯<strong>å³æ‰‹å°æŒ‡æŒ‰ä½shift + å·¦æ‰‹å°æŒ‡æŒ‰ä½å­—æ¯A</strong>.  </p><p>é”®å…¥<code>$</code>æ—¶, åº”è¯¥æ˜¯<strong>å³æ‰‹å°æŒ‡æŒ‰ä½shift + å·¦æ‰‹é£ŸæŒ‡æŒ‰ä½æ•°å­—4</strong></p><p>é”®å…¥<code>(</code>æ—¶, åº”è¯¥æ˜¯<strong>å·¦æ‰‹å°æŒ‡æŒ‰ä½shift + å·¦æ‰‹é£ŸæŒ‡æŒ‰ä½æ•°å­—9</strong></p><p>è¿™é‡Œçš„åŸºæœ¬åŸåˆ™æ˜¯,å¦‚æœä½ éœ€è¦åŒæ—¶æŒ‰ä½ä¸¤ä¸ªæŒ‰é”®æ—¶,å°½é‡è®©è¿™ä¸¤ä¸ªæŒ‰é”®åˆ†æ‘Šåˆ°ä½ çš„ä¸¤åªæ‰‹ä¸Š</p><blockquote><p>ä½†æ˜¯å¦‚ ctrl + c    ctrl + d è¿™æ ·çš„æŒ‰é”®,è¿˜æ˜¯æ— æ³•åˆ†æ‘Šåˆ°ä¸¤åªæ‰‹ä¸Šè¿›è¡Œæ“ä½œ</p></blockquote><h4 id="æ˜ å°„Ctrlé”®"><a href="#æ˜ å°„Ctrlé”®" class="headerlink" title="æ˜ å°„Ctrlé”®"></a>æ˜ å°„Ctrlé”®</h4><p>å½“ä¸åœ¨ä½¿ç”¨capsé”®é”®å…¥å¤§å†™å­—æ¯æ—¶,å°±ç©ºå‡ºäº†ä¸€ä¸ªéå¸¸å®è´µçš„æŒ‰é”®, å› ä¸ºcapså¯¹åº”çš„è¿™ä¸ªé”®ä½å¯¹å°æ‹‡æŒ‡å®åœ¨æ˜¯å¤ªå‹å¥½äº†.</p><p>æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æŠŠæ—¥å¸¸ç”Ÿæ´»ä¸­ç¨‹åºå‘˜éå¸¸éå¸¸å¸¸ç”¨ä½†å´éå¸¸éš¾äºæ•²å‡»çš„é”®ctrlé”®æ˜ å°„åˆ°capsé”®.è¿™ä¸€æ­¥å¯¹äºéå¸¸ä¾èµ–ctrlçš„windows/linuxç”¨æˆ·å°¤ä¸ºé‡è¦. å½“ç„¶å¯¹äºmacç”¨æˆ·ä¹Ÿéå¸¸é‡è¦,å³ä½¿åœ¨commandé”®å·²ç»ä»£æ›¿äº†ctrlçš„å¤§éƒ¨åˆ†æ“ä½œçš„æƒ…å†µä¸‹.</p><blockquote><p>crtl + [ æ˜¯æˆ‘æ—¥å¸¸ä½¿ç”¨æœ€ä¸ºé¢‘ç¹çš„æŒ‰é”®</p></blockquote><p>å¯¹äºmacç”¨æˆ·è¿™å¾ˆå®¹æ˜“æ“ä½œ,ä½ å¯ä»¥å‚è€ƒä¸Šé¢é‚£å¼ å›¾ç‰‡ä¸­çš„æŒ‰é”®æ˜ å°„, å¯¹äºwindows/linuxç”¨æˆ·,ä½ éœ€è¦ä¸‹è½½ä¸“ä¸šçš„æŒ‰é”®æ˜ å°„è½¯ä»¶</p><h4 id="æ˜ å°„Escé”®"><a href="#æ˜ å°„Escé”®" class="headerlink" title="æ˜ å°„Escé”®"></a>æ˜ å°„Escé”®</h4><p>escä¹Ÿæ˜¯è¾ƒä¸ºå¸¸ç”¨çš„ä¸€ä¸ªæŒ‰é”®,å°¤å…¶æ˜¯ç”¨åœ¨ä¸€äº›å¼¹å‡ºå±‚çš„å…³é—­. vimä¸­é€€å‡ºinsert/visualæ¨¡å¼ä¹Ÿéœ€è¦escé”®.ä½†æ˜¯escå®åœ¨æ˜¯å¤ªå¤ªå¤ªé¥è¿œäº†.</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ˜ å°„æ–¹æ¡ˆ</p><p>å¯¹äºévimç”¨æˆ·,å¯ä»¥é€‰æ‹©å°†é”®ç›˜å·¦ä¸‹è§’ç©ºå‡ºæ¥çš„CtrlæŒ‰é”®æ˜ å°„æˆEsc. å¦‚æœä½ çš„é”®ç›˜æŒ‰é”®è¶³å¤Ÿé«˜,å¯ä»¥é€‰æ‹©ä½¿ç”¨æŒå¿ƒæ¥æ•²å‡»è¯¥æŒ‰é”®. <em>å¯¹äºæˆ‘æ¥è¯´,è¿™ç§æ˜ å°„ä½¿ç”¨æœ€å¤šçš„æƒ…å†µæ˜¯é€€å‡ºè§†é¢‘çš„å…¨å±æ¨¡å¼</em></p><blockquote><p>vimç”¨æˆ·è¯·åƒä¸‡ä¸è¦ä½¿ç”¨ä¸Šè¿°çš„æ–¹å¼é€€å‡ºinsert/visualæ¨¡å¼</p></blockquote><p>å¯¹äºvimæ¨¡å¼,æ¨èä½¿ç”¨<code>ctrl + [</code> ä»£æ›¿Escé”®,åœ¨vimç¼–è¾‘å™¨ä¸­,è¿™æ˜¯é»˜è®¤æ˜ å°„.å½“ç„¶æˆ‘ä¹Ÿå–œæ¬¢è‡ªå·±åœ¨ç³»ç»Ÿå±‚é¢åšè¿™æ ·ä¸€ä¸ªæ˜ å°„,è®©æˆ‘åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½å¤Ÿä½¿ç”¨<code>ctrl + [</code>æ¥é€€å‡ºä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„å¼¹å‡ºå±‚,æ¯”å¦‚Alfred</p><p>ä¸‹é¢æ˜¯æˆ‘å¸¸ç”¨çš„ä¸€äº›æ˜ å°„</p><p><img src="http://asset.eienao.com/20190124103742.png" alt></p><p><img src="http://asset.eienao.com/20190124135715.png" alt></p><p>ä¸Šé¢çš„é”®ç›˜æ˜ å°„è½¯ä»¶æ˜¯ <a href="https://pqrs.org/osx/karabiner/" target="_blank" rel="noopener">Karabiner for mac</a>,ç”±äºæˆ‘çš„é”®ç›˜çš„ç‰¹æ®Šæ€§,æ‰€ä»¥åšäº†ä¸€äº›ç‰¹åˆ«çš„æ˜ å°„,ä¸‹é¢æœ‰ä»‹ç»æˆ‘ä½¿ç”¨çš„é”®ç›˜</p><h4 id="æŠ›å¼ƒâ†‘â†“â†â†’"><a href="#æŠ›å¼ƒâ†‘â†“â†â†’" class="headerlink" title="æŠ›å¼ƒâ†‘â†“â†â†’"></a>æŠ›å¼ƒâ†‘â†“â†â†’</h4><p>ä¸Šä¸‹å·¦å³è¿™å‡ ä¸ªé”®ä¾æ—§éå¸¸çš„é¥è¿œ,ä¼šè®©æˆ‘ä»¬çš„æ‰‹æŒ‡ç¦»å¼€ä¸»é”®ä½åŒº. è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•æ¥é¿å…ä½¿ç”¨å®ƒä»¬,è®©ä½ æ›´æœ‰styleçš„æ¥å·¥ä½œä¸æ—¥å¸¸</p><p>emacsçš„è§£å†³æ–¹å¼(é€šç”¨è§£å†³æ–¹å¼). </p><p><code>ctrl + b</code> = â†</p><p><code>ctrl + f</code> = â†’</p><p><code>ctrl + n</code> = â†“</p><p><code>ctrl + p</code> = â†‘</p><p>è¯´ä¸Šé¢çš„ä¸ºé€šç”¨è§£å†³æ–¹æ¡ˆæ˜¯å› ä¸ºä¸Šé¢çš„æŒ‡æ³•åªè¦æ˜¯åœ¨æœ‰æ–‡æœ¬é”®å…¥çš„åœ°æ–¹éƒ½é€‚ç”¨çš„,åŒ…å«iterm2,æµè§ˆå™¨,ideä¸­ç­‰ç­‰.åŸºæœ¬ä¸Šå±äºæ“ä½œç³»ç»Ÿçº§çš„æŒ‡æ³•</p><p>æ›´å¤šçš„ç±»ä¼¼æŒ‡æ³•è¿˜æœ‰</p><p><code>ctrl + a</code> å›åˆ°è¡Œé¦–</p><p><code>ctrl + e</code> å»åˆ°è¡Œå°¾</p><p><code>ctrl + w</code> å›åˆ ä¸€ä¸ªå•è¯</p><p><code>ctrl + m</code>  å›è½¦</p><p>vimçš„è§£å†³æ–¹å¼,è¿™ä¸ªå°±ä¸å¤šå™è¿°äº†,é€‚ç”¨ç¾¤ä½“å’Œè½¯ä»¶æ¯”è¾ƒç‰¹æ®Š,ä¸è¿‡æˆ‘è¿˜æ˜¯æ¨è phpstorm + vimæ’ä»¶ / vscode + vimæ’ä»¶çš„å¼€å‘æ–¹å¼,åœ¨ç®€å•çš„å±‚é¢ä½¿ç”¨vimä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šçš„ä¾¿åˆ©</p><h4 id="æŠ›å¼ƒæ•°å­—å°é”®ç›˜"><a href="#æŠ›å¼ƒæ•°å­—å°é”®ç›˜" class="headerlink" title="æŠ›å¼ƒæ•°å­—å°é”®ç›˜"></a>æŠ›å¼ƒæ•°å­—å°é”®ç›˜</h4><p>ä½¿ç”¨ä¸»é”®ä½åŒºçš„æ•°å­—é”®</p><p><img src="http://asset.eienao.com/20190124104710.png" alt></p><h4 id="é€‰ç”¨ä¸€æŠŠåˆé€‚çš„é”®ç›˜"><a href="#é€‰ç”¨ä¸€æŠŠåˆé€‚çš„é”®ç›˜" class="headerlink" title="é€‰ç”¨ä¸€æŠŠåˆé€‚çš„é”®ç›˜"></a>é€‰ç”¨ä¸€æŠŠåˆé€‚çš„é”®ç›˜</h4><p>å³ä½¿ctrlåœ¨ä¸€ä¸ªè¿™ä¹ˆé¡ºæ‰‹çš„ä½ç½®,ä½†æ˜¯å¯¹äºç¨‹åºå‘˜æ¥è¯´å·¦æ‰‹å°æŒ‡çš„å‹åŠ›è¿˜æ˜¯éå¸¸å¤§çš„,å°¤å…¶æ˜¯å·¦ä¾§shiftå’Œctrlçš„ä½¿ç”¨,æˆ‘ä¾¿æ˜¯ç”±äºå°æ‹‡æŒ‡ç–¼ç—›,ä¾¿è´­å…¥äº†ä¸€æŠŠ<strong>æ¨±æ¡ƒçº¢è½´</strong>çš„æœºæ¢°é”®ç›˜,å…¶å¯¹å°æ‹‡æŒ‡çš„å‡è´Ÿæœ‰ç€ä¸é”™çš„ä½œç”¨</p><p>ä¸‹é¢è¿™æ¬¾æ˜¯æˆ‘ç¼–ç ä½¿ç”¨çš„é”®ç›˜</p><p><img src="http://asset.eienao.com/20190117105613.png" alt></p><p>ç®—æ˜¯æ¯”è¾ƒä¾¿å®œç²¾è‡´çš„æ¨±æ¡ƒè½´é”®ç›˜äº†,åŸºæœ¬ä¸Šæ²¡æœ‰å¤šä½™çš„é”®ä½</p><p>æˆ‘æ²¡æœ‰ä½“éªŒè¿‡é™ç”µå®¹çš„é”®ç›˜, ä½†æ˜¯é¢„ç®—å……è¶³çš„æƒ…å†µä¸‹, hhkbçš„é‚£æ¬¾æ„Ÿè§‰å¾ˆé…·,å€¼å¾—å°è¯•</p><blockquote><p>tip: å¦‚æœä½ è¦è´­å…¥å’Œæˆ‘ä¸€æ ·çš„é”®ç›˜,è¯·ä¸€å®šè¦çœ‹å‡†<strong>æ¨±æ¡ƒçº¢è½´</strong>,è¿™æ¬¾é”®ç›˜è¿˜æœ‰å…¶ä»–å“ç‰Œçš„è½´ä½“</p></blockquote><h4 id="å°è¯•å­¦ä¹ vim"><a href="#å°è¯•å­¦ä¹ vim" class="headerlink" title="å°è¯•å­¦ä¹ vim"></a>å°è¯•å­¦ä¹ vim</h4><p>ç†ç”±ç½‘ä¸Šå¾ˆå¤šæˆ‘å°±ä¸èµ˜è¿°äº†, ä½†æ˜¯å†™ä¸¤è¡Œä»£ç å°±è¦åŠ¨ä¸€ä¸‹é¼ æ ‡æˆ–è€…æ‰‹æŒ‡ç¦»å¼€ä¸»é”®ç›˜åŒº,æ„Ÿè§‰è‡ªå·±å°±åƒæ˜¯ä¸ªç˜¸å­ä¸€æ ·,å¾ˆä¸é…·.ğŸ˜‚</p><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p><em>æ¨èä½¿ç”¨å³æ‰‹æ‹‡æŒ‡æ¥æ•²å‡»ç©ºæ ¼,ä»è€Œå……åˆ†åˆ©ç”¨è¯¥æ‰‹æŒ‡. å½“ç„¶æ›´åŠ æ¨èçš„åšæ³•æ˜¯åŒæ‰‹æ‹‡æŒ‡è½®æµæ•²å‡»ç©ºæ ¼(æˆ‘è¿˜åšä¸åˆ°). ç¨‹åºå‘˜å¯¹ç©ºæ ¼çš„éœ€æ±‚è¿˜æ˜¯è›®å¤§çš„</em></p><p><em>ä¸è¦æ€»æ˜¯å±•å¼€ideå·¦ä¾§çš„treeæ–‡ä»¶å¯¼èˆª,å®é™…ä¸Šå¤§éƒ¨åˆ†æ—¶é—´ä½ éƒ½ç”¨ä¸åˆ°å®ƒ,è®°ä½å±•å¼€ä¸å…³é—­çš„å¿«æ·é”®,ç¼–ç æ—¶æŠŠå®ƒå…³é—­(jetbrainsç³»åˆ—ideçš„å¿«æ·é”®æ˜¯command + 1)</em></p><p><em>ç¼–ç æ—¶æ¨èä½¿ç”¨serach Everywhere + ç¼“å†²åŒº(jetbrainsç³»åˆ—ideä¸­ command + e)  + å‡½æ•°åˆ—è¡¨(jetbrainsç³»åˆ—ideä¸­ command + f12)æ¥è¿›è¡Œè·³è½¬ä¸æ§åˆ¶</em></p><p><em>å®é™…ä¸Šä¸€æŠŠHHKBé”®ç›˜åŒ…å«ä¸Šè¿°80%çš„æ“ä½œ,æ¯•ç«Ÿæ˜¯ä¸“é—¨ä¸ºç¨‹åºå‘˜æ‰“é€ çš„é”®ç›˜.ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½èˆå¾—è´­å…¥ä¸€æŠŠHHKB,æ‰€ä»¥ä¸Šé¢çš„ä¸€äº›æ“ä½œæ–¹æ³•,ä½¿ä½ ä¾æ—§èƒ½å¤Ÿåœ¨æ™®é€šé”®ç›˜ä¸Šä½¿ç”¨</em></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å·¥æ¬²å–„å…¶äº‹,å¿…å…ˆåˆ©å…¶å™¨. é”®ç›˜ä¾¿æ˜¯å…¶ä¸­çš„é‡è¦çš„ä¸€ç¯,é«˜æ•ˆçš„ä½¿ç”¨é”®ç›˜å¯ä»¥å¸¦æ¥ä¼˜é›…é«˜æ•ˆçš„æ—¥å¸¸ä½¿ç”¨åŠç¼–ç ,ç”šè‡³èƒ½å¤Ÿä¿æŠ¤å¥½ä½ çš„æ‰‹æŒ‡.&lt;/p&gt;
&lt;p&gt;äºæ˜¯æˆ‘ä¾¿æ”¶é›†äº†ä¸€äº›è¾ƒä¸ºé€šç”¨å¹¶ä¸”ä¸é”™çš„é”®ç›˜ä½¿ç”¨å®è·µ,å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯å‚è€ƒä¸€äº›é”®ç›˜çš„å†å²è®¾è®¡,ç¨‹åºå‘˜çš„ç¼–ç å®è·µ,ä»¥åŠä¸€äº›é”®ç›˜çš„ä½¿ç”¨æ ‡å‡†,å¦‚é”®ç›˜ä½¿ç”¨æ ‡å‡†æŒ‡æ³•ç­‰.&lt;/p&gt;
&lt;p&gt;ç»è¿‡è¿™ä¸€å¹´çš„ä½¿ç”¨,å‘ç°å¾ˆå¤šå®è·µç¡®å®ä¼šè®©ç¼–ç æ›´åŠ çš„ä¼˜é›…é«˜æ•ˆ,é‚åˆ†äº«å‡ºæ¥.ä¸‹é¢çš„æ–‡ç« è¾ƒä¸ºç®€çŸ­,åªæœ‰å‡ æ¡ç¨‹åºå‘˜é—´è¾ƒä¸ºé€šç”¨çš„åšæ³•,å¹¶ç»™å‡ºäº†è¿™ä¹ˆåšçš„ç†ç”±. &lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨TreeQLåŠ é€Ÿä½ çš„apiå¼€å‘</title>
    <link href="http://beian.miit.gov.cn/posts/accelerate-your-api-development-with-tree-ql.html"/>
    <id>http://beian.miit.gov.cn/posts/accelerate-your-api-development-with-tree-ql.html</id>
    <published>2019-01-21T08:04:20.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯TreeQL"><a href="#ä»€ä¹ˆæ˜¯TreeQL" class="headerlink" title="ä»€ä¹ˆæ˜¯TreeQL"></a>ä»€ä¹ˆæ˜¯TreeQL</h2><p>tree-ql æ˜¯ä¸€ä¸ªlaravelæ‰©å±•,å¸Œæœ›èƒ½å¤Ÿä»urlä¸­includeä½ æ‰€éœ€çš„èµ„æº,å®ç°æŸ¥è¯¢çš„æ‰€è§æ—¢æ‰€å¾—.</p><a id="more"></a><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// http://api.test/posts/&#123;slug&#125;?include=content,user,comments  â†“</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"slug"</span>: <span class="string">"quisquam-asperiores-est-necessitatibus-et."</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Quisquam asperiores est necessitatibus et."</span>,</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"Officiis nihil sunt ut veritatis."</span>,</span><br><span class="line">        <span class="attr">"cover"</span>: <span class="string">"https://lorempixel.com/640/480/?63535"</span>,</span><br><span class="line">        <span class="attr">"comment_count"</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="attr">"like_count"</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="attr">"content"</span>: <span class="string">"Omnis quisquam dolorem quasi sequi veritatis quia dolorem sed. Ut non voluptatem beatae eum. "</span>,</span><br><span class="line">        <span class="attr">"comments"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">303</span>,</span><br><span class="line">            <span class="attr">"content"</span>: <span class="string">"Quasi dignissimos dolor tempore exercitationem."</span>,</span><br><span class="line">            <span class="attr">"user_id"</span>: <span class="number">2481</span>,</span><br><span class="line">            <span class="attr">"post_id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"like_count"</span>: <span class="number">18</span>,</span><br><span class="line">            <span class="attr">"reply_count"</span>: <span class="number">9</span>,</span><br><span class="line">            <span class="attr">"floor"</span>: <span class="number">303</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"user"</span>: &#123;</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">1221</span>,</span><br><span class="line">          <span class="attr">"nickname"</span>: <span class="string">"Ashleigh McKenzie"</span>,</span><br><span class="line">          <span class="attr">"avatar"</span>: <span class="string">"https://lorempixel.com/640/480/?29515"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´åŠ æ·±å…¥çš„ä½¿ç”¨</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">// http://api.test/posts/&#123;slug&#125;?include=</span><br><span class="line">// content,user,comments(sort_by:like_count)&#123;user,replies.user&#125;,is_like,select_comments</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"slug"</span>: <span class="string">"quisquam-asperiores-est-necessitatibus-et."</span>,</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"Quisquam asperiores est necessitatibus et."</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">"Officiis nihil sunt ut veritatis."</span>,</span><br><span class="line">    <span class="attr">"cover"</span>: <span class="string">"https://lorempixel.com/640/480/?63535"</span>,</span><br><span class="line">    <span class="attr">"comment_count"</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="attr">"like_count"</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="attr">"user_id"</span>: <span class="number">1221</span>,</span><br><span class="line">    <span class="attr">"content"</span>: <span class="string">"Omnis quisquam dolorem quasi sequi veritatis quia dolorem sed. Ut non voluptatem beatae eum."</span>,</span><br><span class="line">    <span class="attr">"is_like"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"comments"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">303</span>,</span><br><span class="line">        <span class="attr">"content"</span>: <span class="string">"Quasi dignissimos dolor tempore exercitationem."</span>,</span><br><span class="line">        <span class="attr">"user_id"</span>: <span class="number">2481</span>,</span><br><span class="line">        <span class="attr">"post_id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"like_count"</span>: <span class="number">18</span>,</span><br><span class="line">        <span class="attr">"reply_count"</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="attr">"floor"</span>: <span class="number">303</span>,</span><br><span class="line">        <span class="attr">"user"</span>: &#123;</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">2481</span>,</span><br><span class="line">          <span class="attr">"nickname"</span>: <span class="string">"Garett O'Connell"</span>,</span><br><span class="line">          <span class="attr">"avatar"</span>: <span class="string">"https://lorempixel.com/640/480/?52652"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"replies"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">415</span>,</span><br><span class="line">            <span class="attr">"comment_id"</span>: <span class="number">303</span>,</span><br><span class="line">            <span class="attr">"user_id"</span>: <span class="number">2814</span>,</span><br><span class="line">            <span class="attr">"content"</span>: <span class="string">"Odit magnam sed ut."</span>,</span><br><span class="line">            <span class="attr">"call_user"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2018-12-12 02:26:08"</span>,</span><br><span class="line">            <span class="attr">"updated_at"</span>: <span class="string">"2018-12-12 02:26:08"</span>,</span><br><span class="line">            <span class="attr">"user"</span>: &#123;</span><br><span class="line">              <span class="attr">"id"</span>: <span class="number">2814</span>,</span><br><span class="line">              <span class="attr">"nickname"</span>: <span class="string">"Ted Dickinson"</span>,</span><br><span class="line">              <span class="attr">"avatar"</span>: <span class="string">"https://lorempixel.com/640/480/?19577"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">          </span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"user"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1221</span>,</span><br><span class="line">      <span class="attr">"nickname"</span>: <span class="string">"Ashleigh McKenzie"</span>,</span><br><span class="line">      <span class="attr">"avatar"</span>: <span class="string">"https://lorempixel.com/640/480/?29515"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"meta"</span>: &#123;</span><br><span class="line">    <span class="attr">"selected_comments"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">303</span>,</span><br><span class="line">        <span class="attr">"content"</span>: <span class="string">"Quasi dignissimos dolor tempore exercitationem."</span>,</span><br><span class="line">        <span class="attr">"user_id"</span>: <span class="number">2481</span>,</span><br><span class="line">        <span class="attr">"post_id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"like_count"</span>: <span class="number">18</span>,</span><br><span class="line">        <span class="attr">"reply_count"</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="attr">"floor"</span>: <span class="number">303</span>,</span><br><span class="line">        <span class="attr">"selected"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"created_at"</span>: <span class="string">"2018-12-12 02:25:55"</span>,</span><br><span class="line">        <span class="attr">"updated_at"</span>: <span class="string">"2018-12-12 02:25:55"</span>,</span><br><span class="line">        <span class="attr">"user"</span>: &#123;</span><br><span class="line">          <span class="attr">"id"</span>: <span class="number">2481</span>,</span><br><span class="line">          <span class="attr">"nickname"</span>: <span class="string">"Garett O'Connell"</span>,</span><br><span class="line">          <span class="attr">"avatar"</span>: <span class="string">"https://lorempixel.com/640/480/?52652"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šå‘ç°å’ŒGraphQLæ¯”èµ·æ¥å¹¶ä¸æ˜¯çœŸæ­£çš„æ‰€è§æ—¢æ‰€å¾—,è¿™æ˜¯ç”±äºhttpè¯·æ±‚urlé•¿åº¦çš„é™åˆ¶,æ‰€ä»¥åŠ å…¥äº†defaultçš„æ¦‚å¿µ, TreeQLä¼šç»“åˆincludeå’Œdefaultæ¥è¿”å›ç›¸åº”çš„èµ„æº.</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç¡®ä¿ä½ çš„laravelç‰ˆæœ¬åœ¨5.5ä»¥ä¸Š,åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ</p><p><code>composer require weiwenhao/tree-ql</code></p><blockquote><p>è¯¥ç‰ˆæœ¬ç›®å‰ä¸ºalphaç‰ˆæœ¬,ä¸æ¨èç”¨äºå•†ä¸šç”Ÿäº§ç¯å¢ƒ,æ¨èç”¨äºä¸ªäººé¡¹ç›®</p></blockquote><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>ç”±äºtree-qlæ˜¯ä¸€ä¸ªlaravelçš„æ‰©å±•åŒ…,æ¥ä¸‹æ¥ä¼šä»laravelçš„è§’åº¦è¿›è¡Œåˆ‡å…¥,å®é™…ä¸Šå¦‚æœä½ ç†Ÿæ‚‰ dingo/apiçš„include,ä½ ä¼šæ›´åŠ é€‚åº”è¿™ç§å¼€å‘æ¨¡å¼.</p><h4 id="æˆ‘å¯ä»¥includeä»€ä¹ˆä¸œè¥¿"><a href="#æˆ‘å¯ä»¥includeä»€ä¹ˆä¸œè¥¿" class="headerlink" title="æˆ‘å¯ä»¥includeä»€ä¹ˆä¸œè¥¿?"></a>æˆ‘å¯ä»¥includeä»€ä¹ˆä¸œè¥¿?</h4><p>ç”±äºincludeæ‰€è§å³æ‰€å¾—,å› æ­¤å¯ä»¥æ¢ä¸ªæé—®æ–¹å¼,æˆ‘çš„responseä¸­å¯ä»¥è¿”å›äº›ä»€ä¹ˆæ•°æ®?</p><p>responseä¸­çš„æ•°æ®å¯ä»¥åˆ†ä¸º4ç±», æ—¢ <strong>columns,relations,each,meta.</strong> </p><p>columns æ—¢æˆ‘ä»¬æ•°æ®åº“ä¸­çš„columns, å¦‚ id,name,created_at,updated_atç­‰</p><p>relations æ—¢ormä¸­çš„å…³è”å…³ç³», æ¯”å¦‚postèµ„æºçš„relationæœ‰ä¸€å¯¹ä¸€çš„ user,ä¸€å¯¹å¤šçš„ comments, å…·ä½“çš„å®šä¹‰éƒ½åœ¨laravelçš„modelä¸­å®šä¹‰</p><p>each å¯ä»¥ç†è§£ä¸ºæ²¡æœ‰å­˜å‚¨åœ¨mysqlä¸­,ç”±ç¨‹åºå‘˜è®¡ç®—å¾—æ¥çš„column, å…¶å’Œcolumnæ˜¯å¹³çº§çš„, æ¯”å¦‚ ä¸€ä¸ªuseræ˜¯å¦ç‚¹èµäº†ä¸€ç¯‡post, é‚£ä¹ˆåœ¨æˆ‘ä»¬çš„postçš„responseä¸­å¯èƒ½ä¼šè§åˆ°è¿™æ ·çš„æ•°æ® â†“</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"slug"</span>: <span class="string">"quisquam-asperiores-est-necessitatibus-et."</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Quisquam asperiores est necessitatibus et."</span>,</span><br><span class="line">            <span class="attr">"description"</span>: <span class="string">"Officiis nihil sunt ut veritatis."</span>,</span><br><span class="line">            "is_like": true, // è¯¥å­—æ®µç”±ç¨‹åºå‘˜è®¡ç®—å¾—æ¥, æ²¡æœ‰ä¹Ÿä¸èƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­</span><br><span class="line">    &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"slug"</span>: <span class="string">"quisquam-asperiores-est-necessitatibus-et."</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Quisquam asperiores est necessitatibus et."</span>,</span><br><span class="line">            <span class="attr">"description"</span>: <span class="string">"Officiis nihil sunt ut veritatis."</span>,</span><br><span class="line">            <span class="attr">"is_like"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>meta ç”¨æ¥å­˜å‚¨ä¸€äº›æ— æ³•å­˜å‚¨åœ¨dataä¸­çš„æ•°æ®, æœ€å…¸å‹çš„ä¾‹å­æ—¢åˆ†é¡µä¿¡æ¯ â†“</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">285</span>,</span><br><span class="line">      <span class="attr">"slug"</span>: <span class="string">"repellat-illo-molestias-quidem-ea-autem."</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Repellat illo molestias quidem ea autem."</span>,</span><br><span class="line">      <span class="attr">"description"</span>: <span class="string">"Sed harum."</span>,</span><br><span class="line">      <span class="attr">"cover"</span>: <span class="string">"https://lorempixel.com/640/480/?12347"</span>,</span><br><span class="line">      <span class="attr">"comment_count"</span>: <span class="number">8</span>,</span><br><span class="line">      <span class="attr">"like_count"</span>: <span class="number">14</span>,</span><br><span class="line">      <span class="attr">"user_id"</span>: <span class="number">2023</span></span><br><span class="line">    &#125;,</span><br><span class="line">    // ...</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"meta"</span>: &#123;</span><br><span class="line">    <span class="attr">"pagination"</span>: &#123;</span><br><span class="line">      <span class="attr">"per_page"</span>: <span class="number">15</span>,</span><br><span class="line">      <span class="attr">"total"</span>: <span class="number">300</span>,</span><br><span class="line">      <span class="attr">"current"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">"next"</span>: <span class="string">"http://api.jianshu.test/api/posts?page=2"</span>,</span><br><span class="line">      <span class="attr">"previous"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"last"</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•åœ¨laravelä¸­è¿›è¡Œå®šä¹‰</p><h4 id="Resourceçš„å®šä¹‰"><a href="#Resourceçš„å®šä¹‰" class="headerlink" title="Resourceçš„å®šä¹‰"></a>Resourceçš„å®šä¹‰</h4><p>tree-qlé»˜è®¤ä½¿ç”¨appä¸‹çš„Resourcesç›®å½•, å› æ­¤å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç›®å½•ç»“æ„</p><p><img src="http://asset.eienao.com/20190118180524.png" alt></p><p>æ¥ä¸‹æ¥ä»¥PostResourceä¸ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Resources</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Weiwenhao</span>\<span class="title">TreeQL</span>\<span class="title">Resource</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostResource</span> <span class="keyword">extends</span> <span class="title">Resource</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä»ä¸‹é¢çš„ columns/relations/meta/eachä¸­æŠ½å–å¾—æ¥</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> $default = [</span><br><span class="line">        <span class="string">'id'</span>,</span><br><span class="line">        <span class="string">'slug'</span>,</span><br><span class="line">        <span class="string">'title'</span>,</span><br><span class="line">        <span class="string">'description'</span>,</span><br><span class="line">        <span class="string">'cover'</span>,</span><br><span class="line">        <span class="string">'comment_count'</span>,</span><br><span class="line">        <span class="string">'like_count'</span>,</span><br><span class="line">        <span class="string">'user_id'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $columns = [</span><br><span class="line">        <span class="string">'id'</span>,</span><br><span class="line">        <span class="string">'slug'</span>,</span><br><span class="line">        <span class="string">'title'</span>,</span><br><span class="line">        <span class="string">'description'</span>,</span><br><span class="line">        <span class="string">'cover'</span>,</span><br><span class="line">        <span class="string">'comment_count'</span>,</span><br><span class="line">        <span class="string">'like_count'</span>,</span><br><span class="line">        <span class="string">'user_id'</span>,</span><br><span class="line">        <span class="string">'content'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $relations = [</span><br><span class="line">        <span class="string">'user'</span>,</span><br><span class="line">        <span class="string">'comments'</span>,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $meta = [</span><br><span class="line">        <span class="string">'selected_comments'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $each = [<span class="string">'is_like'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isLike</span><span class="params">($item, $params)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array_random([<span class="keyword">true</span>, <span class="keyword">false</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">selectedComments</span><span class="params">($params)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $post = <span class="keyword">$this</span>-&gt;getCollection()-&gt;first();</span><br><span class="line"></span><br><span class="line">        $comments = $post-&gt;selectedComments;</span><br><span class="line"></span><br><span class="line">        $resource = CommentResource::make($comments, <span class="string">'user,replies.user'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $resource-&gt;getResponseData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Resourceåˆ†ä¸ºä¸¤éƒ¨åˆ†, <strong>ç±»å±æ€§éƒ¨åˆ†</strong>ç”¨æ¥è¿›è¡Œå®šä¹‰,é™¤äº†defaultå¤–,å…¶ä½™éƒ¨åˆ† columns/relations/meta/each ä¸­å®šä¹‰çš„value éƒ½å¯ä»¥åœ¨includeä¸­è¢«å¼•å…¥.</p><p>è€Œdefaultä¸­çš„å®šä¹‰åˆ™æ˜¯ä» columns/relations/meta/each ä¸­å·²ç»å®šä¹‰çš„valueè¿›è¡ŒæŠ½å–,defaultä¸­çš„key,ä¼šè¢«é»˜è®¤includeè¿›æ¥,è€Œä¸éœ€è¦å†urlä¸­æ˜¾å¼çš„å®šä¹‰.</p><p><strong>æ–¹æ³•éƒ¨åˆ†</strong> ç›®å‰çš„ä½œç”¨ä¸»è¦æ˜¯å›è°ƒå‡½æ•°, ä¸”åªæœ‰eachå’Œmetaä¸­å®šä¹‰çš„value éœ€è¦callback. callbackå‘½åçš„è§„åˆ™ä¹Ÿå¾ˆç®€å•, æ—¢å°†metaæˆ–è€…eachä¸­å®šä¹‰çš„å€¼æ”¹ä¸º å°é©¼å³°å‘½å ä½œä¸ºæ–¹æ³•åç§°å³å¯.</p><p>eachçš„callbackæœ‰ä¸¤ä¸ªå‚æ•°,  æ¯ä¸€ä¸ªresourceä¸‹éƒ½æœ‰ä¸€ä¸ªcollectionå±æ€§, å…¶ä¸­å­˜æ”¾äº†è¯¥Resourceä¸‹çš„èµ„æºæ•°æ®, å…¶ç±»å‹ä¸º<code>Illuminate\Database\Eloquent\Collection</code> ,collectionä¸­çš„æ¯ä¸€ä¸ªiteméƒ½ä¼šè¢«callbackä¸€æ¬¡, æ‰€ä»¥ ä¸Šé¢ isLikeçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º Collectionä¸­çš„ä¸€ä¸ªitem, itemæ—¢model </p><blockquote><p>åœ¨Resourceä¸­é€šè¿‡è°ƒç”¨ $this-&gt;getCollection()å¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®</p></blockquote><p>ç”±äºincludeæ”¯æŒparams, æ‰€ä»¥isLikeçš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºincludeä¸­ä¼ é€’çš„params, ç±»å‹ä¸ºarray,æ ¼å¼ä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$params = [</span><br><span class="line">    <span class="string">'sort_by'</span> =&gt; <span class="string">'created_at'</span>,</span><br><span class="line">    <span class="string">'order'</span> =&gt; <span class="string">'desc'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>callback ä¸­ returnçš„å€¼å°†ä¼šåœ¨response dataä¸­è¢«åŸæ ·å±•ç¤º</p><p><strong>å…³äºmeta</strong></p><p>metaä¸åŒäºeach, æ¯ä¸ªinclude metaåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡.ä¸”åªæœ‰ä¸€ä¸ªå‚æ•° æ—¢params. å…¶returnçš„å€¼ä¹Ÿå°†åœ¨response metaä¸­è¢«åŸæ ·å±•ç¤º</p><p>metaçš„å¦ä¸€ä¸ªç‰¹ç‚¹æ—¶,åªæœ‰æœ€å¤–å±‚çš„æ•°æ®ç»“æ„æ‰å­˜åœ¨meta, å³</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    meta: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤å¦‚æœåœ¨æ›´æ·±å±‚æ¬¡çš„resourceä¸­è¿›è¡Œinclude meta é‚£ä¹ˆä¼šäº§ç”Ÿçš„è¡Œä¸ºæ—¶, è¯¥metaæ•°æ®,è¢«æ‹‰åˆ°äº†æœ€å¤–å±‚. ä¸¾ä¸ªä¾‹å­</p><p><code>include=meta1,post.meta2</code>  é‚£ä¹ˆè¿”å›çš„ç»“æœæ˜¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        post: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    meta: &#123;</span><br><span class="line">        meta1: &#123;&#125;,</span><br><span class="line">        meta2: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡Œä¸ºæˆ‘å¹¶ä¸æ˜¯å¾ˆå–œæ¬¢,æ‰€ä»¥åœ¨è€ƒè™‘æ›´åŠ åˆé€‚çš„è§£å†³æ–¹æ¡ˆ</p><p><strong>Columns</strong> ä¸­å®šä¹‰äº†orm selectè¯­å¥ä¸­å¯ä»¥è¢«æŸ¥è¯¢çš„æ•°æ®,æ—¢ç±»ä¼¼è¿™æ ·çš„è¡Œä¸ºä¼šä½¿ç”¨columns</p><p><img src="http://asset.eienao.com/20190121115105.png" alt></p><h4 id="ä½¿ç”¨Resource"><a href="#ä½¿ç”¨Resource" class="headerlink" title="ä½¿ç”¨Resource"></a>ä½¿ç”¨Resource</h4><p>æ¥ä¸‹æ¥çœ‹çœ‹PostControllerçš„indexå’Œshowæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Display a listing of the resource.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Weiwenhao\TreeQL\Resource</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">// $posts = Post::columns()-&gt;latest()-&gt;get(); åŒæ ·æ”¯æŒ</span></span><br><span class="line">       $posts = Post::columns()-&gt;latest()-&gt;paginate();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// ç­‰ä»·äº return PostResource::make($post, request('include'))</span></span><br><span class="line">       <span class="keyword">return</span> PostResource::make($posts);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Display the specified resource.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span>  \App\Models\Post $post</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> \Weiwenhao\TreeQL\Resource</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($post)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> $resource = PostResource::make($post);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä½¿ç”¨éå¸¸çš„ç®€å•, å”¯ä¸€éœ€è¦è®²è§£çš„ä¾¿æ˜¯ columns() è¿™ä¸ªæŸ¥è¯¢æ„é€ å™¨. æˆ‘ä¸å¸Œæœ›Postçš„æŸ¥è¯¢ä¸€ä¸‹æŸ¥è¯¢å‡ºtableä¸­æ‰€æœ‰çš„column,è€Œæ˜¯æ ¹æ®urlä¸­includeè¿›è¡ŒæŸ¥è¯¢. æ‰€ä»¥columns()ä¼šè§£æurlä¸­includeå¹¶ç»“åˆresourceä¸­çš„å®šä¹‰è¿›è¡Œåˆé€‚çš„select.</p><h4 id="includeçš„è¯­æ³•è§„åˆ™"><a href="#includeçš„è¯­æ³•è§„åˆ™" class="headerlink" title="includeçš„è¯­æ³•è§„åˆ™"></a>includeçš„è¯­æ³•è§„åˆ™</h4><p>å·²å®ä¾‹è¿›è¡Œè®²è§£</p><p><code>http://api.test/posts/{slug}?include=user</code>  åŸºç¡€ä½¿ç”¨,åœ¨postçš„åŸºç¡€ä¸Š include è¿™ç¯‡postçš„ä½œè€…</p><p><strong>æˆ‘æƒ³include PostResourceä¸­å®šä¹‰çš„æ›´å¤šçš„ä¸œè¥¿æ€ä¹ˆåŠ?</strong></p><p><code>http://api.test/posts/{slug}?include=user,content,comments</code> ä½¿ç”¨é€—å·è¿›è¡Œåˆ†å‰²</p><p><strong>æˆ‘æƒ³å¼•å…¥commentä¸­çš„useræ€ä¹ˆåŠ?</strong></p><p><code>http://api.test/posts/{slug}?include=user,content,comments.user</code>ä½¿ç”¨<code>.</code>è¿›è¡ŒåµŒå¥—</p><p><strong>æˆ‘æƒ³åŒæ—¶å¼•å…¥commentä¸­çš„userå’Œrepliesæ€ä¹ˆåš?</strong></p><p><code>http://api.test/posts/{slug}?include=user,content,comments{user,replies}</code>  ä½¿ç”¨ <code>{}</code> å’Œ <code>,</code> æ¥ä»£æ›¿<code>.</code>è¯­æ³•è¿›è¡ŒåµŒå¥—</p><blockquote><p>åœ¨dingo/apiä¸­ ä½ å¯èƒ½éœ€è¦è¿™ä¹ˆåš  <code>include=comment.user,comment.replies</code></p></blockquote><p><strong>æˆ‘æƒ³å¯¹includeçš„commentsæ·»åŠ ä¸€äº›æ¡ä»¶æˆ‘åº”è¯¥æ€ä¹ˆåš?</strong></p><p><code>http://api.test/posts/{slug}?include=user,content,comments(sort_by:created_at,order:desc){user,replies}</code>  æ¡ä»¶è¯­æ³•ç´§è·Ÿç€comments, <code>()</code>ä¸­åŒ…å›´çš„æ—¢params,  å½¢å¼ä¸º <code>key1:value1,key2:value2</code></p><blockquote><p>å®é™…ä¸Š ç›®å‰åªæœ‰ eachå’Œmetaæ”¯æŒå›è°ƒ.  åç»­ä¼šå¯¹columnså’Œrelationsæ·»åŠ å›è°ƒ.åˆ°æ—¶paramså°†ä¼šæœ‰æ›´å¼ºå¤§çš„ä½œç”¨</p></blockquote><p><strong>è¿™å°±æ˜¯ includeçš„æ‰€æœ‰è¯­æ³•è§„åˆ™äº†, ç†è®ºä¸Šæ‰€æœ‰çš„è¯­æ³•è§„åˆ™éƒ½æ”¯æŒæ— é™åµŒå¥—ä¸ä»»æ„ç»„åˆ</strong></p><p>æ¯”å¦‚ <code>include=a,b.c.d,c{b},c{b(f:b),a.b.c},c(b.a),c{f,b}.b(a:b).c</code> </p><p><strong>å½“ç„¶æ— è®ºæ€æ ·çš„ç»„åˆåµŒå¥—,ä½ éƒ½æ— éœ€æ‹…å¿ƒn+1çš„é—®é¢˜</strong></p><h2 id="ä¸‹ä¸€æ­¥çš„è®¡åˆ’"><a href="#ä¸‹ä¸€æ­¥çš„è®¡åˆ’" class="headerlink" title="ä¸‹ä¸€æ­¥çš„è®¡åˆ’"></a>ä¸‹ä¸€æ­¥çš„è®¡åˆ’</h2><ul><li><p>ä¸ºcolumn å’Œ relationsæ·»åŠ å›è°ƒ.</p></li><li><p>æ·»åŠ å•å…ƒæµ‹è¯•</p></li><li><p>ä¸ºå®šä¹‰æ·»åŠ ä¸€äº›åŸºç¡€åŠŸèƒ½ æ¯”å¦‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $relations = [</span><br><span class="line">    <span class="string">'user'</span> =&gt; [</span><br><span class="line">        <span class="string">'resource'</span> =&gt; UserResource::class,</span><br><span class="line">        <span class="string">'alias'</span> =&gt; <span class="string">'vip'</span>,</span><br><span class="line">        <span class="string">'builder'</span> =&gt; <span class="function"><span class="keyword">function</span> <span class="params">($builder, $params)</span> </span>&#123;</span><br><span class="line">            $builder-&gt;orderBy($params[<span class="string">'sort_by'</span>], $params[<span class="string">'order'</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'comments'</span> =&gt; [</span><br><span class="line">        <span class="string">'alias'</span> =&gt; <span class="string">'test_comment'</span>,</span><br><span class="line">        <span class="string">'auth'</span> =&gt; <span class="function"><span class="keyword">function</span> <span class="params">($version)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">// or false</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">];</span><br></pre></td></tr></table></figure><blockquote><p>phpå¹¶ä¸æ”¯æŒå›è°ƒå¼çš„å†™æ³•,æ‰€ä»¥éœ€è¦è®¡åˆ’ä¸€ä¸‹è§£å†³æ–¹æ¡ˆ, ä»¥åŠå¼•å…¥å“ªäº›åŸºæœ¬åŠŸèƒ½</p></blockquote></li><li><p>æ·»åŠ ä¸­æ–‡åŠè‹±æ–‡æ–‡æ¡£</p></li></ul><p>å®é™…ä¸Šåœ¨å‡ ä¸ªæœˆå‰,è¯¥é¡¹ç›®å°±åŸºæœ¬å®Œæˆäº†.å—åˆ°å·¥ä½œå½±å“æç½®,æœ€åä¸€ç‚¹æ”¶å°¾å§‹ç»ˆæ— æ³•å®Œæˆ,æˆ‘ä¸æƒ³è¿™ä¸ªé¡¹ç›®ä»˜è¯¸ä¸œæµ,æ‰€ä»¥åœ¨å¹´å‰èµ¶ä¸€æ³¢è¿›åº¦.</p><p>å¸Œæœ›å¤§å®¶å‘è¡¨è‡ªå·±çš„æƒ³æ³•ä¸æ„è§,äº‰å–å°½å¿«å‘å¸ƒ1.0ç‰ˆæœ¬,åœ¨å•†ä¸šé¡¹ç›®ä¸Šæœ‰ç”¨æ­¦ä¹‹åœ°</p><p><a href="https://github.com/weiwenhao/tree-ql" target="_blank" rel="noopener">https://github.com/weiwenhao/tree-ql</a> æ¬¢è¿Star~</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯TreeQL&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯TreeQL&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯TreeQL&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯TreeQL&lt;/h2&gt;&lt;p&gt;tree-ql æ˜¯ä¸€ä¸ªlaravelæ‰©å±•,å¸Œæœ›èƒ½å¤Ÿä»urlä¸­includeä½ æ‰€éœ€çš„èµ„æº,å®ç°æŸ¥è¯¢çš„æ‰€è§æ—¢æ‰€å¾—.&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>E-commerce ä¸­ä¿ƒé”€ç³»ç»Ÿçš„è®¾è®¡</title>
    <link href="http://beian.miit.gov.cn/posts/design-of-promotion-system-in-e-commerce.html"/>
    <id>http://beian.miit.gov.cn/posts/design-of-promotion-system-in-e-commerce.html</id>
    <published>2018-12-26T08:04:20.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ç”µå•†å¹³å°ä¸­,ä¿ƒé”€æ˜¯å¿…ä¸å¯å°‘çš„è¥é”€æ‰‹æ®µ,å°¤å…¶åœ¨å›½å†… å„ç§ç©æ³•å±‚å‡ºä¸ç©·,æœ€å¼€å§‹çš„æ»¡å‡/ç§’æ€ åˆ°ä¼˜æƒ å· å†åˆ° æ‹¼å›¢/ç ä»·ç­‰ç­‰</p><p>ä¸€ä¸ªè‰¯å¥½çš„ä¿ƒé”€ç³»ç»Ÿåº”è¯¥å…·å¤‡æ˜“äºæ‰©å±•,æ˜“äºç»Ÿè®¡ä¿ƒé”€æ•ˆæœç­‰ç‰¹ç‚¹,åœ¨é‡åˆ°ç§’æ€ç±»ä¿ƒé”€æ—¶è¿˜éœ€è¦åšåˆ°å¯æ‰©å®¹,æŠ—å¹¶å‘(æœ¬æ¬¡ä¸è€ƒè™‘ç§’æ€ç³»ç»Ÿçš„è®¾è®¡)ç­‰ç­‰.  åºŸè¯è¯´å®Œäº†,è¿›å…¥æ­£é¢˜å§</p><a id="more"></a><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p><img src="http://asset.eienao.com/18-12-25/96451684.jpg" alt></p><p>å¯¹å„ç§ä¿ƒé”€è¡Œä¸ºè¿›è¡Œåˆ†æ,ä¼šå‘ç°æœ¬è´¨ä¸Šæ˜¯ç”±ä¸¤ä¸ªéƒ¨åˆ†å’Œä¸€ä¸ªä½œç”¨åŸŸç»„æˆ.</p><p><strong>ä¿ƒé”€çš„æ ¸å¿ƒä½œç”¨åŸŸæ—¢è®¢å•</strong>.å› æ­¤æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†ç”µå•†ä¸­è®¢å•ç³»ç»Ÿçš„è®¾è®¡ <a href="https://laravel-china.org/articles/21461" target="_blank" rel="noopener">E-commerce ä¸­è®¢å•ç³»ç»Ÿçš„è®¾è®¡</a></p><p>ä¸¤ä¸ªéƒ¨åˆ†æ—¢ä¸Šå›¾ä¸­çš„ruleå’Œactionéƒ¨åˆ†. </p><p><strong>ruleæè¿°äº†ä¿ƒé”€é™åˆ¶</strong>,æ—¢è®¢å•éœ€è¦æ»¡è¶³é‚£äº›æ¡ä»¶æ‰èƒ½å‚ä¸æŸä¸ªä¿ƒé”€.å¸¸è§çš„ä¿ƒé”€é™åˆ¶æœ‰ è®¢å•é‡‘é¢/è´­ä¹°æ—¶é—´/è´­ä¹°æ•°é‡/æ”¶è´§åœ°å€/æ”¯ä»˜æ–¹å¼/ç”¨æˆ·ç±»å‹/è´­ä¹°äººæ•° ç­‰ç­‰.</p><p><strong>actionæè¿°äº†ç»™äºˆè®¢å•å“ªäº›ä¼˜æƒ ç­–ç•¥</strong> å¦‚æŠ˜æ‰£/ç›´å‡/å…è¿è´¹/è¿”ç°/èµ å“ ç­‰ç­‰.</p><p>è¿™æ ·è®¾è®¡æœ€å¤§å¥½å¤„æ˜¯ <strong>ruleä¸actionç›¸äº’ç‹¬ç«‹ä¸”é«˜åº¦æŠ½è±¡</strong>, è¿è¥äººå‘˜ä¸å¼€å‘äººå‘˜å¯ä»¥<strong>è‡ªç”±ç»„åˆruleå’Œactionæ¥è¾¾åˆ°æœ€å¤§çµæ´»æ€§ä¸å¯æ‰©å±•æ€§</strong></p><h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><h4 id="Promotion"><a href="#Promotion" class="headerlink" title="Promotion"></a>Promotion</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'promotions'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'code'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;string(<span class="string">'name'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;string(<span class="string">'description'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;string(<span class="string">'cover'</span>)-&gt;nullable()-&gt;comment(<span class="string">'ä¿ƒé”€å°é¢'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'asset_url'</span>)-&gt;nullable()-&gt;comment(<span class="string">'ä¿ƒé”€è¯¦æƒ…é“¾æ¥'</span>)</span><br><span class="line"></span><br><span class="line">    $table-&gt;integer(<span class="string">'position'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'æƒé‡'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'type'</span>)-&gt;comment(<span class="string">'ä¼˜æƒ å·/æ»¡å‡ä¿ƒé”€/å“ç‰Œä¿ƒé”€/ç§’æ€/æ‹¼å›¢/é€šç”¨.'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;json(<span class="string">'config'</span>)-&gt;nullable()-&gt;comment(<span class="string">'é…ç½®'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;timestamp(<span class="string">'began_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'ä¿ƒé”€å¼€å§‹æ—¶é—´'</span>);</span><br><span class="line">    $table-&gt;timestamp(<span class="string">'ended_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'ä¿ƒé”€ç»“æŸæ—¶é—´'</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">    $table-&gt;softDeletes();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°è‰¯å¥½çš„ä¿ƒé”€æ•ˆæœç»Ÿè®¡è¡Œä¸º,æ‰€æœ‰çš„ä¿ƒé”€è¡Œä¸ºéƒ½åº”è¯¥å¯¹åº”promotionè¡¨ä¸­çš„ä¸€æ¡è®°å½•.</p><h4 id="Rule"><a href="#Rule" class="headerlink" title="Rule"></a>Rule</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'promotion_rules'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'promotion_id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'type'</span>);</span><br><span class="line">    $table-&gt;json(<span class="string">'config'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line"></span><br><span class="line">    $table-&gt;index(<span class="string">'promotion_id'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„rule typeæœ‰</p><ul><li>è®¢å•æ€»é¢ order_total</li><li>è®¢å•ä¸­ä¿ƒé”€é¡¹ç›®æ€»é¢ promotion_items_total</li><li>ç¬¬Nç¬”è®¢å•  nth_order</li><li>æ‰€å±åˆ†ç±» has_category</li><li>æ¶ˆè´¹è€…ç”¨æˆ·ç»„ customer_group  (ç™½é‡‘ä¼šå‘˜ç»„/é’»çŸ³ä¼šå‘˜ç»„ ç­‰ç­‰)</li><li>è´­ä¹°æ•°é‡  item_quantity </li><li>ç­‰ç­‰</li></ul><h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'promotion_actions'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'promotion_id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'type'</span>);</span><br><span class="line">    $table-&gt;json(<span class="string">'config'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line"></span><br><span class="line">    $table-&gt;index(<span class="string">'promotion_id'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„action typeæœ‰</p><ul><li>è®¢å•å›ºå®šæŠ˜æ‰£ order_fixed_discount</li><li>è®¢å•ç™¾åˆ†æ¯”æŠ˜æ‰£ order_percentage_discount</li><li>è®¢å•ä¸­ä¿ƒé”€é¡¹ç›®å›ºå®šæŠ˜æ‰£ promotion_items_fixed_discount</li><li>è®¢å•ä¸­ä¿ƒé”€é¡¹ç›®é˜¶æ¢¯å¼æŠ˜æ‰£ promotion_items_ladder_discount</li><li>èµ é€ç§¯åˆ† present_integral</li><li>è¿è´¹ç™¾åˆ†æ¯”æŠ˜æ‰£ shipping_percentage_discount</li><li>ç­‰ç­‰</li></ul><blockquote><p>jsonç±»å‹çš„configå­—æ®µçš„çµæ´»åº”ç”¨æ˜¯ä¿ƒé”€ç³»ç»Ÿçµæ´»çš„å¦ä¸€ä¸ªä¸»è¦åŸå› </p><p>å…³äºjsonå­—æ®µçš„ä½¿ç”¨ç»†é¡¹,åŠç´¢å¼•æ–¹å¼ å¯ä»¥å‚è€ƒ  <a href="https://laravel-china.org/articles/20985" target="_blank" rel="noopener">MySQL ä¸­ JSON å­—æ®µçš„ä½¿ç”¨æŠ€å·§</a></p></blockquote><h4 id="PromotionVariant"><a href="#PromotionVariant" class="headerlink" title="PromotionVariant"></a>PromotionVariant</h4><p>åœ¨å¸¸è§çš„ç”µå•†å¹³å°ä¸­,ä¸€ä¸ªä¿ƒé”€æ´»åŠ¨é€šå¸¸ä¸ä¼šæ¶‰åŠæ‰€æœ‰çš„å•†å“, å°¤å…¶æ˜¯ç±»ä¼¼æ·˜å®è¿™ç§B2Cæ¨¡å¼çš„å¹³å°,ä¿ƒé”€é€šå¸¸æ˜¯ä»¥å•†å®¶æŠ¥åçš„å½¢å¼å±•å¼€çš„. å› æ­¤æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªè¡¨æ¥è®°å½• æœ‰å“ªäº›å˜ä½“(variant)å‚ä¸äº†æœ¬æ¬¡ä¿ƒé”€.</p><blockquote><p>å˜ä½“(variant)å³sku, ä¸‹æ–‡å°†ç»Ÿç§°ä¸ºå˜ä½“.</p><p>å¦å¤–ä¸ä»¥productä½œä¸ºå‚ä¸ä¿ƒé”€çš„æœ€å°å•ä½, æ˜¯ä¸ºäº†è¿›è¡Œæ›´ç»†é¢—ç²’åº¦çš„æ§åˆ¶.</p></blockquote><p>ä¸€ä¸ªä¿ƒé”€å¯ä»¥æœ‰å¤šä¸ªå˜ä½“å‚ä¸,ä¸€ä¸ªå˜ä½“å¯ä»¥åŒæ—¶å‚ä¸å¤šä¸ªä¿ƒé”€. å› æ­¤ promotion_variants å®é™…ä¸Šæ˜¯promotionsè¡¨å’Œvariantsè¡¨ä¸­é—´çš„ä¸€å¼ ä¸­é—´è¡¨, å¹¶ä¸”è¿™å¼ ä¸­é—´è¡¨æºå¸¦äº†å…¶ä»–ä¿¡æ¯, æ¥çœ‹çœ‹è¿ç§»æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'promotion_variants'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    </span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'variant_id'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'promotion_id'</span>)-&gt;index();</span><br><span class="line"></span><br><span class="line">    $table-&gt;decimal(<span class="string">'discount_rate'</span>)-&gt;nullable()-&gt;comment(<span class="string">'æŠ˜æ‰£ç‡, å€¼ä¸º0.3è¡¨ç¤ºæ‰“7æŠ˜'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'stock'</span>)-&gt;nullable()-&gt;comment(<span class="string">'ä¿ƒé”€åº“å­˜'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'sold'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'é”€å”®æ•°é‡'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'quantity_limit'</span>)-&gt;nullable()-&gt;comment(<span class="string">'è´­ä¹°æ•°é‡é™åˆ¶'</span>);</span><br><span class="line">$table-&gt;boolean(<span class="string">'enabled'</span>)-&gt;default(<span class="number">1</span>)-&gt;comment(<span class="string">'å¯ç”¨'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†—ä½™</span></span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'product_id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'promotion_type'</span>)-&gt;comment(<span class="string">'å†—ä½™promotionè¡¨type'</span>);</span><br><span class="line">    $table-&gt;json(<span class="string">'rest'</span>)-&gt;nullable()-&gt;comment(<span class="string">'å†—ä½™'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾¿æ˜¯ä¿ƒé”€ç³»ç»Ÿçš„æ ¸å¿ƒè¡¨,æ•°æ®åº“å­—æ®µå¯ä»¥æŒ‰ç…§å®é™…éœ€æ±‚è¿›è¡Œå¢å‡å’Œä¿®æ”¹,ç‰¹æ®Šä¿ƒé”€å¯è‡ªè¡Œæ·»åŠ ç›¸å…³è¡¨, å¦‚ä¼˜æƒ å·ä¿ƒé”€çš„couponsè¡¨, æ‹¼å›¢çš„groupsè¡¨, æŠ¥åä¿ƒé”€çš„promotion_sign_upè¡¨ç­‰ç­‰</p><h2 id="ä¸šåŠ¡è®¾è®¡"><a href="#ä¸šåŠ¡è®¾è®¡" class="headerlink" title="ä¸šåŠ¡è®¾è®¡"></a>ä¸šåŠ¡è®¾è®¡</h2><h4 id="æµç¨‹è®¾è®¡"><a href="#æµç¨‹è®¾è®¡" class="headerlink" title="æµç¨‹è®¾è®¡"></a>æµç¨‹è®¾è®¡</h4><p>ä»¥ä¸€æ¬¡åœ£è¯èŠ‚æ»¡å‡ä¿ƒé”€ä¸ºä¾‹,ç¬¬ä¸€æ­¥çš„å·¥ä½œæ˜¯åˆ›å»ºpromotionå’Œç›¸åº”çš„ruleså’Œactions. æˆ‘ä»¬é¦–å…ˆä¼šæœ‰è¿™æ ·3æ¡è®°å½•</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// promotion</span><br><span class="line">&#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    code: '2018-christmas',</span><br><span class="line">    name: 'åœ£è¯èŠ‚æ»¡å‡å¤§ä¿ƒ',</span><br><span class="line">    type: 'full_discount',</span><br><span class="line">    description: 'ä¿ƒé”€å•†å“æ»¡100å‡10å…ƒ',</span><br><span class="line">    cover: null,</span><br><span class="line">    asset_url: null,</span><br><span class="line">    rest: null,</span><br><span class="line">    config: null,</span><br><span class="line">    position: 0,</span><br><span class="line">    began_at: '2018-12-25 00:00:00',</span><br><span class="line">    ended_at: '2018-12-26 00:00:00'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// rule</span><br><span class="line">&#123;</span><br><span class="line">    'id': 1,</span><br><span class="line">    'promotion_id': 1,</span><br><span class="line">    'type': 'promotion_items_total', // è®¢å•ä¸­ä¿ƒé”€é¡¹æ€»é¢</span><br><span class="line">    'config': &#123;</span><br><span class="line">    'amount' =&gt; 10000, // unit/åˆ† </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// action</span><br><span class="line">&#123;</span><br><span class="line">    'id': 1,</span><br><span class="line">    'promotion_id': 1,</span><br><span class="line">    'type': 'promotion_items_fixed_discount', // è®¢å•ä¸­ä¿ƒé”€é¡¹ å›ºå®šæŠ˜æ‰£</span><br><span class="line">    'config': &#123;</span><br><span class="line">    'amount' =&gt; 1000, // unit/åˆ† </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¿ƒé”€åˆ›å»ºå®Œæˆå,ä¸‹ä¸€æ­¥å°±æ˜¯ç¡®å®šæœ¬æ¬¡ä¿ƒé”€çš„å˜ä½“äº†.</p><p>å¯¹äºè‡ªè¥ç½‘ç«™,ç”±ç½‘ç«™è¿è¥åˆ›å»ºä¿ƒé”€,æŒ‘é€‰å˜ä½“å¹¶æ·»åŠ åˆ°promotion_variantsè¡¨ä¸­.å¯¹äºB2Cå¹³å°,ç”±ç½‘ç«™è¿è¥åˆ›å»ºä¿ƒé”€,å•†å®¶é€‰æ‹©å˜ä½“å¹¶æŠ¥åå‚ä¸æœ¬æ¬¡ä¿ƒé”€,è¿è¥å®¡æ ¸åå°†å…¶æ·»åŠ åˆ°ç›¸åº”çš„promotion_variantsè¡¨ä¸­.</p><p>å½“ä¿ƒé”€çš„å˜ä½“ç¡®å®šå. å¯¹äºæœ‰éœ€è¦çš„ä¿ƒé”€,å¯ä»¥ä¸ºä¿ƒé”€è®¾è®¡èšåˆé¡µé¢/è¯¦æƒ…é¡µ/å®£ä¼ é¡µ/æ¨å¹¿é¡µ,ç„¶åå°†ç›¸åº”çš„é“¾æ¥å’Œå°é¢æ·»åŠ åˆ°promotion.asset_urlå’Œpromotion.coverä¸­ä¿å­˜å³å¯. </p><h4 id="ä»£ç é€»è¾‘"><a href="#ä»£ç é€»è¾‘" class="headerlink" title="ä»£ç é€»è¾‘"></a>ä»£ç é€»è¾‘</h4><p>è®¢å•å¯¹ä¿ƒé”€çš„åˆ¤æ–­çš„é€»è¾‘çš„laravelä¼ªä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¹³å°æ‰€æœ‰æœ‰æ•ˆçš„ä¿ƒé”€</span></span><br><span class="line">$promotions = Promotion::active()-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ruleè¿‡æ»¤promotion</span></span><br><span class="line">$promotions = $promotions-&gt;filter(<span class="function"><span class="keyword">function</span> <span class="params">($promotion)</span> </span>&#123;</span><br><span class="line">    $rules = $promotion-&gt;rules</span><br><span class="line">    $order = <span class="keyword">$this</span>-&gt;getOrder();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤å®šè®¢å•æ˜¯å¦æ»¡è¶³æ‰€æœ‰rule,å½“å­˜åœ¨ä¸€æ¡ruleä¸è¢«è®¢å•æ‰€æ»¡è¶³,åº”è¿”å›false,è¢«è¿‡æ»¤å™¨è¿‡æ»¤æ‰</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºè®¢å•åº”ç”¨action.</span></span><br><span class="line">$promotion-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($promotion)</span> </span>&#123;</span><br><span class="line">    $actions = $promotion-&gt;actions;</span><br><span class="line">    $order = <span class="keyword">$this</span>-&gt;getOrder();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†actionsé€æ¡åº”ç”¨äºè®¢å•</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><strong>ç‰¹åˆ«æ³¨æ„:</strong> å¯¹è®¢å•åº”ç”¨actionså¹¶ä¸æ„å‘³ç€ç›´æ¥ä¿®æ”¹è®¢å•ä¸­çš„å•†å“å•ä»·æˆ–æ”¯ä»˜æ€»é¢ç­‰. è€Œåº”æœ‰æ¡ç†çš„è®°å½•å½±å“è®¢å•æ”¯ä»˜é‡‘é¢çš„è¡Œä¸ºå’ŒåŸå› . æ—¢ä½¿ç”¨ä¸Šä¸€ç¯‡ä¸­æåˆ°çš„adjustmentæ¥è®°å½•  <a href="https://laravel-china.org/articles/21461" target="_blank" rel="noopener">E-commerce ä¸­è®¢å•ç³»ç»Ÿçš„è®¾è®¡</a></p></blockquote><p>å…³äºactionå’Œruleçš„ä»£ç é€»è¾‘å¯ä»¥å…ˆæ¥çœ‹ä¸¤ä¸ªinterface</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Promotion</span>\<span class="title">Constructs</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Checker</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEligible</span><span class="params">(array $configuration)</span>: <span class="title">bool</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Promotion</span>\<span class="title">Constructs</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Action</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">(array $configuration)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸€æ¡ruleçš„è®¾è®¡éƒ½è¦å®ç°ä¸Šé¢çš„ Checkeræ¥å£,æ¯ä¸€æ¡actionéƒ½è¦å®ç°ä¸Šé¢çš„Actionæ¥å£. </p><p>ä»¥ä¸Šé¢çš„åœ£è¯æ»¡å‡ä¿ƒé”€çš„ruleå’Œactionä¸ºä¾‹å­,æ¥çœ‹çœ‹å…·ä½“çš„å®ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Promotion</span>\<span class="title">Checker</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ‰å¾ˆå¤šçš„é€šç”¨æ–¹æ³• å¦‚getOrder,getPromotionOrderItemsç­‰. </span></span><br><span class="line"><span class="comment"> * å› æ­¤æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŸºç±»checkeræ¥å®ç°interfaceå’Œé€šç”¨æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PromotionItemsTotalChecker</span> <span class="keyword">extends</span> <span class="title">Checker</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEligible</span><span class="params">(array $configuration)</span>: <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getPromotionOrderItemsTotal() &gt;= $configuration[<span class="string">'amount'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„ä¸€ç‚¹,ä¸€ç¬”è®¢å•ä¸­å¯èƒ½å­˜åœ¨è®¸å¤šå˜ä½“,ä½†é€šå¸¸æƒ…å†µæ˜¯åªæœ‰éƒ¨åˆ†å˜ä½“å‚åŠ äº†åœ£è¯å¤§ä¿ƒ.å› æ­¤æˆ‘ä»¬è®¡ç®—è´­ç‰©æ€»é¢æ—¶åº”è¯¥ä½¿ç”¨orderä¸­å‚ä¸äº†åœ£è¯ä¿ƒé”€items</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Promotion</span>\<span class="title">Actions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Promotion</span>\<span class="title">Helpers</span>\<span class="title">CreateAdjustment</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Promotion</span>\<span class="title">Helpers</span>\<span class="title">Distribute</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PromotionItemsFixedDiscountAction</span> <span class="keyword">extends</span> <span class="title">Action</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Distribute</span>, <span class="title">CreateAdjustment</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">(array $configuration)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æ»¡å‡çš„é‡‘é¢</span></span><br><span class="line">        $amount = $configuration[<span class="string">'amount'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($amount === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¼å¼æ ¡éªŒ, amountå¦‚æœå°äºè®¢å•é‡‘é¢æ—¶,åˆ™ä½¿ç”¨è®¢å•é‡‘é¢ä½œä¸ºä¼˜æƒ amount</span></span><br><span class="line">        $amount = <span class="number">-1</span> * min(<span class="keyword">$this</span>-&gt;getPromotionOrderItemsTotal(), $amount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($amount === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $items = <span class="keyword">$this</span>-&gt;getPromotionOrderItems();</span><br><span class="line"></span><br><span class="line">        $itemsTotals = [];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> ($items <span class="keyword">as</span> $item) &#123;</span><br><span class="line">            $itemsTotals[] = $item-&gt;total;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿ƒé”€é‡‘é¢ç­‰æ¯”ä¾‹åˆ†é….</span></span><br><span class="line">        $splitAmount = <span class="keyword">$this</span>-&gt;distributeAmountOfItem($itemsTotals, $reduceAmount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºadjustments</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;createUnitsAdjustment($items, <span class="keyword">$this</span>-&gt;getPromotion(), $splitAmount);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯æä¾›æ€è·¯ä¸æƒ³æ³•, å› æ­¤æ²¡æœ‰å¤ªè¿‡å…·ä½“å®Œæ•´çš„ä»£ç .</strong></p><p>æœªæ¥å¦‚æœæœ‰æœºä¼šçš„è¯ä¼šè®¾è®¡ä¸€äº›ä¿ƒé”€ç³»ç»Ÿæ‰©å±•ç­‰æä¾›å‚è€ƒ.</p></blockquote><p>ä¸Šé¢ä¾¿æ˜¯ä¸€ä¸ªä¿ƒé”€ç³»ç»Ÿçš„æµç¨‹æ€è·¯,ä¸‹é¢å¤šæä¾›ä¸€äº›demoä¾›å‚è€ƒ</p><h4 id="ä¼˜æƒ å·"><a href="#ä¼˜æƒ å·" class="headerlink" title="ä¼˜æƒ å·"></a>ä¼˜æƒ å·</h4><p>å·²ä¸€å¼ 10å…ƒä»£é‡‘å·ä¸ºä¾‹,æˆ‘ä»¬ä¼šæœ‰è¿™æ ·ä¸¤æ¡è®°å½•</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// promotion</span><br><span class="line">&#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    code: '10-cash',</span><br><span class="line">    name: '10å…ƒä»£é‡‘åˆ¸',</span><br><span class="line">    type: 'coupon',</span><br><span class="line">    description: 'å…¨åœºå¯ç”¨',</span><br><span class="line">    cover: null,</span><br><span class="line">    asset_url: null,</span><br><span class="line">    config: &#123;</span><br><span class="line">        type: 'cash',</span><br><span class="line">        reduce_amount: 1000, // å†—ä½™è‡ªä¸‹é¢actionä¸­çš„configä¸­çš„amount</span><br><span class="line">        stock: 10000, // åº“å­˜æ•°é‡</span><br><span class="line">        sold: 0, // å·²ç»é¢†å–çš„æ•°é‡</span><br><span class="line">        catch_limit: 1, // é¢†å–é™åˆ¶</span><br><span class="line">        date_type: 'fix_term', // å›ºå®šæœŸé™</span><br><span class="line">        fix_term: 30, // è‡ªé¢†å–æ—¥å†…30å¤©æœ‰æ•ˆ,</span><br><span class="line">        </span><br><span class="line">        // date_type: 'fix_time_range', å›ºå®šæ—¶é—´æ®µ</span><br><span class="line">        // began_at: '2018-12-23 00:00:00',</span><br><span class="line">        // ended_at: '2018-12-25 00:00:00',</span><br><span class="line">    &#125;,</span><br><span class="line">    position: 0,</span><br><span class="line">    began_at: '2018-12-25 00:00:00',</span><br><span class="line">    ended_at: '2018-12-26 00:00:00'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// action</span><br><span class="line">&#123;</span><br><span class="line">    'id': 1,</span><br><span class="line">    'promotion_id': 1,</span><br><span class="line">    'type': 'order_fixed_discount', // è®¢å•ä¸­ä¿ƒé”€é¡¹ å›ºå®šæŠ˜æ‰£</span><br><span class="line">    'config':&#123;</span><br><span class="line">       'amount' =&gt; 1000, // unit/åˆ†  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£é‡‘åˆ¸é€šå¸¸æ²¡æœ‰ä½¿ç”¨é™åˆ¶,å› æ­¤ä¸éœ€è¦rule.</p><p>ä»£é‡‘åˆ¸é€šå¸¸æ˜¯å…¨åœºå¯ç”¨, å› æ­¤actionæˆ‘ä»¬ä½¿ç”¨ order_fixed_discount,è€Œä¸æ˜¯promotion_items_fixed_discount.</p><p>å¯¹äºconfigä¸­çš„é…ç½®é€‚ç”¨äºå„ç§ä¼˜æƒ å·,å¦‚æ»¡å‡å·,è¿è´¹å·ç­‰ç­‰. </p><p>å¯¹äºæ»¡å‡å·çš„é…ç½®åªè¦å†ä¸ºè¿™ç¬”ä¿ƒé”€æ·»åŠ ä¸€ä¸ªç±»å‹ä¸º<code>promotion_items_total</code> (éƒ¨åˆ†å˜ä½“æ»¡å‡)æˆ–è€…<code>order_total</code>(å…¨åœºæ»¡å‡) çš„ruleå³å¯</p><p>ä¼˜æƒ å·ä¿ƒé”€é€šå¸¸è¦åˆ›å»ºä¸€ä¸ª couponsè¡¨æ¥å­˜å‚¨ç”¨æˆ·é¢†å–çš„ä¼˜æƒ å·åŠä½¿ç”¨æƒ…å†µç­‰</p><p>ä¼˜æƒ å·ä¿ƒé”€æœ¬è´¨ä¸Šæ˜¯å°†ä¼ ç»Ÿä¿ƒé”€ä»¥å·çš„å½¢å¼ä½“ç°äº†å‡ºæ¥,æ—¢åœ£è¯æ»¡å‡ä¿ƒé”€ =&gt; åœ£è¯æ»¡å‡å·çš„è½¬æ¢.</p><h4 id="ç§’æ€-ç›´å‡-èšåˆ’ç®—"><a href="#ç§’æ€-ç›´å‡-èšåˆ’ç®—" class="headerlink" title="ç§’æ€/ç›´å‡/èšåˆ’ç®—"></a>ç§’æ€/ç›´å‡/èšåˆ’ç®—</h4><p>ç›´å‡ç±»å‹ä¿ƒé”€é€šå¸¸æ˜¯å·²å˜ä½“ä¸ºå•ä½è¿›è¡Œé«˜æŠ˜æ‰£çš„ä¿ƒé”€è¡Œä¸º,ç§’æ€å…·ä½“è¦æŠ˜æ‰£å¤šå°‘é€šå¸¸ä¸æ˜¯ç»Ÿä¸€è®¾å®šçš„,ä¸åŒçš„å˜ä½“ä¼šæœ‰ä¸åŒçš„æŠ˜æ‰£ç‡,æ‰€ä»¥å¯èƒ½ä¼šæœ‰è¿™æ ·ä¸¤æ¡è®°å½•</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// promotion</span><br><span class="line">&#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    code: 'unit-discount-1290',</span><br><span class="line">    name: '1290æœŸç›´å‡',</span><br><span class="line">    type: 'unit_discount',</span><br><span class="line">    description: null,</span><br><span class="line">    cover: null,</span><br><span class="line">    asset_url: null,</span><br><span class="line">    config: null,</span><br><span class="line">    position: 0,</span><br><span class="line">    began_at: '2018-12-25 00:00:00',</span><br><span class="line">    ended_at: '2018-12-26 00:00:00'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// promotion_variant </span><br><span class="line">&#123;</span><br><span class="line">    'id': 1,</span><br><span class="line">    'variant_id': 1,</span><br><span class="line">    'prootion_id': 1,</span><br><span class="line">    'discount_rate': 0.35,</span><br><span class="line">    'stock': 100, // ç§’æ€åº“å­˜</span><br><span class="line">    'sold': 0,</span><br><span class="line">    'quantity_limit': 1, // é™è´­</span><br><span class="line">    'enabled': 1,</span><br><span class="line">    'product_id': 1,</span><br><span class="line">    'promotion_type': 'unit_discount',</span><br><span class="line">    'rest': &#123;</span><br><span class="line">        variant_name: 'xxx', // ç§’æ€æœŸé—´å˜ä½“åç§°</span><br><span class="line">        image: 'xxx', // ç§’æ€æœŸé—´å˜ä½“å›¾ç‰‡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>promotion_variant ç”±è¿è¥æ·»åŠ æˆ–è€…ä¾›åº”å•†æŠ¥åå¾—åˆ°.ç›´å‡å¹¶æ²¡æœ‰ç›¸åº”çš„rule/actionç»„åˆè€Œæ¥, å±äºç‰¹æ®Šä¿ƒé”€.</p><p>ä½†æ˜¯åœ¨ä»£ç é€»è¾‘ä¸­ä¾æ—§å¯ä»¥æç°å‡ºè¿™ç§ç‰¹æ®Šçš„ruleå’Œaction</p><p>æ—¢<code>UnitDiscountChecker</code>æ¥åˆ¤å®šè®¢å•æ˜¯å¦å¯ä»¥å‚ä¸æœ¬æ¬¡ç§’æ€ä¿ƒé”€,</p><p>é€šè¿‡<code>UnitDicountAction</code>æ¥è®°å½•ç›¸åº”çš„PromotionOrderItemsçš„æŠ˜æ‰£ä¿¡æ¯,æ—¢ä¸‹é¢çš„ä¼ªä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ruleéªŒè¯é˜¶æ®µ</span></span><br><span class="line"><span class="keyword">if</span> ($promotion-&gt;type === <span class="string">'unit_discount'</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> (<span class="keyword">new</span> UnitDiscountChecker)-&gt;isEligible()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº”ç”¨actioné˜¶æ®µ</span></span><br><span class="line"><span class="keyword">if</span> ($promotion-&gt;type === <span class="string">'unit_discount'</span>) &#123;</span><br><span class="line">    (<span class="keyword">new</span> UnitDiscountAction)-&gt;execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é˜¶æ¢¯å¼æ»¡å‡"><a href="#é˜¶æ¢¯å¼æ»¡å‡" class="headerlink" title="é˜¶æ¢¯å¼æ»¡å‡"></a>é˜¶æ¢¯å¼æ»¡å‡</h4><p>é˜¶æ¢¯å¼æ»¡å‡å±äºä¼ ç»Ÿæ»¡å‡ä¿ƒé”€çš„ä¸€ä¸ªå˜ç§.ä¸‹é¢æ˜¯ä¸€ä¸ª æ»¡100 - 10,æ»¡150 - 20,æ»¡200 - 30çš„é˜¶æ¢¯å¼æ»¡å‡çš„actionè®°å½•.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// action</span><br><span class="line">&#123;</span><br><span class="line">    'id': 1,</span><br><span class="line">    'promotion_id': 1,</span><br><span class="line">    'type': 'promotion_items_ladder_discount',</span><br><span class="line">    'config': &#123;</span><br><span class="line">        "ladder": [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"least_amount"</span>: <span class="number">10000</span>,</span><br><span class="line">                <span class="attr">"reduce_amount"</span>: <span class="number">1000</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                "least_amount": 15000, </span><br><span class="line">                "reduce_amount": 2000</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                "least_amount": 20000, </span><br><span class="line">                "reduce_amount": 3000</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„ladderåº”è¯¥ç”±è¿è¥äººå‘˜åå°è®¾å®š,å®é™…ä¸Šå¯¹äºæ¯ä¸€ç§actionå’Œruleçš„type,åœ¨åå°ç®¡ç†ç•Œé¢ä¸­éƒ½åº”è¯¥è®¾ç½®å…¶ç›¸åº”çš„è¡¨å•äº¤äº’</p><h2 id="ç»“"><a href="#ç»“" class="headerlink" title="ç»“"></a>ç»“</h2><p>å¦‚æœä½ æœ‰ç–‘æƒ‘æˆ–è€…æ›´å¤šçš„æƒ³æ³•æ¬¢è¿ç•™è¨€.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ç”µå•†å¹³å°ä¸­,ä¿ƒé”€æ˜¯å¿…ä¸å¯å°‘çš„è¥é”€æ‰‹æ®µ,å°¤å…¶åœ¨å›½å†… å„ç§ç©æ³•å±‚å‡ºä¸ç©·,æœ€å¼€å§‹çš„æ»¡å‡/ç§’æ€ åˆ°ä¼˜æƒ å· å†åˆ° æ‹¼å›¢/ç ä»·ç­‰ç­‰&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè‰¯å¥½çš„ä¿ƒé”€ç³»ç»Ÿåº”è¯¥å…·å¤‡æ˜“äºæ‰©å±•,æ˜“äºç»Ÿè®¡ä¿ƒé”€æ•ˆæœç­‰ç‰¹ç‚¹,åœ¨é‡åˆ°ç§’æ€ç±»ä¿ƒé”€æ—¶è¿˜éœ€è¦åšåˆ°å¯æ‰©å®¹,æŠ—å¹¶å‘(æœ¬æ¬¡ä¸è€ƒè™‘ç§’æ€ç³»ç»Ÿçš„è®¾è®¡)ç­‰ç­‰.  åºŸè¯è¯´å®Œäº†,è¿›å…¥æ­£é¢˜å§&lt;/p&gt;
    
    </summary>
    
    
      <category term="e-commerce promotion laravel" scheme="http://beian.miit.gov.cn/tags/e-commerce-promotion-laravel/"/>
    
  </entry>
  
  <entry>
    <title>E-commerce ä¸­è®¢å•ç³»ç»Ÿçš„è®¾è®¡</title>
    <link href="http://beian.miit.gov.cn/posts/design-of-order-system-in-e-commerce.html"/>
    <id>http://beian.miit.gov.cn/posts/design-of-order-system-in-e-commerce.html</id>
    <published>2018-12-22T10:28:10.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="æ•°æ®åº“è®¾è®¡"><a href="#æ•°æ®åº“è®¾è®¡" class="headerlink" title="æ•°æ®åº“è®¾è®¡"></a>æ•°æ®åº“è®¾è®¡</h2><h4 id="Order"><a href="#Order" class="headerlink" title="Order"></a>Order</h4><p>è®¢å•ç³»ç»Ÿçš„æ ¸å¿ƒè¡¨è‡ªç„¶æ˜¯ <strong>orders</strong>ç³»åˆ—è¡¨,laravelçš„è¿ç§»æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'orders'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'number'</span>)-&gt;nullable()-&gt;comment(<span class="string">'è®¢å•å·'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'address_id'</span>)-&gt;nullable()-&gt;comment(<span class="string">'è®¢å•åœ°å€'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'user_id'</span>)-&gt;index()-&gt;comment(<span class="string">'ç”¨æˆ·id'</span>);</span><br><span class="line">    $table-&gt;integer(<span class="string">'items_total'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'orderæ¯ä¸€ä¸ªitemçš„totalçš„å’Œ unit/åˆ†'</span>);</span><br><span class="line">    $table-&gt;integer(<span class="string">'adjustments_total'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'è°ƒæ•´é‡‘é¢ unit/åˆ†'</span>);</span><br><span class="line">    $table-&gt;integer(<span class="string">'total'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'éœ€æ”¯ä»˜é‡‘é¢ unit/åˆ†'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;string(<span class="string">'local_code'</span>)-&gt;comment(<span class="string">'è¯­è¨€ç¼–å·'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'currency_code'</span>)-&gt;comment(<span class="string">'è´§å¸ç¼–å·'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;string(<span class="string">'state'</span>)-&gt;comment(<span class="string">'ä¸»çŠ¶æ€ checkout/new/cancelled/fulfilled'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'payment_state'</span>)-&gt;comment(<span class="string">'æ”¯ä»˜çŠ¶æ€ checkout/awaiting_payment/partially_paid/cancelled/paid/partially_refunded/refunded'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'shipment_state'</span>)-&gt;comment(<span class="string">'è¿è¾“çŠ¶æ€ checkout/ready/cancelled/partially_shipped/shipped'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;ipAddress(<span class="string">'user_ip'</span>)-&gt;comment(<span class="string">'ç”¨æˆ·ip ip2longåçš„ç»“æœ'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;timestamp(<span class="string">'paid_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'æ”¯ä»˜æ—¶é—´'</span>);</span><br><span class="line">    $table-&gt;timestamp(<span class="string">'confirmed_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'ç¡®è®¤è®¢å•æ—¶é—´'</span>);</span><br><span class="line">    $table-&gt;timestamp(<span class="string">'reviewed_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'è¯„è®ºæ—¶é—´'</span>);</span><br><span class="line">    $table-&gt;timestamp(<span class="string">'fulfilled_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'è®¢å•å®Œæˆæ—¶é—´'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;json(<span class="string">'rest'</span>)-&gt;nullable()-&gt;comment(<span class="string">'éæ ¸å¿ƒå­—æ®µå†—ä½™'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯<strong>order_items</strong>è¡¨,ç”¨äºè®°å½•orderçš„item</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'order_items'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'order_id'</span>)-&gt;index()-&gt;comment(<span class="string">'å¤–é”®'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'variant_id'</span>)-&gt;comment(<span class="string">'variantæ˜¯å›½å¤–çš„ç§°å‘¼,å›½å†…é€šå¸¸ç§°ä¸ºsku. æ—¢åº“å­˜æœ€å°å•ä½'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'product_id'</span>)-&gt;comment(<span class="string">'å†—ä½™å­—æ®µ'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'quantity'</span>)-&gt;comment(<span class="string">'è´­ä¹°æ•°é‡'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// adjustment calculate</span></span><br><span class="line">    $table-&gt;integer(<span class="string">'units_total'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'itemä¸­æ¯ä¸€ä¸ªunitçš„å’Œ. å•ä½/åˆ†'</span>);</span><br><span class="line">    $table-&gt;integer(<span class="string">'adjustments_total'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;integer(<span class="string">'total'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'units_total + adjustments_total'</span>);</span><br><span class="line">    $table-&gt;integer(<span class="string">'unit_price'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'variantå•ä»·,å†—ä½™å­—æ®µ'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;json(<span class="string">'rest'</span>)-&gt;nullable()-&gt;comment(<span class="string">'éæ ¸å¿ƒå­—æ®µå†—ä½™'</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>åšè¿‡æµ·å¤–ç”µå•†æˆ–è€…äºšé©¬é€Šçš„æœ‹å‹åº”è¯¥å¯¹variant(å˜ä½“)ä¸é™Œç”Ÿ. å›½å†…ç§°ä¸ºsku. æ¯ä¸€ä¸ªå•†å“éƒ½ä¼šæœ‰å¤šä¸ªå˜ä½“</p></blockquote><p>æ¥ä¸‹æ¥æ˜¯<strong>order_item_units</strong> è¡¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'order_item_units'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'item_id'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'shipment_id'</span>)-&gt;comment();</span><br><span class="line">    $table-&gt;integer(<span class="string">'adjustments_total'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯¹äºç”¨æˆ·è´­ä¹°çš„æ¯ä¸€ä»¶å®ä½“,æˆ‘ä»¬éƒ½éœ€è¦è°¨æ…çš„åšä¸€æ¡è®°å½•,å…¶ä¼šæ¶‰åŠåˆ°è¿è¾“/ä¿ƒé”€/é€€è´§ç­‰é—®é¢˜, ä¾‹å¦‚variantAæˆ‘ä»¬è´­ä¹°äº†ä¸‰ä»¶,é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸ºè¿™ä¸‰ä»¶ç›¸åŒçš„å˜ä½“åˆ†åˆ«åˆ›å»ºä¸‰æ¡è®°å½•.</p><p>ä¸Šé¢ä¸‰å¼ è¡¨çš„å…³ç³»ä»ä¸Šå¾€ä¸‹ ä¸€ä¸ªorderä¼šæœ‰å¤šä¸ªitem,ä¸€ä¸ªitemæ ¹æ®quantityçš„å€¼,ä¼šæœ‰å¯¹åº”æ•°é‡çš„unit. </p><blockquote><p> orderå’Œorder_itemè¡¨å¤§å®¶åº”è¯¥éƒ½çŸ¥é“. </p><p>order_item_unitsè¡¨å¯èƒ½æœ‰äº›åŒå­¦ç¬¬ä¸€æ¬¡çŸ¥é“,ä½†æ˜¯å…¶æ˜¯å¿…è¦å­˜åœ¨çš„</p></blockquote><p><em>tip: æ‰€æœ‰çš„ä»·æ ¼å­—æ®µéƒ½ä½¿ç”¨åˆ†ä¸ºå•ä½å­˜å‚¨,ä»è€Œé¿å…å°æ•°åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­å­˜åœ¨çš„ä¸€äº›é—®é¢˜</em></p><p>å¯ä»¥æ¶ˆåŒ–æ¢³ç†ä¸€ä¸‹ä¸Šé¢çš„ä¸‰å¼ è®¢å•ç³»ç»Ÿæ ¸å¿ƒè¡¨,ç„¶åå†ä»‹ç»ä¸€ä¸‹å…¶ä»–ç›¸å…³è¡¨çš„è®¾è®¡. æ•°æ®åº“çš„è®¾è®¡åº”è¯¥æ˜¯çµæ´»çš„,å¯ä»¥æ ¹æ®å®é™…çš„éœ€æ±‚ä»»æ„æ·»åŠ å’Œä¿®æ”¹å­—æ®µ</p><h4 id="Adjustment"><a href="#Adjustment" class="headerlink" title="Adjustment"></a>Adjustment</h4><p>ä¸Šé¢ä¸‰å¼ è¡¨éƒ½å‡ºç°äº†adjustment_totalå­—æ®µ,å¯èƒ½ä¼šæœ‰äº›ç–‘æƒ‘.</p><p>å¦‚æœæˆ‘ä»¬æ¯ä¸ªå˜ä½“çš„ä»·æ ¼æ˜¯10å…ƒ,é‚£æˆ‘ä¹°ä¸‰ä¸ªè¿™ä»¶å˜ä½“åˆ™éœ€è¦30å…ƒ,ä½†æ˜¯å®é™…æ”¯ä»˜çš„é‡‘é¢å¾€å¾€éƒ½ä¸æ˜¯30å…ƒ.,ä¼šæœ‰å„ç§å„æ ·çš„æƒ…å†µå½±å“æˆ‘ä»¬æœ€ç»ˆæ”¯ä»˜çš„ä»·æ ¼.</p><p>æ¯”å¦‚è¿è´¹+5å…ƒ,ä¿ƒé”€æŠ˜æ‰£ -8å…ƒ,ç¨æ”¶+3å…ƒ,é€€è¿˜æœåŠ¡ +0.5å…ƒ,æœ€åå®é™…éœ€è¦æ”¯ä»˜ 35.5å…ƒ.  ä¸ºä»€ä¹ˆ30å…ƒçš„é‡‘é¢æœ€åå´æ”¯ä»˜äº†35.5å…ƒ?</p><p>æˆ‘ä»¬ä¸èƒ½å‡­ç©ºè¹¦å‡ºä¸ª35.5å…ƒ,å½±å“å•†å“å®é™…æ”¯ä»˜é‡‘é¢çš„æ¯ä¸€ä¸ªå› ç´ éƒ½æ˜¯è‡³å…³é‡è¦,æˆ‘ä»¬éœ€è¦è´Ÿè´£ä»»çš„è®°å½•ä¸‹æ¥.è¿™ä¾¿æ˜¯adjustmentè¡¨çš„æ¥æº.</p><p>é¦–å…ˆçœ‹çœ‹è¿ç§»æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'adjustments'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'order_id'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'order_item_id'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'order_item_unit_id'</span>)-&gt;nullable();</span><br><span class="line"></span><br><span class="line">    $table-&gt;string(<span class="string">'type'</span>)-&gt;comment(<span class="string">'è°ƒæ•´çš„ç±»å‹ shipping/promotion/taxç­‰ç­‰'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;string(<span class="string">'label'</span>)-&gt;comment(<span class="string">'ç»“åˆtypeå†³å®š'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;string(<span class="string">'origin_code'</span>)-&gt;comment(<span class="string">'ç»“åˆlabelå†³å®š'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;bool(<span class="string">'included'</span>)-&gt;comment(<span class="string">'æ˜¯å¦ä¼šå½±å“æœ€ç»ˆè®¢å•éœ€è¦æ”¯ä»˜çš„ä»·æ ¼'</span>)</span><br><span class="line">        $table-&gt;integer(<span class="string">'amount'</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line"></span><br><span class="line">    $table-&gt;index(<span class="string">'order_id'</span>);</span><br><span class="line">    $table-&gt;index(<span class="string">'order_item_id'</span>);</span><br><span class="line">    $table-&gt;index(<span class="string">'order_item_unit_id'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è°ƒæ•´å¯¹è®¢å•ä»·æ ¼çš„å½±å“åˆ†ä¸ºä¸‰ç§ç±»å‹, åˆ†åˆ«æ˜¯ å½±å“æ•´ä¸ªorder, å½±å“order_item(è¾ƒå°‘é¢„è§),å½±å“order_item_units. </p><blockquote><p>includedå­—æ®µ ç”¨æ¥åˆ¤æ–­æœ¬æ¡adjustmentè®°å½•,æ˜¯å¦ä¼šå½±å“æ¶ˆè´¹è€…æœ€ç»ˆéœ€è¦æ”¯ä»˜çš„é‡‘é¢</p><p>å¤§éƒ¨åˆ†çš„adjustmentéƒ½ä¼šå½±å“æœ€ç»ˆç»“ç®—çš„ä»·æ ¼, å°éƒ¨åˆ†å¦‚å•†å“ç¨,é€šå¸¸å·²ç»è®¡ç®—åœ¨äº†å•†å“çš„å•ä»·ä¸­, ä¸ä¼šå½±å“æ¶ˆè´¹è€…æœ€ç»ˆéœ€è¦æ”¯ä»˜çš„é‡‘é¢.ä½†æ˜¯åœ¨å¼€å…·å‘ç¥¨æ—¶ å´éœ€è¦å±•ç¤º,å› ä¸ºæˆ‘ä»¬åšå¿…è¦çš„è®°å½•</p></blockquote><p>ä¸¾ä¸ªä¾‹å­, å‡è®¾æˆ‘ä»¬ä¸€ç¬”è®¢å•çš„è¿è´¹æ˜¯5å…ƒ,é‚£ä¹ˆä¼šæœ‰è¿™æ ·ä¸€æ¡adjustmentè®°å½•</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    order_id: 1,</span><br><span class="line">    order_item_id: null,</span><br><span class="line">    order_item_unit_id: null,</span><br><span class="line">    amount: 500,</span><br><span class="line">    type: 'shipping',</span><br><span class="line">    label: 'UPS',</span><br><span class="line">    origin_code: null,</span><br><span class="line">    included: 1,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬æ¶ˆè´¹è€…åœ¨ä¸€ä¸ªè®¢å•ä¸­è´­ä¹°äº†ä¸‰æ¡1.5ç±³æ•°æ®çº¿,å¹¶ä½¿ç”¨äº†ä¸€å¼ 8å…ƒçš„ä»£é‡‘åˆ¸,é‚£ä¹ˆä¼šæœ‰è¿™æ ·ä¸‰æ¡adjustmentè®°å½•</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        order_id: null,</span><br><span class="line">        order_item_id: null,</span><br><span class="line">        order_item_unit_id: 1,</span><br><span class="line">        amount: -267,</span><br><span class="line">        type: 'promotion',</span><br><span class="line">        label: '8å…ƒä»£é‡‘åˆ¸',</span><br><span class="line">        origin_code: 'KSDI12K2', // ä»£é‡‘åˆ¸code</span><br><span class="line">        included: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        order_id: null,</span><br><span class="line">        order_item_id: null,</span><br><span class="line">        order_item_unit_id: 2,</span><br><span class="line">        amount: -267,</span><br><span class="line">        type: 'promotion',</span><br><span class="line">        label: '8å…ƒä»£é‡‘åˆ¸',</span><br><span class="line">        origin_code: 'KSDI12K2', // ä»£é‡‘åˆ¸code</span><br><span class="line">        included: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        order_id: null,</span><br><span class="line">        order_item_id: null,</span><br><span class="line">        order_item_unit_id: 3,</span><br><span class="line">        amount: -266,</span><br><span class="line">        type: 'promotion',</span><br><span class="line">        label: '8å…ƒä»£é‡‘åˆ¸',</span><br><span class="line">        origin_code: 'KSDI12K2', // ä»£é‡‘åˆ¸code</span><br><span class="line">        included: 1</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå¯¹äºå¤§éƒ¨åˆ†çš„ä¿ƒé”€éœ€æ±‚ æˆ‘ä»¬éƒ½åº”è¯¥å°†ä¿ƒé”€çš„æŠ˜æ‰£é‡‘é¢å‡åˆ†åˆ°æ¯ä¸€ä¸ªunitä¸­.</p><p>è¿™æ ·è®¾è®¡çš„ä¸€ä¸ªå¥½å¤„æ˜¯,å½“æ¶ˆè´¹è€…é€€è°ƒç”¨å…¶ä¸­ä¸€æ ¹æ•°æ®çº¿æ—¶,æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„è®¡ç®—å‡ºåº”è¯¥é€€å¤šå°‘é‡‘é¢ç»™æ¶ˆè´¹è€…. æ—¢ <code>å•ä»· + order_item_unit.adjustment</code></p><p>å®é™…ä¸Šæ¸…æ¥šçš„è®°å½•æ¯ä¸€ç¬”å½±å“æœ€ç»ˆæ”¯ä»˜é‡‘é¢çš„adjustment,æ— è®ºå¯¹æ¶ˆè´¹è€…è¿˜æ˜¯å¯¹ä¾›åº”å•†æ¥è¯´éƒ½æ˜¯è´Ÿè´£çš„åšæ³•.</p><blockquote><p> è¿è´¹ä¸ºä»€ä¹ˆä¸éœ€è¦åˆ†æ‘Šåˆ°unit?</p><p>è¿è´¹å¯¹äºä¸€ç¬”è®¢å•æ¥è¯´,æ˜¯å›ºå®šçš„å¤–éƒ¨æ¶ˆè´¹(ç”±å¿«é€’å…¬å¸è·åˆ©),é€€æ¬¾æ—¶å•†å®¶å¹¶ä¸éœ€è¦ä¸ºè¿è´¹è´Ÿè´£, åªéœ€è¦é€€è¿˜å•†å“çš„ç­‰é¢ä»·å€¼å³å¯</p><p>æ›´åŠ ç™½è¯çš„è¯´æ³•å°±æ˜¯ ä½ åœ¨æ·˜å®ä¹°äº†ä¸€ä¸ªå•†å“20å…ƒ,è¿è´¹10å…ƒ, ä½ è§‰å¾—å•†å“ä¸å¥½æƒ³è¦é€€è´§(ä¸è€ƒè™‘å¯„å›çš„è¿è´¹), å•†å®¶éœ€è¦é€€ä½ 30å…ƒå—?</p></blockquote><h4 id="Shipment-Payment"><a href="#Shipment-Payment" class="headerlink" title="Shipment/Payment"></a>Shipment/Payment</h4><p>shipmentä¸ºè®¢å•çš„è¿è¾“ä¿¡æ¯å­˜å‚¨,paymentä¸ºæ”¯ä»˜ä¿¡æ¯å­˜å‚¨.å…ˆæ¥çœ‹çœ‹è¿ç§»æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'shipments'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'method_id'</span>)-&gt;comment(<span class="string">'è¿è¾“æ–¹å¼ å¤–é”®'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'order_id'</span>)-&gt;comment(<span class="string">'è®¢å• å¤–é”®'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'state'</span>)-&gt;comment(<span class="string">'è¿è¾“çŠ¶æ€'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'tracking_number'</span>)-&gt;nullable()-&gt;comment(<span class="string">'è®¢å•å·ç '</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line"></span><br><span class="line">    $table-&gt;index(<span class="string">'order_id'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'payments'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'method_id'</span>)-&gt;comment(<span class="string">'æ”¯ä»˜æ–¹å¼'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'order_id'</span>);<span class="number">7</span></span><br><span class="line">    $table-&gt;string(<span class="string">'currency_code'</span>, <span class="number">3</span>)-&gt;comment(<span class="string">'å†—ä½™ è´§å¸ç¼–ç '</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'amount'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'æ”¯ä»˜é‡‘é¢'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'state'</span>);</span><br><span class="line">    $table-&gt;text(<span class="string">'details'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line"></span><br><span class="line">    $table-&gt;index(<span class="string">'order_id'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åœ¨order_item_unitsè¡¨ä¸­å­˜åœ¨ä¸€ä¸ªshipment_id å°±å¯¹åº”è¿™é‡Œçš„shipmentè¡¨. shipmentå’Œorder_item_unitsä¹‹é—´æ˜¯<strong>ä¸€å¯¹å¤š</strong>çš„å…³ç³»,è®¢å•ä¸­çš„æ¯ä¸€ä¸ªå®ä½“éƒ½å¯ä»¥è¢«åˆ†åˆ«è¿è¾“,ä¾‹å¦‚äº¬ä¸œè´­ç‰©æ—¶ç»å¸¸ä¼šè§åˆ°è¿™ç§æƒ…å†µ. </p><p><strong>ä¸€æ¡shipment/payment ä¼šå’Œä¸€æ¡å®é™…å­˜åœ¨çš„è´§è¿è®°å½•/æ”¯ä»˜è®°å½•(é€€æ¬¾è®°å½•) æŒ‚é’©.</strong></p><p>ä¸Šé¢å°±æ˜¯è®¢å•ç³»ç»Ÿçš„æ ¸å¿ƒè¡¨äº†,å¯¹äºåç«¯æ¥è¯´,æ•°æ®åº“å°±å·²ç»å¯ä»¥åæ˜ å‡ºæ•´ä¸ªç³»ç»Ÿçš„è®¾è®¡äº†.</p><p>æ¥ä¸‹æ¥æŠ½å‡ºä¸€äº›ç»†èŠ‚è¿›è¡Œè¯¦ç»†çš„ä»‹ç»</p><h2 id="ä¸šåŠ¡è®¾è®¡"><a href="#ä¸šåŠ¡è®¾è®¡" class="headerlink" title="ä¸šåŠ¡è®¾è®¡"></a>ä¸šåŠ¡è®¾è®¡</h2><h4 id="çŠ¶æ€çš„è®¾è®¡"><a href="#çŠ¶æ€çš„è®¾è®¡" class="headerlink" title="çŠ¶æ€çš„è®¾è®¡"></a>çŠ¶æ€çš„è®¾è®¡</h4><p>ç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´åœ¨åšè®¢å•ç³»ç»Ÿæ—¶ä¼šè¢«å„ç§çŠ¶æ€ å¾…ç¡®è®¤,å¾…æ”¯ä»˜,å¾…å‘è´§,å·²å‘è´§,å…³é—­è®¢å• ç­‰ç­‰å¼„çš„æ™•å¤´è½¬å‘,ä»Šå¤©æˆ‘ä»¬å°±æ¥æ¢³ç†ä¸€ä¸‹è®¢å•ç³»ç»Ÿä¸­çš„å„ç§çŠ¶æ€</p><p>å¦‚æœå„ç§çŠ¶æ€åªåœ¨orderè¡¨ä½¿ç”¨ä¸€ä¸ªstateå­—æ®µæ¥è®°å½•æ˜¾å¾—æœ‰äº›åŠ›ä¸ä»å¿ƒ,å› æ­¤æ¨èä½¿ç”¨ä¸‰ä¸ªå­—æ®µ,å®ƒä»¬åˆ†åˆ«æ˜¯ <strong>state,shipment_state,payment_state.</strong> æ¥åˆ†åˆ«è®°å½•åœ¨è®¢å•ä¸­æˆ‘ä»¬æˆ–è€…æ¶ˆè´¹è€…æœ€å…³å¿ƒçš„ä¸‰ç§çŠ¶æ€. </p><p>å…ˆæ¥åˆ†åˆ«çœ‹çœ‹ä¸‰ä¸ªstateçš„çŠ¶æ€è½¬ç§»å›¾</p><p><strong>order.stateâ†“</strong></p><p><img src="http://asset.eienao.com/18-12-22/78777487.jpg" alt></p><p>è¿™æ˜¯ä¸€ç¬”è®¢å•çš„å‡ ä¸ªæœ€åŸºæœ¬çš„å‡ ä¸ªçŠ¶æ€. </p><p>å…ˆè®²ä¸€è®²åˆå§‹çŠ¶æ€,æ—¢ checkout, è¿™ä¸è®¢å•åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºæœ‰å…³ç³»,å½“æ¶ˆè´¹è€…åœ¨è´­ç‰©è½¦ç‚¹å‡»ç»“è´¦æ—¶,å°±åˆ›å»ºäº†ä¸€ä¸ªè®¢å•,ç”¨äºæœ¬æ¬¡ç»“è´¦, å› æ­¤è®¢å•çš„åˆå§‹çŠ¶æ€ä¸ºcheckout</p><blockquote><p>ç»“è´¦ä¹Ÿå°±æ˜¯æ‰€è°“çš„ç¡®è®¤è®¢å•é¡µ,åœ¨è¯¥é¡µé¢ä¸­,æ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©ä¼˜æƒ åˆ¸,é€‰æ‹©åœ°å€ç­‰æ“ä½œ</p></blockquote><p>å¤„äºè¯¥çŠ¶æ€çš„è®¢å•å¯¹äºåå°ç®¡ç†ç³»ç»Ÿ/ç”¨æˆ·ä¸ªäººä¸­å¿ƒéƒ½æ˜¯ä¸å¯è§çš„,ä¸”checkoutç±»å‹è®¢å•çš„åˆ›å»º,ä¹Ÿä¸ä¼šæ˜¯åº“å­˜æœ‰ä»»ä½•çš„å˜åŒ–</p><p>å½“ç”¨æˆ·åœ¨ç»“è´¦ç•Œé¢æ“ä½œå®Œæˆåéœ€è¦ç”¨æˆ·ç‚¹å‡»ç¡®è®¤è®¢å•. æ—¢è¡Œä¸º <strong>confirm</strong>çš„è§¦å‘,ä½¿è®¢å•çš„çŠ¶æ€ä»checkoutè½¬æ¢æˆäº†new. æ­¤æ—¶çš„è®¢å•æ— è®ºæ˜¯å¯¹äºæ¶ˆè´¹è€…/è¿è¥äººå‘˜/ä»“å‚¨ç³»ç»Ÿæ¥è¯´,éƒ½æ˜¯çœŸå®å­˜åœ¨ä¸”æœ‰æ•ˆçš„. ä¸”å“åº”çš„è´­ç‰©è½¦è®°å½•ä¹Ÿè¢«æ¸…ç©º. å¯¹äºä¸€ç¬”çŠ¶æ€ä¸ºnewçš„è®¢å•,æ¶ˆè´¹è€…å¯ä»¥å¯¹å…¶è¡Œä½¿ä»˜æ¬¾çš„æƒåˆ©. </p><p><strong>order.payment_stateâ†“</strong></p><p><img src="http://asset.eienao.com/18-12-22/4209529.jpg" alt></p><p>paymentçš„åˆå§‹çŠ¶æ€ä¸ºcheckoutä¸ä¸Šè¿°ä¸€è‡´.</p><p>å½“æ¶ˆè´¹è€…è§¦å‘confirmå, æˆ‘ä»¬å°±å¯ä»¥è§¦å‘request_paymentè¡Œä¸º,å°†è®¢å•çš„ä»˜æ¬¾çŠ¶æ€è½¬æ¢ä¸º await_payment, ä¸”å°†æ¶ˆè´¹è€…å¼•å¯¼åˆ°æ”¯ä»˜ç•Œé¢, å½“æ¶ˆè´¹è€…æ”¯ä»˜æˆåŠŸå,åœ¨æ”¯ä»˜æˆåŠŸçš„å›è°ƒä¸­,è§¦å‘payè¡Œä¸º,å°†æ”¯ä»˜çŠ¶æ€è½¬æ¢ä¸ºpaid.</p><p>å…³äºé€€æ¬¾çš„çŠ¶æ€å¦‚ä¸Šå›¾æ‰€ç¤º,éœ€è¦æ³¨æ„çš„æ˜¯,å¯¹äºé€€æ¬¾,ä¼šå‡ºç°åªéœ€è¦é€€è®¢å•ä¸­çš„éƒ¨åˆ†å•†å“çš„æƒ…å†µ,å› æ­¤åŠ å…¥äº† partially_refunded(éƒ¨åˆ†é€€æ¬¾çš„çŠ¶æ€). </p><p><strong>order.shipment_stateâ†“</strong></p><p><img src="http://asset.eienao.com/18-12-22/15354759.jpg" alt></p><p>å½“æ¶ˆè´¹è€…confirmå, æˆ‘ä»¬åŒæ—¶ä¹Ÿéœ€è¦è°ƒç”¨å“åº”çš„request_shipment,å°†æˆ‘ä»¬çš„è¿è¾“çŠ¶æ€è®¾ç½®ä¸ºä¸€ä¸ªreadyçŠ¶æ€,æ­¤æ—¶åº“å­˜å·²ç»é”å®š.</p><blockquote><p>å…³äºä»“åº“å…·ä½“çš„å¤‡è´§æ—¶æœº æ˜¯åœ¨ç”¨æˆ·ç¡®è®¤è®¢å•ä¹‹å,è¿˜æ˜¯ç­‰ç”¨æˆ·æ”¯ä»˜å®Œæˆä¹‹å,éœ€è¦æ ¹æ®å®é™…çš„äº§å“éœ€æ±‚ç¡®å®š.</p><p>ä¸Šé¢çš„çŠ¶æ€å›¾å±äºå‰è€…,å½“æ¶ˆè´¹è€…ç¡®è®¤è®¢å•å,ä¾¿é”å®šäº†åº“å­˜,å¹¶å¼€å§‹äº†å¤‡è´§é˜¶æ®µ.å¦‚æœæ˜¯åä¸€ç§æƒ…å†µå¯ä»¥å°†checkoutä¿®æ”¹ä¸ºpending,ç­‰å¾…æ¶ˆè´¹è€…ä»˜æ¬¾å®Œæˆåå†å°†çŠ¶æ€è½¬ç§»åˆ°ready</p></blockquote><p><strong>å¯¹äºä¸Šé¢ç¹æ‚çš„çŠ¶æ€è½¬æ¢,å¯ä»¥æ‰‹åŠ¨å¤„ç†,ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨<a href="https://github.com/weiwenhao/state-machine" target="_blank" rel="noopener">state-machine</a> è¿›è¡Œå¤„ç†</strong></p><h4 id="è®¢å•ä»·æ ¼çš„è®¡ç®—"><a href="#è®¢å•ä»·æ ¼çš„è®¡ç®—" class="headerlink" title="è®¢å•ä»·æ ¼çš„è®¡ç®—"></a>è®¢å•ä»·æ ¼çš„è®¡ç®—</h4><p>å•ä»·ä½œä¸ºä¸€ä»¶å•†å“çš„å›ºæœ‰å±æ€§,ä¸ä¼šå—åˆ°è¿è¾“/ä¿ƒé”€æŠ˜æ‰£ç­‰ç­‰å› ç´ çš„å½±å“. å½“å•†å®¶å¯¹ä¸€ä¸ªä»·å€¼100å…ƒå•†å“è¿›è¡Œä¸€ä¸ª30%çš„æŠ˜æ‰£æ—¶,æ¶ˆè´¹è€…åªéœ€è¦ç”¨70å…ƒçš„ä»·æ ¼ä¹°å…¥, ä½†å®é™…ä¸Šå•†å“çš„å•ä»·ä¾æ—§æ˜¯100å…ƒ.</p><p>å½“ä¸€ç¬”è®¢å•ä¸å­˜åœ¨ä»»ä½•çš„adjustmentæ—¶,æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„è®¡ç®—å‡ºè®¢å•çš„å®é™…æ”¯ä»˜ä»·æ ¼, åªéœ€è¦æŠŠå„ä¸ªorder_itemçš„unit_price * quantity ç›¸åŠ èµ·æ¥å³å¯</p><p>ä½†æ˜¯æœ‰äº†adjustmentå‚ä¸ä¹‹å,æˆ‘ä»¬å¿…é¡»è‡ªä¸‹å¾€ä¸Šçš„è®¡ç®—. ä¸‹é¢çš„ä¾‹å­æ˜¯åœ¨laravelé¡¹ç›®ä¸”ä½¿ç”¨äº†ä¸Šè¿°çš„æ•°æ®åº“è®¾è®¡åçš„ä¸€ä¸ªè®¡ç®—æ–¹æ³•.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calculator</span><span class="params">(Order $order)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $items = $order-&gt;items;</span><br><span class="line">    $items-&gt;load(<span class="string">'adjustments'</span>, <span class="string">'units.adjustments'</span>);</span><br><span class="line">    $order-&gt;load(<span class="string">'adjustments'</span>);</span><br><span class="line"></span><br><span class="line">    $items-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($item)</span> </span>&#123;</span><br><span class="line">        $item-&gt;units-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($unit)</span> </span>&#123;</span><br><span class="line">            $unit-&gt;adjustments_total = $unit-&gt;adjustments-&gt;sum(<span class="string">'amount'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        $item-&gt;units()-&gt;saveMany($item-&gt;units);</span><br><span class="line"></span><br><span class="line">        $item-&gt;adjustments_total = $item-&gt;adjustments-&gt;sum(<span class="string">'amount'</span>);</span><br><span class="line"></span><br><span class="line">        $item-&gt;units_total = $item-&gt;quantity * $item-&gt;unit_price + $item-&gt;units-&gt;sum(<span class="string">'adjustments_total'</span>);</span><br><span class="line"></span><br><span class="line">        $item-&gt;total = $item-&gt;units_total + $item-&gt;adjustments_total;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $order-&gt;items()-&gt;saveMany($items);</span><br><span class="line"></span><br><span class="line">    $order-&gt;adjustments_total = $order-&gt;adjustments-&gt;sum(<span class="string">'amount'</span>);</span><br><span class="line">    $order-&gt;items_total = $order-&gt;items-&gt;sum(<span class="string">'total'</span>);</span><br><span class="line">    $order-&gt;total = $order-&gt;items_total + $order-&gt;adjustments_total;</span><br><span class="line">    $order-&gt;save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><ol><li><p>å½“è®¢å•åˆ›å»ºçš„åŒæ—¶(ç»“è´¦é˜¶æ®µ)å°±åˆ†åˆ«åˆ›å»ºäº†ä¸€æ¡payment/å’Œshipmentè®°å½•.åœ¨paymentå’Œshipmentä¸­åˆ†åˆ«è®°å½•äº†ç”¨æˆ·é€‰æ‹©çš„æ”¯ä»˜æ–¹å¼ä¸è¿è¾“æ–¹å¼.</p><p>åœ¨ç”µå•†ç³»ç»Ÿä¸­,é€šå¸¸ä¼šæœ‰å¤šç§å¤šæ ·çš„æ”¯ä»˜æ–¹å¼å’Œè¿è¾“æ–¹å¼.</p><p>ä½†æ˜¯åœ¨å®é™…çš„ä¸šåŠ¡ç¼–å†™æ—¶,ä¸šåŠ¡å±‚å¹¶ä¸å¸Œæœ›å…³å¿ƒå’Œå¤„ç†ç¹æ‚çš„æ”¯ä»˜ä¸è¿è¾“æ–¹å¼,æ­¤æ—¶æ”¯ä»˜ç½‘å…³å’Œè¿è¾“ç½‘å…³ä¾¿åº”è¿è€Œç”Ÿ,å…¶å¯¹ä¸šåŠ¡å±‚éšè—äº†ç¹æ‚çš„ç»†èŠ‚,è€Œæš´éœ²å‡ºäº†ç»Ÿä¸€çš„apiæ¥å£.</p><p>æ”¯ä»˜ç½‘å…³å¦‚æä¾›å•†ä¸šæœåŠ¡çš„ ping++,å½“ç„¶ä¹Ÿæœ‰ä¸€äº›å¼€æºé¡¹ç›®å¯¹è¿™æ–¹é¢æœ‰æ‰€æ”¯æŒ. å¦‚ <a href="https://github.com/yansongda/pay" target="_blank" rel="noopener">yansongda/pay</a> , <a href="https://github.com/Payum/Payum" target="_blank" rel="noopener">Payum/Payum</a>ç­‰ç­‰</p></li><li><p>å¯¹äºç¡®è®¤äº†ä½†è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ä»˜æ¬¾çš„è®¢å•,æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸»åŠ¨å…³é—­è¯¥è®¢å•. å°†order.state/order.payment_state/order.shipment_state è®¾ç½®ä¸ºcancelled,å¹¶å¯¹åº“å­˜è¿›è¡Œå½’è¿˜ç­‰ç³»åˆ—æ“ä½œ</p></li></ol><p>ä¸‹ä¸€ç¯‡å°†ä¼šä»‹ç»ä¿ƒé”€ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°,æœ¬ç¯‡çš„ä¸»è¦ç›®çš„æ˜¯ä»‹ç»è®¢å•ç³»ç»Ÿçš„ç›¸å…³è®¾è®¡,ä¸ºä¸‹ä¸€ç¯‡åšä¸€ä¸ªé“ºå«. </p><p>ç”±äºç¯‡å¹…æœ‰é™å¹¶æ²¡æœ‰è¿‡å¤šçš„ç»†èŠ‚,æœ‰ç–‘é—®æˆ–è€…ä¸å¦¥çš„åœ°æ–¹æ¬¢è¿ç•™è¨€.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;æ•°æ®åº“è®¾è®¡&quot;&gt;&lt;a href=&quot;#æ•°æ®åº“è®¾è®¡&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®åº“è®¾è®¡&quot;&gt;&lt;/a&gt;æ•°æ®åº“è®¾è®¡&lt;/h2&gt;&lt;h4 id=&quot;Order&quot;&gt;&lt;a href=&quot;#Order&quot; class=&quot;head
      
    
    </summary>
    
    
      <category term="e-commerce order laravel" scheme="http://beian.miit.gov.cn/tags/e-commerce-order-laravel/"/>
    
  </entry>
  
  <entry>
    <title>Vue å·¥ç¨‹åŒ–æœ€ä½³å®è·µ</title>
    <link href="http://beian.miit.gov.cn/posts/vue-engineering-best-practices.html"/>
    <id>http://beian.miit.gov.cn/posts/vue-engineering-best-practices.html</id>
    <published>2018-12-14T03:49:27.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p>æ€»è§ˆ</p><p><img src="http://asset.eienao.com/20181214113352.png" alt></p><ul><li><p>apiç›®å½•ç”¨äºå­˜æ”¾ apiè¯·æ±‚,æ–‡ä»¶åä¸æ¨¡å‹åç§°åŸºæœ¬ä¸€è‡´,æ–‡ä»¶åä½¿ç”¨å°é©¼å³°, æ–¹æ³•åç§°ä¸åç«¯restfulæ§åˆ¶å™¨ä¸€è‡´.</p><ul><li><img src="http://asset.eienao.com/20181214113459.png" alt></li></ul></li><li><p>enums ç›®å½•å­˜æ”¾ å¸¸é‡, ä¸åç«¯çš„å¸¸é‡ç›®å½•å¯¹åº”</p><ul><li><img src="http://asset.eienao.com/20181214113531.png" alt></li></ul></li><li><p>iconsç›®å½•ç”¨äºå­˜æ”¾å›¾æ ‡, element-uiæä¾›çš„å›¾æ ‡å®åœ¨æ˜¯å¤ªå°‘å•¦.æ‰€ä»¥æˆ‘é€šå¸¸ä¼šä½¿ç”¨ é˜¿é‡Œçš„iconfont</p></li><li>langç›®å½•å­˜æ”¾å¤šè¯­è¨€</li><li>layoutsç›®å½•å­˜æ”¾å¸ƒå±€<ul><li><img src="http://asset.eienao.com/20181214114528.png" alt></li><li>ä¸Šé¢å±•ç¤ºçš„æ˜¯ä¸€ä¸ªåå°ç³»ç»Ÿ, emptyä¸ºä¸€ä¸ªç©ºå¸ƒå±€.ç”¨äºç™»å½•é¡µé¢, å…¶ä»–é¡µé¢åˆ™ä½¿ç”¨defaultå¸ƒå±€. å¸ƒå±€ä¸éœ€è¦è¿‡å¤šä»‹ç»,å†™è¿‡laravel bladeéƒ½å¾ˆç†Ÿæ‚‰äº†.è¿™é‡Œçš„å¸ƒå±€éœ€è¦å’Œvue-routeré…åˆä½¿ç”¨</li></ul></li><li>mixins ç±»ä¼¼phpçš„trait, ä½†æ˜¯å®ƒæ›´å¼ºå¤§, å®Œæ•´è´´åˆvueç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</li><li><p>plugins ç›®å½•å­˜æ”¾æ’ä»¶é…ç½®, æ¯”å¦‚ axios,vue-lazyç­‰ (è¿™æ˜¯ä»nuxtä¸­å­¦åˆ°çš„æ¦‚å¿µ)</p><ul><li><img src="http://asset.eienao.com/20181214114547.png" alt></li></ul></li><li><p>routerç›®å½•å­˜æ”¾ä¸ å‰ç«¯è·¯ç”±ç›¸å…³çš„é…ç½®,æ€»ä½“æ¥è¯´ç±»ä¼¼äºlaravelçš„apiå±‚</p></li><li><p>store ç›®å½•å³vuexçš„ç›®å½•, ç±»ä¼¼äºå‰ç«¯çš„model. å…¶æ–‡ä»¶ä¸åç«¯modelç›¸åŒ¹é…,é‡‡ç”¨å°é©¼å³°å‘½å</p><ul><li><img src="http://asset.eienao.com/20181214114609.png" alt></li></ul></li><li><p>utils ç›®å½•å­˜æ”¾è¾…åŠ©å‡½æ•°</p></li><li>views ä¸ºä¸šåŠ¡è§†å›¾å±‚,ç›¸ä¿¡åç«¯åŒå­¦ä¹Ÿå¾ˆç†Ÿæ‚‰.å…¶ç”±vue-routerç›´æ¥è°ƒåº¦</li><li>main.js ä¸ºappçš„å…¥å£, ç±»ä¼¼äºåç«¯çš„index.php</li><li>components ç›®å½•, å­˜æ”¾ç»„ä»¶.é€šå¸¸æ˜¯ä¸€äº›å¯å¤ç”¨çš„ç»„ä»¶ä¼šå•ç‹¬å­˜æ”¾åœ¨è¯¥ç›®å½•</li></ul><p>æ€»ä½“æ¥è¯´, å·²åç«¯çš„mvcæ€æƒ³æ¥çœ‹ç°ä»£çš„å‰ç«¯é¡¹ç›®æ˜¯éå¸¸çš„è‡ªç„¶çš„. åç«¯çš„modelå¯¹åº”å‰ç«¯çš„store, åç«¯çš„routerå¯¹åº”å‰ç«¯çš„router,åç«¯çš„controller + views å¯¹åº”å‰ç«¯çš„views.</p><h3 id="åŸºç¡€è§„èŒƒ"><a href="#åŸºç¡€è§„èŒƒ" class="headerlink" title="åŸºç¡€è§„èŒƒ"></a>åŸºç¡€è§„èŒƒ</h3><p> å°±ç›®å‰æ¥è¯´ vueé¡¹ç›®å¾ˆå°‘ç”¨åˆ° class, å› æ­¤ .jsæ–‡ä»¶é€šå¸¸éƒ½æ˜¯ä¸€ä¸ª module, æ‰€ä»¥æ–‡ä»¶åä½¿ç”¨å°é©¼å³°çš„å½¢å¼å‘½å. å¦‚æœæœ‰ç±»æ–‡ä»¶,åˆ™ç±»æ–‡ä»¶ä½¿ç”¨å¤§é©¼å³°çš„å½¢å¼å‘½å.</p><p>.vueæ–‡ä»¶ å¯ä»¥ä½¿ç”¨ ä¸­åˆ’çº¿å’Œå¤§é©¼å³°ä¸¤ç§å‘½åæ–¹å¼, å‚è€ƒäº†element/iview/nuxté¡¹ç›®ä¹‹å, æ¨èç»Ÿä¸€ä½¿ç”¨ä¸­åˆ’çº¿å‘½å.</p><p>æ‰€æœ‰çš„æ–‡ä»¶å¤¹åç§°ç»Ÿä¸€ä½¿ç”¨ä¸­åˆ’çº¿å‘½å</p><blockquote><p>å¼•å…¥vueç»„ä»¶æ—¶æ–‡ä»¶æ—¶éœ€è¦è½¬æ¢æˆå¤§é©¼å³°<code>import &#39;TestTest&#39; from &#39;@/components/test-test&#39;</code></p><p>åœ¨template ä½¿ç”¨æ—¶ä¾æ—§ä½¿ç”¨ä¸­åˆ’çº¿</p><p><code>&lt;test-test /&gt;</code></p></blockquote><p>å…¶ä»–è§„èŒƒå¦‚å˜é‡å‘½åå’Œä½¿ç”¨è§„èŒƒ ä½¿ç”¨eslintçš„standard å³å¯å¾ˆå¥½çš„è§£å†³.</p><p>å‰ç«¯å­˜åœ¨å¾ˆå¤šçš„äº‹ä»¶ å¦‚change/input/upload/sumitç­‰ç­‰,ç›¸åº”çš„å¤„ç†æ¨èä½¿ç”¨ handle + äº‹ä»¶åç§°, å¦‚<code>handleChange</code></p><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>vue-router è§£æå½“å‰ç”¨æˆ·é”®å…¥çš„ url, ç„¶ååŒ¹é…åˆé€‚çš„è§†å›¾ç»„ä»¶åŠ è½½. </p><p>ç€é‡ä»‹ç»ä¸€ä¸‹ æˆ‘å¯¹viewsç›®å½•ä¸‹çš„è§†å›¾ç»„ä»¶çš„ç†è§£,å·²ä¿®æ”¹åœ°å€ä¸ºä¾‹</p><p><img src="http://asset.eienao.com/20181214114635.png" alt></p><p>scriptéƒ¨åˆ†æ—¢æ§åˆ¶å™¨éƒ¨åˆ†,å…¶è¯·æ±‚æ•°æ®, ç„¶åæ³¨å…¥åˆ°view ä¸­, å°±åƒåç«¯çš„mvcä¸€æ ·.åªä¸è¿‡vueå°† vc å…¶å†™å…¥åˆ°äº†ä¸€ä¸ªæ–‡ä»¶ä¸­.è¿™æ ·ç†è§£å¯¹äºå†™è¿‡åç«¯çš„åŒå­¦æ˜¾å¾—æ›´åŠ çš„è‡ªç„¶</p><h5 id="æ§åˆ¶å™¨å¦‚ä½•è·å–æ•°æ®"><a href="#æ§åˆ¶å™¨å¦‚ä½•è·å–æ•°æ®" class="headerlink" title="æ§åˆ¶å™¨å¦‚ä½•è·å–æ•°æ®?"></a>æ§åˆ¶å™¨å¦‚ä½•è·å–æ•°æ®?</h5><p>åœ¨è¿‡å»çš„vueé¡¹ç›®ä¸­,æˆ‘ä»¬å¯èƒ½ä¼šè§åˆ°è¿™æ ·çš„å†™æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ... views/address/edit.vue</span></span><br><span class="line">created () &#123;</span><br><span class="line">    axios.get(<span class="string">'/addresses/1'</span>)</span><br><span class="line">        .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">this</span>.list = resposne.data              </span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•æ— å¼‚äºåç«¯åœ¨æ§åˆ¶å™¨ä¸­å†™sqlè¯­å¥ä¸€æ ·,åœ¨å·¥ç¨‹åŒ–å®è·µä¸­ä¸æ¨èè¿™ä¹ˆåš,åç«¯é€šè¿‡modelæ¥è·å–æ•°æ®ä¼šæ›´åŠ çš„ä¼˜é›…è‡ªç„¶.åœ¨vueé¡¹ç›®ä¸­, modelæ—¢vuex,å› æ­¤æ¨èè¿™ä¹ˆåš</p><blockquote><p>å¦‚æœä½ å¯¹æˆ‘è¯´çš„ä¸œè¥¿ä¸€è„¸æ‡µé€¼, é‚£ä¹ˆä½ å¯ä»¥çœ‹ä¸€ä¸‹ vuexçš„æ–‡æ¡£. æˆ‘ç°åœ¨åšçš„å°±æ˜¯ç”¨åç«¯ç†Ÿæ‚‰çš„æ¦‚å¿µ,æ¥æè¿°å‰ç«¯é¡¹ç›®çš„æœ€ä½³å®è·µ</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ... views/address/edit.vue æ§åˆ¶å™¨+è§†å›¾</span></span><br><span class="line">computed: &#123;</span><br><span class="line">    address: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.$store.address.itemBy[<span class="number">1</span>] <span class="comment">// ä»storeæ¨¡å‹ä¸­å–å‡ºæˆ‘ä»¬æƒ³è¦æ•°æ®</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ... store/modules/address.js  æ•°æ®æº</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        itemBy: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h5 id="storeä¸­çš„æ•°æ®ä»å“ªé‡Œæ¥"><a href="#storeä¸­çš„æ•°æ®ä»å“ªé‡Œæ¥" class="headerlink" title="storeä¸­çš„æ•°æ®ä»å“ªé‡Œæ¥?"></a>storeä¸­çš„æ•°æ®ä»å“ªé‡Œæ¥?</h5><p>æ•°æ®å½“ç„¶æ˜¯ä»åç«¯çš„æ•°æ®åº“ä¸­è·å–,æˆ‘ä»¬ä¸èƒ½è®©å‰ç«¯ç›´æ¥è®¿é—®æˆ‘ä»¬çš„æ•°æ®åº“,å› æ­¤æˆ‘ä»¬ä¼šæä¾›apiè®©å‰ç«¯è®¿é—®.storeä¸­å­˜åœ¨ä¸€ä¸ªå‘èµ·apiè¯·æ±‚çš„åœ°æ–¹,æ—¢ action.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ... store/modules/address.js  æ¨¡å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        itemBy: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        <span class="keyword">async</span> fetchItem(&#123; commit, state &#125;, &#123; id &#125;) &#123;</span><br><span class="line">             <span class="comment">// å¯¹axioså’Œapiè¿›è¡Œäº†ç®€å•çš„å°è£…,ä½¿apiè¯·æ±‚æ›´åŠ è¯­ä¹‰åŒ–</span></span><br><span class="line">            cosnt &#123; data &#125; = <span class="keyword">await</span> address.show(id)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// actionåªèƒ½é€šè¿‡æäº¤commitæ¥ä¿®æ”¹state,å…·ä½“åŸå› è¯·æŸ¥çœ‹vuexæ–‡æ¡£ (å…¶å®æˆ‘ä¹Ÿå¿˜äº†ä¸ºå•¥ (â•¯ï¹â•°))</span></span><br><span class="line">            commit(<span class="string">'SET_ITEM'</span>, data) </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        SET_ITEM: <span class="function">(<span class="params">state, item</span>) =&gt;</span> &#123;</span><br><span class="line">            state.itemBy[item.id] = item</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬çš„æ¨¡å‹ä¸­å°±æœ‰æ•°æ®å•¦</p><h5 id="ä»€ä¹ˆæ—¶å€™å»è°ƒç”¨fetchItemå»è¯·æ±‚åç«¯å‘¢"><a href="#ä»€ä¹ˆæ—¶å€™å»è°ƒç”¨fetchItemå»è¯·æ±‚åç«¯å‘¢" class="headerlink" title="ä»€ä¹ˆæ—¶å€™å»è°ƒç”¨fetchItemå»è¯·æ±‚åç«¯å‘¢?"></a>ä»€ä¹ˆæ—¶å€™å»è°ƒç”¨<code>fetchItem</code>å»è¯·æ±‚åç«¯å‘¢?</h5><blockquote><p><a href="https://router.vuejs.org/zh/guide/advanced/data-fetching.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/advanced/data-fetching.html</a> vue-routeræ–‡æ¡£çš„è§£ç­”</p></blockquote><p>è¿™é‡Œä¸æ¨èåœ¨vueåŸå§‹çš„ç”Ÿå‘½å‘¨æœŸä¸­å»è°ƒç”¨åˆå§‹åŒ–è¯·æ±‚,å¯èƒ½ä¼šå¸¦æ¥ æ•°æ®è¿˜æ²¡æœ‰è·å–åˆ°,templateå´å·²ç»è¢«æ¸²æŸ“.ä¼šé€ æˆä¸€äº›æ•°æ®ä¸å­˜åœ¨çš„å¼‚å¸¸,æ¨èåœ¨vue-routerçš„ç”Ÿå‘½å‘¨æœŸä¸­å»è¯·æ±‚æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ... views/address/edit.vue</span></span><br><span class="line"><span class="keyword">async</span> beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// ç­‰å¾…æ¨¡å‹æ•°æ®åŠ è½½å®Œæ¯•,æ‰ç»§ç»­è¿›è¡Œvueç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    <span class="keyword">await</span> store.dispatch(<span class="string">'fetchItem'</span>, to.params.id) </span><br><span class="line">    </span><br><span class="line">    next()</span><br><span class="line">&#125;</span><br><span class="line">created () &#123;</span><br><span class="line">    <span class="comment">// ä¸æ¨èåœ¨è¿™é‡Œè°ƒç”¨ fetchItem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä½ å¯èƒ½å‘ç°,è¿™å’Œä½ å¹³æ—¶å†™çš„vueæœ‰äº›ä¸ä¸€æ ·, æ²¡æœ‰ç±»ä¼¼ <code>this.data = response.data</code> è¿™ç§æ“ä½œ. ç±»ä¼¼è¿™ç§æ“ä½œå…¶å®ç±»ä¼¼èµ‹å€¼æ“ä½œ,æˆ–è€…ç§°ä¸ºå‰¯ä½œç”¨,å…¶å¼•å…¥äº†æ—¶é—´çš„æ¦‚å¿µ,ä½¿æ•°æ®çš„ç®¡ç†å˜çš„å¤æ‚. ç›´è§‚çš„ä½“ç°å°±æ˜¯æˆ‘ä»¬å¯èƒ½ä¼šæœ‰è¿™ç§å¤šä½™çš„ <code>if(data)</code>åˆ¤æ–­.</p><p>å½“ç„¶å‰¯ä½œç”¨æ˜¯éš¾ä»¥é¿å…çš„,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€çš„ç®¡ç†ä»–ä»¬.ç±»ä¼¼ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€å¥—æˆ‘è§‰å¾—è¿˜ä¸é”™çš„æ–¹æ³•.ä»viewçš„è§’åº¦çœ‹, æ•°æ®æ˜¯å›ºæœ‰å­˜åœ¨å­˜åœ¨çš„,å…¶ä¸éœ€è¦å…³å¿ƒæ˜¯å¦æ˜¯å¦å·²ç»è¢«åŠ è½½å®Œæ¯•,ä¸”storeä¸­çš„ä¸å¯è¢«viewä¿®æ”¹,æ—¢æ•°æ®åªèƒ½å•å‘æµåŠ¨</p><p>åœ¨storeä¸­ç»Ÿä¸€ç®¡ç†æ•°æ®çš„å¦å¤–ä¸€ä¸ªå¥½å¤„å°±æ˜¯æ–¹ä¾¿æŒä¹…åŒ–</p><h5 id="viewå±‚å¦‚ä½•ä¿®æ”¹æ•°æ®æº"><a href="#viewå±‚å¦‚ä½•ä¿®æ”¹æ•°æ®æº" class="headerlink" title="viewå±‚å¦‚ä½•ä¿®æ”¹æ•°æ®æº?"></a>viewå±‚å¦‚ä½•ä¿®æ”¹æ•°æ®æº?</h5><p>ä¸Šé¢çš„æè¿°å®é™…ä¸Šè¡¨è¾¾äº†ä¸€ç§ å‘å¸ƒä¸è®¢é˜…çš„æ¨¡å¼, ä»storeåˆ°viewçš„æ•°æ®æµæ˜¯ä¸¥æ ¼å•å‘æ•°æ®æµåŠ¨.</p><p>viewå±‚ä¸å…è®¸ç›´æ¥ä¿®æ”¹storeä¸­çš„æ•°æ®,ä½†æ˜¯viewå±‚å´å¯ä»¥é€šè¿‡å‘é€actionæ¥å½±å“æ•°æ®æº. </p><p>æ¯”å¦‚åˆå§‹åŒ–æ—¶çš„dispatchçš„action,å„ç§eventè§¦å‘çš„dispatch. å½“æ•°æ®æºå‘ç”Ÿæ”¹å˜æ—¶,ä½œä¸ºè®¢é˜…è€…çš„viewå±‚ä¼šéå¸¸è‡ªç„¶çš„é‡æ–°æ¸²æŸ“.</p><blockquote><p>è¿™ç§è®¾è®¡å’Œçˆ¶å­ç»„ä»¶ç±»ä¼¼,vueä¸­å­ç»„ä»¶ä¸å…è®¸ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶propsåˆ°å­ç»„ä»¶çš„æ•°æ®,åªèƒ½é€šè¿‡å‘çˆ¶ç»„ä»¶emit event. åœ¨viewå’Œstoreä¹‹é—´,è¿™ç§è®¾è®¡ä¾ç„¶åˆç†.</p><p>è¿™ä¹Ÿæ„å‘³ç€åº”ç”¨ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½éµå¾ªç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ ·å¯ä»¥è®©åº”ç”¨å˜å¾—æ›´åŠ å¯é¢„æµ‹ä¸”å®¹æ˜“ç†è§£ã€‚</p></blockquote><p><img src="http://asset.eienao.com/20181214114653.png" alt></p><p>ä¸Šé¢çš„å›¾å¾ˆå¥½çš„é˜è¿°äº†è¿™ç§å¼€å‘æ¨¡å¼.  å¼•è‡ª <a href="https://github.com/sorrycc/blog/issues/1" target="_blank" rel="noopener">https://github.com/sorrycc/blog/issues/1</a></p><h3 id="viewå±‚å†æ·±å…¥"><a href="#viewå±‚å†æ·±å…¥" class="headerlink" title="viewå±‚å†æ·±å…¥"></a>viewå±‚å†æ·±å…¥</h3><p>viewå±‚çš„scriptéƒ¨åˆ†,é™¤äº†å……å½“äº†ä¼ ç»Ÿçš„controller,èµ·åˆ°åˆå§‹åŒ–çš„ä½œç”¨å¤–,å®é™…ä¸Šè¿˜åšäº†æ›´å¤šçš„äº‹æƒ…. </p><p>å…ˆä»dataéƒ¨åˆ†è¯´èµ·,åœ¨viewå±‚ä¼šæœ‰ä¸€äº›çŠ¶æ€éœ€è¦è®°å½•, å¦‚ èœå•çš„å±•å¼€æˆ–æ”¶èµ·, å¼¹çª—çš„å¼¹å‡ºä¸å…³é—­. å¯¹äºè¿™æ ·çš„çŠ¶æ€çš„ç®¡ç†,ä¸€ç§åšæ³•å°±æ˜¯å°†å­˜å‚¨åœ¨dataéƒ¨åˆ†.</p><blockquote><p>ä¹Ÿæœ‰äººå°†æ‰€æœ‰çš„çŠ¶æ€ ä¹Ÿæ”¾åœ¨ storeä¸­çš„stateç»´æŠ¤. æ—¢stateåˆ†ä¸ºçŠ¶æ€å’Œæ•°æ® ä¸¤ç§ç±»å‹.</p></blockquote><p>viewå±‚çš„scriptæ›´é‡è¦çš„éƒ¨åˆ†,æ˜¯å…¶åˆ°äº†ä¸€ä¸ªäº¤äº’åé¦ˆçš„ä½œç”¨, æ—¢ç±»ä¼¼ä¸‹é¢çš„ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button @click=&quot;handleSubmit&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data: &#123;&#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleSubmit() &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å…³äºcsséƒ¨åˆ†,ç”±äºä¸ªäººä¸äº†è§£css,ä¹Ÿä¸æ¸…æ¥šcssçš„ä¸šç•Œè§„èŒƒåŠåœ¨vueä¸Šçš„æœ€ä½³å®è·µ,å› æ­¤ä¸åšè¿‡å¤šä»‹ç».</p><h3 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h3><p>åœ¨å‰é¢çš„ä»‹ç»ä¸­, storeå’Œapi ç›®å½•æ˜¯å’Œæ•°æ®æŒ‚é’©çš„,å½“æ•°æ®åº“å®šä¸‹æ¥,è¿™ä¸€éƒ¨åˆ†ä¹Ÿå°±å®šäº†ä¸‹æ¥.</p><p> views/components å’Œä¸šåŠ¡(ui)æŒ‚é’©,éœ€è¦ç­‰è®¾è®¡ç¨¿ç¡®å®šå,è¿™ä¸€éƒ¨åˆ†æ‰èƒ½ç¡®å®šä¸‹æ¥.</p><blockquote><p>PSè®¾è®¡ç¨¿çš„å›¾å±‚é€šå¸¸å°±æ˜¯ç»„ä»¶çš„æ‹†åˆ†è§„èŒƒ ?<br>ä½¿ç”¨vuexå­˜å‚¨æ•°æ®çš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯å¯ä»¥æ— ç¼çš„åˆ‡æ¢åˆ°ssræ¡†æ¶nuxt</p></blockquote><p>viewså’Œstoreä¹‹é—´æ˜¯ä¸€ç§è®¢é˜…å’Œå‘å¸ƒçš„æ¨¡å¼.</p><h4 id="ä¸¤ä¸ªé—®é¢˜"><a href="#ä¸¤ä¸ªé—®é¢˜" class="headerlink" title="ä¸¤ä¸ªé—®é¢˜"></a>ä¸¤ä¸ªé—®é¢˜</h4><p><strong>storeä¸­çš„stateåº”è¯¥å¦‚ä½•ç»„ç»‡?</strong> å¯¹äºapiè¯·æ±‚,æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„jsonæ•°æ®</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// post</span><br><span class="line">&#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    title: xxxx,</span><br><span class="line">    content: xxxx,</span><br><span class="line">    user: &#123;</span><br><span class="line">        id: xxx,</span><br><span class="line">        nickname: xxx,</span><br><span class="line">        avatar: xxx,</span><br><span class="line">    &#125;,</span><br><span class="line">    comments: [</span><br><span class="line">        &#123;</span><br><span class="line">            id: xxx,</span><br><span class="line">            user_id: xxx,</span><br><span class="line">            content: xxx,</span><br><span class="line">            user: &#123;</span><br><span class="line">                // ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            //....</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ•°æ®ç»“æ„å¤æ‚,åµŒå¥—æ·±å…¥.  å¦‚æœæˆ‘ä»¬å°†ä»–ä»¬ä¸€è‚¡è„‘çš„å­˜åœ¨ postçš„stateä¸­,ä¼šé€ æˆæ•°æ®è¿‡äºé›†ä¸­,å†—ä½™. commentsæ— æ³•ç‹¬ç«‹åŒ–æ›´æ–°ç­‰ç­‰é—®é¢˜.  ä½¿å¾—å‰ç«¯ scheme/orm,æ•°æ®ç»„ç»‡çš„è§„èŒƒåŒ–å˜çš„è¿«åˆ‡éœ€è¦</p><p>ä½†æ˜¯vueåœ¨è¿™æ–¹é¢æ²¡æœ‰å¾ˆå¥½çš„è§„èŒƒå’Œæœ€ä½³å®è·µ. reactåœ¨è¿™æ–¹é¢æ¯”è¾ƒä¸é”™çš„å®è·µ <a href="https://github.com/paularmstrong/normalizr" target="_blank" rel="noopener">https://github.com/paularmstrong/normalizr</a></p><p><strong>å¦‚ä½•è®¾è®¡è‰¯å¥½è§„èŒƒçš„compoents?</strong> </p><p>ç»„ä»¶çš„è®¾è®¡åœ¨ä¸šåŠ¡å±‚éå¸¸çš„é‡è¦,åœ¨ä¸‹ä¸€ç¯‡æˆ‘ä¼šä»‹ç»ä¸€ä¸‹æˆ‘æ€»ç»“å‡ºçš„ä¸€äº›å®è·µ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;a href=&quot;#ç›®å½•ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ç»“æ„&quot;&gt;&lt;/a&gt;ç›®å½•ç»“æ„&lt;/h3&gt;&lt;p&gt;æ€»è§ˆ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://asset.eienao.com/
      
    
    </summary>
    
    
      <category term="vue" scheme="http://beian.miit.gov.cn/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>MySQL ä¸­ JSON å­—æ®µçš„ä½¿ç”¨æŠ€å·§</title>
    <link href="http://beian.miit.gov.cn/posts/tips-for-using-json-fields-in-mysql.html"/>
    <id>http://beian.miit.gov.cn/posts/tips-for-using-json-fields-in-mysql.html</id>
    <published>2018-12-12T03:13:40.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>mysql5.7.8ä¹‹åå¼€å§‹åŸç”Ÿæ”¯æŒjson. åœ¨ç±»ä¼¼mongodbè¿™ç§nosqlæ•°æ®åº“ä¸­,jsonå­˜å‚¨æ•°æ®æ˜¯éå¸¸è‡ªç„¶çš„, åœ¨mysqlä¸­åˆç†çš„ä½¿ç”¨json,èƒ½å¤Ÿå¸¦æ¥æå¤§çš„ä¾¿åˆ©</p><a id="more"></a><h4 id="Jsonå­—æ®µçš„ä½¿ç”¨åœºæ™¯"><a href="#Jsonå­—æ®µçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="Jsonå­—æ®µçš„ä½¿ç”¨åœºæ™¯"></a>Jsonå­—æ®µçš„ä½¿ç”¨åœºæ™¯</h4><p>åœ¨è¯»laravelæ‰‹å†Œä¸¾ä¾‹å­æ—¶,æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ° <code>$user-&gt;is_admin</code> æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜,ä½†æ˜¯åœ¨ç”¨æˆ·è¡¨ä¸­,adminå¾€å¾€åªå å¾ˆå°ä¸€éƒ¨åˆ†.å¦‚æœå•å¼€ä¸€ä¸ªis_adminå­—æ®µæ˜¯å¾ˆæ²¡æœ‰å¿…è¦çš„è¡Œä¸º.æ•°æ®åº“ä¸­ä¼šæœ‰å¤§é‡çš„æ— æ„ä¹‰æ•°æ®å­˜å‚¨, æˆ‘ä»¬å¯ä»¥ä¸ºuserè¡¨åˆ›å»ºä¸€ä¸ª json å­—æ®µ,æ¥å­˜å‚¨æˆ‘ä»¬çš„is_adminå­—æ®µ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        username: 'weiwenhao',</span><br><span class="line">        rest: &#123; // å†—ä½™å­—æ®µ</span><br><span class="line">            is_admin: 1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        username: 'eienao',</span><br><span class="line">        rest: null</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><blockquote><p>å½“ç„¶å³ä½¿ä¸ä½¿ç”¨json,æˆ‘ä»¬ä¹Ÿä¸ä¼šä½¿ç”¨is_adminæ¥åˆ¤æ–­æ˜¯å¦ä¸ºç®¡ç†å‘˜.</p><p>å¯ä»¥é€šè¿‡æ–°å¢adminè¡¨æˆ–è€…RABCæ¥æ ‡å¿—ç®¡ç†å‘˜</p></blockquote><p>ä¾æ—§æ˜¯ç”¨æˆ·è¡¨, å¾ˆå¸¸è§çš„ä¸€ä¸ªéœ€æ±‚æ˜¯ç¬¬ä¸‰æ–¹ç™»å½•,å¦‚æœæˆ‘ä»¬ä½¿ç›´æ¥åœ¨userè¡¨æ–°å¢<code>facebook_id,facebook_email,facebook_phone_number,google_id,....</code>å­—æ®µ, å¯ä»¥é¢„è§è¿™ä¼šé€ æˆå¤§é‡çš„æ— æ„ä¹‰æ•°æ®(å³ä½¿ä»–ä»¬ä¸å ç”¨å†…å­˜,æˆ–è€…å½±å“æ€§èƒ½)</p><blockquote><p>ä¸€ç§è§£å†³åŠæ³•æ˜¯ ä½¿ç”¨ä¸€å¯¹å¤šå…³ç³»æ¥è§£å†³, æ—¢å»ºç«‹ä¸€ä¸ª ç¬¬ä¸‰æ–¹ç™»å½•è¡¨æ¥å­˜å‚¨ç¬¬ä¸‰æ–¹ç™»å½•çš„id/email/phone_numberç­‰</p></blockquote><p>ä½†æ˜¯æˆ‘æ›´å–œæ¬¢ä½¿ç”¨jsonå­—æ®µæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        username: &apos;weiwenhao&apos;,</span><br><span class="line">        rest: &#123;</span><br><span class="line">            is_admin: 1,</span><br><span class="line">            facebook_id: 2348234,</span><br><span class="line">            facebook_phone_number: 2834723234,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        username: &apos;eienao&apos;,</span><br><span class="line">        rest: &#123;</span><br><span class="line">            google_id: 2348234,</span><br><span class="line">            google_email: xxx@gmail.com</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º,ä½¿ç”¨jsonå­—æ®µä½¿æ•°æ®è¡¨çš„è®¾è®¡æ›´åŠ è‡ªç„¶,é›†ä¸­,ä¸šåŠ¡ä¹Ÿç›¸åº”çš„æ›´åŠ çš„ç®€å•æ–¹ä¾¿.</p><h4 id="Jsonå­—æ®µåœ¨laravelä¸­çš„ä½¿ç”¨"><a href="#Jsonå­—æ®µåœ¨laravelä¸­çš„ä½¿ç”¨" class="headerlink" title="Jsonå­—æ®µåœ¨laravelä¸­çš„ä½¿ç”¨"></a>Jsonå­—æ®µåœ¨laravelä¸­çš„ä½¿ç”¨</h4><p>é¦–å…ˆæ˜¯è¿ç§»æ–‡ä»¶ <code>$table-&gt;json(&#39;rest&#39;)-&gt;nullable();</code> </p><p>laravelå¯¹jsonçš„ä½¿ç”¨è¿›è¡Œäº†ä¸€å®šçš„ä¼˜åŒ–,å¯¹äºæ›´æ–°å’Œåˆ›å»ºæˆ‘ä»¬å¯ä»¥.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$user = <span class="keyword">new</span> User;</span><br><span class="line">$user-&gt;&#123;<span class="string">'rest-&gt;google_id'</span>&#125; = <span class="string">'xxx'</span>; </span><br><span class="line"><span class="comment"># å¦‚æœä½ çš„restå­—æ®µä¸ºnull,é‚£ä¹ˆä¸Šé¢çš„æ“ä½œä¼šä½¿ null ä¼šå˜æˆ &#123;google_id: "xxx"&#125;, ä¸éœ€è¦å†åš æ˜¯å¦ä¸ºnullçš„åˆ¤å®šå•¦</span></span><br><span class="line"><span class="comment"># å¦‚æœä»…ä½¿ç”¨ä¸Šé¢çš„æ’å…¥æ“ä½œ,ä¹Ÿä¸éœ€è¦åœ¨ä½¿ç”¨æ¨¡å‹çš„ä¿®æ”¹å™¨æ¥å§ json =&gt; array, array =&gt; jsonå•¦</span></span><br></pre></td></tr></table></figure><blockquote><p>å½“restå­—æ®µçš„å€¼ä¸ºnullæ—¶,æ‰¹é‡æ“ä½œæ— æ³•æ‰§è¡Œ, ç±»ä¼¼  <code>update([&#39;rest-&gt;google_id&#39; =&gt; &#39;xxx&#39;])</code> è¿™æ ·çš„æ“ä½œæ‰§è¡Œæ— æ•ˆ,å› æ­¤æ›´æ¨èä¸Šé¢çš„æ–¹å¼æ¥è¿›è¡Œæ›´æ–°æ“ä½œ</p></blockquote><p>å¯¹äºæŸ¥æ‰¾æ“ä½œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨</p><p><code>User::where(&#39;rest-&gt;google_id&#39;,&#39;xxx&#39;)-&gt;firstOrFail()</code></p><blockquote><p> å…³äºæ£€ç´¢çš„æ•ˆç‡é—®é¢˜,åœ¨åé¢å†…å®¹ä¸­ç»™å‡ºè§£å†³æ–¹æ¡ˆ</p></blockquote><h4 id="Generated-Column-ç”Ÿæˆåˆ—"><a href="#Generated-Column-ç”Ÿæˆåˆ—" class="headerlink" title="Generated Column (ç”Ÿæˆåˆ—)"></a>Generated Column (ç”Ÿæˆåˆ—)</h4><p>5.7æ–°å¢äº†ç”Ÿæˆåˆ—, ç”Ÿæˆåˆ—çš„å€¼æ˜¯æ ¹æ®åˆ—å®šä¹‰ä¸­åŒ…å«çš„è¡¨è¾¾å¼è®¡ç®—å¾—æ¥.å®˜æ–¹ç¤ºä¾‹:è®¡ç®—ç›´è§’ä¸‰è§’å½¢çš„æ–œè¾¹çš„é•¿åº¦</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> triangle (</span><br><span class="line">  sidea <span class="keyword">DOUBLE</span>,</span><br><span class="line">  sideb <span class="keyword">DOUBLE</span>,</span><br><span class="line">  sidec <span class="keyword">DOUBLE</span> <span class="keyword">AS</span> (<span class="keyword">SQRT</span>(sidea * sidea + sideb * sideb)) # <span class="keyword">AS</span> (expression) ä¸ºç”Ÿæˆåˆ—çš„æ ¸å¿ƒè¯­æ³•</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> triangle (sidea, sideb) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">6</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"># å¯¹äºä¸Šé¢çš„æ’å…¥,æŸ¥è¯¢å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœ</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM triangle;</span><br><span class="line">+<span class="comment">-------+-------+--------------------+</span></span><br><span class="line">| sidea | sideb | sidec              |</span><br><span class="line">+<span class="comment">-------+-------+--------------------+</span></span><br><span class="line">|     1 |     1 | 1.4142135623730951 |</span><br><span class="line">|     3 |     4 |                  5 |</span><br><span class="line">|     6 |     8 |                 10 |</span><br><span class="line">+<span class="comment">-------+-------+--------------------+</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ sidecçš„å€¼ æ˜¯æ ¹æ®sideaå’Œsidebè®¡ç®—å¾—æ¥, å¹¶æœªå®é™…çš„å­˜å‚¨åœ¨ç£ç›˜ä¸­.mysql5.7ä¹‹å‰æˆ‘ä»¬æƒ³è¦å®ç°ä¸Šé¢çš„éœ€æ±‚å¯èƒ½ä¼šè¿™æ ·å†™sqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *,(<span class="keyword">SQRT</span>(sidea * sidea + sideb * sideb)) <span class="keyword">as</span> sidec <span class="keyword">FROM</span> triangle;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ—¢ç”Ÿæˆåˆ—çš„ä¸»è¦ä½œç”¨, å®é™…ä¸Šç”Ÿæˆåˆ—æœ‰ä¸¤ç§å­ç±»å‹,ä¸Šé¢çš„ä¾‹å­å±äº virtual (è™šæ‹Ÿ) ç±»å‹çš„ç”Ÿæˆåˆ—, å…¶å¹¶æ²¡æœ‰å°†sidecçš„å€¼å®é™…å­˜å‚¨åœ¨ç£ç›˜ä¸­.</p><p>é™¤äº†virtual, ç”Ÿæˆåˆ—è¿˜æ”¯æŒ storedç±»å‹,å…¶åˆ›å»ºè¯­å¥ä¸º</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#...</span><br><span class="line">sidec DOUBLE AS (SQRT(sidea * sidea + sideb * sideb)) STORED # storedä¸æŒ‡å®šåˆ™é»˜è®¤ä¸º virtual</span><br><span class="line">#...</span><br></pre></td></tr></table></figure><p>å½“è¡Œåˆ›å»ºæˆ–è€…æ›´æ–°æ—¶, ä¼šé‡æ–°è®¡ç®— sidecå¹¶å°†å…¶å­˜å‚¨åœ¨ç£ç›˜ä¸­</p><p>ç”Ÿæˆåˆ—çš„å¦ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§æ˜¯å¯ä»¥æ ¹æ®<strong>ç”Ÿæˆåˆ—è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœå»ºç«‹ç´¢å¼•</strong>. å…¶å»ºç«‹ç´¢å¼•çš„æ–¹å¼å’Œæ™®é€šå­—æ®µåˆ›å»ºç´¢å¼•çš„æ–¹å¼ä¸€è‡´.1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> triangle (</span><br><span class="line">  sidea <span class="keyword">DOUBLE</span>,</span><br><span class="line">  sideb <span class="keyword">DOUBLE</span>,</span><br><span class="line">  sidec <span class="keyword">DOUBLE</span> <span class="keyword">AS</span> (<span class="keyword">SQRT</span>(sidea * sidea + sideb * sideb)) # <span class="keyword">AS</span> (expression) ä¸ºç”Ÿæˆåˆ—çš„æ ¸å¿ƒè¯­æ³•</span><br><span class="line">  <span class="keyword">INDEX</span>(<span class="string">`sidec`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç´¢å¼•æœ¬èº«ä¹Ÿæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„å®é™…å­˜åœ¨çš„ç‰©è´¨, å› æ­¤ virtual ç”Ÿæˆåˆ— + ç´¢å¼•,å¯ä»¥è¾¾åˆ°å­˜å‚¨ç©ºé—´çš„æœ€æœ‰æ•ˆåˆ©ç”¨. </p><blockquote><p>å¯¹äºstored ç”Ÿæˆåˆ— + ç´¢å¼•, é€šå¸¸ä¸ä¼šè®¿é—®åˆ°å­˜å‚¨åœ¨ç£ç›˜ä¸­stored ç”Ÿæˆåˆ—,è€Œæ˜¯ç›´æ¥è®¿é—®ç´¢å¼•.å› æ­¤æ²¡æœ‰å¿…è¦ä½¿ç”¨storedç”Ÿæˆåˆ—</p></blockquote><h4 id="ä½¿ç”¨ç”Ÿæˆåˆ—ä¸ºjsonä¸­çš„å­—æ®µæ·»åŠ ç´¢å¼•"><a href="#ä½¿ç”¨ç”Ÿæˆåˆ—ä¸ºjsonä¸­çš„å­—æ®µæ·»åŠ ç´¢å¼•" class="headerlink" title="ä½¿ç”¨ç”Ÿæˆåˆ—ä¸ºjsonä¸­çš„å­—æ®µæ·»åŠ ç´¢å¼•"></a>ä½¿ç”¨ç”Ÿæˆåˆ—ä¸ºjsonä¸­çš„å­—æ®µæ·»åŠ ç´¢å¼•</h4><p>å·²userè¡¨çš„rest.google_idä¸ºä¾‹,å»ºè¡¨æ“ä½œ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#...</span><br><span class="line">`rest` json NULL,</span><br><span class="line"></span><br><span class="line"># JSON_EXTRACT(`rest`,'$.google_id') ç­‰ä»·äº `rest`-&gt;'$.google_id'</span><br><span class="line"># 5.7.13ç‰ˆæœ¬å </span><br><span class="line"># JSON_UNQUOTE(JSON_EXTRACT(`rest`,'$.google_id')) ç­‰ä»·äº `rest`-&gt;&gt;'$.google_id'</span><br><span class="line"># ä½¿ç”¨ç”Ÿæˆåˆ—ä¸ºjsonæ·»åŠ ç´¢å¼•æ—¶,è¯·åŠ¡å¿…ä½¿ç”¨ JSON_UNQUOTE(JSON_EXTRACT(`rest`,'$.google_id'))/-&gt;&gt;</span><br><span class="line">`google_id` varchar GENERATED ALWAYS AS (`rest`-&gt;&gt;'$.google_id')) NULL</span><br><span class="line"></span><br><span class="line">UNIQUE INDEX(`google_id`)</span><br><span class="line">#...</span><br></pre></td></tr></table></figure><p>åœ¨laravelè¿ç§»æ–‡ä»¶ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$table-&gt;json(<span class="string">'rest'</span>)-&gt;nullable();</span><br><span class="line"></span><br><span class="line">$table-&gt;string(<span class="string">'rest'</span>)-&gt;nullable()-&gt;unique()-&gt;virtualAs(<span class="string">'`oauth`-&gt;&gt;"$.google_id"'</span>);</span><br></pre></td></tr></table></figure><p>æœ‰äº†ç´¢å¼•å,å½“æˆ‘ä»¬æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="string">`rest`</span>-&gt;<span class="string">'$.google_id'</span> = <span class="string">'xxx'</span> # é€šå¸¸ä½¿ç”¨è¿™ç§æ›´åŠ ç®€å•çš„å½¢å¼</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="string">`rest`</span>-&gt;&gt;<span class="string">'$.google_id'</span> = <span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line"># ä¸Šé¢ä¸¤ç§è¡¨è¾¾å¼ä¼šè¢«mysqlçš„ä¼˜åŒ–å™¨åœ¨æŸ¥è¯¢é˜¶æ®µè‡ªåŠ¨ä¼˜åŒ–ä¸º <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> google_id = <span class="string">'xxx'</span></span><br></pre></td></tr></table></figure><h4 id="ä¸€äº›è¡¥å……"><a href="#ä¸€äº›è¡¥å……" class="headerlink" title="ä¸€äº›è¡¥å……"></a>ä¸€äº›è¡¥å……</h4><ul><li><p><code>virtualAs(oauth-&gt;&quot;$.google_id&quot;&#39;);</code> ä½¿ç”¨ <strong>-&gt;</strong>ç¬¦å·æ¥åˆ›å»ºç”Ÿæˆåˆ—ä¼šå‡ºç°æ— æ³•ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ, åŸå› ä¸æ˜¯å¾ˆæ˜äº†,éœ€è¦ç»§ç»­ç ”ç©¶ä¸€ä¸‹æ‰‹å†Œ. å¦å¤–å¯¹äºåˆ›å»ºè¯­å¥ <code>GENERATED ALWAYS</code>çš„ä½œç”¨ä¹Ÿä¸æ˜¯å¾ˆæ˜äº†.</p></li><li><p>å…³äºnull, ç»å¸¸ä¼šçœ‹åˆ°ä¸€ç§è¨€è®ºæ˜¯mysqlä¸­ä½¿ç”¨nullä½œä¸ºå­—æ®µé»˜è®¤å€¼ä¼šå‡ºç°æ— æ³•ç´¢å¼•çš„æƒ…å†µ.ä½†ç»è¿‡æŸ¥è¯¢äº†è§£,å‘ç°è¿™æ˜¯ä¸€ç§è€ä¸­åŒ»ç†è®º. æˆ‘æ›´å€¾å‘äºä½¿ç”¨nullä½œä¸ºé»˜è®¤å€¼, è€Œä¸æ˜¯ â€˜â€™/0/0.0 ,æˆ‘è®¤ä¸ºnullçš„è¡¨è¾¾æ€§æ›´å¥½, laravelä¸­ä¹Ÿæ— æ—¶æ— åˆ»ä¸åœ¨æç°è¿™ç§æ€æƒ³.</p></li><li>å…³äºjsonçš„ä½¿ç”¨, æœ€è¿‘çš„é¡¹ç›®ä¸­,æˆ‘å¤§éƒ¨åˆ†æ ¸å¿ƒè¡¨éƒ½æœ‰ä¸€ä¸ªjsonå­—æ®µ,åšä¸€äº›éæ ¸å¿ƒæ•°æ®çš„å­˜å‚¨å’Œå†—ä½™. </li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mysql5.7.8ä¹‹åå¼€å§‹åŸç”Ÿæ”¯æŒjson. åœ¨ç±»ä¼¼mongodbè¿™ç§nosqlæ•°æ®åº“ä¸­,jsonå­˜å‚¨æ•°æ®æ˜¯éå¸¸è‡ªç„¶çš„, åœ¨mysqlä¸­åˆç†çš„ä½¿ç”¨json,èƒ½å¤Ÿå¸¦æ¥æå¤§çš„ä¾¿åˆ©&lt;/p&gt;
    
    </summary>
    
    
      <category term="mysql json" scheme="http://beian.miit.gov.cn/tags/mysql-json/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜é›…çš„ä½¿ç”¨è·¯ç”±æ¨¡å‹ç»‘å®š</title>
    <link href="http://beian.miit.gov.cn/posts/elegant-use-of-routing-model-bindings.html"/>
    <id>http://beian.miit.gov.cn/posts/elegant-use-of-routing-model-bindings.html</id>
    <published>2018-09-21T07:44:20.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><blockquote><p>laravel5.1/5.2å‘å¸ƒçš„è·¯ç”±æ¨¡å‹ç»‘å®šæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½,dingo/apiä¸­æƒ³è¦ä½¿ç”¨è·¯ç”±æ¨¡å‹ç»‘å®šéœ€è¦å¼•å…¥bindingsç»„ä»¶åˆ°dingoçš„è·¯ç”±ç»„ä¸­</p></blockquote><a id="more"></a><h4 id="è·¯ç”±ä¸­çš„å‚æ•°å‘½å"><a href="#è·¯ç”±ä¸­çš„å‚æ•°å‘½å" class="headerlink" title="è·¯ç”±ä¸­çš„å‚æ•°å‘½å"></a>è·¯ç”±ä¸­çš„å‚æ•°å‘½å</h4><p>å¦‚æœ‰éœ€è¦,ä½¿ç”¨èµ„æºçš„å•æ•°å½¢å¼ä¸ºè·¯ç”±å‘½å,è€Œä¸æ˜¯ {id}/{slug}/{code}ç­‰ç­‰</p><p>æ­£ç¡®çš„ç¤ºä¾‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># api.php</span></span><br><span class="line"></span><br><span class="line">Route::resource(<span class="string">'posts'</span>, <span class="string">'PostController'</span>); <span class="comment">// laravelä¼šå°†å‚æ•°å‘½åä¸º post</span></span><br><span class="line">Route::get(<span class="string">'users/&#123;user&#125;/posts'</span>, <span class="string">'PostController@index'</span>);</span><br><span class="line">Route::get(<span class="string">'posts/&#123;post&#125;/comments'</span>, <span class="string">'CommentController@index'</span>);</span><br></pre></td></tr></table></figure><h4 id="æ˜¾å¼ç»‘å®š"><a href="#æ˜¾å¼ç»‘å®š" class="headerlink" title="æ˜¾å¼ç»‘å®š"></a>æ˜¾å¼ç»‘å®š</h4><p>ä»¥<a href="https://www.jianshu.com/" target="_blank" rel="noopener">ç®€ä¹¦</a>çš„æ–‡ç« ä¸ºä¾‹,ä½¿ç”¨RESTFul é£æ ¼å¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ æ¡è·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># api.php</span></span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'posts'</span>, <span class="string">'PostController@index'</span>); <span class="comment">// é¦–é¡µ/åŸºç¡€å¸–å­å±•ç¤º</span></span><br><span class="line">Route::get(<span class="string">'users/&#123;user&#125;/posts'</span>, <span class="string">'PostController@index'</span>); <span class="comment">// æŸä¸ªç”¨æˆ·çš„å¸–å­</span></span><br><span class="line">Route::get(<span class="string">'collections/&#123;collections&#125;/posts'</span>, <span class="string">'PostController@index'</span>) <span class="comment">// æŸä¸ªä¸“é¢˜ä¸‹çš„å¸–å­</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°,è¿™é‡Œæˆ‘ä½¿ç”¨äº†åŒä¸€ä¸ªæ–¹æ³•æ¥å¤„ç†è¿™ä¸‰æ¡è·¯ç”±.</p><p>æ¥ä¸‹æ¥å®šä¹‰è·¯ç”±æ¨¡å‹ç»‘å®š,è¿™é‡Œä½¿ç”¨æ˜¾å¼ç»‘å®š,ä»¥è·å¾—è¾ƒå¤§çš„çµæ´»æ€§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RouteServiceProvider.php</span></span><br><span class="line"></span><br><span class="line">Route::model(<span class="string">'user'</span>, User::class);</span><br><span class="line">Route::model(<span class="string">'collection'</span>, Collection::class)</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹çœ‹æ§åˆ¶å™¨ä¸­çš„å®šä¹‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PostController.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($parent = null)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $query = $parent ? $parent-&gt;posts() : Post::query();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// e.g</span></span><br><span class="line">    $posts = $query-&gt;latest()-&gt;paginate();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€æ¡è·¯ç”±è®¿é—®æˆ‘ä»¬çš„å¸–å­æ—¶, $parentå¾—åˆ°çš„æ˜¯ä¸€ä¸ªnull, <code>$query = Post::query</code>.</p><p>è®¿é—®åä¸¤æ¡è·¯ç”±æ—¶,ç”±äºè·¯ç”±æ¨¡å‹ç»‘å®š,$parent è¢«èµ‹å€¼ä¸ºå…·ä½“çš„model. æ­¤æ—¶å¯ä»¥é€šè¿‡modelä¸­å®šä¹‰çš„å…³è”å…³ç³»æ¥è·å–query. é€šè¿‡æ˜¾ç¤ºç»‘å®šå’Œå…³è”å…³ç³»çš„å®šä¹‰,ä½¿å¾—$parent-&gt;posts()è¶³å¤ŸæŠ½è±¡,ä¸ä¾èµ–äºå…·ä½“çš„model.å…·æœ‰å¼ºå¤§çš„é€šç”¨æ€§.</p><h4 id="p-s"><a href="#p-s" class="headerlink" title="p.s"></a>p.s</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># User.php</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Post::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Collection.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(Post::class, <span class="string">'collection_post'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Advance"><a href="#Advance" class="headerlink" title="Advance"></a>Advance</h2><p>å¯¹äº, å¦‚ æˆ‘çš„æ–‡ç« åˆ—è¡¨,æˆ‘çš„è®¢å•ç­‰æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å®šä¹‰æˆ‘ä»¬çš„ RESTFul è·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œå•æ•°å½¢å¼çš„userå°±ä»£è¡¨ç€meçš„æ„æ€, å‚è€ƒäºgithub api</span></span><br><span class="line">Route::get(<span class="string">'user/posts'</span>, <span class="string">'PostController@index'</span>);</span><br><span class="line">Route::get(<span class="string">'user/orders'</span>, <span class="string">'OrderController@index'</span>);</span><br></pre></td></tr></table></figure><p>ç”šè‡³,ä¾æ—§å·²ç®€ä¹¦ä¸ºä¾‹,ç®€ä¹¦æœ‰ä¸¤ä¸ªæ¿å—<a href="https://www.jianshu.com/trending/weekly?utm_medium=index-banner-s&amp;utm_source=desktop" target="_blank" rel="noopener">30æ—¥çƒ­é—¨</a>å’Œ<a href="https://www.jianshu.com/trending/monthly?utm_medium=index-banner-s&amp;utm_source=desktop" target="_blank" rel="noopener">7æ—¥çƒ­é—¨</a>, æˆ‘ä»¬å¯èƒ½ä¼šæœ‰è¿™æ ·ä¸¤æ¡è·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'hot-30/posts'</span>, <span class="string">'PostController@index'</span>);</span><br><span class="line">Route::get(<span class="string">'hot-7/posts'</span>, <span class="string">'PostController@index'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆæˆ–è€…æ ¹æ®æ¨èç®—æ³•é€šè¿‡ç”¨æˆ·ç”»åƒæ¨èä¸åŒçš„æ–‡ç« </span></span><br><span class="line">Route::get(<span class="string">'recommend/posts'</span>, <span class="string">'PostController@index'</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ä¸è¦æ¿€åŠ¨,æ¥ä¸‹æ¥ä¸æ˜¯ç®—æ³•ç¯èŠ‚?</p></blockquote><p>?ç°åœ¨çš„é—®é¢˜æ˜¯,å¦‚ä½•ä¾æ—§ä½¿ç”¨åŒä¸€ä¸ªæ–¹æ³•å®ç°?çš„å‡ æ¡è·¯ç”±å‘¢?</p><p><strong>æˆ‘ä»¬æ¢ä¸€ç§æ€è·¯.å‰é¢æˆ‘ä»¬éƒ½æ˜¯åœ¨æ§åˆ¶å™¨å±‚é¢åšæŠ½è±¡,ç„¶åæŠŠå…·ä½“é€»è¾‘äº¤ç»™è·¯ç”±å±‚.å¯é¢å¯¹ä¸Šé¢çš„éœ€æ±‚ä¾æ—§æœ‰äº›åŠ›ä¸ä»å¿ƒ,é‚£æˆ‘ä»¬ä¸å¦¨å¯»æ‰¾ä¸€ä¸‹ä¸Šé¢éœ€æ±‚çš„å…±åŒç‚¹,å†æå–ä¸€å±‚æŠ½è±¡</strong></p><blockquote><p>å½“ç„¶æ›´ç®€å•çš„æ€è·¯æ˜¯ æ‹†å¼€å‡ ä¸ªæ–¹æ³•å†™å°±okå•¦,æè¿™ä¹ˆéº»çƒ¦æ˜¯å§.è§ä»è§æ™º.çæŠ˜è…¾å°±æ˜¯äº†</p></blockquote><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># api.php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ &#123;virtual&#125; æ¥åŒ¹é…ä¸Šé¢çš„hot-30,hot-7,recommend ç­‰ç­‰</span></span><br><span class="line">Route::get(<span class="string">'&#123;virtual&#125;/posts'</span>, <span class="string">'PostController@index'</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RouteServiceProvider.php</span></span><br><span class="line"></span><br><span class="line">Route::bind(<span class="string">'virtual'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($value)</span> </span>&#123;</span><br><span class="line">    $virtual = <span class="string">"App\\Virtual\\"</span> . studly_case($value);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> $virtual($value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„åšæ³•æ˜¯, è·¯ç”±æ¨¡å‹ç»‘å®šæ˜¯åŸºäºmodel,æˆ–è€…è¯´ entity çš„<em>(åœ¨symfonyä¸­modelè¢«ç§°ä½œentity)</em>.ä½†æ˜¯hot-30/hot-7/recommend å¹¶ä¸åŸºäºmodel.<em>(å½“ç„¶ä¹Ÿå¯ä»¥åŸºäºmodel,ä¸è¿‡è¿™ä¸æ˜¯æˆ‘ä»¬æœ¬æ¬¡è®¨è®ºçš„é‡ç‚¹)</em>, </p><p>é‚£æˆ‘ä»¬ä¸å¦¨ä½¿ç”¨ä¸€ä¸ªvirtual æ¥æ‰¿è½½å®ƒä»¬, virtualæ˜¯ä¸€ä¸ªå’Œentityç›¸è¿‘åˆç›¸åçš„æ„æ€.åœ¨è¿™é‡Œå†é€‚åˆä¸è¿‡äº†.æ¥çœ‹çœ‹å…·ä½“å®ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hot30.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Virtual</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Post</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hot30</span> <span class="keyword">extends</span> <span class="title">Virtual</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ids = ...; <span class="comment">// service</span></span><br><span class="line">        <span class="keyword">return</span> Post::whereIn(<span class="string">'id'</span>, $ids);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hot7,RecommendåŒç†. è¿™æ ·æˆ‘ä»¬åˆæ‰¿æ¥èµ·äº†ä¸Šé¢æ§åˆ¶å™¨çš„ä»£ç .è¿™é‡Œçš„posts()çš„ä½œç”¨å°±ç›¸å½“äºæ¯”å¦‚User.phpä¸­çš„posts()çš„ä½œç”¨,ä½†æ˜¯å´æ›´åŠ çš„çµæ´».</p><blockquote><p>é²è¿…è¯´è¿‡: ä¸è¦å®³æ€•åœ¨ä½ çš„appä¸‹æ·»åŠ ç›®å½•</p></blockquote><p>æˆ‘åªæ˜¯åˆ†äº«äº†ä¸€ä¸ªç®€å•çš„æƒ³æ³•,æ›´å¤šçš„ç”¨æ³•ç­‰ç€ä½ æ¥æ¢ç´¢.</p><p>successful!</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Basic&quot;&gt;&lt;a href=&quot;#Basic&quot; class=&quot;headerlink&quot; title=&quot;Basic&quot;&gt;&lt;/a&gt;Basic&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;laravel5.1/5.2å‘å¸ƒçš„è·¯ç”±æ¨¡å‹ç»‘å®šæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½,dingo/apiä¸­æƒ³è¦ä½¿ç”¨è·¯ç”±æ¨¡å‹ç»‘å®šéœ€è¦å¼•å…¥bindingsç»„ä»¶åˆ°dingoçš„è·¯ç”±ç»„ä¸­&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="laravel api" scheme="http://beian.miit.gov.cn/tags/laravel-api/"/>
    
  </entry>
  
  <entry>
    <title>è¿‡ç¨‹æŠ½è±¡è§£ä¸€èˆ¬æ–¹ç¨‹</title>
    <link href="http://beian.miit.gov.cn/posts/process-abstract-solution-general-equation.html"/>
    <id>http://beian.miit.gov.cn/posts/process-abstract-solution-general-equation.html</id>
    <published>2018-09-21T02:06:45.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="ä¼ ç»Ÿè§£æ–¹ç¨‹"><a href="#ä¼ ç»Ÿè§£æ–¹ç¨‹" class="headerlink" title="ä¼ ç»Ÿè§£æ–¹ç¨‹"></a>ä¼ ç»Ÿè§£æ–¹ç¨‹</h2><h4 id="äºŒæ¬¡å‡½æ•°ä¸ºä¾‹"><a href="#äºŒæ¬¡å‡½æ•°ä¸ºä¾‹" class="headerlink" title="äºŒæ¬¡å‡½æ•°ä¸ºä¾‹"></a>äºŒæ¬¡å‡½æ•°ä¸ºä¾‹</h4><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Polynomialdeg_2.svg/233px-Polynomialdeg_2.svg.png" alt="img"></p><p>è§£æå¼ï¼š<strong>f(x) = xÂ² - x -2</strong></p><p>åœ¨æ•°å­¦ä¸­ï¼Œ<strong>äºŒæ¬¡å‡½æ•°</strong> <code>f(x) = axÂ² + bx + c</code> (a â‰  0ï¼Œä¸”aã€bã€c æ˜¯å¸¸æ•°)çš„å¤šé¡¹å¼å‡½æ•°ï¼Œå…¶ä¸­ï¼Œx ä¸ºè‡ªå˜é‡ï¼Œa, b, c åˆ†åˆ«æ˜¯å‡½æ•°è§£æå¼çš„äºŒæ¬¡é¡¹ç³»æ•°ã€ä¸€æ¬¡é¡¹ç³»æ•°å’Œå¸¸æ•°é¡¹ã€‚äºŒæ¬¡å‡½æ•°çš„å›¾åƒæ˜¯ä¸€æ¡ä¸»è½´å¹³è¡Œäº<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/b8a6208ec717213d4317e666f1ae872e00620a0d" alt="y"> è½´çš„æŠ›ç‰©çº¿</p><blockquote><p>ä»¤f(x) = 0 å¯ä»¥å°†äºŒæ¬¡å‡½æ•°è½¬æ¢æˆäºŒæ¬¡æ–¹ç¨‹,è¯¥æ–¹ç¨‹çš„è§£ç§°ä¸ºæ–¹ç¨‹çš„æ ¹æˆ–è€…å‡½æ•°çš„é›¶ç‚¹(y = 0æ˜¯xçš„å€¼)</p><p>é€šè¿‡åˆ¤åˆ«å¼ â–³ = bÂ² - 4ac æ¥åˆ¤å®šæ–¹ç¨‹æ ¹çš„æƒ…å†µ</p></blockquote><h4 id="å› å¼åˆ†è§£"><a href="#å› å¼åˆ†è§£" class="headerlink" title="å› å¼åˆ†è§£"></a>å› å¼åˆ†è§£</h4><p>ä¾‹ xÂ² - 3x + 2 = 0 å¯ä»¥å°†å·¦è¾¹çš„æ–¹ç¨‹ä½¿ç”¨åå­—ç›¸ä¹˜æ³•åˆ†è§£æˆ (x - 1) (x - 2) = 0, æ‰€ä»¥åˆ†åˆ«æœ‰ x - 1 = 0 æˆ–è€… x - 2 = 0 ä»è€Œå¾—åˆ°æ–¹ç¨‹çš„ä¸¤ä¸ªè§£</p><h4 id="æ±‚æ ¹å…¬å¼"><a href="#æ±‚æ ¹å…¬å¼" class="headerlink" title="æ±‚æ ¹å…¬å¼"></a>æ±‚æ ¹å…¬å¼</h4><p>å¯¹<code>axÂ² + bx + c = 0 (a â‰  0)</code>å®ƒçš„æ ¹å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/ddcdc99b985b5d370851854c27f1e803c29ebd6a" alt="img"></p><h2 id="åŒºé—´æŠ˜åŠæ³•æ±‚ä»»æ„å‡½æ•°çš„é›¶ç‚¹"><a href="#åŒºé—´æŠ˜åŠæ³•æ±‚ä»»æ„å‡½æ•°çš„é›¶ç‚¹" class="headerlink" title="åŒºé—´æŠ˜åŠæ³•æ±‚ä»»æ„å‡½æ•°çš„é›¶ç‚¹"></a>åŒºé—´æŠ˜åŠæ³•æ±‚ä»»æ„å‡½æ•°çš„é›¶ç‚¹</h2><p>f(x) = 0, fæ˜¯ä¸€ä¸ªè¿ç»­çš„å‡½æ•°. å¦‚æœç»™å®šç‚¹aå’Œbæœ‰ <code>f(a) &lt; 0 &lt; f(b)</code>, é‚£ä¹ˆfåœ¨aå’Œbä¹‹é—´å¿…ç„¶æœ‰ä¸€ä¸ªé›¶ç‚¹(f(x) = 0çš„ç‚¹).ä¸ºäº†ç¡®å®šè¿™ä¸ªé›¶ç‚¹. æˆ‘ä»¬åªéœ€è¦ç¼©å° aå’Œbçš„åŒºé—´ä»è€Œç¡®å®šé›¶ç‚¹æ‰€åœ¨çš„èŒƒå›´.å…·ä½“çš„åšæ³•æ˜¯</p><p>ä»¤ xæ˜¯aå’Œbçš„å¹³å‡å€¼å¹¶è®¡ç®—å‡º f(x). å¦‚ä½•f(x) &gt; 0 é‚£ä¹ˆ aå’Œxä¹‹é—´å¿…ç„¶æœ‰ä¸€ä¸ªfçš„é›¶ç‚¹. f(x) &lt; 0åˆ™åä¹‹</p><p>å®ç°</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">average</span> a b)</span><br><span class="line">  (<span class="name"><span class="builtin-name">/</span></span> (<span class="name"><span class="builtin-name">+</span></span> a b)</span><br><span class="line">     <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">; æ›´åŠ é€šç”¨çš„å¯»æ‰¾ä¸€ä¸ªå‡½æ•°çš„é›¶ç‚¹</span></span><br><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">search</span> f lower upper)</span><br><span class="line">  <span class="comment">; åˆ¤æ–­æ˜¯å¦å¯ä»¥æ¥æ”¶è¯¯å·®åŒºé—´</span></span><br><span class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">close-enough?</span> x y)</span><br><span class="line">    (<span class="name"><span class="builtin-name">&lt;</span></span> (<span class="name"><span class="builtin-name">abs</span></span> (<span class="name"><span class="builtin-name">-</span></span> x y)) <span class="number">0.001</span>))</span><br><span class="line">  (<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">middle</span> (<span class="name">average</span> lower upper)))</span><br><span class="line">    (<span class="name"><span class="builtin-name">if</span></span> (<span class="name">close-enough?</span> lower upper)</span><br><span class="line">        middle</span><br><span class="line">        (<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">mid-value</span> (<span class="name">f</span> middle))) <span class="comment">; æ±‚è§£ä¸­é—´å€¼</span></span><br><span class="line">            (<span class="name"><span class="builtin-name">cond</span></span> ((<span class="name"><span class="builtin-name">positive?</span></span> mid-value) <span class="comment">; åˆ¤æ–­å¤§å°è¿›è¡Œä¸‹ä¸€æ¬¡æ“ä½œ</span></span><br><span class="line">                   (<span class="name">search</span> f lower middle))</span><br><span class="line">                  ((<span class="name"><span class="builtin-name">&lt;</span></span> mid-value <span class="number">0</span>)</span><br><span class="line">                   (<span class="name"><span class="builtin-name">negative?</span></span> f middle upper))</span><br><span class="line">                  (<span class="name"><span class="builtin-name">else</span></span> middle))))))</span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">half-interval-method</span> f a b)</span><br><span class="line">  (<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">a-value</span> (<span class="name">f</span> a))</span><br><span class="line">        (<span class="name">b-value</span> (<span class="name">f</span> b)))</span><br><span class="line">    (<span class="name"><span class="builtin-name">cond</span></span> ((<span class="name"><span class="builtin-name">and</span></span> (<span class="name"><span class="builtin-name">negative?</span></span> a-value) (<span class="name"><span class="builtin-name">positive?</span></span> b-value))</span><br><span class="line">           (<span class="name">search</span> f a b))</span><br><span class="line">          ((<span class="name"><span class="builtin-name">and</span></span> (<span class="name"><span class="builtin-name">negative?</span></span> b-value) (<span class="name"><span class="builtin-name">positive?</span></span> a-value))</span><br><span class="line">           (<span class="name">search</span> f b a))</span><br><span class="line">          (<span class="name"><span class="builtin-name">else</span></span></span><br><span class="line">            (<span class="name"><span class="builtin-name">display</span></span> <span class="string">"Values are not of opposite sign"</span>)))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">; æŠ˜åŠæ³•è§£ xÂ³ - 2x - 3 = 0 åœ¨1å’Œ2ä¹‹é—´çš„æ ¹</span></span><br><span class="line">(<span class="name">half-interval-method</span> (<span class="name"><span class="builtin-name">lambda</span></span> (x) (<span class="name"><span class="builtin-name">-</span></span> (<span class="name"><span class="builtin-name">*</span></span> x x x) (<span class="name"><span class="builtin-name">*</span></span> <span class="number">2</span> x) <span class="number">3</span>))</span><br><span class="line">                      <span class="number">1</span></span><br><span class="line">                      <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>åŒºé—´æŠ˜åŠæ³•ç»™å‡ºäº†ä¸€ç§è§£æ–¹ç¨‹çš„é€šç”¨æ–¹æ³•.å…¶æ˜¯é«˜åº¦æŠ½è±¡çš„ä¸”é€‚ç”¨äºè®¡ç®—æœºçš„å¯ä»¥è§£ä»»ä½•çº¿æ€§æ–¹ç¨‹çš„æ–¹æ³•.</p><h2 id="æ‰¾å‡ºå‡½æ•°çš„ä¸åŠ¨ç‚¹"><a href="#æ‰¾å‡ºå‡½æ•°çš„ä¸åŠ¨ç‚¹" class="headerlink" title="æ‰¾å‡ºå‡½æ•°çš„ä¸åŠ¨ç‚¹"></a>æ‰¾å‡ºå‡½æ•°çš„ä¸åŠ¨ç‚¹</h2><p><strong>å®šä¹‰:</strong>f(x) = 0,ç§°ä¸ºf(x) çš„é›¶ç‚¹. è€Œf(x) = x. xç§°ä¸ºf(x)çš„ä¸åŠ¨ç‚¹, </p><p>ä¾‹å¦‚ <code>f(x) = -x + 3</code>ä»¤ x = -x + 3 è§£å¾— x = - (3/2). è¿™å°±æ˜¯æ–¹ç¨‹f(x)çš„ä¸åŠ¨ç‚¹.</p><p>å½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰ä¸åŠ¨ç‚¹,å¦‚ <code>f(x) = x + 2</code>,æˆ‘ä»¬æ‰¾ä¸åˆ°ä¸€ä¸ªxä½¿å¾— x = x + 2 (å½“ç„¶0é™¤å¤–)</p><p>ğŸ¤” <strong>ç»™å®šä»»æ„å‡½æ•°,å¦‚ä½•æ‰¾åˆ°å…¶ä¸åŠ¨ç‚¹å‘¢?</strong></p><p>å¯¹äºæŸäº›å‡½æ•°,é€šè¿‡æŸä¸ªåˆå§‹çŒœæµ‹è§¦å‘,åå¤çš„åº”ç”¨f</p><p><code>x, f(x), (f(fx)), f(f(f(x))),...,</code></p><p>ç›´åˆ°å€¼çš„å˜åŒ–ä¸å¤§æ—¶,å°±å¯ä»¥æ‰¾åˆ°å®ƒçš„ä¸€ä¸ªä¸åŠ¨ç‚¹.</p><p>è¿™ç§ç‰¹æ®Šçš„ä¸åŠ¨ç‚¹ç§°ä¸º<strong>å¸å¼•ä¸åŠ¨ç‚¹</strong> , å…¶ä¸¥æ ¼å®šä¹‰æ˜¯: å¯¹äºå‡½æ•°çš„ä¸åŠ¨ç‚¹x0, åœ¨è¶³å¤Ÿæ¥è¿‘x0çš„å®šä¹‰åŸŸ(xç›¸å¯¹äºf(x)çš„å–å€¼èŒƒå›´ç§°ä¸ºå®šä¹‰åŸŸ)çš„ä»»ä½•x, é€šè¿‡è¿­ä»£åºåˆ— <code>x, f(x), f(f(x))â€¦</code> , xä¼šä¸»é”®æ”¶æ•›äºx0</p><p>å¦‚ä½•æ‰æ˜¯ â€œè¶³å¤Ÿæ¥è¿‘â€æ˜¯ä¸ªå¾®å¦™çš„é—®é¢˜, åœ¨è®¡ç®—æœºä¸­ä¸æ–­çš„ cos(cos(cos(cos(â€¦â€¦R, å®ƒä¼šå¿«é€Ÿçš„æ”¶æ•›å¤§é›¨ 0.73908513. è¿™å°±æ˜¯ä¸åŠ¨ç‚¹. è¿™ç§æƒ…å†µä¸‹ è¶³å¤Ÿæ¥è¿‘çš„çº¦æŸå®é™…ä¸Šæ˜¯ä¸å­˜åœ¨çš„</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/Cosine_fixed_point.svg" alt="https://upload.wikimedia.org/wikipedia/commons/e/ea/Cosine_fixed_point.svg"></p><p>æ ¹æ®ä¸Šé¢çš„å®šä¹‰æˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªå¯»æ‰¾å‡½æ•°ä¸æ‡‚ç‚¹çš„è¿‡ç¨‹</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> tolerance <span class="number">0.00001</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">fixed-point</span> f guess)</span><br><span class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">close-enough?</span> a b)</span><br><span class="line">    (<span class="name"><span class="builtin-name">&lt;</span></span> (<span class="name"><span class="builtin-name">abs</span></span> (<span class="name"><span class="builtin-name">-</span></span> a b)) tolerance))</span><br><span class="line">  (<span class="name"><span class="builtin-name">define</span></span> (<span class="name">iter</span> guess)</span><br><span class="line">    (<span class="name"><span class="builtin-name">let</span></span> ((<span class="name">next</span> (<span class="name">f</span> guess)))</span><br><span class="line">      <span class="comment">; è®¡ç®—å‡ºçš„ä¸‹ä¸€ä¸ªçŒœæµ‹å€¼å’Œå½“å‰çŒœæµ‹å€¼çš„å·®åœ¨å…è®¸è¯¯å·®èŒƒå›´å†…åˆ™è¡¨ç¤ºå·²ç»æ”¶æ•›å®Œæ¯•, nextæ—¢æ˜¯æˆ‘ä»¬éœ€è¦å¯»æ‰¾çš„ä¸åŠ¨ç‚¹</span></span><br><span class="line">      (<span class="name"><span class="builtin-name">if</span></span> (<span class="name">close-enough?</span> guess next)</span><br><span class="line">          next</span><br><span class="line">          (<span class="name">iter</span> next))))</span><br><span class="line">  (<span class="name">iter</span> guess))</span><br><span class="line"></span><br><span class="line"><span class="comment">; æµ‹è¯• cosçš„ä¸åŠ¨ç‚¹</span></span><br><span class="line">(<span class="name">fixed-point</span> cos <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡å¯»æ‰¾ä¸åŠ¨ç‚¹çš„æ–¹å¼æ±‚å¹³æ–¹æ ¹"><a href="#é€šè¿‡å¯»æ‰¾ä¸åŠ¨ç‚¹çš„æ–¹å¼æ±‚å¹³æ–¹æ ¹" class="headerlink" title="é€šè¿‡å¯»æ‰¾ä¸åŠ¨ç‚¹çš„æ–¹å¼æ±‚å¹³æ–¹æ ¹"></a>é€šè¿‡å¯»æ‰¾ä¸åŠ¨ç‚¹çš„æ–¹å¼æ±‚å¹³æ–¹æ ¹</h4><p>xÂ² = y.  è½¬æ¢ä¸€ä¸‹å¯ä»¥å¾—åˆ° x = y/x. ç°åœ¨åªè¦æ‰¾åˆ°ä¸€ä¸ªxä½¿å¾— x = y/x . é‚£å°±è¿™ä¸ªxå°±æ˜¯yçš„å¹³æ–¹æ ¹. ä¸”é€šè¿‡ä¸Šé¢çš„æè¿°,æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™æ ·çš„xä¹Ÿç§°ä¸º y/x çš„ä¸åŠ¨ç‚¹. æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯»æ‰¾å‡½æ•°ä¸åŠ¨ç‚¹çš„è¿‡ç¨‹.ç°åœ¨åº”ç”¨çœ‹çœ‹</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">my-sqrt</span> y)</span><br><span class="line">  (<span class="name">fixed-point</span> (<span class="name"><span class="builtin-name">lambda</span></span> (x) (<span class="name"><span class="builtin-name">/</span></span> y x)) <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">my-sqrt</span> <span class="number">4</span>) <span class="comment">; è¿™ä¸ok,æˆ‘ä»¬é™·å…¥äº†ä¸€ä¸ªiteræ— æ³•è‡ªæ‹”äº†...</span></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ—¶ x = x1; x2 = y/x1; x3 =  y/(y/x1) = x1  è¿™é‡Œé™·å…¥äº†ä¸€ä¸ªæ­»å¾ªç¯,æˆ‘ä»¬å§‹ç»ˆåœ¨x3 ~ x1ä¹‹é—´éœ‡è¡.</p><p>ç”±äºå®é™…ç­”æ¡ˆæ€»æ˜¯åœ¨ x å’Œ y/x ä¹‹é—´</p><blockquote><p>x <em> y/x = y  å¹³æ–¹æ ¹æ€»æ˜¯åœ¨ä¸­ç‚¹éƒ¨åˆ†. å…¶ä½™è¢«ä¹˜æ•°å’Œä¹˜æ•°åˆ™ä¸€å®šä¼šæœ‰ä¸€ä¸ªå¤§äºä¸­é—´å€¼.æ¯”å¦‚ 16çš„å¹³æ–¹æ ¹æ˜¯4, é‚£16çš„å…¶ä½™ä¹˜æ•°æ¯”å¦‚ 1 \</em> 16 / 2 * 8 / 0.5 * 32ç­‰ç­‰ æ€»æ˜¯æœ‰ä¸€ä¸ªä¹˜æ•°ä¼šå¤§äº4.</p></blockquote><p>æ—¢ç„¶æœ‰äº†ä¸Šä¸€æ¬¡çš„ç»“è®º,é‚£æˆ‘ä»¬å¯ä»¥ä¸é€‚ç”¨ y/xä½œä¸ºä¸‹ä¸€æ¬¡çš„çŒœæµ‹å€¼, è€Œä½¿ç”¨xå’Œ y / xçš„å¹³å‡å€¼ä½œä¸ºä¸‹ä¸€æ¬¡çš„çŒœæµ‹å€¼,ä»è€Œä½¿æ¯ä¸€æ¬¡çš„çŒœæµ‹å€¼å˜åŒ–éƒ½æ²¡æœ‰é‚£ä¹ˆå‰§çƒˆ</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name"><span class="builtin-name">define</span></span> (<span class="name">my-sqrt</span> y)</span><br><span class="line">  (<span class="name">fixed-point</span> (<span class="name"><span class="builtin-name">lambda</span></span> (x) (<span class="name">average</span> x (<span class="name"><span class="builtin-name">/</span></span> y x))) <span class="number">1.0</span>))</span><br></pre></td></tr></table></figure><p>successful!</p><p>å°†è¿‡ç¨‹ä½œä¸ºå‚æ•°ä¼ é€’,èƒ½å¤Ÿæ˜¾è‘—å¢å¼ºæˆ‘ä»¬çš„ç¨‹åºè®¾è®¡è¯­è¨€çš„è¡¨è¾¾èƒ½åŠ›.å¯ä»¥è¡¨è¿°è®¡ç®—çš„ä¸€èˆ¬æ€§è¿‡ç¨‹,ä¸å…¶ä¸­æ‰€æ¶‰åŠçš„ç‰¹å®šå‡½æ•°æ— å…³.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;ä¼ ç»Ÿè§£æ–¹ç¨‹&quot;&gt;&lt;a href=&quot;#ä¼ ç»Ÿè§£æ–¹ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;ä¼ ç»Ÿè§£æ–¹ç¨‹&quot;&gt;&lt;/a&gt;ä¼ ç»Ÿè§£æ–¹ç¨‹&lt;/h2&gt;&lt;h4 id=&quot;äºŒæ¬¡å‡½æ•°ä¸ºä¾‹&quot;&gt;&lt;a href=&quot;#äºŒæ¬¡å‡½æ•°ä¸ºä¾‹&quot; class=&quot;he
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>kmp ç®—æ³•ç®€ä»‹åŠ next æ•°ç»„æ¨å¯¼</title>
    <link href="http://beian.miit.gov.cn/posts/introduction-of-kmp-algorithm-and-derivation-of-next-array.html"/>
    <id>http://beian.miit.gov.cn/posts/introduction-of-kmp-algorithm-and-derivation-of-next-array.html</id>
    <published>2018-05-01T07:18:51.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>Knuth-Morris-Prattå­—ç¬¦ä¸²æŸ¥æ‰¾ç®—æ³•ï¼ˆç®€ç§°ä¸ºKMPç®—æ³•ï¼‰å¯åœ¨ä¸€ä¸ªä¸»æ–‡æœ¬å­—ç¬¦ä¸²Så†…æŸ¥æ‰¾ä¸€ä¸ªè¯Wçš„å‡ºç°ä½ç½®ã€‚æ­¤ç®—æ³•é€šè¿‡è¿ç”¨å¯¹è¿™ä¸ªè¯åœ¨<strong>ä¸åŒ¹é…æ—¶æœ¬èº«å°±åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯</strong>æ¥ç¡®å®š<strong>ä¸‹ä¸€ä¸ªåŒ¹é…</strong>å°†åœ¨å“ªé‡Œå¼€å§‹çš„å‘ç°ï¼Œä»è€Œé¿å…é‡æ–°æ£€æŸ¥å…ˆå‰åŒ¹é…çš„å­—ç¬¦ã€‚</p><a id="more"></a><p>æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ<br><img src="http://asset.eienao.com/15250626677035.jpg" alt></p><p><img src="http://asset.eienao.com/15250673175700.gif" alt></p><p>gifä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŒ¹é…å¤±è´¥ä¹‹åkmpç®—æ³•ä¸å¯¹ä¸»å­—ç¬¦ä¸²çš„æŒ‡é’ˆè¿›è¡Œä»»ä½•çš„å›é€€ï¼Œå…¶å…³å¿ƒçš„æ˜¯å¯¹æœç´¢è¯æŒ‡é’ˆçš„å¤„ç†ã€‚</p><p>ç»†å¿ƒçš„ä½ å¯èƒ½å·²ç»æ„Ÿå—åˆ°äº†ä¸€ç‚¹ï¼Œä¸Šé¢çš„å¤„ç†æ˜¯æŠ½è±¡çš„ï¼ˆé€šç”¨çš„ï¼‰ï¼Œæ—¢å®Œå…¨ä¸éœ€è¦çŸ¥é“ä¸»å­—ç¬¦ä¸²å…·ä½“æ˜¯å¤šå°‘çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ¨¡æ‹Ÿæ¼”ä¹ ã€‚</p><p>gifä¸­æ¨¡æ‹Ÿäº†æŒ‡é’ˆkåœ¨å­—ç¬¦cå¤„å¤±é…çš„æƒ…å†µï¼Œé€šè¿‡è¿™æ ·ä¸€ä¸ªé¢„å¤„ç†ï¼Œåœ¨å®é™…åŒ¹é…ä¸­ï¼Œå¦‚æœé‡åˆ°äº†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªéœ€è¦ä»å®¹çš„å°†æœç´¢è¯æŒ‡é’ˆç§»åŠ¨åˆ°Eå¤„ï¼Œç„¶åç»§ç»­åŒ¹é…å³å¯ã€‚</p><blockquote><p>è¡¥å……ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæœç´¢è¯åœ¨ç§»åŠ¨åˆ° K = Eçš„ä½ç½®åœäº†ä¸‹æ¥ï¼Ÿ<br>è¿™é‡Œå¯ä»¥æ„Ÿæ€§çš„ç†è§£ï¼Œç”±äºåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ ABæˆåŠŸè¿›è¡Œäº†åŒ¹é…ï¼Œè€Œåœ¨ä¸çŸ¥é“ â€˜?â€™æ‰€ä»£è¡¨çš„å…·ä½“å­—ç¬¦æ˜¯å¤šå°‘çš„æƒ…å†µä¸‹ç»§ç»­å‘å‰ç§»åŠ¨æœç´¢è¯ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°é”™å¤±åŒ¹é…çš„æƒ…å†µã€‚</p></blockquote><p>ç°åœ¨ä¾æ—§å·²<strong>ABEABC</strong>ä½œä¸ºæœç´¢è¯ï¼Œå†çœ‹å‡ ç§æ¼”ä¹ æƒ…å†µ</p><p><img src="http://asset.eienao.com/15250699691851.jpg" alt></p><p><img src="http://asset.eienao.com/15250697769552.jpg" alt><br><img src="http://asset.eienao.com/15250698346450.jpg" alt><br><img src="http://asset.eienao.com/15250698836098.jpg" alt></p><p>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹è§„å¾‹ã€‚<br>å¯¹äºå‰ä¸¤ç§æƒ…å†µKæŒ‡é’ˆéƒ½æ²¡æœ‰ç§»åŠ¨åˆ°èµ·ç‚¹0ï¼Œè€Œæ˜¯ä¸­é€”ä½ç½®åœäº†ä¸‹æ¥ã€‚<br>å¯ä»¥å‘ç° ABEAB?ä¸ABEABCåœ¨å¤±é…å­—ç¬¦ä¹‹å‰çš„å­—ç¬¦<strong>ABEAB</strong> çš„å¤´éƒ¨ä¸å°¾éƒ¨å­˜åœ¨ç›¸åŒçš„å­—ç¬¦<strong>AB</strong>ã€‚</p><p>ABEA?å’ŒABEABåœ¨å¤±é…ä¹‹å‰çš„å­—ç¬¦<strong>ABEA</strong>ä¸­ï¼Œå¤´éƒ¨å’Œå°¾éƒ¨å­˜åœ¨ç›¸åŒçš„å­—ç¬¦ <strong>A</strong>ã€‚</p><p><img src="http://asset.eienao.com/15250705065666.jpg" alt><br>å¯¹äºè¿™ç§å­—ç¬¦æˆ‘ä»¬ç§°ä¹‹ä¸ºå‰åç¼€ï¼Œé€šè¿‡ä¸Šé¢çš„å›¾æˆ‘ä»¬å‘ç°<strong>KæŒ‡é’ˆåœ¨å¤±é…æ—¶ç§»åŠ¨åˆ°çš„ä½ç½®åˆšå¥½æ˜¯å‰ç¼€çš„åä¸€ä¸ªå­—ç¬¦</strong>ã€‚ä½†ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€å¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥è¿™å¥è¯éå¸¸ä¸ä¸¥è°¨ã€‚</p><blockquote><p>é¦–å…ˆï¼Œè¦äº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼šâ€å‰ç¼€â€å’Œâ€åç¼€â€ã€‚ â€œå‰ç¼€â€æŒ‡é™¤äº†æœ€åä¸€ä¸ªå­—ç¬¦ä»¥å¤–ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²çš„å…¨éƒ¨å¤´éƒ¨ç»„åˆï¼›â€åç¼€â€æŒ‡é™¤äº†ç¬¬ä¸€ä¸ªå­—ç¬¦ä»¥å¤–ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²çš„å…¨éƒ¨å°¾éƒ¨ç»„åˆã€‚<br><img src="http://asset.eienao.com/15250708572240.jpg" alt><br>å‡ºè‡ª é˜®ä¸€å³° <a href="http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html" target="_blank" rel="noopener">å­—ç¬¦ä¸²åŒ¹é…çš„KMPç®—æ³•</a></p></blockquote><p>äº†è§£äº†å‰ç¼€ä¸åç¼€ä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡å®šä¹‰ã€‚<br>å½“æŒ‡é’ˆjæ‰€æŒ‡å‘çš„å­—ç¬¦ä¸æŒ‡é’ˆkæ‰€æŒ‡å‘çš„å­—ç¬¦å¤±é…æ—¶ï¼Œå¤±é…ä¹‹å‰çš„å­—ç¬¦å­˜åœ¨ä¸€ä¸ªå‰ç¼€é›†åˆå’Œä¸€ä¸ªåç¼€é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° </p><p><code>k&#39; = max(0 ~ k-1çš„å‰ç¼€é›†åˆ âˆ© 0 ~ k-1çš„åç¼€é›†åˆåç¼€é›†åˆ)</code></p><p>kâ€™çš„å«ä¹‰ä»å…¬å¼ä¸­çœ‹çš„å¾ˆæ¸…æ¥šï¼ˆå‰ç¼€ä¸åç¼€çš„äº¤é›†çš„æœ€å¤§å€¼ï¼‰ã€‚è€Œå¦ä¸€å±‚å«ä¹‰åˆ™æ˜¯ï¼Œå¦‚æœæœç´¢è¯ä¸‹æ ‡ä»0å¼€å§‹è®¡ç®—ï¼Œå½“kå¤„å¤±é…æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†kç§»åŠ¨åˆ°kâ€™å¤„ç»§ç»­åŒ¹é…å³å¯ã€‚</p><p>kmpç®—æ³•çš„é€šå¸¸æŠŠè®¡ç®—å‡ºçš„kâ€™æ”¾åˆ°nextæ•°ç»„ä¸­å­˜å‚¨<br><strong>next[k] = kâ€™</strong>ã€‚å½“æˆ‘ä»¬å®æˆ˜ä¸­åœ¨æŒ‡é’ˆkå¤„å¤±é…æ—¶,æˆ‘ä»¬åªéœ€è¦å°†kæŒ‡é’ˆå›é€€åˆ°kâ€™å¤„ï¼Œæ—¢k = kâ€™ = next[k]å³å¯ã€‚</p><p>ç¡®å®å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¨€ï¼Œé€šè¿‡å®šä¹‰å¯ä»¥æ¸…æ¥šçš„è®¤è¯†åˆ°ï¼Œè®¡ç®—nextæ•°ç»„å®Œå…¨ä¸éœ€è¦ä¸»å­—ç¬¦ä¸²å‚ä¸ï¼Œå®Œå…¨æ˜¯æœç´¢è¯è‡ªåŒ¹é…è®¡ç®—<code>k&#39; = max(0~k-1çš„å‰ç¼€é›†åˆ âˆ© 0~k-1çš„åç¼€é›†åˆ)</code>çš„è¿‡ç¨‹ã€‚</p><p>è¿™ä¸ªå®šä¹‰è™½ç„¶å¾ˆä¸¥è°¨ï¼Œä¾¿äºç†è§£ï¼Œä½†å´ä¸èƒ½å¾ˆå¥½çš„ä½¿ç”¨è®¡ç®—æœºè¯­è¨€æè¿°å‡ºæ¥ã€‚ä¸‹é¢çœ‹çœ‹ä¾¿äºè®¡ç®—æœºç†è§£çš„nextæ•°ç»„çš„æ¨å¯¼è¿‡ç¨‹ã€‚è¿™åº”è¯¥æ˜¯æ•´ä¸ªkmpç®—æ³•æœ€éš¾ç†è§£çš„åœ°æ–¹</p><h2 id="nextæ•°ç»„æ¨å¯¼"><a href="#nextæ•°ç»„æ¨å¯¼" class="headerlink" title="nextæ•°ç»„æ¨å¯¼"></a>nextæ•°ç»„æ¨å¯¼</h2><p>æ ¹æ®nextæ•°ç»„çš„å®šä¹‰,æˆ‘ä»¬å¯ä»¥æœ‰</p><p>è‹¥ <code>next[j] = k</code>ï¼Œåˆ™ <code>w[0 ~ k-1] = w[j-k ~ j-1]</code></p><p>è¦æ˜ç™½è¿™ä¸¤è€…ä¹‹é—´æ˜¯å……åˆ†å¿…è¦æ¡ä»¶å…³ç³»ï¼Œæ—¢<br>è‹¥ <code>w[0 ~ k-1] = w[j-k ~ j-1]</code>åˆ™<code>next[j] = k</code></p><p>ä¸‹å›¾å›¾ä¸­çš„æƒ…å†µä¸ºä¸€ç§æ»¡è¶³å®šä¹‰çš„æƒ…å†µ<code>next[6] = 2</code><br><img src="http://asset.eienao.com/15251567062585.jpg" alt></p><blockquote><p>è¿™ä¸ªæˆ‘ä¸çŸ¥é“æ€ä¹ˆè¯æ˜ï¼Œå› ä¸ºè¿™æ˜¯ç”±nextæ•°ç»„çš„å®šä¹‰å¾—åˆ°çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦è¯æ˜ã€‚</p></blockquote><p>ç°åœ¨å·²ç»çŸ¥é“äº†<code>next[j] = k</code>ï¼Œé¡ºç†æˆç« ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­æ±‚<code>next[j+1]</code>ï¼Œ<code>next[j+1]</code>æ±‚è§£è¿‡ç¨‹ä¸­å­˜åœ¨ä¸¤ç§æƒ…å†µ</p><h3 id="w-k-w-j"><a href="#w-k-w-j" class="headerlink" title="w[k] == w[j]"></a>w[k] == w[j]</h3><p>æ ¹æ®ä¸Šé¢çš„æ¨å¯¼ï¼Œå½“ <code>w[k] == w[j]</code>æ—¶ï¼Œæœ‰<code>w[0 ~ k] = w[j-k ~ j]</code>ï¼Œ åˆ™å¯ä»¥å¾—åˆ° <code>next[j+1] = k + 1</code><br><img src="http://asset.eienao.com/15251568780076.jpg" alt></p><h3 id="w-k-w-j-1"><a href="#w-k-w-j-1" class="headerlink" title="w[k] != w[j]"></a>w[k] != w[j]</h3><p>è‹¥<code>w[k] != w[j]</code>åˆ™è¿›å…¥äº†ç†Ÿæ‚‰çš„å­—ç¬¦ä¸²å¤±é…ç¯èŠ‚ï¼Œæ˜ç¡®ä¸€ä¸‹ï¼Œè°ä¸è°çš„æ¯”è¾ƒä¸­äº§ç”Ÿäº†å¤±é…ï¼Ÿä¸‹å›¾æ˜¯ä¸€ä¸ªç¬¦åˆæˆ‘ä»¬è®¨è®ºçš„ä¾‹å­</p><p><img src="http://asset.eienao.com/15251569142399.jpg" alt></p><p>å¯ä»¥çœ‹å‡ºåœ¨å¯»æ‰¾å­—ç¬¦ä¸²<strong>ABEFABA</strong>çš„æœ€å¤§å‰åç¼€äº¤é›†æ—¶ï¼Œ<strong>k</strong>ä¸<strong>j</strong>å‘ç”Ÿäº†å¤±é…</p><p><img src="http://asset.eienao.com/15251570164284.jpg" alt></p><p>åœ¨kmpç®—æ³•ä¸­å¦‚æœå‘ç”Ÿäº†è¿™ç§æƒ…å†µï¼Œåˆ™å¦ <code>k = next[k]</code>ï¼Œç„¶åå†æ¬¡è®©w[k]ä¸w[j]æ¯”è¾ƒã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†</p><ol><li><p>ä¸ºä»€ä¹ˆå½“<code>w[k] != w[j]</code>æ—¶,ä»¤ <code>k = next[k]</code>, è€Œä¸æ˜¯k = k-1æˆ–è€…å…¶ä»–å‘¢?</p><p> w[k]ä¸w[j]å¤±é…æ—¶ï¼Œ kè‡³å°‘è¦ç§»åŠ¨åˆ°next[k]å¤„æ‰èƒ½ä½¿å¾—<strong>k</strong>ä¸ä¸»å­—ç¬¦ä¸²çš„<strong>j</strong>ç»§ç»­åŒ¹é…ã€‚è¿™æ˜¯nextæ•°ç»„çš„å®šä¹‰ï¼Œç°åœ¨åªä¸è¿‡åœ¨ä½¿ç”¨è¿™ä¸ªå®šä¹‰è€Œå·²</p></li><li><p><code>w[k] != w[j]</code>ï¼Œæ‰€ä»¥å¦<code>k&#39; = next[k]</code>ï¼Œå‡å¦‚æ­¤æ—¶<code>w[k&#39;] == w[j]</code>ï¼Œå¦‚ä½•è¯æ˜ <code>w[0 ~ k&#39;] == w[j-k&#39; ~ j]</code> å‘¢?(å›¾ä¸­ç²‰è‰²éƒ¨åˆ†)</p><p> <img src="http://asset.eienao.com/15251572646346.jpg" alt><br> ç”±<code>k&#39; = next[k]</code>å¾—åˆ°<code>w[0 ~ k&#39;-1] == w[k-k&#39; ~ k-1]</code></p><p> ç”±<code>next[j] = k</code>å¾—åˆ°<code>w[0 ~ k-1] == w[j-k ~ j-1]</code></p><p> å› ä¸º <code>w[0 ~ k-1] == w[j-k ~ j-1]</code><br> æ‰€ä»¥ <code>w[k-k&#39; ~ k-1] == w[j-k&#39; ~ j-1]</code></p><blockquote><p>è¿™é‡Œå±äºæ„Ÿæ€§è¯æ˜ï¼Œèƒ½åŠ›ä¸è¶³æš‚æ—¶æ— æ³•ä½¿ç”¨å…¬å¼è¯æ˜</p></blockquote><p> æ‰€ä»¥ <code>w[0 ~ k&#39;-1] == w[j-k&#39; ~ j-1]</code> </p><p> åˆå› ä¸º <code>w[k&#39;] == w[j]</code><br> æ‰€ä»¥ <code>w[0 ~ k&#39;] == w[j-k&#39; ~ j]</code></p><p> ç”± <code>w[0 ~ k&#39;] == w[j-k&#39; ~ j]</code>ï¼Œå¾—åˆ° next[j+1] = kâ€™ + 1</p><p> è¿™æ˜¯å‡å¦‚æ­¤æ—¶ <code>w[k&#39;] == w[j]</code>çš„æƒ…å†µï¼Œä½†å¤§å¤šæ•°æƒ…å†µæ˜¯<code>w[k&#39;] != w[j]</code>çš„ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬åœ¨ç®—æ³•å®ç°ä¸­è®¨è®ºã€‚</p></li></ol><h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><p>nextæ•°ç»„å®ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getNext</span><span class="params">($word)</span>: <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $next = [<span class="number">-1</span>];</span><br><span class="line">    $len = strlen($word);</span><br><span class="line">    $k = <span class="number">-1</span>;</span><br><span class="line">    $j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ($j &lt; $len - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($k == <span class="number">-1</span> || $word[$j] == $word[$k]) &#123;</span><br><span class="line">            $next[++$j] = ++$k;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $k = $next[$k];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>next[0] = -1</code> ä¸­-1æ˜¯ä¸€ç§ç‰¹æ®Šæ ‡å¿—ï¼Œæ–¹ä¾¿è¿›è¡Œåˆ¤æ–­ã€‚åœ¨ä¸Šé¢çš„<code>w[k] != w[j]</code>æ—¶ï¼Œæˆ‘ä»¬å¦ <code>k = next[k]</code>ç„¶åå†å»åˆ¤æ–­w[k]æ˜¯å¦ç­‰äºw[j]ï¼Œå¦‚æœè¿˜æ˜¯ä¸ç›¸ç­‰ï¼Œåˆ™å†å¦<code>k = next[k]</code>åƒè¿™æ ·ä¸€ç›´å¾ªç¯ä¸‹å»ã€‚<br>ä½†æ˜¯å¾ªç¯æ€»å½’æœ‰ä¸ªå°½å¤´ï¼Œåœ¨å°½å¤´ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œæ­¤æ—¶k = 0ï¼Œ<code>w[k] != w[j]</code>ï¼ŒæŒ‰ç…§ç®—æ³•<code>k = next[0] = -1</code>ã€‚</p><p>å› æ­¤å½“æˆ‘ä»¬çœ‹åˆ° k = -1æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½å¤ŸçŸ¥é“ w[0 ~ k]ä¸å­˜åœ¨å‰ç¼€ä¸åç¼€çš„äº¤é›†ï¼Œæ—¢ <code>max(0~kçš„å‰ç¼€é›†åˆ âˆ© 0~kçš„åç¼€é›†åˆ) = 0</code> æ‰€ä»¥æˆ‘ä»¬å¦ <code>next[k+1] = 0</code>å³å¯</p><p>ä¸Šé¢çš„ç®—æ³•ä¸ºäº†ä¿æŒç®€æ´æ€§ï¼Œä»¤ç‰¹æ®Šå€¼ä¸º-1ï¼Œä½¿å¾—ä¸€ä¸ªifï¼Œelseå¯ä»¥è¦†ç›–ä¸‰ç§æƒ…å†µï¼Œå½“ç„¶ä½ ç”¨ä¸‹é¢çš„å†™æ³•ä¹Ÿæ˜¯ä¸€ä¸ªæ„æ€</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($k == <span class="number">-1</span>) &#123;</span><br><span class="line">    $next[++$j] = <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">elseif</span> ($word[$j] == $word[$k]) &#123;</span><br><span class="line">    $next[++$j] = ++$k;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $k = $next[$k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯¦ç»†å®ç°å«æµ‹è¯•ç”¨ä¾‹</strong><br><a href="https://github.com/weiwenhao/algorithm/blob/master/src/KMP.php" target="_blank" rel="noopener">https://github.com/weiwenhao/algorithm/blob/master/src/KMP.php</a></p><h2 id="ç»“"><a href="#ç»“" class="headerlink" title="ç»“"></a>ç»“</h2><p>kmpç®—æ³•å®é™…ä¸Šåœ¨å­—ç¬¦ä¸²åŒ¹é…ä¸­ä½¿ç”¨çš„æƒ…å†µå¹¶ä¸å¤šï¼Œè™½ç„¶å…¶æ—¶é—´å¤æ‚åº¦æ˜¯O(m+n)ï¼Œä½†å®é™…ä¸Šå…¶è¡¨ç°è·Ÿæœ´ç´ ç®—æ³•å¹¶ä¸ä¼šå·®å¤ªå¤šï¼Œåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å…¶å®ä¹Ÿåº”è¯¥å‘ç°äº†ï¼Œèƒ½å¤Ÿéƒ¨åˆ†åŒ¹é…çš„æƒ…å†µå…¶å®ä¸å¤šè§ã€‚<br>ä¸å¾—ä¸è¯´kmpç®—æ³•éå¸¸çš„éš¾ä»¥ç†è§£ï¼Œç»†èŠ‚å¤ªå¤šå¾ˆå®¹æ˜“é™·å…¥ä¸€ä¸ªæ‹†ä¸œå¢™è¡¥è¥¿å¢™çš„æƒ…å†µï¼Œå„ç§ç‰›è§’å°–é’»åˆ°åœä¸ä¸‹æ¥ã€‚ä½†æ˜¯å…¶çŠ¶æ€æœºçš„æ€æƒ³ï¼Œä»¥åŠnextæ•°ç»„çš„æ¨å¯¼è¿‡ç¨‹å´éå¸¸å€¼å¾—å­¦ä¹ ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Knuth-Morris-Prattå­—ç¬¦ä¸²æŸ¥æ‰¾ç®—æ³•ï¼ˆç®€ç§°ä¸ºKMPç®—æ³•ï¼‰å¯åœ¨ä¸€ä¸ªä¸»æ–‡æœ¬å­—ç¬¦ä¸²Så†…æŸ¥æ‰¾ä¸€ä¸ªè¯Wçš„å‡ºç°ä½ç½®ã€‚æ­¤ç®—æ³•é€šè¿‡è¿ç”¨å¯¹è¿™ä¸ªè¯åœ¨&lt;strong&gt;ä¸åŒ¹é…æ—¶æœ¬èº«å°±åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯&lt;/strong&gt;æ¥ç¡®å®š&lt;strong&gt;ä¸‹ä¸€ä¸ªåŒ¹é…&lt;/strong&gt;å°†åœ¨å“ªé‡Œå¼€å§‹çš„å‘ç°ï¼Œä»è€Œé¿å…é‡æ–°æ£€æŸ¥å…ˆå‰åŒ¹é…çš„å­—ç¬¦ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Amazing tree â€”â€” äºŒå‰æŸ¥æ‰¾æ ‘</title>
    <link href="http://beian.miit.gov.cn/posts/amazing-tree-two-fork-lookup-tree.html"/>
    <id>http://beian.miit.gov.cn/posts/amazing-tree-two-fork-lookup-tree.html</id>
    <published>2018-04-20T08:12:02.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>äºŒåˆ†æŸ¥æ‰¾å¾ˆå¥½çš„è§£å†³äº†æŸ¥æ‰¾é—®é¢˜ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä» O(n)é™åˆ°äº†O(logn)ã€‚<br>ä½†æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„å‰ææ¡ä»¶æ˜¯æ•°æ®å¿…é¡»æ˜¯æœ‰åºçš„ï¼Œå¹¶ä¸”å…·æœ‰çº¿æ€§çš„ä¸‹æ ‡ã€‚<br>å¯¹äºçº¿æ€§è¡¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œä½†æ˜¯åœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶åˆ™å¯èƒ½ä¼šé€ æˆæ•´ä¸ªçº¿æ€§è¡¨çš„åŠ¨è¡ï¼Œæ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº†O(n)<br>é“¾è¡¨æ›´æ˜¯æ²¡æ³•åº”ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚</p></blockquote><p>äºæ˜¯æœ‰äº†ä¸‹é¢å°†è¦ä»‹ç»çš„ç®—æ³•ï¼Œå…¶åœ¨æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤éƒ½èƒ½å¤Ÿè¾¾åˆ°O(logn)çš„æ—¶é—´å¤æ‚åº¦ â€”â€” <strong>äºŒå‰æŸ¥æ‰¾æ ‘</strong></p><a id="more"></a><p>è§åçŸ¥æ„ï¼Œå…¶æ•°æ®ç»“æ„åŸºç¡€ä¸ºäºŒå‰æ ‘ï¼Œåˆæ¬¡æ¥è§¦åˆ°äºŒå‰æ ‘æ—¶å¹¶æ²¡æœ‰æ„Ÿè§‰åˆ°å…¶æœ‰ä»€ä¹ˆçªå‡ºä¹‹å¤„ã€‚ä½†çœ‹åˆ°é€šè¿‡äºŒå‰æ ‘æ„å»ºå‡ºçš„äºŒå‰æŸ¥æ‰¾æ ‘æ–¹æ¡ˆæ—¶ï¼Œç¡®è¢«æ·±æ·±çš„éœ‡æ’¼äº†ã€‚</p><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°äºŒå‰æœç´¢æ ‘ã€æœ‰åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šordered binary treeï¼‰ï¼Œæ’åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šsorted binary treeï¼‰ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š</p><p>è‹¥ä»»æ„ç»“ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›<br>è‹¥ä»»æ„ç»“ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›<br>ä»»æ„ç»“ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›<br>æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„ç»“ç‚¹ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„è§„åˆ™æˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸€é¢—äºŒå‰æ ‘<br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0a99f8188?w=478&amp;h=468&amp;f=jpeg&amp;s=29956" alt></p><p>è¿™é‡Œå¯ä»¥å¾ˆå®¹æ˜“çœ‹å‡ºå…¶è§„å¾‹ï¼Œä¸éœ€è¦è¿‡å¤šçš„è§£é‡Šã€‚</p><h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><p>ç°åœ¨å†æ’å…¥ä¸€ä¸ªå…ƒç´ 13ã€‚ 13&gt;12æ‰€ä»¥å¾€å³è¾¹èµ°æ¥åˆ°14ï¼Œ13 &lt; 14åˆ™å·¦èµ°ï¼Œå‘ç°14æ²¡æœ‰å·¦å­©å­ï¼Œæ‰€ä»¥å°†13æ’å…¥ä¹‹ï¼Œå¾—åˆ°ä¸‹é¢è¿™å¼ å›¾<br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0a9a9885d?w=534&amp;h=483&amp;f=jpeg&amp;s=35531" alt></p><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><p>æŒ‰ç…§ä¸Šé¢æ’å…¥çš„æ€è·¯ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å®ç°æœç´¢æ“ä½œã€‚å¹¶ä¸”å‘ç°å…¶æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å°±ä¸ºè¿™é¢—æ ‘çš„æ·±åº¦ã€‚</p><blockquote><p>æ ¹æ®å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨ï¼Œå…·æœ‰nä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦ä¸º <code>[logn] + 1</code></p></blockquote><p>å¿½ç•¥æ‰<code>+1</code>å¾—åˆ°äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸º <code>O(logn)</code>ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼Œåé¢æˆ‘ä»¬åˆ†æã€‚</p><h3 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h3><p>äºŒå‰æ ‘çš„éå†æœ‰å‰åºã€ä¸­åºã€ååºéå†ä¸‰ç§æ–¹å¼ï¼Œè¿™é‡Œç€é‡ä»‹ç»ååºéå†ã€‚<br>å¯¹äºŒå·®æŸ¥æ‰¾æ ‘è¿›è¡Œä¸­åºéå†æ—¶ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ª<code>asc</code>çš„æ’åºç»“æœã€‚å¦‚ä¸Šé¢çš„æ ‘ä¸­åºéå†çš„ç»“æœæ˜¯ <strong>3, 8, 9, 12, 13, 14</strong>ã€‚<br><code>ä¸­åºéå†ä»ä¸€é¢—å­æ ‘æœ€å·¦çš„èŠ‚ç‚¹å¼€å§‹è¾“å‡ºï¼Œæ—¢è¯¥æ ‘çš„æœ€å°å€¼</code>ã€‚å®ç°ä¸­åºéå†åªéœ€è¦å°†<strong>æ•°æ®æ”¶é›†ç‚¹</strong>ç½®äºå·¦é€’å½’ç‚¹ä¸å³é€’å½’ç‚¹ä¹‹é—´ï¼Œè¿™æ ·è¯´è¿˜æ˜¯æœ‰äº›å«ç³Šäº†ï¼Œçœ‹ä»£ç å§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸­åºéå†</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $root</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">inorder</span><span class="params">($root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $data = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($root-&gt;left) &#123;</span><br><span class="line">        $data = array_merge($data, <span class="keyword">$this</span>-&gt;inorder($root-&gt;left)); <span class="comment">//å·¦å­©å­é€’å½’ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $data[] = $root-&gt;data; <span class="comment">// è¿™é‡Œæ˜¯ä¸­åºéå†çš„æ•°æ®æ”¶é›†ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($root-&gt;right) &#123;</span><br><span class="line">        $data = array_merge($data, <span class="keyword">$this</span>-&gt;inorder($root-&gt;right)); <span class="comment">// å³å­©å­é€’å½’ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‰é©±ä¸åç»§ï¼Œ ä»¥9èŠ‚ç‚¹ä¸ºä¾‹ï¼Œ 12å±äº9çš„åç»§ï¼Œ8å±äº9çš„å‰é©±ã€‚</p></blockquote><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>æˆ‘ä»¬ç»™è¿™é¢—æ ‘å¤šåŠ å‡ ä¸ªç»“ç‚¹<br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0add13dd2?w=968&amp;h=703&amp;f=jpeg&amp;s=76963" alt></p><p>åˆ é™¤æ ‘ä¸­çš„ç»“ç‚¹åˆ†ä¸ºå¾ˆå¤šç§æƒ…å†µï¼Œå¦‚è¢«åˆ é™¤çš„ç»“ç‚¹ä¸å­˜åœ¨å­ç»“ç‚¹ï¼Œåªå­˜åœ¨å·¦å­æ ‘/å³å­æ ‘ï¼Œå·¦å³å­æ ‘éƒ½å­˜åœ¨ï¼Œè¿™é‡Œå·²è¦†ç›–ç‡æœ€å¹¿çš„å·¦å³å­æ ‘éƒ½å­˜åœ¨ä¸ºä¾‹ã€‚</p><blockquote><p>åˆ†æä¸€ä¸ªéœ€æ±‚æ—¶è¦å¹¶ä¸æ˜¯éœ€æ±‚å­˜åœ¨å¤šå°‘ä¸­æƒ…å†µæˆ‘ä»¬å°±å†™å¤šå°‘ç§æƒ…å†µã€‚è€Œåº”è¯¥åˆ†ææƒ…å†µä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯å¦å­˜åœ¨é‡å¤ï¼Œæˆ–è€…å±äºå…³ç³»ç­‰ï¼Œç¨‹åºå‘˜åº”è¯¥åšçš„å°±æ˜¯æå–éœ€æ±‚çš„æœ¬è´¨ï¼ŒåŠ›æ±‚äºæœ€ç®€æ´çš„å®ç°</p></blockquote><p>ç°åœ¨æˆ‘ä»¬æ‰“ç®—åˆ é™¤25è¿™ä¸ªç»“ç‚¹ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ<br>å¦‚æœåªæ˜¯ç®€å•æŠŠ18æ¥é¡¶æ›¿åŸæ¥25çš„ä½ç½®ï¼Œåˆ™éœ€è¦å¯¹18è¿™é¢—å­æ ‘çš„å­©å­ä»¬è¿›è¡Œé‡æ–°è°ƒæ•´ã€‚18åªæœ‰ä¸‰ä¸ªå­©å­è¿˜å¥½ï¼Œä½†æ˜¯å½“å­©å­æˆåƒä¸Šä¸‡æ—¶ï¼Œæ˜¾ç„¶ä¼šé€ æˆå¤§é¢ç§¯çš„è°ƒæ•´ã€‚<br>æ‰€ä»¥æˆ‘å¸Œæœ›èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„èŠ‚ç‚¹æ¥ä»£æ›¿25ï¼ŒæŒ‰ç…§ç®—æ³•å¯¼è®ºä¸­çš„æè¿°ï¼Œæˆ‘ä»¬åº”è¯¥å¯»æ‰¾è¯¥ç»“ç‚¹çš„å‰é©±æˆ–è€…åç»§æ¥ä»£æ›¿ï¼Œæ¯”å¦‚å›¾ä¸­çš„24å’Œ27åˆ†åˆ«æ˜¯25çš„å‰é©±å’Œåç»§ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å‰é©±æˆ–è€…åç¼€æ¥ä»£æ›¿ï¼Ÿè¿™ç‚¹æˆ‘ååˆ†ä¸ç¡®å®šï¼Œæˆ‘ç»™è‡ªå·±çš„ç†ç”±æ˜¯</p><ol><li>è¯¥ç»“ç‚¹æ˜¯ä¸€ä¸ªç‰¹æ®Šå€¼ï¼Œå±äºæŸé¢—å­æ ‘çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ï¼Œå…·æœ‰ç¡®å®šæ€§ï¼Œå¯ä»¥è¢«æ¯”è¾ƒå¥½çš„å®šä¹‰ä¸”æŸ¥æ‰¾å‡ºæ¥ã€‚</li><li>ç”±äºè¯¥ç»“ç‚¹å±äºè¢«åˆ é™¤èŠ‚ç‚¹çš„å‰é©±æˆ–è€…åç»§ï¼Œåˆ™åˆ é™¤è¯¥ç»“ç‚¹å¯¹æ•°æ®ç»“æ„é€ æˆçš„å½±å“æœ€å°ã€‚<em>æˆ‘å¹¶ä¸ç¡®å®šæ˜¯å¯¹ä»€ä¹ˆçš„æ•°æ®ç»“æ„é€ æˆçš„å½±å“æœ€å°</em></li></ol></blockquote><p>ä¸Šé¢æè¿°çš„æƒ…å†µçš„å›¾è§£å¦‚ä¸‹ â†“<br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0a9bdc5fc?w=756&amp;h=537&amp;f=jpeg&amp;s=50523" alt><br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0a9b88949?w=696&amp;h=457&amp;f=jpeg&amp;s=47267" alt></p><p>åˆ é™¤è¿˜å­˜åœ¨ä¸€äº›å…¶ä»–çš„æƒ…å†µ,æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µâ†“<br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0ae694229?w=909&amp;h=529&amp;f=jpeg&amp;s=52024" alt></p><p>å¯¹äºè¿™ç§æƒ…å†µç›´æ¥å°†30æå‡åˆ°25å³å¯ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹çœ‹phpçš„ä»£ç å®ç°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span><span class="params">($root, $data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!$root) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($root-&gt;data === $data) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($root-&gt;left) &#123;</span><br><span class="line">            <span class="comment">// å·¦è½¬</span></span><br><span class="line">            $node = $root-&gt;left;</span><br><span class="line"></span><br><span class="line">            $parent = $root;</span><br><span class="line">            $toward = <span class="string">'left'</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> ($node-&gt;right) &#123;</span><br><span class="line"></span><br><span class="line">                $parent = $node;</span><br><span class="line">                $toward = <span class="string">'right'</span>;</span><br><span class="line"></span><br><span class="line">                $node = $node-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $root-&gt;data = $node-&gt;data;</span><br><span class="line"></span><br><span class="line">            $parent-&gt;&#123;$toward&#125; = <span class="keyword">$this</span>-&gt;delete($node, $node-&gt;data);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> $root-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($root-&gt;data &gt; $data) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœrootçš„å·¦å­©å­æ²¡æœ‰è¢«åˆ é™¤,é‚£å°±åŸæ ·è¿”å›å›æ¥, å¦‚æœè¢«åˆ é™¤äº†,é‚£å°±æ‰¾ä¸ªå­©å­ä»£æ›¿</span></span><br><span class="line">        $root-&gt;left = <span class="keyword">$this</span>-&gt;delete($root-&gt;left, $data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $root-&gt;right = <span class="keyword">$this</span>-&gt;delete($root-&gt;right, $data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºphpæœ‰å†…å­˜å›æ”¶æœºåˆ¶ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰åŠæ³•åƒcä¸€æ ·ç›´æ¥å»ä¿®æ”¹å†…å­˜ï¼Œæ‰€ä»¥è¿™é‡Œå€ŸåŠ©é€’å½’çš„ç‰¹æ€§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ <code>$root-&gt;left = $this-&gt;delete($root-&gt;left, $data);</code> åšç±»ä¼¼è¿™æ ·ä¸€ä¸ªå¤„ç†ï¼Œè¿™å¯èƒ½ä¼šæœ‰äº›ç†è§£ä¸Šçš„å›°éš¾ã€‚ä½†æ€»å½’è¿˜æ˜¯èƒ½å¤Ÿæ˜ç™½çš„~</p><p>é™¤äº†é€’å½’è§£å†³å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹é¢è¿™ç§åŠæ³•ã€‚<br>å³å®šä¹‰ä¸€ä¸ªparentå’Œtowardæ¥åšä¸€ä¸ªå¯¼å‘ï¼Œè¿™åœ¨ä¸Šé¢çš„ä»£ç ä¸­ä¹Ÿæœ‰ä½“ç°ã€‚<strong>è¯¥æ–¹æ³•æ›´åŠ é€‚ç”¨äºè¿­ä»£å¤„ç†</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$parent = $root;</span><br><span class="line">$toward = <span class="string">'left'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ($node-&gt;right) &#123;</span><br><span class="line"></span><br><span class="line">    $parent = $node;</span><br><span class="line">    $toward = <span class="string">'right'</span>;</span><br><span class="line"></span><br><span class="line">    $node = $node-&gt;right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´è¯¦ç»†çš„å®ä¹ ç»†èŠ‚å’Œè°ƒç”¨ç¤ºä¾‹è¯·å‚è€ƒå•å…ƒæµ‹è¯•ã€‚</p><p><a href="https://github.com/weiwenhao/algorithm/blob/master/test/BinarySearchTreeTest.php" target="_blank" rel="noopener">https://github.com/weiwenhao/algorithm/blob/master/test/BinarySearchTreeTest.php</a></p><h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><p><a href="https://github.com/weiwenhao/algorithm/blob/master/src/BinarySearchTree.php" target="_blank" rel="noopener">https://github.com/weiwenhao/algorithm/blob/master/src/BinarySearchTree.php</a></p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>ç”±äºphpæ²¡æœ‰åƒjsä¸€æ ·çš„å­—é¢é‡å¯¹è±¡æˆ–è€…cä¸€æ ·çš„structã€‚å› æ­¤ç›´æ¥ä½¿ç”¨å¯¹è±¡æ¥è¡¨ç¤ºæ ‘ä¸­çš„ç»“ç‚¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BiTNode</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $data;</span><br><span class="line">    <span class="keyword">public</span> $left;</span><br><span class="line">    <span class="keyword">public</span> $right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($data, $left = null, $right = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = $data;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;left = $left;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;right = $right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æŸ¥æ‰¾çš„æ—¶å€™æŒ‡å‡ºäº†ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„O(logn) æ˜¯å› ä¸ºæœ‰è¿™æ ·çš„æƒ…å†µå‘ç”Ÿï¼Œ å‡è®¾éœ€è¦æ’å…¥ <strong>12, 10, 9, 5, 4, 1</strong>è¿™å‡ ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå¾—åˆ°è¿™æ ·ä¸€é¢—æ­ªè„–å­æ ‘</p><p><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0e77d4df1?w=628&amp;h=729&amp;f=jpeg&amp;s=29661" alt><br>æ­¤æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¿¨ç„¶å·²ç»å˜æˆäº†O(n)ï¼Œä¸è¿‡å¯¹äºè¿™æ ·çš„é—®é¢˜è‡ªç„¶å·²ç»æœ‰è§£å†³æ–¹æ¡ˆã€‚ä¸‹ä¸€èŠ‚å°†ä¼šåœ¨<strong>AVLæ ‘</strong>å’Œ<strong>çº¢é»‘æ ‘</strong>è¿™ä¸¤ç§è§£å†³æ–¹æ¡ˆä¸­é€‰ä¸€ç§æ¥BB~</p><p>å½“ç„¶äºŒå‰æŸ¥æ‰¾æ ‘ä¾æ—§æ˜¯å„ç§æ ‘çš„æ ¹åŸºï¼Œè¿˜è¯·è®¤çœŸç†è§£ã€‚<br><img src="https://user-gold-cdn.xitu.io/2018/4/20/162e36b0e7d2e92c?w=788&amp;h=162&amp;f=jpeg&amp;s=22352" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;äºŒåˆ†æŸ¥æ‰¾å¾ˆå¥½çš„è§£å†³äº†æŸ¥æ‰¾é—®é¢˜ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä» O(n)é™åˆ°äº†O(logn)ã€‚&lt;br&gt;ä½†æ˜¯äºŒåˆ†æŸ¥æ‰¾çš„å‰ææ¡ä»¶æ˜¯æ•°æ®å¿…é¡»æ˜¯æœ‰åºçš„ï¼Œå¹¶ä¸”å…·æœ‰çº¿æ€§çš„ä¸‹æ ‡ã€‚&lt;br&gt;å¯¹äºçº¿æ€§è¡¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œä½†æ˜¯åœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶åˆ™å¯èƒ½ä¼šé€ æˆæ•´ä¸ªçº¿æ€§è¡¨çš„åŠ¨è¡ï¼Œæ—¶é—´å¤æ‚åº¦è¾¾åˆ°äº†O(n)&lt;br&gt;é“¾è¡¨æ›´æ˜¯æ²¡æ³•åº”ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;äºæ˜¯æœ‰äº†ä¸‹é¢å°†è¦ä»‹ç»çš„ç®—æ³•ï¼Œå…¶åœ¨æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤éƒ½èƒ½å¤Ÿè¾¾åˆ°O(logn)çš„æ—¶é—´å¤æ‚åº¦ â€”â€” &lt;strong&gt;äºŒå‰æŸ¥æ‰¾æ ‘&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="algorithm" scheme="http://beian.miit.gov.cn/categories/algorithm/"/>
    
    
      <category term="algorithm" scheme="http://beian.miit.gov.cn/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Dijkstraç®—æ³•åŠæ­£ç¡®æ€§åˆ†æ</title>
    <link href="http://beian.miit.gov.cn/posts/dijkstra-algorithm-and-correctness-analysis.html"/>
    <id>http://beian.miit.gov.cn/posts/dijkstra-algorithm-and-correctness-analysis.html</id>
    <published>2018-04-11T09:39:08.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‹å‹é—®äº†ä¸€ä¸ªå…³äºåˆ—è½¦è°ƒåº¦çš„é—®é¢˜ï¼Œæ±‚ä¸¤ä¸ªåœ°ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚å¬èµ·æ¥æŒºç®€å•çš„é—®é¢˜ï¼Œå¯æ˜¯ä»”ç»†æ€è€ƒåå‘ç°å®Œå…¨æ— ä»ä¸‹æ‰‹ã€‚æœ€è¿‘ç©ºé—²ä¸‹æ¥ä¾¿æ¶è¡¥äº†ä¸€ç•ªæ•°æ®ç»“æ„ã€‚</p><p>æ±‚æœ€çŸ­è·¯å¾„çš„æ–¹æ³•æœ‰Dijkstraï¼ŒFloydï¼ŒBFSç­‰ç­‰ å…¶ä¸­Floydé€‚åˆå¤šæºæœ€çŸ­è·¯å¾„ï¼ŒBFSé€‚åˆæ— æƒå€¼çš„æƒ…å†µï¼Œè¿™é‡Œé—®é¢˜å±äºå•æºæœ€çŸ­è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨Dijkstraç®—æ³•.</p><a id="more"></a><p>å¼€å¹²å§ï¼æ‹¿å‡ºåœ°é“å¡å°±æ˜¯ä¸€é¡¿ç”»ï¼Œç°åœ¨æˆ‘ä»¬å°±æŠŠé—®é¢˜æŠ½è±¡ä¸ºæ±‚<strong>å®å®‰ä¸­å¿ƒ-è€è¡—</strong>çš„æœ€çŸ­è·¯å¾„</p><p><img src="http://asset.eienao.com/15233494076868.jpg" alt></p><p>å¼€å§‹ä¹‹å‰é¦–å…ˆæˆ‘ä»¬ä»‹ç»å‡ ä¸ªæ¦‚å¿µ</p><h3 id="foundé›†åˆ"><a href="#foundé›†åˆ" class="headerlink" title="foundé›†åˆ"></a>foundé›†åˆ</h3><p>å¯¹äºè¿™ç§èµ·ç‚¹åˆ°æŸä¸ªé¡¶ç‚¹çš„çœŸæ­£çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºå…¨å±€æœ€çŸ­è·¯å¾„ã€‚å·²ç»æ‰¾åˆ°å…¨å±€æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹ï¼Œæˆ‘ä»¬å°†å…¶å‚¨åœ¨foundé›†åˆä¸­.ç°åœ¨æ¥åˆå§‹åŒ–ä¸€ä¸‹found</p> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹æ—¶,æˆ‘ä»¬å·²çŸ¥çš„å°±åªæœ‰å®å®‰ä¸­å¿ƒåˆ°å®å®‰ä¸­å¿ƒçš„æœ€çŸ­è·¯å¾„</span></span><br><span class="line">$found = [<span class="string">'å®å®‰ä¸­å¿ƒ'</span>];</span><br></pre></td></tr></table></figure><h3 id="disté›†åˆ"><a href="#disté›†åˆ" class="headerlink" title="disté›†åˆ"></a>disté›†åˆ</h3><p>ç”¨æ¥å­˜å‚¨èµ·ç‚¹(å®å®‰ä¸­å¿ƒ)åˆ°æŸä¸ªé¡¶ç‚¹uï¼Œ ç›¸å¯¹äºSçš„æœ€çŸ­è·¯å¾„ã€‚é€šä¿—è§£é‡Šå°±æ˜¯ï¼šå®å®‰ä¸­å¿ƒåˆ°ä¸–ç•Œä¹‹çª—ç»è¿‡äº†æ–°å®‰ï¼Œé‚£ä¹ˆå¿…é¡»æœ‰æ–°å®‰âˆˆ Sã€‚ å¦åˆ™æˆ‘ä»¬æ— æ³•ç›´æ¥çŸ¥é“å…¶ç›¸å¯¹æœ€çŸ­è·¯å¾„ï¼Œåœ¨distä¸­åˆ™å°†å…¶è®°ä¸ºä¸å¯èƒ½å­˜åœ¨çš„å¤§å€¼ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªç‚¹æˆ‘ä»¬ç›®å‰è¿˜æ²¡æœ‰åŠæ³•æ¢ç´¢åˆ°ã€‚</p><blockquote><p>distä¸­å­˜å‚¨çš„æœ€çŸ­è·¯å¾„ç§°ä¹‹ä¸ºç›¸å¯¹äºSçš„æœ€çŸ­è·¯å¾„ã€‚ä¸‹æ–‡æˆ‘ä»¬ç®€ç§°ä¸ºç›¸å¯¹æœ€çŸ­è·¯å¾„ï¼Œå’Œå…¶å¯¹åº”çš„æˆ‘ä»¬æœ‰ä¸€ä¸ªå…¨å±€æœ€çŸ­è·¯å¾„</p></blockquote><p>  åˆå§‹ä¸€ä¸‹disté›†åˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MAX = <span class="number">65525</span>; <span class="comment">//65525æ˜¯æˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªä¸å¯èƒ½å‡ºç°çš„å¤§å€¼</span></span><br><span class="line"></span><br><span class="line"> $dist = [</span><br><span class="line">     <span class="string">'æ·±åœ³åŒ—ç«™'</span> =&gt; <span class="number">5</span>,</span><br><span class="line">     <span class="string">'æ–°å®‰'</span> =&gt; <span class="number">8</span>,</span><br><span class="line">     <span class="string">'ä¸–ç•Œä¹‹çª—'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'ç¦ç”°'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'è´­ç‰©å…¬å›­'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'è€è¡—'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'å¸ƒå‰'</span> =&gt; MAX,</span><br><span class="line"> ];</span><br></pre></td></tr></table></figure><h2 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h2><p>å¼€å§‹æˆ‘ä»¬çš„ç®—æ³•~ æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°<code>dist</code>ä¸­çš„æœ€å°å€¼ï¼Œè¿™é‡Œæ˜¯ <code>æ·±åœ³åŒ—ç«™ =&gt; 5</code>ã€‚</p><p>é¡ºä¾¿å‘Šè¯‰ä½ ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å®å®‰ä¸­å¿ƒåˆ°æ·±åœ³åŒ—ç«™çš„å…¨å±€æœ€çŸ­è·¯å¾„ã€‚</p><blockquote><p>what?ä¸ºä»€ä¹ˆdistä¸­çš„æœ€å°å€¼å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…¨å±€æœ€çŸ­è·¯å¾„(è¿™é‡Œæ˜¯<code>å®å®‰ä¸­å¿ƒ-æ·±åœ³åŒ—ç«™</code>)ï¼Ÿ<br> æˆ‘ä»¬è¦æ‰¾çš„ä¸æ˜¯<code>å®å®‰ä¸­å¿ƒ-è€è¡—</code>çš„å…¨å±€æœ€çŸ­è·¯å¾„å—ï¼ŒçŸ¥é“äº†<code>å®å®‰ä¸­å¿ƒ-æ·±åœ³åŒ—ç«™</code>çš„æœ€çŸ­è·¯å¾„æœ‰ä»€ä¹ˆç”¨å—ï¼Ÿ<br> æˆ‘ç°åœ¨æ²¡æ³•ç»™ä½ ä¸€ä¸ªå¾ˆå¥½çš„è§£é‡Šï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p></blockquote><p> ç»§ç»­è¿›è¡Œç®—æ³•ï¼Œä¸‹é¢æ˜¯çº¢è‰²é¡¶ç‚¹è¡¨ç¤ºå·²ç»ç¡®å®šäº†å…¨å±€æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹</p><p> <img src="http://asset.eienao.com/15233522196267.jpg" alt><br>æ—¢ç„¶å·²ç»åˆæ‰¾åˆ°äº†ä¸€ä¸ªå…¨å±€æœ€çŸ­è·¯å¾„é¡¶ç‚¹ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒæ›´æ–°åˆ°<strong>found</strong>é›†åˆä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$found = [<span class="string">'å®å®‰ä¸­å¿ƒ'</span>, <span class="string">'æ·±åœ³åŒ—ç«™'</span>];</span><br></pre></td></tr></table></figure><p>é›†åˆfoundä¸­çš„å…ƒç´ å¢åŠ äº†ä¸€æšåï¼Œæˆ‘ä»¬çš„è§†é‡å˜çš„å®½å¹¿äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>æ·±åœ³åŒ—ç«™</code>ä½œä¸ºä¸€ä¸ªä¸­è½¬æ›´æ–° <strong>dist</strong>è¿™ä¸ª<strong>ç›¸å¯¹æœ€çŸ­è·¯å¾„</strong>é›†åˆäº†</p><p><img src="http://asset.eienao.com/15233530403158.jpg" alt></p><p>é€šè¿‡æ·±åœ³åŒ—ç«™è¿™ä¸ªä¸­è½¬ç«™æˆ‘ä»¬å¯ä»¥å¾—åˆ°å·²ä¸‹ç›¸å¯¹æœ€çŸ­è·¯å¾„</p><p><code>å®å®‰ä¸­å¿ƒ-æ·±åœ³åŒ—ç«™-æ–°å®‰</code> = 5 + 2 = 7<br><code>å®å®‰ä¸­å¿ƒ-æ·±åœ³åŒ—ç«™-ç¦ç”°</code> = 5 + 5 = 10<br><code>å®å®‰ä¸­å¿ƒ-æ·±åœ³åŒ—ç«™-å¸ƒå‰</code> = 5 + 10 = 15</p><p>ç°åœ¨å¯ä»¥é©¬ä¸Šå»æ›¿æ¢æˆ‘ä»¬<strong>dist</strong>é›†åˆä¸­çš„å€¼äº†å—ï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç›¸å¯¹æœ€çŸ­è·¯å¾„ï¼Œå¯ä¸æ˜¯ä»€ä¹ˆé˜¿çŒ«é˜¿ç‹—å°±èƒ½è¿›æ¥çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒ.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœæ–°çš„ç›¸å¯¹æœ€çŸ­è·¯å¾„æ¯”åŸæœ‰çš„ç›¸å¯¹æœ€çŸ­è·¯å¾„è¦å°ï¼Œæˆ‘ä»¬åˆ™è¿›è¡Œä¸€ä¸ªæ›´æ–°</span></span><br><span class="line"><span class="keyword">if</span> ($newWeight &lt; $dist[<span class="string">'æ–°å®‰'</span>]) &#123;</span><br><span class="line">    $dist[<span class="string">'æ–°å®‰'</span>] = $newWeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>dist</strong>é›†åˆæ›´æ–°å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$dist = [</span><br><span class="line">     <span class="string">'æ·±åœ³åŒ—ç«™'</span> =&gt; <span class="number">5</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'æ–°å®‰'</span> =&gt; <span class="number">7</span>, <span class="comment">//8 -&gt; 7</span></span><br><span class="line">     <span class="string">'ä¸–ç•Œä¹‹çª—'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'ç¦ç”°'</span> =&gt; <span class="number">10</span>, <span class="comment">// MAX -&gt; 10</span></span><br><span class="line">     <span class="string">'è´­ç‰©å…¬å›­'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'è€è¡—'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'å¸ƒå‰'</span> =&gt; <span class="number">15</span> <span class="comment">// MAX -&gt; 15</span></span><br><span class="line"> ];</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬é‡å¤ä¹‹å‰çš„æ­¥éª¤ï¼Œæ‰¾ä¸€ä¸ªæœ€å°å€¼ï¼Œå…¶å°±æ˜¯æˆ‘ä»¬ä¸‹ä¸€ä¸ªå…¨å±€æœ€çŸ­è·¯å¾„ã€‚è¦è®°ä½ï¼Œæ·±åœ³åŒ—ç«™å°±ä¸è¦åŠ å…¥æŸ¥æ‰¾é˜Ÿåˆ—äº†ï¼Œå…¶å·²ç»è¢«foundäº†</p><p>äººçœ¼æ‰«æåå¯ä»¥ç¡®å®šä¸‹ä¸€ä¸ªå…¨å±€æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹ä¸ºæ–°å®‰ã€‚å¹¶ä¸”æœ‰äº†æ–°å®‰çš„ä¸­è½¬ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡æ‹“å®½æˆ‘ä»¬çš„è§†é‡</p><blockquote><p>ä¸ºäº†è¡¨ç¤ºæ¸…æ™°,å¯¹äºè¿˜æ²¡æœ‰æ¢ç´¢åˆ°ç›¸å¯¹æœ€çŸ­è·¯å¾„ï¼Œå…ˆéšè—å…¶æƒé‡å€¼</p></blockquote><p><img src="http://asset.eienao.com/15233539494101.jpg" alt><br>æ›´æ–°åçš„<strong>found</strong>å’Œ<strong>dist</strong>å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$found = [<span class="string">'å®å®‰ä¸­å¿ƒ'</span>, <span class="string">'æ·±åœ³åŒ—ç«™'</span>,<span class="string">'æ–°å®‰'</span>];</span><br><span class="line"></span><br><span class="line">$dist = [</span><br><span class="line">     <span class="string">'æ·±åœ³åŒ—ç«™'</span> =&gt; <span class="number">5</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'æ–°å®‰'</span> =&gt; <span class="number">7</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'ä¸–ç•Œä¹‹çª—'</span> =&gt; <span class="number">16</span>, <span class="comment">// MAX -&gt; 16 = 9+7 = å®å®‰-&gt;æ–°å®‰ + æ–°å®‰-&gt;ä¸–ç•Œä¹‹çª—</span></span><br><span class="line">     <span class="string">'ç¦ç”°'</span> =&gt; <span class="number">10</span>, <span class="comment">// MAX -&gt; 10</span></span><br><span class="line">     <span class="string">'è´­ç‰©å…¬å›­'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'è€è¡—'</span> =&gt; MAX,</span><br><span class="line">     <span class="string">'å¸ƒå‰'</span> =&gt; <span class="number">15</span></span><br><span class="line"> ];</span><br></pre></td></tr></table></figure><p>å†æ¬¡å¾ªç¯ (ç›®æ ‡å·²ç»å‡ºç°åœ¨æˆ‘ä»¬çš„è§†é‡ä¸­å•¦ï¼Œåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ç¡®å®šå…¶å…¨å±€æœ€çŸ­è·¯å¾„) â†“</p><p><img src="http://asset.eienao.com/15233548442864.jpg" alt></p><p>æ›´æ–°åçš„så’Œdistå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$found = [<span class="string">'å®å®‰ä¸­å¿ƒ'</span>, <span class="string">'æ·±åœ³åŒ—ç«™'</span>, <span class="string">'æ–°å®‰'</span>, <span class="string">'ç¦ç”°'</span>];</span><br><span class="line"></span><br><span class="line">$dist = [</span><br><span class="line">     <span class="string">'æ·±åœ³åŒ—ç«™'</span> =&gt; <span class="number">5</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'æ–°å®‰'</span> =&gt; <span class="number">7</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'ä¸–ç•Œä¹‹çª—'</span> =&gt; <span class="number">16</span>,</span><br><span class="line">     <span class="string">'ç¦ç”°'</span> =&gt; <span class="number">10</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'è´­ç‰©å…¬å›­'</span> =&gt; <span class="number">12</span>, <span class="comment">// MAX -&gt; 12</span></span><br><span class="line">     <span class="string">'è€è¡—'</span> =&gt; <span class="number">15</span>, <span class="comment">// MAX -&gt; 15</span></span><br><span class="line">     <span class="string">'å¸ƒå‰'</span> =&gt; <span class="number">15</span></span><br><span class="line"> ];</span><br></pre></td></tr></table></figure><p>å†æ¬¡å¾ªç¯â†“</p><p><img src="http://asset.eienao.com/15233550139862.jpg" alt></p><p>æ›´æ–°åçš„foundå’Œdistå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$s = [<span class="string">'å®å®‰ä¸­å¿ƒ'</span>, <span class="string">'æ·±åœ³åŒ—ç«™'</span>, <span class="string">'æ–°å®‰'</span>, <span class="string">'ç¦ç”°'</span>, <span class="string">'è´­ç‰©å…¬å›­'</span>];</span><br><span class="line"></span><br><span class="line">$dist = [</span><br><span class="line">     <span class="string">'æ·±åœ³åŒ—ç«™'</span> =&gt; <span class="number">5</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'æ–°å®‰'</span> =&gt; <span class="number">7</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'ä¸–ç•Œä¹‹çª—'</span> =&gt; <span class="number">16</span>,</span><br><span class="line">     <span class="string">'ç¦ç”°'</span> =&gt; <span class="number">10</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'è´­ç‰©å…¬å›­'</span> =&gt; <span class="number">12</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'è€è¡—'</span> =&gt; <span class="number">15</span>,</span><br><span class="line">     <span class="string">'å¸ƒå‰'</span> =&gt; <span class="number">15</span></span><br><span class="line"> ];</span><br></pre></td></tr></table></figure><p>å†æ¬¡å¯»æ‰¾distä¸­æœ€å°å€¼æ—¶ï¼Œ æ‰¾åˆ°äº†æˆ‘ä»¬çš„ç›®æ ‡ï¼Œè€è¡—ã€‚</p><p><img src="http://asset.eienao.com/15234317131194.jpg" alt></p><p><strong>ç®—æ³•æè¿°å®Œæ¯•!</strong></p><h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><p><a href="https://github.com/weiwenhao/algorithm/blob/master/src/Dijkstra.php" target="_blank" rel="noopener">https://github.com/weiwenhao/algorithm/blob/master/src/Dijkstra.php</a></p><h2 id="æ­£ç¡®æ€§åˆ†æ"><a href="#æ­£ç¡®æ€§åˆ†æ" class="headerlink" title="æ­£ç¡®æ€§åˆ†æ"></a>æ­£ç¡®æ€§åˆ†æ</h2><p>ä¸ºä»€ä¹ˆdisté›†åˆä¸­çš„æœ€å°å€¼å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…¨å±€æœ€çŸ­è·¯å¾„ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$dist = [</span><br><span class="line">     <span class="string">'ç¦ç”°'</span> =&gt; <span class="number">10</span>, <span class="comment">// ok</span></span><br><span class="line">     <span class="string">'è´­ç‰©å…¬å›­'</span> =&gt; <span class="number">12</span>,</span><br><span class="line">     <span class="string">'è€è¡—'</span> =&gt; <span class="number">15</span>,</span><br><span class="line"> ];</span><br></pre></td></tr></table></figure><p>ä»¥æŸä¸€æ¬¡disté›†åˆçš„éƒ¨åˆ†æ•°æ®ä¸ºä¾‹å­ï¼ŒæŒ‰ç…§ç®—æ³•æè¿° <code>å®å®‰ä¸­å¿ƒ-ç¦ç”°-è´­ç‰©å…¬å›­</code>æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…¨å±€æœ€çŸ­è·¯å¾„ã€‚ç°åœ¨æˆ‘ä»¬å‡è®¾åˆ°<code>å®å®‰ä¸­å¿ƒ-è´­ç‰©å…¬å›­</code>å­˜åœ¨æ›´çŸ­çš„è·¯å¾„ï¼Œåˆ™å­˜åœ¨å¦‚ä¸‹ä¸¤ç§æƒ…å†µ</p><h3 id="æƒ…å†µ1"><a href="#æƒ…å†µ1" class="headerlink" title="æƒ…å†µ1"></a>æƒ…å†µ1</h3><p><img src="http://asset.eienao.com/15234386518638.jpg" alt></p><blockquote><p>çº¢è‰²åŒºåŸŸä»£è¡¨é›†åˆfoundï¼Œè¡¨ç¤ºå·²ç»æ‰¾åˆ°äº†å…¨å±€æœ€çŸ­è·¯å¾„çš„é¡¶ç‚¹é›†åˆã€‚<br>ä¸Šé¢æåˆ°è¿‡ï¼Œdisté›†åˆä¸­å­˜å‚¨çš„æ˜¯ç›¸å¯¹äºSçš„æœ€çŸ­è·¯å¾„ã€‚</p></blockquote><p>å¯¹äºè¿™ç§æƒ…å†µï¼Œç®—æ³•åœ¨è¿›è¡Œdisté›†åˆæ›´æ–°æ“ä½œçš„æ—¶å€™å°±å·²ç»åˆ¤æ–­äº†<code>å®å®‰ä¸­å¿ƒ-ç¦ç”°-è´­ç‰©å…¬å›­</code>å’Œ<code>å®å®‰ä¸­å¿ƒ-X-è´­ç‰©å…¬å›­</code>ä¹‹é—´çš„æ›´å°å€¼ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸å¯èƒ½å­˜åœ¨ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹å¦å¤–ä¸€ç§æ›´åŠ å¯èƒ½å‡ºç°çš„æƒ…å†µ</p><ul><li>æƒ…å†µ2</li></ul><p><img src="http://asset.eienao.com/15234352675359.jpg" alt></p><p>æ˜¯å¦ä¼šå­˜åœ¨è¿™æ ·ä¸€æ¡æœ€çŸ­è·¯å¾„å‘¢ï¼Ÿå› ä¸º<code>y-è´­ç‰©å…¬å›­</code>çš„è·ç¦»æˆ‘ä»¬å¹¶æ²¡æœ‰æ¢ç´¢è¿‡ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µæ˜¯éœ€è¦æ…é‡æ€è€ƒä¸€ç§æƒ…å†µã€‚</p><p>å…ˆè®©æ—¶å…‰å€’æµ<br><img src="http://asset.eienao.com/15234387863781.jpg" alt></p><p>æ­¤æ—¶æˆ‘ä»¬çš„disté›†åˆä¸­ä¸€å…±æœ‰5ä¸ªé¡¶ç‚¹ã€‚å…¶ä¸­å®å®‰ä¸­å¿ƒï¼Œç¦ç”°ï¼ŒXå·²ç»è¢«åŠ å…¥åˆ°äº†foundé›†åˆä¸­ã€‚Yé€šè¿‡Xçš„ä¸­è½¬åè¢«å‘ç°ï¼Œè´­ç‰©å…¬å›­é€šè¿‡ç¦ç”°ä¸­ä¸“åè¢«å‘ç°ã€‚<br>æ­¤æ—¶æ ¹æ®æˆ‘ä»¬çš„ç®—æ³•ï¼Œå°†ä¼šåœ¨Yå’Œè´­ç‰©å…¬å›­ä¸­é€‰å–ä¸€ä¸ªæœ€å°å€¼ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªå…¨å±€æœ€çŸ­è·¯å¾„é¡¶ç‚¹ã€‚è¿™é‡Œç®—æ³•é€‰æ‹©äº†è´­ç‰©å…¬å›­ã€‚è¯´æ˜<code>å®å®‰ä¸­å¿ƒ-ç¦ç”°-è´­ç‰©å…¬å›­ &lt; å®å®‰ä¸­å¿ƒ-X-Y</code></p><p>å›åˆ°æƒ…å†µ2<br><img src="http://asset.eienao.com/15234352675359.jpg" alt></p><p>åœ¨æœ‰äº† <code>å®å®‰ä¸­å¿ƒ-ç¦ç”°-è´­ç‰©å…¬å›­ &lt; å®å®‰ä¸­å¿ƒ-X-Y</code>å‰æä¸‹ã€‚<br><code>å®å®‰ä¸­å¿ƒ-X-Y-è´­ç‰©å…¬å›­ &lt; å®å®‰ä¸­å¿ƒ-ç¦ç”°-è´­ç‰©å…¬å›­</code>æ˜¯å¦èƒ½å¤Ÿæˆç«‹å‘¢ï¼Ÿå‡å¦‚ç­‰å¼ä¸æˆç«‹ï¼Œåˆ™è¯´æ˜ä¸å¯èƒ½å­˜åœ¨ä¸€æ¡æ¯”<code>å®å®‰ä¸­å¿ƒ-ç¦ç”°-è´­ç‰©å…¬å›­</code>æ›´çŸ­çš„å…¨å±€æœ€çŸ­è·¯å¾„ã€‚</p><p>ç­‰å¼æ˜¯å¦æˆç«‹æˆ‘ç›¸ä¿¡ä½ ä¸€ç›®äº†ç„¶ã€‚</p><p><strong>æ­£ç¡®æ€§åˆ†æå®Œæ¯•ï¼</strong></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä½ å¯èƒ½è¿˜åœ¨æƒŠè®¶äºdijkstraç®—æ³•ä¸ºä»€ä¹ˆè¿™ä¹ˆç¥å¥‡ï¼Ÿå°±ç®—æˆ‘ä»¬å·²ç»çŸ¥é“äº†ç®—æ³•æ­¥éª¤ï¼Œåˆ†æäº†ç®—æ³•çš„æ­£ç¡®æ€§ã€‚å¯è¿˜æ˜¯ä¸ç¦ä¼šæ„Ÿå¹ï¼Œåˆ°åº•æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œåˆ°åº•æ˜¯æ€ä¹ˆæ‰¾åˆ°æœ€ä¼˜è§£çš„ï¼Ÿ</p><p>å›è¿‡å¤´å»çœ‹çœ‹ç®—æ³•æè¿°ä½ ä¼šå‘ç°ï¼Œå…¶å®<strong>dijkstra</strong>å¹¶ä¸çŸ¥é“è‡ªå·±ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿæ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ç›®æ ‡ï¼Œå®ƒåªæ˜¯å…³æ³¨äºçœ¼å‰çš„æœ€ä¼˜è§£ï¼Œç„¶åç¢°å·§åœ¨æŸä¸€æ—¶åˆ»çœ¼å‰çš„æœ€ä¼˜è§£å°±æ˜¯è¦å¯»æ‰¾çš„ç›®æ ‡å€¼ã€‚è¿™çœ‹èµ·æ¥æœ‰ç‚¹ç¬¨ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µååˆ†æœ‰ç”¨ï¼Œæ¯”å¦‚è·¯ç”±å¯»å€ä¸­æŸ¥æ‰¾æœ€çŸ­è·¯å¾„å¿…é¡»è¦ç”¨åˆ°è¿™ç§ç­–ç•¥ã€‚</p><p>å“¦~å¯¹äº†ï¼Œè¿™ç§åªå…³æ³¨äºçœ¼å‰æœ€ä¼˜è§£çš„æ–¹æ³•å…¶å®æœ‰ä¸ªæ›´åŠ æœ‰é€¼æ ¼çš„åå­— â€”â€”  è´ªå¿ƒç®—æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æœ‹å‹é—®äº†ä¸€ä¸ªå…³äºåˆ—è½¦è°ƒåº¦çš„é—®é¢˜ï¼Œæ±‚ä¸¤ä¸ªåœ°ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ã€‚å¬èµ·æ¥æŒºç®€å•çš„é—®é¢˜ï¼Œå¯æ˜¯ä»”ç»†æ€è€ƒåå‘ç°å®Œå…¨æ— ä»ä¸‹æ‰‹ã€‚æœ€è¿‘ç©ºé—²ä¸‹æ¥ä¾¿æ¶è¡¥äº†ä¸€ç•ªæ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;æ±‚æœ€çŸ­è·¯å¾„çš„æ–¹æ³•æœ‰Dijkstraï¼ŒFloydï¼ŒBFSç­‰ç­‰ å…¶ä¸­Floydé€‚åˆå¤šæºæœ€çŸ­è·¯å¾„ï¼ŒBFSé€‚åˆæ— æƒå€¼çš„æƒ…å†µï¼Œè¿™é‡Œé—®é¢˜å±äºå•æºæœ€çŸ­è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨Dijkstraç®—æ³•.&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä½ çœŸçš„äº†è§£ Git å—ï¼Ÿ</title>
    <link href="http://beian.miit.gov.cn/posts/do-you-really-know-git.html"/>
    <id>http://beian.miit.gov.cn/posts/do-you-really-know-git.html</id>
    <published>2018-04-08T08:31:19.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹äº†å‡ éå»–é›ªå³°çš„gitæ•™ç¨‹å’Œé˜®ä¸€å³°çš„gitæ•™ç¨‹ä¹‹åï¼Œè§‰å¾—è‡ªå·±ä½¿ç”¨gitå·²ç»æ˜¯å¾—å¿ƒåº”æ‰‹äº†ï¼Œè„‘ä¸­ä¹Ÿæ„å»ºå‡ºäº†ä¸€å‰¯å…³äºgitæ“ä½œçš„å›¾åƒã€‚</p><blockquote><p>å­¦ä¹ ä¸€ä¸ªæ–°ä¸œè¥¿çš„æ—¶å€™æˆ‘æ€»æ˜¯å–œæ¬¢æŠŠçŸ¥è¯†å½¢è±¡åŒ–å‡ºä¸€ä¸ªå›¾è°±åœ¨è„‘ä¸­ï¼Œè¿™æ ·è®°å¿†çš„æ›´åŠ æ·±åˆ»ã€‚</p></blockquote><p>ä½†æ˜¯éšç€ä½¿ç”¨çš„æ·±å…¥ï¼Œæˆ‘å‘ç°æˆ‘è„‘ä¸­çš„å›¾åƒä¸gitçš„å®é™…è¡Œä¸ºå­˜åœ¨å‡ºå…¥ã€‚</p><a id="more"></a><p>ç¨å¾®è¿›å…¥ä¸€ä¸‹æ­£é¢˜ã€‚å‡å¦‚ä½ çš„ä»“åº“å…³è”äº†è¿œç¨‹ä»“åº“ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ<code>&gt;git status</code>æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹æç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># æ‚¨çš„åˆ†æ”¯ä¸origin/master ä¸€è‡´</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure><p>å½“æˆ‘çš„é˜Ÿå‹commit and push ä¹‹åæˆ‘å†æ¬¡æ‰§è¡Œ <code>&gt;git status</code>ï¼Œæˆ‘ä»¥ä¸ºä¼šæœ‰å¦‚ä¸‹æç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä½ çš„åˆ†æ”¯è½åäº origin/masterä¸€æ¬¡æäº¤.å¹¶ä¸”å¯ä»¥å¿«é€Ÿåˆå¹¶.æ‰§è¡Œgit pullå¯ä»¥è¿›è¡Œå¿«é€Ÿåˆå¹¶</span><br><span class="line">On branch master</span><br><span class="line">Your branch is behind &apos;origin/master&apos; by 1 commits, and can be fast-forwarded.</span><br><span class="line">  (use &quot;git pull&quot; to update your local branch)</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯é˜®ä¸€å³°å¤§ç¥ä¸€ç¯‡åšå®¢ä¸­çœ‹åˆ°çš„gitæ“ä½œç¤ºæ„å›¾</p><blockquote><p>ç½‘ä¸Šæµä¼ çš„å¤§éƒ¨åˆ†èµ„æ–™éƒ½ç±»ä¼¼è¿™æ ·</p></blockquote><p><img src="http://asset.eienao.com/15231690297894.jpg" alt></p><p>é€šè¿‡è¿™å¹…å›¾ï¼Œæˆ‘ç†æ‰€å½“ç„¶çš„è®¤ä¸ºåœ¨é˜Ÿå‹pushä¹‹åï¼Œæˆ‘æ‰§è¡Œgit statuså‘½ä»¤ä¼šæç¤º<code>Your branch is behind</code><br>æˆ‘ç›¸ä¿¡å¾ˆå¤šäººéƒ½æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ã€‚</p><p>ä½†å®é™…äº§ç”Ÿçš„è¡Œä¸ºæ˜¯å‰è€…ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Ÿ è¿™å°±æ˜¯æˆ‘çš„é—®é¢˜ã€‚<br>å†æŠ½è±¡ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ <strong>git status æ˜¯å¯¹å“ªä¸¤ä¸ªä»“åº“è¿›è¡Œçš„æ¯”è¾ƒ?</strong></p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹æç¤ºè¯­å¥ <code>Your branch is behind &#39;origin/master&#39;</code> ã€‚ä¸éš¾çœ‹å‡ºæ˜¯ <code>master</code>åˆ†æ”¯å’Œ <code>origin/master</code>è¿›è¡Œçš„æ¯”è¾ƒ</p><p>æŒ‰ç…§ä¸Šé¢çš„ç¤ºæ„å›¾ï¼Œä¹Ÿå°±æ˜¯ Remote(origin/master)å’ŒRepositoryè¿›è¡Œäº†ä¸€ä¸ªæ¯”è¾ƒã€‚ä½†æ˜¯è¿™ä¸å®é™…æƒ…ä¸ç¬¦ã€‚</p><p>å¦‚æœä½ æœ‰å¿ƒå°è¯•ï¼Œä½ ä¼šå‘ç°<code>git status</code>æ˜¯ä¸€ä¸ªæ–­ç½‘ä¹‹åä¹Ÿå¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ã€‚æ‰€ä»¥ä¸å¯èƒ½æ˜¯Remoteå’ŒRepositoryè¿›è¡Œçš„æ¯”è¾ƒã€‚</p><p>äºæ˜¯ç»è¿‡ç®€å•çš„æµ‹è¯•ï¼Œæˆ‘è„‘æµ·ä¸­åˆé‡æ–°æ„å»ºå‡ºä¸€ä»½gitç¤ºæ„å›¾ã€‚</p><h3 id="æ²¡æœ‰è¿œç¨‹ä»“åº“æ—¶ï¼Œæˆ‘ä»¬å¸¸æ‰§è¡Œçš„å‘½ä»¤æœ‰ä¸¤æ¡"><a href="#æ²¡æœ‰è¿œç¨‹ä»“åº“æ—¶ï¼Œæˆ‘ä»¬å¸¸æ‰§è¡Œçš„å‘½ä»¤æœ‰ä¸¤æ¡" class="headerlink" title="æ²¡æœ‰è¿œç¨‹ä»“åº“æ—¶ï¼Œæˆ‘ä»¬å¸¸æ‰§è¡Œçš„å‘½ä»¤æœ‰ä¸¤æ¡"></a>æ²¡æœ‰è¿œç¨‹ä»“åº“æ—¶ï¼Œæˆ‘ä»¬å¸¸æ‰§è¡Œçš„å‘½ä»¤æœ‰ä¸¤æ¡</h3><p><code>git add</code>å’Œ<code>git commit</code> é€šè¿‡è¿™ä¸¤æ¡å‘½ä»¤ç»˜åˆ¶å‡ºå¦‚ä¸‹å›¾åƒ<br><img src="http://asset.eienao.com/15231725127941.jpg" alt></p><h3 id="å½“å…³è”è¿œç¨‹ä»“åº“åï¼Œå¾—åˆ°å¦‚ä¸‹ç¤ºæ„å›¾"><a href="#å½“å…³è”è¿œç¨‹ä»“åº“åï¼Œå¾—åˆ°å¦‚ä¸‹ç¤ºæ„å›¾" class="headerlink" title="å½“å…³è”è¿œç¨‹ä»“åº“åï¼Œå¾—åˆ°å¦‚ä¸‹ç¤ºæ„å›¾"></a>å½“å…³è”è¿œç¨‹ä»“åº“åï¼Œå¾—åˆ°å¦‚ä¸‹ç¤ºæ„å›¾</h3><p><img src="http://asset.eienao.com/15231740463034.jpg" alt></p><p>è¿™å¼ å›¾æ˜¯æˆ‘æ ¹æ®gitå‘½ä»¤çš„ä¸€äº›è¡Œä¸ºå¾—åˆ°ï¼Œéæƒå¨ã€‚å’Œä¸Šé¢é˜®ä¸€å³°çš„ç¤ºæ„å›¾ç›¸æ¯”ï¼Œæœ¬åœ°å¢åŠ äº†ä¸€ä¸ª origin/masterã€‚</p><p>å†ç¨å¾®ä»‹ç»å‡ ä¸ªå‘½ä»¤</p><h3 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h3><p>è¯¥å‘½ä»¤æ²¡æœ‰åœ¨å›¾ä¸Šä½“ç°ï¼Œå…¶æ˜¯ä¸€æ¡å¤åˆå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull = git fetch + git merge origin/master</span><br></pre></td></tr></table></figure><p>git fetchæ“ä½œå°†remoteåŒæ­¥åˆ°æœ¬åœ°çš„origin/master</p><p>git merge origin/master å°† originçš„masteråˆ†æ”¯ åˆå¹¶åˆ° ä»“åº“çš„masteråˆ†æ”¯ã€‚</p><h3 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h3><p>è¿™æ¡å‘½ä»¤æˆ‘æ²¡æ³•ç¡®åˆ‡çš„ç†è§£ã€‚æˆ‘çš„çŒœæµ‹æ˜¯ï¼Œ git pushæ“ä½œæ˜¯å°†localçš„master pushåˆ°äº†localçš„origin/master<br>gitæ£€æµ‹åˆ°originå˜åŒ–ä¹‹åï¼Œè¿›è¡Œäº†ä¸€ä¸ªoriginåˆ°remoteçš„åŒæ­¥æ“ä½œ</p><h3 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h3><p>è¯¥å‘½ä»¤ä¸­å¯¹æ¯”çš„ä¸¤ä¸ªä»“åº“å¦‚å›¾ç¤ºã€‚é€šè¿‡ä¸Šå›¾å°±èƒ½å¤Ÿè§£é‡Šï¼Œä¸ºä»€ä¹ˆ é˜Ÿå‹æäº¤åˆ°remoteä¹‹å,æˆ‘æ‰§è¡Œgit statusæ²¡æœ‰è½åæç¤ºã€‚è‡³æ­¤æˆ‘ä¸Šæ–‡æåˆ°çš„é—®é¢˜å¾—åˆ°äº†è§£å†³ã€‚</p><h2 id="ç»“"><a href="#ç»“" class="headerlink" title="ç»“"></a>ç»“</h2><p>æˆ‘è®¤ä¸ºlocalå’Œremoteä¹‹é—´çš„è¡Œä¸ºï¼Œç”¨æ¨é€å’Œæ‹‰å–æ¥æè¿°å¹¶ä¸é‚£ä¹ˆä¼˜é›…ã€‚è¿™ä¸¤ä¸ªè¯å¾ˆå®¹æ˜“ä¼šè¯¯è§£æˆï¼Œremoteæ˜¯ä¸€ä¸ªæ§åˆ¶ä¸­å¿ƒã€‚</p><p>å®é™…ä¸Šlocalå’Œremoteä¹‹é—´è¿›è¡Œçš„åªæ˜¯ç®€å•çš„åŒæ­¥æ“ä½œï¼Œæ— è®ºæ˜¯ç¤ºæ„å›¾è¿˜æ˜¯æˆ‘åœ¨ä»‹ç»git fetchå’Œgit pushéƒ½åˆ»æ„ä½“ç°å‡ºäº†è¿™ç§åŒæ­¥ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼ŒåŒæ­¥è¿™ä¸ªå­—çœ¼æ›´èƒ½ä½“ç°gitè®¾è®¡çš„åˆè¡· â€”â€” åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çœ‹äº†å‡ éå»–é›ªå³°çš„gitæ•™ç¨‹å’Œé˜®ä¸€å³°çš„gitæ•™ç¨‹ä¹‹åï¼Œè§‰å¾—è‡ªå·±ä½¿ç”¨gitå·²ç»æ˜¯å¾—å¿ƒåº”æ‰‹äº†ï¼Œè„‘ä¸­ä¹Ÿæ„å»ºå‡ºäº†ä¸€å‰¯å…³äºgitæ“ä½œçš„å›¾åƒã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å­¦ä¹ ä¸€ä¸ªæ–°ä¸œè¥¿çš„æ—¶å€™æˆ‘æ€»æ˜¯å–œæ¬¢æŠŠçŸ¥è¯†å½¢è±¡åŒ–å‡ºä¸€ä¸ªå›¾è°±åœ¨è„‘ä¸­ï¼Œè¿™æ ·è®°å¿†çš„æ›´åŠ æ·±åˆ»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†æ˜¯éšç€ä½¿ç”¨çš„æ·±å…¥ï¼Œæˆ‘å‘ç°æˆ‘è„‘ä¸­çš„å›¾åƒä¸gitçš„å®é™…è¡Œä¸ºå­˜åœ¨å‡ºå…¥ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç¼–å†™æ›´å…·æœ‰æè¿°æ€§çš„ RESTful API</title>
    <link href="http://beian.miit.gov.cn/posts/writing-more-descriptive-restful-api.html"/>
    <id>http://beian.miit.gov.cn/posts/writing-more-descriptive-restful-api.html</id>
    <published>2018-04-01T07:36:09.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘æ—¶å¸¸è§‰å¾—åç«¯åº”è¯¥å…³å¿ƒçš„æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡ã€‚<br>å› æ­¤æˆ‘å¸Œæœ›èƒ½å¤Ÿåœ¨æ•°æ®çš„åŸºç¡€ä¸Šç¼–å†™ä¸€å¥—æ¥å£ èƒ½å¤Ÿæ»¡è¶³h5ç«¯ã€pcç«¯ã€ios/androidç«¯ã€åŒ…æ‹¬å°ç¨‹åºç«¯ç­‰ç­‰80%çš„éœ€æ±‚</p><a id="more"></a><p>laravel + dingo/api å¯¹äºapiå¼€å‘æ¥è¯´å·²ç»è¶³å¤Ÿå‹å¥½äº†ï¼Œå› æ­¤é€‰æ‹©åœ¨å®ƒçš„åŸºç¡€ä¸Šæ„å»ºã€‚</p><p>é¢„å¤‡çš„çŸ¥è¯†</p><ul><li>laravel</li><li>RESTful</li><li>dingo/api</li></ul><h2 id="æŸ¥è¯¢Filter"><a href="#æŸ¥è¯¢Filter" class="headerlink" title="æŸ¥è¯¢Filter"></a>æŸ¥è¯¢Filter</h2><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p>æ’åºå­—æ®µçš„é€‰æ‹©åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šç§</p><ol><li><code>?sort_field=created_at&amp;sort_order=asc</code> </li><li><code>?order=+created</code></li><li><p><code>?sort_by=created_at&amp;order=asc</code><br>â€¦</p><p>è¿™é‡Œé€‰æ‹©åœ¨ç¬¬ä¸‰ç§æ–¹å¼,åœ¨å¯è¯»æ€§å’Œæ•°æ®å¤„ç†ä¸Šæ›´åŠ æ–¹ä¾¿</p></li></ol><p><strong>urlï¼š</strong> <code>http://api.test/api/posts?sort_by=created_at&amp;order=desc</code></p><p><strong>laravelï¼š</strong> <code>$query-&gt;orderBy(request()-&gt;get(&#39;sort_by&#39;, &#39;id&#39;), request()-&gt;get(&#39;order&#39;, &#39;desc&#39;))</code></p><h3 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h3><p>å¯¹äºåˆ†é¡µæ¥è¯´ <code>offset/limit</code>å’Œ<code>page/per_page</code> åˆæ˜¯ä¸¤ä¸ªçº ç»“çš„é€‰æ‹©<br>å¸¸è§çš„åˆ†é¡µéœ€æ±‚æœ‰ä¸¤ç§ï¼Œä¸€ç§æ—¶æ™®é€šçš„ajaxåˆ†é¡µï¼Œå¦å¤–ä¸€ç§æ˜¯ä¸‹æ‹‰åŠ è½½æ›´å¤šåˆ†é¡µ<br>ajaxåˆ†é¡µç›¸æ¯”äºåŠ è½½æ›´å¤š é€šå¸¸éœ€è¦ä¸€ä¸ªtotal</p><p>å› æ­¤é€‰æ‹©èƒ½åŒæ—¶é€‚åº”ä¸¤ç§åˆ†é¡µéœ€æ±‚çš„ <code>page/per_page</code>ï¼Œlaravelå’Œdingo/apiå¯¹è¯¥æ–¹å¼çš„æ”¯æŒä¹Ÿè¶³å¤Ÿå¥½</p><p><strong>urlï¼š</strong> <code>http://maxwei.me/api/posts?per_page=3&amp;page=2</code></p><p><strong>laravelï¼š</strong> <code>$query-&gt;paginate(request()-&gt;get(&#39;per_page&#39;, 15))-&gt;appends(request()-&gt;except(&#39;page&#39;))</code></p><p><strong>è¿”å›ç»“æœä¸­çš„linksç¤ºä¾‹ï¼š</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;links&quot;: &#123;</span><br><span class="line">        &quot;next&quot;: &quot;http://api.test/api/posts?order=asc&amp;page=3&quot;,</span><br><span class="line">        &quot;previous&quot;: &quot;http://mp.test/api/diaries?order=asc&amp;page=1&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p><h3 id="å­—æ®µç­›é€‰"><a href="#å­—æ®µç­›é€‰" class="headerlink" title="å­—æ®µç­›é€‰"></a>å­—æ®µç­›é€‰</h3><p><strong>apiï¼š</strong> <code>api.test/users?fields=id,nickname,avatar</code> å¯¹äºuserè¡¨ä¸­çš„phoneï¼Œpasswordå­—æ®µæ¨èä½¿ç”¨Modelçš„hiddenå±æ€§éšè—ã€‚<br><strong>laravelï¼š</strong> <code>!is_null(request()-&gt;get(&#39;fields&#39;)) &amp;&amp; $query-&gt;addSelect(explode(&#39;,&#39;, request()-&gt;get(&#39;fields&#39;)));</code></p><p>transform()çš„å¸¸ç”¨å†™æ³•å’Œfieldsæœ‰ä¸€å®šçš„å†²çªï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="whereç­›é€‰"><a href="#whereç­›é€‰" class="headerlink" title="whereç­›é€‰"></a>whereç­›é€‰</h3><p>å½“æˆ‘ä»¬åªæƒ³è¦çŠ¶æ€ä¸º1çš„æ–‡ç« æ—¶ æˆ‘å¸Œæœ›å¯ä»¥è¿™ä¹ˆåš<br><strong>urlï¼š</strong> <code>http://api.test/api/posts?status=1</code></p><p>å½“æˆ‘æƒ³è¦æ ‡ç­¾idä¸º1, 2çš„æ–‡ç« æ—¶åˆ™è¿™æ ·<br><strong>urlï¼š</strong> <code>http://api.test/api/posts?tag_id=1,2</code></p><p>å½“æˆ‘â€¦ å¤Ÿäº†ï¼Œç®€å•ç‚¹æ˜¯æˆ‘æ‰€è¿½æ±‚çš„ï¼Œæˆ‘ä¸å¸Œæœ›å»åˆ›å»ºä¸€äº›è§„åˆ™æ»¡è¶³æ¨¡ç³ŠæŸ¥è¯¢ã€notInã€orWhereã€åµŒå¥—whereç­‰ç­‰ã€‚è¿™ä¸å…·æœ‰é€šç”¨æ€§ï¼Œå¦‚æœéœ€è¦å¯ä»¥åˆ›å»ºä¸€äº›ç‰¹å®šçš„è·¯ç”±å»æ»¡è¶³è¿™äº›æ¡ä»¶å³å¯ã€‚</p><p><strong>laravel:</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$where = [<span class="string">'status'</span>, <span class="string">'tag_id'</span>] <span class="comment">//è¿™æ˜¯æˆ‘å¸Œæœ›èƒ½å¤Ÿè¢«ç­›é€‰çš„å­—æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($where <span class="keyword">as</span> $item) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_null($value = request()-&gt;get($item))) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (str_contains($value, <span class="string">','</span>)) &#123;</span><br><span class="line">        $query-&gt;whereIn($item, explode(<span class="string">','</span>, $value));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $query-&gt;where($item, <span class="string">'='</span>, $value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="èµ„æºåµŒå¥—"><a href="#èµ„æºåµŒå¥—" class="headerlink" title="èµ„æºåµŒå¥—"></a>èµ„æºåµŒå¥—</h2><p>æœ‰å¦‚ä¸‹ä¸¤ç§éœ€æ±‚åœºæ™¯</p><ul><li>è·å–æŸä¸ªç”¨æˆ·/æˆ–æ ‡ç­¾ä¸‹çš„æ‰€æœ‰æ–‡ç« </li><li>è·å–é¦–é¡µçš„ç²¾é€‰æ–‡ç« </li></ul><p>æˆ‘å¸Œæœ›è¿™ä¸¤ç§æƒ…å†µéƒ½èƒ½é€šè¿‡ä¸€ä¸ªindex()æ–¹æ³•å¾—åˆ°è§£å†³ï¼Œå› æ­¤æˆ‘è¿™æ ·åš</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#api.php</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// ä¸»èµ„æºè·¯ç”± </span></span><br><span class="line"> $api-&gt;resource(<span class="string">'posts'</span>, <span class="string">'PostController'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å¤šå¯¹å¤šå…³ç³»åµŒå¥—è·¯ç”±</span></span><br><span class="line"> $api-&gt;get(<span class="string">'tags/&#123;tag&#125;/posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">     $tags = \App\Models\Tag::findOrFail($id);</span><br><span class="line">     <span class="keyword">return</span> app()-&gt;call(<span class="string">'App\Http\Controllers\Api\PostController@index'</span>, [<span class="string">'query'</span> =&gt; $tags-&gt;posts()]);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment">// ä¸€å¯¹å¤šå…³ç³»åµŒå¥—è·¯ç”±</span></span><br><span class="line"> $api-&gt;get(<span class="string">'users/&#123;user&#125;/posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">     $user = \App\Models\User::findOrFail($id);</span><br><span class="line">     <span class="keyword">return</span> app()-&gt;call(<span class="string">'App\Http\Controllers\Api\PostController@index'</span>, [<span class="string">'query'</span> =&gt; $user-&gt;posts()]);</span><br><span class="line"> &#125;)</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// ä¸Šé¢çš„ä»£ç éå¸¸çš„æœ‰è§„å¾‹ï¼Œå¯ä»¥è¿›è¡Œä¸€æ¬¡å°è£…ï¼Œè€Œä¸æ˜¯è¿™æ ·ä¸è¡Œçš„é‡å¤è§£æã€‚laravel5.6æ”¯æŒçš„è·¯ç”±æ¨¡å‹æ³¨å…¥æ˜¯ä¸ªä¸é”™çš„æ³¨æ„ï¼Œä½†æ˜¯dingo/apiç›®å‰è¿˜ä¸æ”¯æŒ</span></span><br><span class="line"> <span class="comment">// åˆ«å¿˜äº†åœ¨ä½ æ¨¡å‹ä¸­å®šä¹‰ç›¸åº”çš„å…³è”å…³ç³»</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># PostController.php</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($query = null)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="comment">// parseFilteræ˜¯æˆ‘å°è£…çš„ä¸€ä¸ªç”¨æ¥è§£æé€šç”¨å‚æ•°çš„æ–¹æ³•</span></span><br><span class="line">     $paginator = <span class="keyword">$this</span>-&gt;parseFilter($query ?? Post::query());</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;paginator($paginator, <span class="keyword">new</span> PostTransformer());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="èµ„æºå…³è”"><a href="#èµ„æºå…³è”" class="headerlink" title="èµ„æºå…³è”"></a>èµ„æºå…³è”</h2><p>dingo/api + Fractal å¯¹èµ„æºå…³è”å¤„ç†éå¸¸ä¼˜é›…ï¼Œå¹¶ä¸”å¾ˆå¥½çš„è§£å†³äº†n+1 é—®é¢˜ã€‚</p><p>å‡è®¾ä¸¤ä¸ªéœ€æ±‚</p><ul><li>å½“æˆ‘å–å‡ºå¤šä¸ªæ–‡ç« èµ„æºæ—¶æˆ‘å¸Œæœ›èƒ½å¤Ÿå…³è”å®ƒä»¬çš„ä½œè€…ã€‚</li></ul><p><strong>urlï¼š</strong> <code>http://api.test/posts?include=user:field(id|name|avatar)</code></p><ul><li>å–å‡ºä¸€ä¸ªç¤¾åŒºèµ„æºå¹¶é™„å¸¦å‡ åæ´»è·ƒçš„ç”¨æˆ·èµ„æºï¼Œä»¥åŠè¿™äº›æ´»è·ƒç”¨æˆ·æœ€è¿‘å‘è¡¨è¿‡çš„3ç¯‡æ–‡ç« æ—¶<br><strong>urlï¼š</strong> <code>http://api.test/hubs/1?include=hot_users:limit(3).posts:fields(id|title):limit(3)</code></li></ul><p>è¿™å¤§æ¦‚å°±æ˜¯æˆ‘éå¸¸å–œæ¬¢fractalè€Œè¿Ÿè¿Ÿä¸è‚¯ä½¿ç”¨laravel5.5çš„resourcesçš„åŸå› ï¼Œ å› ä¸ºå®ƒåˆ¶å®šå‡ºäº†ä¸€å¥—includeçš„è§„åˆ™å’Œç›¸åº”çš„ä»£ç å¤„ç†ï¼Œä½¿å¾—ä»£ç çš„å¶åˆæ€§éå¸¸ä½ã€‚</p><blockquote><p>includeå‚æ•°çš„è¯¦ç»†ä½¿ç”¨æ–¹å¼ è¯·å‚è€ƒdingo/apiæ–‡æ¡£ å’Œ fractalæ–‡æ¡£ <a href="https://fractal.thephpleague.com/" target="_blank" rel="noopener">https://fractal.thephpleague.com/</a></p></blockquote><p>å¯¹äºä¸Šé¢çš„éœ€æ±‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PostTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includeUser</span><span class="params">(Post $post, ParamBag $params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// fractalä¼šå¸®æˆ‘ä»¬è§£æincludeä¸­çš„å‚æ•°ï¼Œå¹¶æ³¨å…¥åˆ° $paramsä¸­ã€‚å› æ­¤æˆ‘ä»¬ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">    $user = $post-&gt;user()-&gt;select($params[fields] ?? <span class="string">'*'</span>)-&gt;firstOrFail();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;item($user, <span class="keyword">new</span> UserTransformer());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># HubTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includeHotUsers</span><span class="params">(Hub $hub, ParamBag $params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $users = $hub-&gt;hot_users()</span><br><span class="line">        -&gt;limit($params[<span class="string">'limit'</span>][<span class="number">0</span>] ?? <span class="number">5</span>)</span><br><span class="line">        -&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;collection($users, <span class="keyword">new</span> UserTransformer());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includePosts</span><span class="params">(User $user, ParamBag $params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $post = $user-&gt;posts()</span><br><span class="line">        -&gt;select($params[fields] ?? [<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'description'</span>, <span class="string">'like_count'</span>])</span><br><span class="line">        -&gt;limit($params[<span class="string">'limit'</span>][<span class="number">0</span>] ?? <span class="number">5</span>)</span><br><span class="line">        -&gt;get();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;collection($posts, <span class="keyword">new</span> PostTransformer());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¡¥å……ä¸€ä¸‹ï¼Œ å¯¹äºä½¿ç”¨äº† <code>$this-&gt;response()-&gt;collection()</code>å’Œ<code>$this-&gt;response-&gt;paginator()</code> æ–¹æ³•çš„èµ„æºã€‚ dingo/api ä¼šå»è§£æurlä¸­çš„includeå‚æ•°ï¼Œç„¶åå»è°ƒç”¨æ¨¡å‹çš„ç›¸åº”çš„å…³è”æ–¹æ³•æ¥è¿›è¡Œé¢„åŠ è½½ï¼Œä»è€Œè§£å†³æŸ¥è¯¢çš„n+1é—®é¢˜</p><p>ä¸Šé¢çš„ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œè¦æ±‚Hubæ¨¡å‹ä¸­å¿…é¡»å®šä¹‰ hot_userså’Œposts è¿™ä¸¤ä¸ªå…³è”æ–¹æ³•ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºå¼‚å¸¸</p><blockquote><p>è¿™é‡Œæ¨¡å‹å®šä¹‰çš„å…³è”æ–¹æ³•çš„åç§°å¿…é¡»ä¸urlä¸€è‡´ æ—¢ hot_users()ã€‚éå¸¸éš¾å—å‘€ï¼Œå› ä¸ºurlæ¨èå°å†™ï¼Œæ–¹æ³•åæ¨èå°é©¼å³°ï¼ï¼</p></blockquote><h3 id="å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™"><a href="#å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™" class="headerlink" title="å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™"></a>å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™</h3><p><code>:å‚æ•°åç§°(å€¼1|å€¼2|å€¼N)</code><br>â€˜:â€™ å†’å·æ ‡å¿—ç€ä¸€ä¸ªå‚æ•°çš„å¼€å§‹<br>ç´§è·Ÿç€æ˜¯å‚æ•°åç§°<br>ç„¶åæ¥ä¸Šå‚æ•°å€¼ å…¶ä¸­å‚æ•°çš„å€¼éœ€è¦è¢«æ‹¬å·æ‹¬èµ·<br>å¤šä¸ªå‚æ•°å€¼æ—¶ä½¿ç”¨ â€˜|â€™ åˆ†éš”</p><blockquote><p>å…³è”èµ„æºæˆ‘å¹¶ä¸æ¨èæä¾›åˆ†é¡µå‚æ•°ï¼Œå› ä¸ºå…¶ä¼šé€ æˆæ•°æ®çš„é‡å¤è¯»å–ï¼Œå¦‚æœéœ€è¦å–å‡ºçš„å…³è”èµ„æºæ•°æ®é‡å¾ˆå¤šã€‚æ¨èé€šè¿‡å•ç‹¬çš„apiè¯·æ±‚è·å–è¯¥èµ„æºï¼Œè€Œä¸æ˜¯é€šè¿‡includeæ–¹å¼åŠ è½½è¿›æ¥ã€‚</p></blockquote><h2 id="èµ„æºä¸­çš„åŠ¨ä½œ"><a href="#èµ„æºä¸­çš„åŠ¨ä½œ" class="headerlink" title="èµ„æºä¸­çš„åŠ¨ä½œ"></a>èµ„æºä¸­çš„åŠ¨ä½œ</h2><p>æˆ‘ä»¬å¯¹èµ„æºå­˜åœ¨ä¸€äº›åŠ¨ä½œè¡Œä¸ºï¼Œå¦‚å¯¹å¸–å­çš„ç‚¹èµæ”¶è—ç­‰ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©æ¨¡ä»¿githubçš„åšæ³•ï¼Œå°†åŠ¨ä½œè½¬æ¢ä¸ºèµ„æºã€‚</p><h3 id="åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº"><a href="#åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº" class="headerlink" title="åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº"></a>åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº</h3><ul><li>ç‚¹èµæ–‡ç« </li></ul><p><strong>url:</strong> <code>http://mp.test/posts/1/likes</code><br><strong>method:</strong> <code>POST</code></p><ul><li>å–æ¶ˆç‚¹èµæ–‡ç« </li></ul><p><strong>url:</strong> <code>http://mp.test/posts/1/likes</code><br><strong>method:</strong> <code>DELETE</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PostLikeController.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(Request $request, $id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DB::table(<span class="string">'user_like_post'</span>)-&gt;insert([</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; \Auth::id(),</span><br><span class="line">        <span class="string">'post_id'</span> =&gt; $id</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;created();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DB::table(<span class="string">'user_like_post'</span>)-&gt;where(<span class="string">'user_id'</span>, \Auth::id())-&gt;where(<span class="string">'post'</span>, $id)-&gt;delete();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;noContent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯åŠ¨ä½œèµ„æº"><a href="#éªŒè¯åŠ¨ä½œèµ„æº" class="headerlink" title="éªŒè¯åŠ¨ä½œèµ„æº"></a>éªŒè¯åŠ¨ä½œèµ„æº</h3><p>è¿™æ˜¯ä¸€ä¸ªæˆ‘ç ”ç©¶/çº ç»“äº†å¾ˆä¹…çš„é—®é¢˜ï¼Œå°è¯•è¿‡å¾ˆå¤šç§å†™æ³•ï¼Œè¿™é‡Œå†³å®šæ¨¡ä»¿çŸ¥ä¹çš„apiå†™æ³•</p><p>éªŒè¯ç”¨æˆ·æ˜¯å¦ç‚¹èµäº†æŸä¸€ç¯‡å¸–å­</p><p><strong>urlï¼š</strong> <code>http://api.test/posts/1?include=is_like</code></p><p>å¯¹äºä¸Šé¢çš„urlï¼Œdingo/api ä¼šè‡ªåŠ¨è°ƒç”¨PostTransformerçš„includeIsLikeæ–¹æ³•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨è¯¥æ–¹æ³•ä¸­è¿›è¡ŒéªŒè¯å³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PostTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includeIsLike</span><span class="params">(Post $post)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™è¡Œä»£ç å¯ä»¥æ ¹æ®Auth::id Cacheä¸€ä¸‹</span></span><br><span class="line">    $likePostIds = DB::table(<span class="string">'user_like_post'</span>)-&gt;where(<span class="string">'user_id'</span>, Auth::id())-&gt;pluck(<span class="string">'post_id'</span>)-&gt;toArray();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;primitive(in_array($diary-&gt;id, $likePostIds));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åæ§½ä¸€ä¸‹ includeIsLikeå¦‚ä½•è¿”å›æ ‡é‡èµ„æºï¼Œæ–‡æ¡£ä¸Šæ²¡æœ‰ä»»ä½•æè¿°ã€‚<br>çœ‹äº†æºç æ‰å‘ç°primitiveè¿™ä¸ªå…³é”®è¯ã€‚ğŸ˜£</p><p>å¯¹äºå•ä¸ªèµ„æºå¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆä¸Šé¢çš„éœ€æ±‚ï¼Œä½†å¯¹äºèµ„æºé›†åˆæˆ‘é‡åˆ°äº†å¾ˆå¤§çš„é—®é¢˜</p><p><strong>urlï¼š</strong> <code>http://api.test/posts?include=is_like</code></p><p>é›†åˆæˆ‘ç»Ÿä¸€ä½¿ç”¨äº†<code>$this-&gt;response-&gt;paginator()</code>ï¼Œ å‰é¢æåˆ° paginatorå’Œcollectionæ–¹æ³•ï¼Œä¼šå»æ£€æµ‹includeå‚æ•°å¹¶è°ƒç”¨æ¨¡å‹çš„ç›¸åº”çš„å…³è”æ–¹æ³•æ¥è¿›è¡Œé¢„åŠ è½½ã€‚ æ‰€ä»¥ä¼šå»postsæ¨¡å‹å»æ‰¾is_likeæ–¹æ³•ï¼Œå¯æ˜¯æˆ‘çœŸçš„å®šä¹‰ä¸å‡ºä¸€ä¸ªis_likeå…³è”å…³ç³»å‘¢ã€‚<br>è€Œä¸”è¿™ä¸ªè¡Œä¸ºæ˜¯æ²¡æ³•ä¼˜é›…çš„ç¦æ­¢æ‰çš„ï¼Œæƒ³è¦ç¦æ­¢ï¼Ÿokå•Šï¼Œé‚£å°±å…¨å…³äº†ï¼Œåˆ«æƒ³æˆ‘å†ç»™ä½ è§£å†³n+1é—®é¢˜äº†</p><p>è¿™æ˜æ˜æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è§£å†³çš„é—®é¢˜ï¼Œåœ¨dingo/apiçš„issueä¸­ä¹Ÿæåˆ°äº†å¤šæ¬¡ã€‚ä½†æ˜¯éƒ½æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚</p><blockquote><p>äºæ˜¯æˆ‘forkä¸‹äº†dingo/apiçš„ä»£ç å‡†å¤‡è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘ç»ˆäºæ˜ç™½æ˜¯ä¸ºä»€ä¹ˆäº†~<br>dingo/apiå’ŒFractalæ˜¯ä¸åŒä½œè€…çš„é¡¹ç›®ã€‚dingo/apiæ˜¯ä¸ºlaravelé‡èº«æ‰“é€ çš„ã€‚å…¶ä¾èµ–çš„transformä½¿ç”¨çš„æ˜¯Fractalã€‚ è€ŒFractalå¹¶ä¸ä¸“å±äºlaravel.<br>åœ¨dingo/apiä¸­åšå¾ˆå®¹æ˜“ï¼Œä½†æ˜¯åœ¨Fractalä¸­æ·»åŠ ä¸€ä¸ªä¸ºlaravelæœåŠ¡çš„æ‰©å±•å°±æœ‰äº›ä¸åˆ‡å®é™…äº†</p></blockquote><p>æ—¢ç„¶å¦‚æ­¤å°±åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ç¨å¾®è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ ¹Transformers.php æ‰€æœ‰çš„Transformeréƒ½ç»§æ‰¿è‡ªè¯¥Transformer</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Transformers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">League</span>\<span class="title">Fractal</span>\<span class="title">TransformerAbstract</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transformer</span> <span class="keyword">extends</span> <span class="title">TransformerAbstract</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $disableEagerLoadedIncludes = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getDisableEagerLoadedIncludes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;disableEagerLoadedIncludes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ª Fractal.php å¹¶ç»§æ‰¿äºåŸæœ‰Fractal</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fractal</span> <span class="keyword">extends</span> \<span class="title">Dingo</span>\<span class="title">Api</span>\<span class="title">Transformer</span>\<span class="title">Adapter</span>\<span class="title">Fractal</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mergeEagerLoads</span><span class="params">($transformer, $requestedIncludes)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $includes = array_merge($requestedIncludes, $transformer-&gt;getDefaultIncludes());</span><br><span class="line">        $includes = array_diff($includes, $transformer-&gt;getDisableEagerLoadedIncludes());</span><br><span class="line">        $eagerLoads = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($includes <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            $eagerLoads[] = is_string($key) ? $key : $value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $eagerLoads;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ dingo/apiçš„é…ç½®æ–‡ä»¶api.php å°†åŸæœ‰çš„Fractalæ›´æ”¹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„</span></span><br><span class="line"></span><br><span class="line"><span class="string">'transformer'</span> =&gt; env(<span class="string">'API_TRANSFORMER'</span>, \App\Services\Fractal::class),</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆ~ æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦åœ¨PostTransformerä¸­å®šä¹‰ä¸€ä¸ª disableEagerLoadedIncludeså±æ€§æ¥æ·»åŠ ä¸éœ€è¦æ€¥åˆ‡åŠ è½½çš„å±æ€§äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $disableEagerLoadedIncludes = [<span class="string">'is_like'</span>];</span><br></pre></td></tr></table></figure><p>ç»ˆäºå¯ä»¥  <code>?include=is_like,like_count,is_author,balala...</code> é¢å‘includeçš„ç¼–ç¨‹äº†</p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>ä¸Šé¢è¯´çš„éƒ½æ˜¯å·²æŸ¥è¯¢ä¸ºä¸»ï¼Œä½†å¢åˆ æ”¹ä¹Ÿæœ‰ä¸€äº›å°æŠ€å·§ å¦‚åˆ›å»ºèµ„æºé™¤äº†ä½¿ç”¨ dingo/apiå°è£…çš„<code>$this-&gt;response-&gt;created()</code>å¤–ï¼Œ ä½¿ç”¨<code>$this-&gt;response-&gt;item($post, new PostTransformer())-&gt;setStatusCode(201);</code>ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ã€‚</p><p>ä½¿ç”¨ requestè¿›è¡Œè¡¨å•éªŒè¯ã€ä½¿ç”¨ Policiyè¿›è¡Œæƒé™éªŒè¯ã€ä½¿ç”¨Observerè¿›è¡Œå‰¯ä½œç”¨çš„å¤„ç†ç­‰ç­‰ï¼Œä»è€Œä¿è¯å¢åˆ æ”¹çš„ä»£ç æ›´å…·æœ‰å¯è¯»æ€§å’Œè§£è€¦æ€§ã€‚</p><p>å¦å¤–è¿˜æœ‰å¾ˆå¤šå¾…è§£å†³çš„é—®é¢˜</p><ul><li>å¦‚åµŒå¥—èµ„æºä¸­ï¼Œç›´æ¥åœ¨è·¯ç”±æ–‡ä»¶ä¸­å¤„ç†é€»è¾‘å¹¶ä¸ä¼˜é›…</li><li>fields ç­›é€‰å­—æ®µå¯¹ Transformçš„ä¼ ç»Ÿå†™æ³•å¹¶ä¸å‹å¥½ æœ‰å¾…æ”¹è¿›</li><li>fieldsæ–¹æ³•åœ¨laravelä¸­æ˜¾å¾—å’Œincludeæœ‰äº›å†²çªï¼Œæ˜¯å¦å¯ä»¥ç›´æ¥åœ¨includeä¸­ç¼–å†™éœ€è¦è·å–çš„fieldså‘¢<ul><li>è¿™é‡Œæˆ‘è§‰å¾—å¯èƒ½éœ€è¦æŠ›å¼ƒåŸæœ‰transform()çš„å†™æ³•ï¼Œæ•°æ®å¤„ç†åº”è¯¥é€šè¿‡ormæä¾›çš„ä¸€äº›ä¿®æ”¹å™¨æ¥è¿›è¡Œã€‚æ›´å¤šçš„æ•°æ®å¤„ç†åˆ™äº¤ç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æä¾›ä¸€äº›æ›´åŠ rawçš„æ•°æ®ã€‚</li></ul></li><li><p>å½“ä¸€ä¸ªç•Œé¢è¿‡äºå¤æ‚æ—¶ï¼Œéœ€è¦è¯·æ±‚å¤šæ¬¡apiï¼Œè¶…è¿‡3æ¬¡ä»¥ä¸Šæˆ‘å°±æœ‰äº›éš¾ä»¥æ¥å—äº†ï¼Œgetè¯·æ±‚urlè¿‡é•¿é—®é¢˜ï¼Œæ¥ä¸‹æ¥ä¼šå°è¯•è¿›è¡Œè·¯ç”±çš„æ˜ å°„ ç»„è£…æ“ä½œç­‰æ“ä½œè§£å†³è¿™ä¸ªé—®é¢˜</p></li><li><p>èµ„æºæš´éœ²æ˜¯å¦ä¼šå¸¦æ¥å®‰å…¨é—®é¢˜ï¼Ÿè¿™ä¸€ç‚¹æˆ‘è§‰ä¸ä¼šã€‚å¦‚ä½•è®¤è¯å’Œé™æµå‚è€ƒdingo/apiæ–‡æ¡£å³å¯</p></li><li>å¯¹äºä¸€äº›ä¸ç¬¦åˆRESTfulèµ„æºçš„éœ€æ±‚å¦‚ä½•å¤„ç†ï¼Œå¦‚æœç´¢éœ€æ±‚ã€‚å¯ä»¥å°è¯•åˆ›å»ºäº›é¢å¤–çš„è·¯ç”±æ¥å¤„ç†è¿™äº›é¢å¤–çš„éœ€æ±‚ã€‚è¿™äº›éœ€æ±‚å¯ä»¥å åˆ°ä¸€ä¸ªé¡¹ç›®çš„20%å·¦å³</li><li>èµ„æºæ§åˆ¶å™¨çš„indexæ–¹æ³•ä½¿ç”¨çš„pageæ¯æ¬¡éƒ½ä¼šå¤šæŸ¥è¯¢ä¸€æ¡æ€»è®°å½•æ•°çš„sqlã€‚</li><li><p>èµ„æºæ§åˆ¶å™¨çš„indexæ–¹æ³•å¦‚æœä¸å­˜åœ¨ç­›é€‰æ¡ä»¶æ—¶å¦‚ä½•åšèµ„æºé™åˆ¶ï¼Œæ€»ä¸èƒ½ä¸€æ¬¡å–å‡ºæ‰€æœ‰çš„èµ„æº</p><ul><li><p>çªå‘å¥‡æƒ³é‡‡ç”¨äº†ä¸€ä¸ªsqlé»‘åå•çš„æœºåˆ¶</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">isBlacklist</span><span class="params">($query)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        $limit = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (request(<span class="string">'per_page'</span>) &amp;&amp; request(<span class="string">'per_page'</span>) &lt; $limit) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $key = <span class="string">'sql:'</span>. $query-&gt;toSql();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Cache::has($key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($query-&gt;count() &gt; $limit) &#123;</span><br><span class="line">                Cache::forever($key, date(<span class="string">'Y-m-d H:i:s'</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>â€¦</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å†æ¬¡è¯´æ˜ä¸€ä¸‹æˆ‘åœ¨åšä»€ä¹ˆï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿåœ¨æ•°æ®çš„åŸºç¡€ä¸Šç¼–å†™ä¸€å¥—æ¥å£èƒ½å¤Ÿæ»¡è¶³h5ç«¯ã€pcç«¯ã€ios/androidç«¯ã€åŒ…æ‹¬å°ç¨‹åºç«¯ç­‰ç­‰80%çš„éœ€æ±‚ã€‚<br>æˆ‘ä¸å¸Œæœ›æˆ‘çš„æ¥å£è¦è·Ÿç€æ¯ä¸€æ¬¡çš„ä¸šåŠ¡å˜åŠ¨è€Œå»ä¿®æ”¹ï¼Œæˆ‘å¸Œæœ›è‡ªå·±å…³å¿ƒçš„æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡ã€‚<br>æˆ‘å¸Œæœ›åªè¦çŸ¥é“äº§å“çš„åŸå‹ï¼Œå°±èƒ½å®Œæˆåç«¯80%çš„å¼€å‘ï¼Œ è€Œä¸æ˜¯ç­‰è®¾è®¡å®šç¨¿/ç­‰å‰ç«¯å¼€å‘ç­‰ç­‰</p><p>ç°åœ¨å‰ç«¯çš„å¼€å‘æ˜¯æ¨¡å—åŒ–çš„ï¼Œåœ¨æˆ‘çœ‹æ¥å°±æ˜¯é¢å‘importçš„å¼€å‘ã€‚<br>ä¼ ç»Ÿçš„RESTfulæ¥å£æ²¡æ³•é€‚åº”äºå‰ç«¯çš„æ¨¡å—åŒ–å¼€å‘ã€‚å­˜åœ¨ç€å¤§é‡çš„å­—æ®µå†—ä½™å’Œhttpè¯·æ±‚ï¼Œè¿™æ˜¯æˆ‘åœ¨å­¦ä¹ graphQLçš„æ—¶çœ‹åˆ°çš„ä¸€å¥è¯ã€‚</p><p>ä½†æ—¢ç„¶å‰ç«¯çš„å¼€å‘æ˜¯æ¨¡å—åŒ–çš„ã€é¢å‘importçš„ï¼Œåç«¯çš„apiæ¥å£ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯é¢å‘includeçš„å‘¢ ğŸ˜†</p><blockquote><p>æŒç»­å…³æ³¨ä¸­ - å¸Œæœ›ä½ èƒ½åˆ†äº«åœ¨RESTful APIã€dingo/apiã€laravel apiç­‰å¼€å‘æ—¶çš„ç»éªŒã€æƒ³æ³•å’ŒæŠ€å·§~<br>æˆ‘å°†ä¼šæ€»ç»“å‡ºä¸€ä»½ä»£ç demoå¹¶åˆ†äº«å‡ºæ¥</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘æ—¶å¸¸è§‰å¾—åç«¯åº”è¯¥å…³å¿ƒçš„æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡ã€‚&lt;br&gt;å› æ­¤æˆ‘å¸Œæœ›èƒ½å¤Ÿåœ¨æ•°æ®çš„åŸºç¡€ä¸Šç¼–å†™ä¸€å¥—æ¥å£ èƒ½å¤Ÿæ»¡è¶³h5ç«¯ã€pcç«¯ã€ios/androidç«¯ã€åŒ…æ‹¬å°ç¨‹åºç«¯ç­‰ç­‰80%çš„éœ€æ±‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£TCPåè®®ï¼ˆä¸€ï¼‰</title>
    <link href="http://beian.miit.gov.cn/posts/a-deep-understanding-of-the-tcp-protocol-1.html"/>
    <id>http://beian.miit.gov.cn/posts/a-deep-understanding-of-the-tcp-protocol-1.html</id>
    <published>2018-02-09T15:39:24.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="ä¸‰è·¯æ¡æ‰‹"><a href="#ä¸‰è·¯æ¡æ‰‹" class="headerlink" title="ä¸‰è·¯æ¡æ‰‹"></a>ä¸‰è·¯æ¡æ‰‹</h2><ol><li><p>æœåŠ¡å™¨ç«¯é€šè¿‡è°ƒç”¨ socketã€bindå’Œ1istenè¿™3ä¸ªå‡½æ•°å‡†å¤‡å¥½æ¥å—å¤–æ¥çš„è¿æ¥ã€‚ç§°ä¹‹ä¸ºè¢«åŠ¨æ‰“å¼€ï¼ˆpassive openï¼‰</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ connectå‘èµ·ä¸»åŠ¨æ‰“å¼€( active open)ã€‚è¯¥è°ƒç”¨ä½¿å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYN(åŒæ­¥)åˆ†èŠ‚ç»™æœåŠ¡å™¨ï¼ŒSYNä¸­åŒ…å«å®¢æˆ·å°†åœ¨(å¾…å»ºç«‹çš„)è¿æ¥ä¸­å‘é€çš„æ•°æ®çš„åˆå§‹åºåˆ—å·ã€‚<strong>é€šå¸¸SYNåˆ†èŠ‚ä¸æºå¸¦æ•°æ®</strong>ï¼Œ å…¶æ‰€åœ¨IPæ•°æ®æŠ¥åªå«æœ‰ä¸€ä¸ªIPé¦–éƒ¨ã€ä¸€ä¸ªTCPé¦–éƒ¨åŠå¯èƒ½æœ‰çš„TCPé€‰é¡¹ã€‚</p></li><li>æœåŠ¡å™¨å¿…é¡»ç¡®è®¤(ACK)å®¢æˆ·çš„SYN,åŒæ—¶è‡ªå·±ä¹Ÿå¾—å‘é€ä¸€ä¸ªSYNåˆ†èŠ‚ï¼Œå®ƒå«æœ‰æœåŠ¡å™¨å°†åœ¨åŒä¸€è¿æ¥ä¸­å‘é€çš„æ•°æ®çš„åˆå§‹åºåˆ—å·ã€‚æœåŠ¡å™¨åœ¨å•ä¸ªåˆ†èŠ‚ä¸­å‘é€SYNå’Œå¯¹å®¢æˆ·SYNçš„ACK(ç¡®è®¤)ã€‚</li><li>å®¢æˆ·å¿…é¡»ç¡®è®¤æœåŠ¡å™¨çš„SYNã€‚æ—¢å‘é€ä¸€ä¸ªç¡®è®¤SYNçš„ACKã€‚</li></ol><p>è¿™ç§äº¤æ¢è‡³å°‘éœ€è¦3ä¸ªåˆ†ç»„,å› æ­¤ç§°ä¹‹ä¸ºTCPçš„ä¸‰è·¯æ¡æ‰‹(thre-way handshake)ã€‚<br><img src="http://asset.eienao.com/15175486060759.jpg" alt></p><p>å¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯è°ƒç”¨accept()å‡½æ•°åï¼Œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚ç›´åˆ°ä¸‰è·¯æ¡æ‰‹å®Œæˆåï¼Œacceptå‡½æ•°æ‰è¿”å›ã€‚ç„¶åå†é˜»å¡äºreadçŠ¶æ€</p><h2 id="TCPçŠ¶æ€è½¬æ¢å›¾"><a href="#TCPçŠ¶æ€è½¬æ¢å›¾" class="headerlink" title="TCPçŠ¶æ€è½¬æ¢å›¾"></a>TCPçŠ¶æ€è½¬æ¢å›¾</h2><p>TCPä¸ºä¸€ä¸ªè¿æ¥å®šä¹‰äº†11ç§çŠ¶æ€</p><p><img src="http://asset.eienao.com/15179303680473.jpg" alt></p><p>å…¶ä¸­ESTABLISHEDä¸ºï¼ˆå®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯ï¼‰å®Œæˆä¸‰è·¯æ¡æ‰‹åçš„çŠ¶æ€ï¼Œè¿™ä¸ªæœ€ç»ˆçŠ¶æ€åœ¨æ•°æ®å‘é€æœŸé—´ä¸€ç›´ä¿æŒã€‚</p><p>ä¸»åŠ¨è°ƒç”¨closeä¸€æ–¹ç»å†äº†TIME_WAITçŠ¶æ€ï¼Œ  åœ¨TIME_WAITçŠ¶æ€ä¸‹ä¼šæŒç»­ 2MSL (æ—¶é—´å•ä½)ã€‚<br><strong>MSL: maximum segment lifetime</strong><br>å®ç°TCPæ—¶å¿…é¡»å¿…é¡»ä¸ºMSLé€‰æ‹©ä¸€ä¸ªå€¼ï¼Œå»ºè®®åœ¨30ç§’~2åˆ†é’Ÿã€‚<br>MSLæ˜¯ä»»ä½•IPæ•°æ®æŠ¥èƒ½å¤Ÿåœ¨å› ç‰¹ç½‘ä¸­å­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚</p><p>TIME_WAITçŠ¶æ€æœ‰ä¸¤ä¸ªå­˜åœ¨çš„ç†ç”±ï¼š<br>(1)å¯é åœ°å®ç°TCPå…¨åŒå·¥è¿æ¥çš„ç»ˆæ­¢<br>(2)å…è®¸è€çš„é‡å¤åˆ†èŠ‚åœ¨ç½‘ç»œä¸­æ¶ˆé€ï¼Œå› ä¸ºTCPåè®®è§„å®šåœ¨TIME_WAITçŠ¶æ€ä¸‹çš„ä¸€ç«¯ä¸å…è®¸åˆ›å»ºæ–°çš„TCPè¿æ¥ã€‚ä»è€Œä¿è¯æ—§è¿æ¥çš„ä»»ä½•åˆ†èŠ‚éƒ½ä¸ä¼šå‘é€åˆ°æ–°çš„è¿æ¥ä¸­å»ï¼ˆåˆ†èŠ‚åœ¨å› ç‰¹ç½‘ä¸­çš„æœ€é•¿å­˜æ´»æ—¶é—´å°äºTIME_WAITæŒç»­çš„æ—¶é—´ï¼‰ã€‚</p><p><img src="http://asset.eienao.com/15179304017422.jpg" alt></p><p>ä¸Šå›¾æœåŠ¡å™¨å¯¹å®¢æˆ·çš„è¯·æ±‚çš„ç¡®è®¤æ˜¯ä¼´éšå…¶åº”ç­”å‘é€çš„,è¿™ç§åšæ³•ç§°ä¸º piggybackingï¼Œ<br>å®ƒé€šå¸¸åœ¨æœåŠ¡å™¨è¯·æ±‚å¹¶äº§ç”Ÿçš„åº”ç­”çš„æ—¶é—´å°‘äº200msæ—¶å‘ç”Ÿã€‚</p><h2 id="å¹¶å‘æœåŠ¡å™¨"><a href="#å¹¶å‘æœåŠ¡å™¨" class="headerlink" title="å¹¶å‘æœåŠ¡å™¨"></a>å¹¶å‘æœåŠ¡å™¨</h2><p><img src="http://asset.eienao.com/15181013775313.jpg" alt><br>å¦‚å›¾ä¸ºä¸€ä¸ªå¤šè¿›ç¨‹æ¨¡å‹çš„å¹¶å‘æœåŠ¡å™¨</p><p>æˆ‘ä»¬å‘ç°å­è¿›ç¨‹1å’Œå­è¿›ç¨‹2çš„connect_socketç”šè‡³æ˜¯listen_socketéƒ½ä½¿ç”¨äº†æœåŠ¡å™¨ç«¯çš„21ç«¯å£ã€‚</p><p>å½“å®¢æˆ·ç«¯è¯·æ±‚12.106.32.254:21ç«¯å£æ—¶ï¼Œtcpåè®®åº”è¯¥å°†è¯¥è¯·æ±‚äº¤ç»™ä¸‰ä¸ªsocketä¸­çš„å“ªä¸€ä¸ªå‘¢ï¼Ÿ</p><p>é¦–å…ˆé€šè¿‡ä¸Šå›¾å¯ä»¥ç¡®å®šçš„æ˜¯æ— æ³•ä»…ä»…é€šè¿‡ç›®çš„ç«¯å£å°†åˆ°æ¥çš„è¯·æ±‚äº¤ç»™å¯¹åº”çš„socketã€‚</p><p><strong>ä¹¦ï¼ˆunixç½‘ç»œç¼–ç¨‹å·3ï¼‰ä¸­çš„è§£é‡Šæ˜¯ï¼š</strong>  TCPåè®®å¿…é¡»æŸ¥çœ‹<strong>å¥—æ¥å­—å¯¹</strong>çš„æ‰€æœ‰å››ä¸ªå…ƒç´ ï¼Œæ‰èƒ½ç¡®å®šç”±å“ªä¸ªsocketæ¥å—åˆ°è¾¾çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><blockquote><p>å¯¹äºtcpè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†èŠ‚çš„tcpæ ‡å¤´ä¸­å¾—åˆ°è¿™å››ä¸ªå…ƒç´ ï¼ˆè¯·æ±‚åŒæ–¹çš„idå’Œç«¯å£å·ï¼‰<br><img src="http://asset.eienao.com/15181892735181.jpg" alt></p></blockquote><p><strong>ä¸‹é¢æ˜¯æˆ‘æ ¹æ®ä¹¦ä¸­çš„è§£é‡Šåšå‡ºçš„è‡†æƒ³</strong></p><p>å¯¹äºä¸€å°å¹¶å‘æœåŠ¡å™¨æ¥è¯´ï¼Œä¸€ä¸ªç®€å•çš„ç®—æ³•æ˜¯ï¼šå¯¹äºä¸€ä¸ªåˆ°æ¥çš„åˆ†èŠ‚ã€‚é¦–å…ˆæŸ¥çœ‹å…¶ç›®çš„ç«¯å£(å¯¹äºå•ipæœåŠ¡å™¨æ¥è¯´ï¼Œå†æŸ¥çœ‹åˆ†èŠ‚çš„ç›®çš„ipå°±æœ‰äº›å¤šæ­¤ä¸€ä¸¾äº†)ã€‚</p><p>ç„¶åæ£€ç´¢æ‰€æœ‰ç›‘å¬äº†è¯¥ç›®çš„ç«¯å£çš„socketã€‚å‡å¦‚åªæ£€ç´¢åˆ°ä¸€ä¸ªï¼Œé‚£ä¹ˆç›´æ¥å°†è¯¥åˆ†èŠ‚äº¤ç»™è¯¥socketå³å¯ã€‚</p><p>å½“æ£€ç´¢å‡ºäº†å¤šä¸ªsocketæ—¶ (ä¸Šå›¾ä¸­å¤šä¸ªå·²è¿æ¥socketçš„æƒ…å†µ)ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·ç«¯çš„ipä¸ç«¯å£å·è¿›è¡ŒåŒ¹é…ï¼Œå½“ç„¶è¿™ä¸€æ¬¡æ˜¯å®¢æˆ·ç«¯çš„ipä¸ç«¯å£éƒ½éœ€è¦å‚ä¸åŒ¹é…ã€‚<br>ä¼˜å…ˆåŒ¹é…å…·æœ‰ç²¾ç¡®å®¢æˆ·ç«¯åœ°å€çš„socket å¦‚æœåŠ¡å™¨çš„å­è¿›ç¨‹2çš„socketä¸­ä¿å­˜çš„socket pairä¸º <code>{12.106.32.254:21,206.168.112.219:1501}</code><br>å…¶ç²¾ç¡®çš„æ ‡è¯†äº†è¯·æ±‚ç«¯çš„ipåœ°å€å’Œç«¯å£å· 206.168.112.219:1501<br>å…¶æ¬¡å†åŒ¹é…é€šé…çš„socketã€‚å¦‚ç›‘å¬socket</p><p>å½“ç„¶è¦åšåˆ°ä¸Šé¢åŒ¹é…éœ€è¦æˆ‘ä»¬æœåŠ¡å™¨ç«¯çš„socketä¸­ä¿å­˜äº†4ä¸ªå…ƒç´ ã€‚å®é™…ä¸Šä¹Ÿç¡®å®å¦‚æ­¤</p><p>socketä¸­åŒ…å«çš„ä¸€ä¸ªinet_sockçš„ç»“æ„ä½“å¦‚ä¸‹ã€‚å…¶ä¸­åŒ…å«ç¡®å®šä¸€ä¸ªtcpè¿æ¥æ‰€éœ€çš„4ä¸ªå…ƒç´ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct inet_sock   </span><br><span class="line">&#123;   </span><br><span class="line">    struct sock sk;   </span><br><span class="line">#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)   </span><br><span class="line">    struct ipv6_pinfo   *pinet6;   </span><br><span class="line">#endif   </span><br><span class="line">    __u32           daddr;          //IPv4çš„ç›®çš„åœ°å€ã€‚   </span><br><span class="line">    __u32           rcv_saddr;      //IPv4çš„æœ¬åœ°æ¥æ”¶åœ°å€ã€‚   </span><br><span class="line">    __u16           dport;          //ç›®çš„ç«¯å£ã€‚   </span><br><span class="line">    __u16           num;            //æœ¬åœ°ç«¯å£ï¼ˆä¸»æœºå­—èŠ‚åºï¼‰ã€‚  </span><br><span class="line">    </span><br><span class="line">    â€¦â€¦â€¦â€¦      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;ä¸‰è·¯æ¡æ‰‹&quot;&gt;&lt;a href=&quot;#ä¸‰è·¯æ¡æ‰‹&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰è·¯æ¡æ‰‹&quot;&gt;&lt;/a&gt;ä¸‰è·¯æ¡æ‰‹&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;æœåŠ¡å™¨ç«¯é€šè¿‡è°ƒç”¨ socketã€bindå’Œ1istenè¿™3ä¸ªå‡½æ•°å‡†å¤‡å¥½
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>nuxtâ€”â€”æœåŠ¡ç«¯æ¸²æŸ“å¯é€‰æ–¹æ¡ˆ</title>
    <link href="http://beian.miit.gov.cn/posts/nuxt-server-side-rendering-options.html"/>
    <id>http://beian.miit.gov.cn/posts/nuxt-server-side-rendering-options.html</id>
    <published>2018-01-27T12:54:45.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>å›¢é˜Ÿåœ¨æœ€è¿‘çš„ä¸€æ¬¡å¼€å‘ä¸­å‰ç«¯æŠ€æœ¯æ ˆä»html + css + jqueryè½¬å‘vueå…¨å®¶æ¡¶ã€‚åç«¯ä»php + Blade + jqueryè½¬å‘vueå…¨å®¶æ¡¶ã€‚</p><p>åœ¨è½¬å‘å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚</p><ul><li>é¦–å±åŠ è½½ç¼“æ…¢</li><li>seoé—®é¢˜</li><li>å‰åç«¯åˆ†ç¦»ä¸­çš„å¼‚æ­¥è¯·æ±‚æ•°é‡è¿‡å¤šç­‰é—®é¢˜</li></ul><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„å°¤å…¶æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ã€‚å›¢é˜Ÿå†³å®šä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ã€‚</p><h2 id="æœåŠ¡ç«¯æ¸²æŸ“"><a href="#æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="æœåŠ¡ç«¯æ¸²æŸ“"></a>æœåŠ¡ç«¯æ¸²æŸ“</h2><p>æœåŠ¡ç«¯æ¸²æŸ“å¯ä»¥å¾ˆå¥½çš„è§£å†³æ‰“åŒ…æ–‡ä»¶è¿‡å¤§å¯¼è‡´çš„é¦–æ¬¡åŠ è½½ç™½å±é—®é¢˜ï¼Œå¹¶ä¸”é¡µé¢æ‰“å¼€é€Ÿåº¦ç›¸æ¯”äºjsæ¸²æŸ“ç•Œé¢å¿«å¾ˆå¤šã€‚</p><p>å°±åƒè¿‡å»ç”¨phpçš„æ¨¡æ¿å¼•æ“æ¸²æŸ“htmlç•Œé¢ä¹Ÿæ˜¯ä¸€ç§æœåŠ¡ç«¯æ¸²æŸ“æ–¹å¼ï¼Œä½†å¹¶ä¸é€‚ç”¨äºå¤§JavaScriptæ—¶ä»£äº†ã€‚</p><p>æˆ‘æœ€æ—©çœ‹åˆ°æœåŠ¡ç«¯æ¸²æŸ“æ˜¯åœ¨æ·˜å®åšå®¢çš„å‰åç«¯åˆ†ç¦»çš„æ€è€ƒä¸å®è·µä¸­ï¼Œä»–ä»¬æå‡ºäº†ä¸€ä¸ªä¸­é€”å²›çš„æ¦‚å¿µã€‚</p><blockquote><p>å…¶å®å›å¤´æƒ³æƒ³ï¼Œåœ¨æˆ‘ä»¬æŠŠæ¸²æŸ“çš„å·¥ä½œä» æœåŠ¡ç«¯æŠ½å‡ºæ¥åˆ° æµè§ˆå™¨ç«¯ï¼ˆJSï¼‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç›®çš„åªæ˜¯æ˜ç¡®çš„å‰åç«¯èŒè´£åˆ’åˆ†ï¼Œå¹¶ä¸æ˜¯éæµè§ˆå™¨æ¸²æŸ“ä¸å¯ã€‚</p><p>åªæ˜¯å› ä¸ºåœ¨ä¼ ç»Ÿçš„å¼€å‘æ¨¡å¼ä¸­ï¼Œå‡ºäº†æœåŠ¡å™¨å°±åˆ°äº†æµè§ˆå™¨ï¼Œæ‰€ä»¥å‰ç«¯çš„å·¥ä½œå†…å®¹åªèƒ½è¢«é™åˆ¶åœ¨æµè§ˆå™¨ç«¯ã€‚</p><p>ä¹Ÿå› æ­¤å¾ˆå¤šäººè®¤å®šäº† åç«¯ = æœåŠ¡ç«¯ å‰ç«¯ = æµè§ˆå™¨ç«¯<br>                     â€”â€”å‰åç«¯åˆ†ç¦»çš„æ€è€ƒä¸å®è·µ</p></blockquote><p><img src="https://gw.alicdn.com/tfs/TB1WEF2QpXXXXXvaXXXXXXXXXXX-572-145.png" alt="ä¸­é€”å²›çš„æ¦‚å¿µ"></p><p>åŸæ–‡é“¾æ¥ <a href="http://taobaofed.org/blog/2014/04/09/practice-of-separation-of-front-end-from-back-end-2/" target="_blank" rel="noopener">å‰åç«¯åˆ†ç¦»çš„æ€è€ƒä¸å®è·µï¼ˆäºŒï¼‰</a></p><hr><p>å‰åç«¯åˆ†ç¦»æ˜¯æ¶æ„ä¸Šçš„åˆ†ç¦»ï¼Œå¹¶ä¸æ˜¯äººå‘˜ä¸Šçš„åˆ†ç¦»ï¼Œphpç¨‹åºå‘˜å†™å†™ç°ä»£jså¯¹è‡ªèº«çš„æˆé•¿ä¹Ÿæ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚</p><p>å…¶å®æˆ‘æƒ³è¯´çš„æ˜¯phpå¹¶ä¸æ˜¯ä¸å¯æ›¿ä»£çš„ğŸ˜†ï¼Œnode.jsä»€ä¹ˆå—’ä¹Ÿæ˜¯å¯ä»¥å¾ˆå¥½çš„å®Œæˆwebå¼€å‘çš„</p><p>ç”±äºä½¿ç”¨äº†vueå…¨å®¶æ¡¶ï¼Œä¸”å¯¹node.jsä¹Ÿä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥é€‰æ‹©äº†nuxt.jsæœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶ ï¼ˆä¸»è¦è¿˜æ˜¯ç”¨èµ·æ¥ç®€å•ï¼Œå­¦èµ·æ¥å¿«ï¼‰</p><h2 id="nuxt"><a href="#nuxt" class="headerlink" title="nuxt"></a>nuxt</h2><p>nuxtä¸­æ–‡æ–‡æ¡£ <a href="https://zh.nuxtjs.org/guide" target="_blank" rel="noopener">https://zh.nuxtjs.org/guide</a></p><p><img src="https://zh.nuxtjs.org/nuxt-schema.png" alt></p><p>åœ¨ä½¿ç”¨nuxtçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªç•Œé¢çš„è¯·æ±‚æ–¹å¼æœ‰ä¸¤ç§ã€‚</p><ul><li>ä»æµè§ˆå™¨åœ°å€æ é”®å…¥</li><li>é€šè¿‡ç±»ä¼¼ router-linkçš„aæ ‡ç­¾ç‚¹å‡»è·³è½¬</li></ul><p>å½“æˆ‘ä»¬ä»æµè§ˆå™¨çš„åœ°å€æ ä¸­é”®å…¥ä¸€æ¡è¯·æ±‚æ—¶ï¼Œè¯·æ±‚è¢«äº¤ç»™äº†nuxtæœåŠ¡å™¨ï¼ˆæˆ–è€…nginxâ†’nuxtï¼‰ã€‚<br>nuxtæœåŠ¡å™¨è§£ævueç»„ä»¶ï¼ˆä¸­çš„asyncDataæ–¹æ³•ï¼‰ï¼Œå¹¶å°†æ•°æ®ç»‘å®šåˆ°htmlã€‚ç„¶åå†è¿”å›ç»™æµè§ˆå™¨ã€‚</p><p>å½“æˆ‘ä»¬é€šè¿‡ç‚¹å‡»router-linkè·³è½¬æ—¶æ•´ä¸ªåº”ç”¨ä¾æ—§æ˜¯æ— åˆ·æ–°çš„å•é¡µåº”ç”¨ã€‚ä¸”ä¼šåœ¨window.historyä¸­é”®å…¥è®°å½•ã€‚</p><p>å› æ­¤å¯¹äºä»»æ„ä¸€ä¸ªvueç»„ä»¶å…¶è¢«è®¿é—®çš„æƒ…å†µåˆ†ä¸ºä¸¤ç§ï¼Œæµè§ˆå™¨ç«¯æ¸²æŸ“å’ŒnuxtæœåŠ¡å™¨ç«¯æ¸²æŸ“ã€‚</p><p>äº†è§£nuxtæœ€å¿«çš„æ–¹å¼å°±æ˜¯äº†è§£nuxtçš„ç”Ÿå‘½å‘¨æœŸï¼Œäº†è§£nuxtç”Ÿå‘½å‘¨æœŸæœ€å¿«çš„æ–¹å¼è‡ªç„¶æ˜¯conlose.log()äº†ã€‚<br>å¹¶ä¸å…·ä½“çš„ç»†èŠ‚è¯·å‚è€ƒæ‰‹å†Œã€‚</p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>nuxté¡¹ç›®è¿˜æ¯”è¾ƒå¹´è½»ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€äº›è«åå¥‡å¦™çš„bugï¼ˆæ›´å¤šçš„bugä¸»è¦æ˜¯å¯¹jsä¸ç†Ÿæ‚‰æ‰€è‡´ï¼‰ã€‚<br>ä½†æ˜¯vueå®˜æ–¹æ¨èï¼Œä¸”æœ‰ç€å¼ºå¤§çš„ç¤¾åŒºæ”¯æ’‘ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ç€ä¸é”™çš„ç»´æŠ¤æ•ˆç‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;å›¢é˜Ÿåœ¨æœ€è¿‘çš„ä¸€æ¬¡å¼€å‘ä¸­å‰ç«¯æŠ€æœ¯æ ˆä»html + css + jqueryè½¬å‘vueå…¨å®¶æ¡¶ã€‚åç«¯ä»php + Blade + jqueryè½¬å‘vueå…¨å®¶æ¡¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è½¬å‘å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;l
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç®€è¿° container â€”â€” åå°„æœºåˆ¶å®ç°</title>
    <link href="http://beian.miit.gov.cn/posts/a-brief-introduction-to-the-realization-of-container-reflection-mechanism.html"/>
    <id>http://beian.miit.gov.cn/posts/a-brief-introduction-to-the-realization-of-container-reflection-mechanism.html</id>
    <published>2018-01-27T09:00:03.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>ä½¿ç”¨ä¾èµ–æ³¨å…¥å®ç°æ§åˆ¶åè½¬æ¥é™ä½ä»£ç çš„è€¦åˆæ€§ã€‚</p></blockquote><p>ä¾èµ–æ³¨å…¥ DIï¼Œæ§åˆ¶åè½¬ IOCï¼Œè§£è€¦ç­‰ç­‰ç­‰ å¤§å®¶æ¢ç´¢å‰è¿›ï¼Œç»ˆèµ°åˆ°äº†è¿™ä¸€æ­¥,ç»ˆäºè®©ä»£ç çµæ´»ã€å¯æ‰©å±•ã€ä½è€¦åˆã€é«˜å†…èšï¼Œç»ˆäºå¯ä»¥å¼€å¿ƒçš„codingäº†!!</p><p>å¥½ï¼Œç°åœ¨æˆ‘è¦å»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·idä¸º1çš„ç”¨æˆ·åã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">new</span> User(</span><br><span class="line">    <span class="keyword">new</span> \Database\MysqlDrive(<span class="keyword">new</span> \Database\Connection),</span><br><span class="line">    <span class="keyword">new</span> Builder(),</span><br><span class="line">    <span class="keyword">new</span> Relations(),</span><br><span class="line">    <span class="keyword">new</span> Event(<span class="keyword">new</span> Listener()),</span><br><span class="line">    <span class="keyword">new</span> Auth(),</span><br><span class="line">    ...</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">stopï¼Ÿæˆ‘å¥½åƒæœ‰ç‚¹å†™ä¸å®Œï¼Œæˆ‘åªæƒ³è·å–ä¸€ä¸ªç”¨æˆ·åè€Œå·²ï¼ï¼ï¼</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä½¿ç”¨ä¾èµ–æ³¨å…¥åï¼Œæ‰€æœ‰çš„ä¾èµ–éƒ½ç”±è°ƒç”¨è€…æ¥å¤„ç†ï¼Œ è°ƒç”¨è€…å¯ä»¥æ§åˆ¶Userçš„è¡Œä¸ºï¼Œä½†å´è¦åšæ›´å¤šçš„äº‹æƒ…ã€‚</p><p>ä½†æˆ‘ä¸æƒ³å¤šåšä¸€ä¸äº‹æƒ…ï¼Œæˆ‘å¸Œæœ›æ›´åŠ ç®€å•ï¼Œç®€å•åˆ°è¿ä¾èµ–ä¹Ÿèƒ½è‡ªåŠ¨å¤„ç†ï¼Œè§£æï¼Œè‡ªåŠ¨æ³¨å…¥è¯¥æœ‰å¤šå¥½å‘€ï¼</p><blockquote><p>é¢˜å¤–è¯ï¼šæˆ‘æ‰€ç†è§£çš„æœ€ä¸ºçµæ´»çš„phpå¼€å‘æ¶æ„æ˜¯ï¼Œphpä½œä¸ºä¸€ä¸ªä¸­è½¬ï¼Œå°†å‰ç«¯å’Œmysqlè¿æ¥èµ·æ¥ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çµæ´»åˆ°ä¸€å¥—ä»£ç è§£å†³æ‰€æœ‰æ‰€æœ‰çš„é—®é¢˜äº†ã€‚<br>ä¾‹å¦‚<code>http://web.dev/users/1?fields=id,username&amp;include=posts:limit(1|5):order(created_at|desc)</code></p></blockquote><h2 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h2><p>æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªFooç±»ï¼ŒFooç±»ä¸­ä¸€ä¸ª<code>allBarName()</code>æ–¹æ³•.å¹¶ä¸”ä¾èµ–äºBarA~BarDè¿™4ä¸ªç±»çš„name()æ–¹æ³•. å¦‚ä¸‹ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Container</span>\<span class="title">Foo</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Container</span>\<span class="title">Bar</span>\<span class="title">BarA</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Container</span>\<span class="title">Bar</span>\<span class="title">BarB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Container</span>\<span class="title">Bar</span>\<span class="title">BarC</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Container</span>\<span class="title">Bar</span>\<span class="title">BarD</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $barA;</span><br><span class="line">    <span class="keyword">private</span> $barB;</span><br><span class="line">    <span class="keyword">private</span> $barC;</span><br><span class="line">    <span class="keyword">private</span> $barD;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(BarA $barA, BarB $barB, BarC $barC, BarD $barD)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;barA = $barA;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;barB = $barB;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;barC = $barC;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;barD = $barD;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">allBarName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;barA-&gt;name().<span class="string">'/'</span>.<span class="keyword">$this</span>-&gt;barB-&gt;name().<span class="string">'/'</span>.<span class="keyword">$this</span>-&gt;barC-&gt;name().<span class="string">'/'</span>.<span class="keyword">$this</span>-&gt;barD-&gt;name();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BarAç¤ºä¾‹ï¼Œ BarBï¼ŒBarCï¼ŒBarDç›¸åŒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Container</span>\<span class="title">Bar</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BarA</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'å½¼å¾—Â·å¸•å…‹'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ¥ï¼Œè°ƒç”¨<code>allBarName()</code>æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$foo = <span class="keyword">new</span> \Container\Foo\Foo(</span><br><span class="line">    <span class="keyword">new</span> \Container\Bar\BarA(),</span><br><span class="line">    <span class="keyword">new</span> \Container\Bar\BarB(),</span><br><span class="line">    <span class="keyword">new</span> \Container\Bar\BarC(),</span><br><span class="line">    <span class="keyword">new</span> \Container\Bar\BarD()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $foo-&gt;allBarName(); <span class="comment">// å½¼å¾—Â·å¸•å…‹/æ‰˜å°¼Â·å±å¤§é¢—/å·´é‡ŒÂ·è‰¾ä¼¦/å¸ƒé²æ–¯Â·éŸ¦æ©</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„codeå·²ç»æ˜¯ä½è€¦åˆçš„äº†ã€‚<br>ä½†æ‡’æƒ°çš„æˆ‘å¹¶ä¸æƒ³å»æ‰‹åŠ¨æ³¨å…¥Fooçš„æ‰€æœ‰ä¾èµ–ï¼Œæˆ‘å¸Œæœ›èƒ½æœ‰ä¸€ä¸ªContaineræ¥å¸®æˆ‘è§£æFooçš„æ‰€æœ‰ä¾èµ–ï¼Œç„¶åå†æŠŠå®ä¾‹è¿”å›ç»™æˆ‘ã€‚</p><p>é‚£å°±æ¥å§ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„Container</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Container</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">make</span><span class="params">($class)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $reflection = <span class="keyword">new</span> \ReflectionClass($class);</span><br><span class="line"></span><br><span class="line">        $constructor = $reflection-&gt;getConstructor();</span><br><span class="line">        $parameters = $constructor-&gt;getParameters();</span><br><span class="line"></span><br><span class="line">        $instances = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($parameters <span class="keyword">as</span> $parameter) &#123;</span><br><span class="line">            $className =  $parameter-&gt;getClass()-&gt;getName();</span><br><span class="line">            $instances[] = <span class="keyword">new</span> $className;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//... å°†æ•°ç»„æ‹†å°æˆå‚æ•°ä¼ é€’ç»™æ–¹æ³•, ç±»ä¼¼äº call_user_func_array()</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> $class(...$instances);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•åˆ°ä¸èƒ½å†ç®€å•çš„ä¾èµ–è§£æå®¹å™¨äº†ï¼Œä½†æˆ‘æƒ³å®ƒèƒ½æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚</p><p>å†æ¬¡è°ƒç”¨allBarName()æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$foo = \Container\Container::make(\Container\Foo\Foo::class);</span><br><span class="line"><span class="keyword">echo</span> $foo-&gt;allBarName(); <span class="comment">// å½¼å¾—Â·å¸•å…‹/æ‰˜å°¼Â·å±å¤§é¢—/å·´é‡ŒÂ·è‰¾ä¼¦/å¸ƒé²æ–¯Â·éŸ¦æ©</span></span><br></pre></td></tr></table></figure><p>oh yeahï¼æˆåŠŸäº†</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æˆ‘æƒ³æˆ‘å·²ç»è¡¨è¾¾äº†æˆ‘çš„æƒ³æ³•ï¼Œæˆ‘è¿˜æ²¡æœ‰èƒ½åŠ›ä¹Ÿä¸æ˜¯å¾ˆæƒ³å»å®ç°ä¸€ä¸ªå¼ºå¤§çµæ´»çš„containerï¼Œèƒ½å¤ŸçŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦containeræˆ‘å·²ç»å¾ˆæ»¡è¶³äº†ã€‚</p><ul><li>code demo <a href="https://github.com/weiwenhao/container" target="_blank" rel="noopener">https://github.com/weiwenhao/container</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨ä¾èµ–æ³¨å…¥å®ç°æ§åˆ¶åè½¬æ¥é™ä½ä»£ç çš„è€¦åˆæ€§ã€‚&lt;/p&gt;
&lt;/blockquote
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>è§£å†³Chrome6.2ä»¥ä¸ŠPreviewæ— æ³•æ¸²æŸ“jsé—®é¢˜</title>
    <link href="http://beian.miit.gov.cn/posts/chrome62-above-to-solve-the-problem-can-not-render-js.html"/>
    <id>http://beian.miit.gov.cn/posts/chrome62-above-to-solve-the-problem-can-not-render-js.html</id>
    <published>2017-12-26T17:31:19.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p><img src="http://omjq5ny0e.bkt.clouddn.com/17-12-23/6366700.jpg" alt><br>æ—¢è¯¥ç•Œé¢æ— æ³•æ¸²æŸ“dump()æˆ–è€…dd()</p><blockquote><p>chromç‰ˆæœ¬: 63.0.3239.84<br>ç³»ç»Ÿç‰ˆæœ¬:  os10.12</p></blockquote><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>å½“å“åº”çš„çŠ¶æ€ç ä¸º400 or 500ç³»åˆ—æ—¶å¯ä»¥ä½¿Previewæ¸²æŸ“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http_response_code(<span class="number">500</span>); <span class="comment">// or 400ç³»åˆ—çŠ¶æ€ç </span></span><br><span class="line">dd(request());</span><br></pre></td></tr></table></figure><p><img src="http://omjq5ny0e.bkt.clouddn.com/17-12-23/14918492.jpg" alt></p><p>å¯»æ±‚æ–¹ä¾¿çš„è¯,å¯ä»¥å°†ä¸Šé¢çš„ä»£ç æ·»åŠ åˆ° live templatesä¸­,æˆ–è€…æ·»åŠ ä¸€ä¸ªhelper function<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function ddd(...$args)&#123;</span><br><span class="line">    http_response_code(500);</span><br><span class="line">    call_user_func_array(&apos;dd&apos;, $args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>å¦‚æœæœåŠ¡ç«¯å“åº”çš„æ•°æ®è¿‡å¤§æ—¶Previewå¯èƒ½ä¼šå‡ºç° <code>failed to load response data</code> è¿™æ ·çš„é”™è¯¯.<br>å¹¶æ²¡æœ‰æ‰¾åˆ°ç¡®åˆ‡çš„è§£å†³åŠæ³•,å¯ä»¥å°è¯•å˜æ›´httpå“åº”çš„çŠ¶æ€ç ä¸º400è§£å†³è¯¥é—®é¢˜.</p><p>å‚è€ƒé“¾æ¥: <a href="https://github.com/symfony/symfony/issues/24688" target="_blank" rel="noopener">https://github.com/symfony/symfony/issues/24688</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://omjq5ny0e.bkt.clouddn.com/1
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç®€è¿°pythonå¼‚æ­¥i/oåº“ â€”â€” asyncio</title>
    <link href="http://beian.miit.gov.cn/posts/python-asyncio.html"/>
    <id>http://beian.miit.gov.cn/posts/python-asyncio.html</id>
    <published>2017-10-31T08:12:02.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>pythonçš„asyncioåº“ä»¥åç¨‹ä¸ºåŸºç¡€ï¼Œevent_loopä½œä¸ºåç¨‹çš„é©±åŠ¨å’Œè°ƒåº¦æ¨¡å‹ã€‚è¯¥æ¨¡å‹æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„å¼‚æ­¥æ¨¡å‹ï¼Œç±»ä¼¼äºnode.jsã€‚ä¸‹å›¾æˆ‘æ‰€ç†è§£çš„è¯¥æ¨¡å‹</p><a id="more"></a><p><img src="https://user-gold-cdn.xitu.io/2017/10/31/23b17e8d92ec76fcefb7abadc0101dd7" alt></p><p>äº‹ä»¶å¾ªç¯é€šè¿‡select()æ¥ç›‘å¬æ˜¯å¦å­˜åœ¨å°±ç»ªçš„äº‹ä»¶ï¼Œå¦‚æœå­˜åœ¨å°±æŠŠäº‹ä»¶å¯¹åº”çš„callbackæ·»åŠ åˆ°ä¸€ä¸ªtask listä¸­ã€‚ç„¶åä»task listå¤´éƒ¨ä¸­å–å‡ºä¸€ä¸ªtaskæ‰§è¡Œã€‚åœ¨å•çº¿ç¨‹ä¸­ä¸æ–­çš„æ³¨å†Œäº‹ä»¶ï¼Œæ‰§è¡Œäº‹ä»¶ï¼Œä»è€Œå®ç°äº†æˆ‘ä»¬çš„event_loopæ¨¡å‹ã€‚</p><p><strong>event_loopä¸­æ‰§è¡Œçš„taskå¹¶ä¸æ˜¯å‡½æ•°</strong></p><p>å¦‚æœ<strong>æˆ‘ä»¬æŠŠä¸Šå›¾å½“æˆä¸€ä¸ªwebæœåŠ¡å™¨</strong>ï¼Œå·¦è¾¹çš„ä¸€ä¸ªtaskå½“æˆä¸€æ¬¡httpè¯·æ±‚éœ€è¦æ‰§è¡Œçš„å®Œæ•´ä»»åŠ¡ã€‚å¦‚æœæˆ‘ä»¬æ¯ä¸€æ¬¡run_task()éƒ½æ‰§è¡Œå®Œä¸€ä¸ªå®Œæ•´çš„ä»»åŠ¡ï¼Œå†å»runä¸‹ä¸€ä¸ªtaskã€‚ é‚£è¿™è·Ÿæ™®é€šçš„ä¸²è¡ŒæœåŠ¡å™¨å¹¶æ²¡æœ‰åŒºåˆ«ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸‹é€ æˆçš„ç”¨æˆ·ä½“éªŒéå¸¸å·®ã€‚</p><blockquote><p>å…·ä½“æ€ä¹ˆå·®ä½ å¯ä»¥è„‘è¡¥ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ç°åœ¨æ˜¯ä½¿ç”¨å•çº¿ç¨‹æ–¹å¼å®ç°çš„webæœåŠ¡å™¨</p></blockquote><p>æ‰€ä»¥taskå¦‚æœå¯¹åº”ä¸€ä¸ªå®Œæ•´çš„httpè¯·æ±‚é‚£ä¹ˆå…¶ä¸å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºå‡½æ•°éœ€è¦ä»å¤´æ‰§è¡Œåˆ°å°¾å ç”¨ç€æ•´ä¸ªçº¿ç¨‹ã€‚é‚£ä½ è§‰å¾—taskæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆçš„è¯å¯ä»¥çœ‹ä¸€çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="http://www.weiwenhao.xyz/article/the-yield-and-yield-of-python-the-from" target="_blank" rel="noopener">ç®€è¿°pythonçš„yieldå’Œyield from</a></p><p>æ²¡é”™ï¼Œtaskæ˜¯ä¸€ä¸ªgeneratorï¼Œæˆ–è€…å¯ä»¥å«åšå¯ä¸­æ–­çš„å‡½æ•°ã€‚taskçš„ä»£ç ä¾æ—§æ˜¯ä»ä¸Šå†™åˆ°ä¸‹æ¥å¤„ç†ä¸€ä¸ªhttpè¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åŒæ­¥çš„ä»£ç ç»„ç»‡ã€‚</p><p>ä½†æ˜¯æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼Œåœ¨taskä¸­ï¼Œæˆ‘ä»¬é‡åˆ°i/oæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å°±æŠŠi/oæ“ä½œäº¤ç»™selectorï¼ˆç¨åæˆ‘ä»¬è§£æä¸€ä¸‹selectorï¼Œå¹¶ä¸”æŠŠè¯¥i/oæ“ä½œå‡†å¤‡å®Œæ¯•åéœ€è¦æ‰§è¡Œçš„å›è°ƒä¹Ÿå‘Šè¯‰selectorã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨yieldä¿å­˜å¹¶ä¸­æ–­è¯¥å‡½æ•°ã€‚</p><p>æ­¤æ—¶çº¿ç¨‹çš„æ§åˆ¶æƒå›åˆ°event_loopæ‰‹ä¸­ã€‚event_loopé¦–å…ˆçœ‹ä¸€ä¸‹selectorä¸­æ˜¯å¦å­˜åœ¨å°±ç»ªçš„æ•°æ®ï¼Œå­˜åœ¨çš„è¯å°±æŠŠå¯¹åº”çš„å›è°ƒæ”¾åˆ°task listçš„å°¾éƒ¨ï¼ˆå¦‚å›¾ï¼‰ï¼Œç„¶åä»å¤´éƒ¨ç»§ç»­run_task()ã€‚</p><p>ä½ å¯èƒ½æƒ³é—®ä¸Šé¢ä¸­æ–­çš„taskä»€ä¹ˆæ—¶å€™æ‰èƒ½ç»§ç»­æ‰§è¡Œå‘¢ï¼Ÿæˆ‘å‰ä¸€å¥è¯´è¿‡äº†ï¼Œevent_loopæ¯ä¸€æ¬¡å¾ªç¯éƒ½ä¼šæ£€æµ‹selectorä¸­æ˜¯å¦å­˜åœ¨å°±ç»ªçš„i/oæ“ä½œï¼Œå¦‚æœå­˜åœ¨å°±ç»ªçš„i/oæ“ä½œï¼Œæˆ‘ä»¬å¯¹åº”å°±æŠŠcallbackæ”¾åˆ°taskçš„å°¾éƒ¨ï¼Œå½“event_loopæ‰§è¡Œåˆ°è¿™ä¸ªtaskæ—¶ã€‚æˆ‘ä»¬å°±èƒ½å›åˆ°æˆ‘ä»¬åˆšåˆšä¸­æ–­çš„å‡½æ•°ç»§ç»­æ‰§è¡Œå•¦ï¼Œè€Œä¸”æ­¤æ—¶æˆ‘ä»¬éœ€è¦çš„i/oæ“ä½œå¾—åˆ°çš„æ•°æ®ä¹Ÿå·²ç»å‡†å¤‡å¥½äº†ã€‚</p><blockquote><p>è¿™ç§æ“ä½œå¦‚æœä½ ç«™åœ¨å‡½æ•°çš„è§’åº¦ä¼šæœ‰ç§ç¥å¥‡çš„æ„Ÿè§‰ï¼Œåœ¨å‡½æ•°çœ¼é‡Œï¼Œè‡ªå·±éœ€è¦geté¥è¿œæœåŠ¡å™¨çš„ä¸€äº›æ•°æ®ï¼Œäºæ˜¯è°ƒåŠ¨get()ï¼Œç„¶åç¬é—´å°±å¾—åˆ°äº†é¥è¿œæœåŠ¡å™¨çš„æ•°æ®ã€‚æ²¡é”™åœ¨å‡½æ•°çš„çœ¼é‡Œå°±æ˜¯ç¬é—´å¾—åˆ°ï¼Œè¿™æ„Ÿè§‰å°±ä»¿ä½›æ˜¯ç©¿è¶Šåˆ°äº†æœªæ¥ä¸€æ ·ã€‚</p></blockquote><p>ä½ å¯èƒ½åˆæƒ³é—®ï¼Œä¸ºä»€ä¹ˆæŠŠcallbackæ”¾åˆ°taskï¼Œç„¶årunä¸€ä¸‹å°±å›åˆ°åŸæœ‰çš„å‡½æ•°æ‰§è¡Œä½ç½®äº†ï¼Ÿ</p><p>è¿™æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæˆ‘å¹¶æ²¡æœ‰æ·±è¿½asyncioçš„ä»£ç ï¼Œè¿™å¯¹äºæˆ‘æ¥è¯´æœ‰äº›å¤æ‚ã€‚ä½†å¦‚æœæ˜¯æˆ‘çš„è¯ï¼Œæˆ‘åªè¦åœ¨callbackä¸­è®¾ç½®ä¸€ä¸ªå˜é‡genæŒ‡å‘æˆ‘ä»¬çš„generatorå°±è¡Œäº†ï¼Œç„¶ååªè¦åœ¨callbackä¸­<code>gen.send(res_data)</code>ï¼Œæˆ‘ä»¬å°±èƒ½å›åˆ°ä¸­æ–­å¤„ç»§ç»­æ‰§è¡Œäº†ã€‚å¦‚æœä½ æœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±ä½¿ç”¨debugæ¥è¿½ä¸€ä¸‹ä»£ç ã€‚</p><p>ä¸è¿‡æˆ‘æ›´æ¨èä½ é˜…è¯»ä¸€ä¸‹è¿™ç¯‡åšæ–‡ <a href="http://python.jobbole.com/88291/" target="_blank" rel="noopener">æ·±å…¥ç†è§£ Python å¼‚æ­¥ç¼–ç¨‹(ä¸Š)</a></p><h3 id="è¿™é‡Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜ã€‚"><a href="#è¿™é‡Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜ã€‚" class="headerlink" title="è¿™é‡Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜ã€‚"></a>è¿™é‡Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜ã€‚</h3><p>æ¯”å¦‚æˆ‘ä»¬åœ¨taskä¸­éœ€è¦æ‰§è¡Œä¸€ä¸ª1+2+3+åˆ°2000ä¸‡è¿™æ ·ä¸€ä¸ªæ“ä½œï¼Œè¿™ä¸ªæ“ä½œè€—æ—¶æœ‰äº›é•¿ï¼Œè€Œä¸”ä¸å±äºi/oæ“ä½œï¼Œæ²¡æ³•äº¤ç»™selectorå»è°ƒåº¦ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦è‡ªå·±yieldï¼Œè®©å…¶ä»–çš„taskèƒ½æœ‰æœºä¼šæ¥ä½¿ç”¨æˆ‘ä»¬å”¯ä¸€çš„çº¿ç¨‹ã€‚è¿™æ ·å°±åˆæœ‰ä¸€ä¸ªæ–°çš„é—®é¢˜ã€‚yieldåï¼Œæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å†æ¬¡æ¥æ‰§è¡Œè¿™ä¸ªè¢«ä¸­æ–­çš„å‡½æ•°å‘¢ï¼Ÿ</p><p>é—®é¢˜ä»£ç ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_sum</span><span class="params">()</span>:</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> range(<span class="number">20000000</span>):</span><br><span class="line">        sum += a</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">1000000</span>:</span><br><span class="line">            count = <span class="number">0</span></span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">    print(<span class="string">'1+åˆ°2000ä¸‡çš„å’Œæ˜¯&#123;&#125;'</span>.format(sum))</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> print_sum()</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(init())</span><br><span class="line">loop.run_forever()</span><br></pre></td></tr></table></figure><p>æˆ‘æƒ³æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼ŒæŠŠè¿™ä¸ªä¸­æ–­çš„taskç›´æ¥åŠ å…¥åˆ°task listçš„å°¾éƒ¨ï¼Œç„¶åç»§ç»­event_loopï¼Œè¿™æ ·è®©å…¶ä»–taskæœ‰æœºä¼šæ‰§è¡Œï¼Œå¹¶ä¸”å¤„ç†èµ·æ¥æ›´åŠ çš„ç®€å•ã€‚ asyncioåº“ä¹Ÿç¡®å®æ˜¯è¿™æ ·åšçš„ã€‚</p><p><em>ä½†æ˜¯asyncioè¿˜æä¾›äº†æ›´å¥½çš„åšæ³•ï¼Œæˆ‘ä»¬å¯ä»¥å†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™ç§cpuå¯†é›†å‹è¿ç®—</em></p><hr><p>å†æ¥çœ‹çœ‹å¦å¤–ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœåœ¨ä¸€ä¸ªå‡Œæ™¨ä¸‰ç‚¹åŠï¼Œä½ task listæ­¤æ—¶æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä½ çš„event_loopæ€ä¹ˆè¿ä½œï¼Ÿç»§ç»­ä¸åœçš„loopç­‰å¾…æ–°çš„httpè¯·æ±‚è¿›æ¥ï¼Ÿ noï¼Œæˆ‘ä»¬ä¸å…è®¸å¦‚æ­¤æµªè´¹cpuçš„èµ„æºã€‚asyncioåº“ä¹Ÿä¸å…è®¸ã€‚</p><p>é¦–å…ˆçœ‹ä¸¤è¡Œevent_loopä¸­çš„ä»£ç ç‰‡æ®µï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­å³ä¸Šè§’éƒ¨åˆ†çš„select(timeout)éƒ¨åˆ†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">event_list = self._selector.select(timeout)</span><br><span class="line">   self._process_events(event_list)</span><br></pre></td></tr></table></figure><blockquote><p>è¡¥å……ä¸€ç‚¹ï¼Œä½œä¸ºä¸€å°webæœåŠ¡å™¨ï¼Œæˆ‘ä»¬æ€»æ˜¯éœ€è¦socket()ã€bind()ã€listen()ã€æ¥åˆ›å»ºä¸€ä¸ªç›‘å¬æè¿°ç¬¦sockfdï¼Œç”¨æ¥ç›‘å¬åˆ°æ¥çš„httpè¯·æ±‚ï¼Œä¸httpè¯·æ±‚å®Œæˆä¸‰è·¯æ¡æ‰‹ã€‚ç„¶åé€šè¿‡accept()æ“ä½œæ¥å¾—åˆ°ä¸€ä¸ªå·²è¿æ¥æè¿°ç¬¦connectfdã€‚</p><p>è¿™é‡Œçš„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ­¤æ—¶éƒ½å­˜åœ¨äºæˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œå…¶ä¸­sockfdç»§ç»­ç”¨æ¥æ‰§è¡Œç›‘å¬httpè¯·æ±‚æ“ä½œã€‚å·²ç»è¿æ¥äº†çš„å®¢æˆ·ç«¯æˆ‘ä»¬åˆ™é€šè¿‡connectfdæ¥ä¸å…¶é€šä¿¡ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªsockfdå¯¹å¤šä¸ªconnectfdã€‚</p><p>æ›´å¤šçš„ç»†èŠ‚æ¨èé˜…è¯»  â€”â€”ã€Šunixç½‘ç»œç¼–ç¨‹å·ä¸€ã€‹ä¸­çš„å…³äºsocketç¼–ç¨‹çš„å‡ ç« </p></blockquote><p>asyncioå¯¹äºç½‘ç»œi/oä½¿ç”¨äº† selectoræ¨¡å—ï¼Œselectoræ¨¡å—çš„åº•å±‚åˆ™æ˜¯ç”± epoll()æ¥å®ç°ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒæ­¥çš„i/oå¤ç”¨ç³»ç»Ÿè°ƒç”¨<strong>ï¼ˆä½ å®šä¼šæƒŠè®¶äºasyncioçš„ç«Ÿç„¶ä½¿ç”¨äº†åŒæ­¥i/oæ¥å®ç°ï¼Ÿæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚æ¥è§£è¯»ä¸€ä¸‹epollå‡½æ•°ï¼‰</strong></p><p><em>è¿™é‡Œä½ å¯ä»¥å»è¯»ä¸€ä¸‹pythonæ‰‹å†Œä¸­çš„selectoræ¨¡å—ï¼Œçœ‹çœ‹è¿™ä¸ªæ¨¡å—çš„ä½œç”¨</em></p><p>epoll()å‡½æ•°æœ‰ä¸ªtimeoutå‚æ•°ï¼Œç”¨æ¥æ§åˆ¶è¯¥å‡½æ•°æ˜¯å¦é˜»å¡ï¼Œé˜»å¡å¤šä¹…ã€‚æ˜ å°„åˆ°é«˜å±‚å°±æ˜¯æˆ‘ä»¬ä¸Šé¢çš„<code>selector.select(timeout)</code>ä¸­çš„timeoutã€‚åŸæ¥æˆ‘ä»¬çš„event_loopä¸­çš„å­˜åœ¨ä¸€ä¸ªtimeoutã€‚è¿™æ ·å‡Œæ™¨ä¸‰ç‚¹åŠæˆ‘ä»¬å¦‚ä½•å¤„ç†event_loopæˆ‘æƒ³ä½ å·²ç»å¿ƒé‡Œæœ‰æ•°äº†å§ã€‚</p><p>asyncioçš„å®ç°å’Œä½ æƒ³çš„å·®ä¸å¤šã€‚å¦‚æœtask list is not  Noneé‚£ä¹ˆæˆ‘ä»¬çš„timeout=0ä¹Ÿå°±æ˜¯éé˜»å¡çš„ã€‚è§£é‡Šä¸€ä¸‹å°±æ˜¯ï¼Œæˆ‘ä»¬è°ƒç”¨selector.select(timeout = 0 )ï¼Œè¯¥å‡½æ•°ä¼šé©¬ä¸Šè¿”å›ç»“æœï¼Œæˆ‘ä»¬å¯¹ç»“æœåšä¸€ä¸ªä¸Šé¢è®²è¿‡çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯<code>self._process_events(event_list)</code>ã€‚ç„¶åæˆ‘ä»¬ç»§ç»­run taskã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„task list is Noneï¼Œ é‚£ä¹ˆæˆ‘ä»¬åˆ™æŠŠtimeout=Noneã€‚ä¹Ÿå°±æ˜¯è®¾ç½®æˆé˜»å¡æ“ä½œã€‚æ­¤æ—¶æˆ‘ä»¬çš„ä»£ç æˆ–è€…è¯´çº¿ç¨‹ä¼šé˜»å¡åœ¨selector.select(timeout = 0)å¤„ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ç­‰å¾…è¯¥å‡½æ•°çš„è¿”å›ã€‚<strong>å½“ç„¶è¿™æ ·åšçš„å‰ææ˜¯ï¼Œä½ å¾€selectorä¸­æ³¨å†Œäº†éœ€è¦ç­‰å¾…çš„socketæè¿°ç¬¦ã€‚</strong></p><hr><p>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é—®é¢˜ï¼Œæ¯”å¦‚å¼‚æ­¥mysqlæ˜¯å¦‚ä½•åœ¨asyncioçš„åŸºç¡€ä¸Šå®ç°çš„ï¼Œè¿™å¯èƒ½éœ€è¦å»é˜…è¯»aiomysqlåº“äº†ã€‚</p><p>ä½ ä¹Ÿè®¸å‘ç°ï¼Œæˆ‘ä»¬ä¸€æ—¦ä½¿ç”¨äº†event_loopå®ç°å•çº¿ç¨‹å¼‚æ­¥æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å†™çš„æ‰€æœ‰ä»£ç å°±éƒ½ä¸æ˜¯æˆ‘ä»¬æ¥æ§åˆ¶æ‰§è¡Œäº†ï¼Œä»£ç çš„æ‰§è¡Œæƒå…¨éƒ¨äº¤ç»™äº†event_loopï¼Œevent_loopåœ¨é€‚å½“çš„æ—¶é—´run taskã€‚è¯»è¿‡å»–é›ªå³°pythonæ•™ç¨‹çš„å°ä¼™ä¼´ä¸€å®šçœ‹è¿‡è¿™å¥è¯</p><blockquote><p>è¿™å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªåŸåˆ™ï¼šä¸€æ—¦å†³å®šä½¿ç”¨å¼‚æ­¥ï¼Œåˆ™ç³»ç»Ÿæ¯ä¸€å±‚éƒ½å¿…é¡»æ˜¯å¼‚æ­¥ï¼Œâ€œå¼€å¼“æ²¡æœ‰å›å¤´ç®­â€ã€‚  </p></blockquote><p>è¿™å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹ã€‚</p><hr><p>ä½ ä¹Ÿè®¸å¯¹asyncioçš„ä½œç”¨ï¼Œæˆ–è€…ä½¿ç”¨ï¼Œæˆ–è€…ä»£ç å®ç°æœ‰ç€å¾ˆå¤šçš„ç–‘é—®ï¼Œæˆ‘ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯å¾ˆæŠ±æ­‰ï¼Œæˆ‘å¹¶ä¸æ€ä¹ˆç†Ÿæ‚‰pythonï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨asyncioåšè¿‡é¡¹ç›®ï¼Œåªæ˜¯å‡ºäºå¥½å¥‡æ‰€ä»¥æˆ‘å¯¹pythonçš„å¼‚æ­¥i/oè¿›è¡Œäº†ä¸€ä¸ªäº†è§£ã€‚</p><p>æˆ‘æ˜¯ä¸€ä¸ªçº¸ä¸Šè°ˆå…µçš„é—¨å¤–æ±‰ï¼Œåˆ°æœ€åæˆ‘ä¹Ÿæ²¡èƒ½çœ‹æ¸…asyncioåº“çš„å…·ä½“å®ç°ã€‚æˆ‘æ¥ä¸‹æ¥çš„è®¡åˆ’ä¸­å¹¶ä¸æ‰“ç®—å¯¹asyncioåº“è¿›è¡Œæ›´å¤šçš„ç ”ç©¶ï¼Œä½†æ˜¯æˆ‘åˆä¸ç”˜å¿ƒè¿™ä¸¤å¤©å¯¹asyncioåº“çš„ç ”ç©¶ä»˜è¯¸ä¸œæµã€‚æ‰€ä»¥æˆ‘ç•™ä¸‹è¿™ç¯‡åšæ–‡ï¼Œç®—æ˜¯å¯¹è‡ªå·±çš„ä¸€ä¸ªäº¤å¾…ï¼å¸Œæœ›ä¸‹æ¬¡èƒ½å¤Ÿæœ‰æœºä¼šï¼Œèƒ½å¤Ÿæ›´åŠ äº†è§£pythonå’Œasyncioçš„å‰æä¸‹ï¼Œå†å†™ä¸€ç¯‡æ·±å…¥è§£æpythonâ€”asyncioçš„åšæ–‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;pythonçš„asyncioåº“ä»¥åç¨‹ä¸ºåŸºç¡€ï¼Œevent_loopä½œä¸ºåç¨‹çš„é©±åŠ¨å’Œè°ƒåº¦æ¨¡å‹ã€‚è¯¥æ¨¡å‹æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„å¼‚æ­¥æ¨¡å‹ï¼Œç±»ä¼¼äºnode.jsã€‚ä¸‹å›¾æˆ‘æ‰€ç†è§£çš„è¯¥æ¨¡å‹&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="http://beian.miit.gov.cn/categories/python/"/>
    
    
      <category term="asyncio" scheme="http://beian.miit.gov.cn/tags/asyncio/"/>
    
  </entry>
  
  <entry>
    <title>ç®€è¿°pythonçš„yieldå’Œyield from</title>
    <link href="http://beian.miit.gov.cn/posts/python-yield-from.html"/>
    <id>http://beian.miit.gov.cn/posts/python-yield-from.html</id>
    <published>2017-10-31T01:12:02.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h2><p>å‡½æ•°å¯ä»¥çœ‹æˆæ˜¯ä¸€å †æŒ‡ä»¤çš„é›†åˆã€‚åœ¨å‡½æ•°ä¸­åŠ å…¥yieldå¯ä»¥æŠŠä¸€ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªgeneratorï¼Œè™½ç„¶è°ƒç”¨çš„æ–¹å¼ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯å…¶å®ç°çš„åŠŸèƒ½å’ŒåŸæ¥çš„å‡½æ•°åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚</p><a id="more"></a><p>è€Œyieldåœ¨è¿™å…¶ä¸­çš„ä½œç”¨æ˜¯ï¼ŒæŠŠè¿è¡Œä¸­çš„å‡½æ•°è¿›è¡Œäº†ä¸€ä¸ªä¿å­˜é€€å‡ºï¼ˆä¹Ÿå°±æ˜¯ä¸­æ–­ï¼‰ã€‚ç„¶åæŠŠçº¿ç¨‹çš„çš„æ§åˆ¶æƒä»å‡½æ•°æ‰‹é‡Œäº¤æ¢åˆ°æˆ‘ä»¬æ‰‹é‡Œ(è¿™æ ·è¯´å¾ˆç‰µå¼ºï¼Œå› ä¸ºç¨‹åºéƒ½æ˜¯æˆ‘ä»¬å†™çš„å“ˆå“ˆ)ï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨<strong>é€‚å½“</strong>çš„æ—¶æœºåœ¨ç»§ç»­è¿è¡Œè¯¥å‡½æ•°ã€‚</p><p>å‡½æ•°è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸­æ–­æ“ä½œåœ¨å•çº¿ç¨‹ä¸­å¯ä»¥ç”¨æ¥å®ç°ä¸€äº›å¾ˆç¥å¥‡çš„åŠŸèƒ½ã€‚å°¤å…¶æ˜¯åœ¨ç½‘ç»œi/oæ“ä½œä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test():</span><br><span class="line">request_baidu_server(baidu_data)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    print(baidu_data)</span><br></pre></td></tr></table></figure><p><code>request_baidu_server(baidu_data)</code>å»è¯·æ±‚ç™¾åº¦éœ€è¦èµ°å¾ˆé•¿çš„ç½‘ç»œçº¿è·¯ï¼Œä¸‰è·¯æ¡æ‰‹,æ•°æ®ä¼ é€’ã€‚è¿™åœ¨cpuçš„æ„Ÿå®˜é‡Œè¿™å°±æ˜¯ç­‰å¾…æ•°å¹´çš„æ“ä½œã€‚æˆ‘ä»¬çš„ç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œï¼Œéš¾é“æˆ‘ä»¬å°±è¿™æ ·è®©cpuç­‰å¾…ï¼Ÿå½“ç„¶ä¸<br>æ‰€ä»¥è°ƒç”¨yieldæŠŠçº¿ç¨‹çš„æ§åˆ¶æƒäº¤å‡ºæ¥ï¼Œç„¶åæˆ‘ä»¬è®©çº¿ç¨‹å»åšä¸€äº›å…¶ä»–çš„äº‹æƒ…ï¼Œæ¯”å¦‚å†å…¥è¯·æ±‚æ–°æµªæœåŠ¡å™¨ã€‚åˆè¦ç­‰å¾…ï¼Ÿokï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œå°±ä¸€ç¬é—´ï¼Œæˆ‘ä»¬åŒæ—¶è¯·æ±‚äº†ä¸Šåƒå°æœåŠ¡å™¨çš„æ•°æ®ã€‚è¿™éš¾é“è¿˜ä¸å¤Ÿç¥å¥‡å—ï¼Ÿ</p><p><strong>ç¨å¾®æ€»ç»“ä¸€ä¸‹yieldï¼Œé€šè¿‡å…¶å¯ä»¥è®©æˆ‘ä»¬ç¨‹åºå‘˜å®ç°å¯¹çº¿ç¨‹çš„è°ƒé…ï¼Œä»è€Œæ›´åŠ å……åˆ†çš„åˆ©ç”¨çš„ä»¬çš„cpuã€‚</strong></p><p>ä¸Šé¢çš„ç¨‹åºåªæ˜¯ä¸€ä¸ªé›å½¢ï¼Œä½†æ˜¯ç”±äºyieldçš„åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ä¸èµ˜è¿°ã€‚è‡³å°‘è¦äº†è§£ä¸€ä¸‹send()æ“ä½œæ‰èƒ½ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><h2 id="yield-from"><a href="#yield-from" class="headerlink" title="yield from"></a>yield from</h2><hr><p>ä¸€ä¸ªå‡½æ•°ä¸å¯èƒ½å†™å‡ åƒè¡Œï¼Œé€šå¸¸éƒ½æ˜¯ aè°ƒç”¨bï¼Œbè°ƒç”¨cï¼Œ cè°ƒç”¨aã€‚è¿™æ ·ä¼šå¢åŠ ä»£ç çš„å¯è¯»æ€§ï¼Œå¤ç”¨æ€§ã€‚</p><p>ç°åœ¨æ€è€ƒå‡å¦‚b()è°ƒç”¨c()ï¼Œc()ä¸­å­˜åœ¨yieldæ—¶æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p><p>æˆ‘ä»¬å¯èƒ½éœ€è¦è¿™ä¹ˆå¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">()</span>:</span></span><br><span class="line">  gen = c()</span><br><span class="line">  r = gen.send(<span class="keyword">None</span>)</span><br><span class="line">  print(r)</span><br><span class="line">  r = gen.send(<span class="keyword">None</span>)</span><br><span class="line">  <span class="comment"># æˆ–è€…ç”¨for gen in c()æ¥è¿›è¡Œç”Ÿæˆå™¨çš„è¿è¡Œï¼Œä½†æ˜¯è¿™æ ·å·²ç»å¾ˆéº»çƒ¦äº†ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>é‰´äºåœ¨ç”Ÿæˆå™¨ä¸­è°ƒç”¨ç”Ÿæˆå™¨æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æœ‰äº†yield fromè¯­æ³•ã€‚ç”¨äºç®€åŒ–åµŒå¥—è°ƒç”¨ç”Ÿæˆå™¨çš„è¯­æ³•å¤æ‚åº¦ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">()</span>:</span></span><br><span class="line">r = <span class="keyword">yield</span> <span class="keyword">from</span> c()</span><br><span class="line">    print(r) <span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">()</span>:</span></span><br><span class="line">r = <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    print(r) <span class="comment"># å“ˆå“ˆ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gen = b()</span><br><span class="line">gen.send(<span class="keyword">None</span>) <span class="comment"># 1</span></span><br><span class="line">gen.send(<span class="string">'å“ˆå“ˆ'</span>) <span class="comment"># 2</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨sendæ—¶ï¼Œè¿è¡Œåˆ°è¯­å¥ <code>yield from c()</code> è¿™æ¡è¯­å¥åœ¨æˆ‘ç†è§£å°±æ˜¯</p><p><code>gc = c(),res = gc.send(None),yield res</code> æ‰§è¡Œäº†è¿™ä¸‰æ¡è¯­å¥.</p><p>ä½†æ˜¯ï¼Œå…¶ä¸­ç¬¬äºŒæ¡æŒ‡ä»¤<code>gc.send()</code>æ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹çš„æ§åˆ¶æƒä»bå‡½æ•°è½¬ç§»åˆ°äº†cå‡½æ•°ã€‚ æ‰€ä»¥<code>yield from c()</code>å¯ä»¥ç†è§£ä¸ºä¿å­˜å¹¶ä¸­æ–­å½“å‰å‡½æ•°ï¼Œç„¶åæŠŠçº¿ç¨‹çš„æ§åˆ¶æƒäº¤ç»™cå‡½æ•°ã€‚</p><p>æ­¤æ—¶çº¿ç¨‹æ‰§è¡Œcå‡½æ•°ï¼Œå‡½æ•°æ‰§è¡Œäº†ä¸€æ¡<code>r = yield 1</code>è¿›è¡Œäº†ä¿å­˜é€€å‡ºï¼Œæ­¤æ—¶çº¿ç¨‹çš„æ§åˆ¶æƒåˆå†ä¸€æ¬¡å›åˆ°äº†æˆ‘ä»¬æ‰‹ä¸Šã€‚ä¹Ÿå°±æ˜¯<code>gen.send(None)</code>è¿”å›äº†ç»“æœ1ã€‚</p><p>æ­¤æ—¶çº¿ç¨‹çš„æ§åˆ¶æƒåœ¨æˆ‘ä»¬æ‰‹é‡Œï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨<code>gen.send(&#39;å“ˆå“ˆ&#39;)</code>ï¼ŒåˆæŠŠçº¿ç¨‹çš„æ§åˆ¶æƒäº¤è¿˜ç»™äº†cå‡½æ•°ï¼Œçº¿ç¨‹æ¥åˆ°cå‡½æ•°åˆšåˆšçš„é€€å‡ºç‚¹ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p><p>æ ¹æ®è¯­æ³•å®šä¹‰ï¼Œ<code>send(&#39;å“ˆå“ˆ&#39;)</code>çš„å‚æ•°å°†ä¼šä½œä¸ºyieldçš„è¿”å›å€¼ã€‚ä¹Ÿå°±æ˜¯<code>r = yield 1</code>ä¸­çš„<code>r</code>ä¼šæ”¶åˆ°å­—ç¬¦ä¸² â€˜å“ˆå“ˆâ€™ã€‚æˆ‘ä»¬ç°åœ¨é€è¿‡äº†bå‡½æ•°ï¼Œç›´æ¥å’Œcå‡½æ•°è¿›è¡Œäº†äº¤äº’ã€‚æˆ‘æƒ³è¿™å°±æ˜¯yield fromæœ€å¤§çš„ä½œç”¨äº†!</p><p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ï¼Œæ­¤æ—¶cå‡½æ•° <code>return 4</code> è¿™åˆä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿä½ å¯ä»¥çŒœæµ‹ä¸€ä¸‹ã€‚</p><p>è¯´ä¸€ä¸‹æˆ‘çš„ç†è§£ï¼Œcå‡½æ•°ç°åœ¨æ‰§è¡Œå®Œæ¯•ï¼Œè‡ªç„¶æ˜¯å›åˆ°è°ƒç”¨å¤„ã€‚ä¹Ÿå³æ˜¯<code>r = yield from c()</code>ï¼Œç°åœ¨é‡æ–°å®¡è§†ä¸€ä¸‹è¿™æ¡è¯­å¥ã€‚bå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦cçš„ç»“æœï¼Œå¦åˆ™æ²¡æœ‰åŠæ³•ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥æŠŠçº¿ç¨‹æ§åˆ¶æƒäº¤ç»™äº†cã€‚bç»è¿‡äº†æ•°å¹´çš„ç­‰å¾…ç»ˆäºç­‰åˆ°äº†cçš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå°±æ˜¯<code>return 4</code>ä¸­çš„4ã€‚æ­¤æ—¶4çš„å€¼ä¼šèµ‹ç»™rã€‚ç„¶åå‡½æ•°ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚è¿™å°±å’Œæˆ‘ä»¬å†æ™®é€šå‡½æ•°a()ä¸­è°ƒç”¨b()ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯åœ¨ç”Ÿæˆå™¨è°ƒç”¨ç”Ÿæˆå™¨éœ€è¦ç”¨åˆ°ç‰¹æ®Šçš„å†™æ³•è€Œå·²ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦yield fromï¼Œ å·²ç»yield fromçš„ä½œç”¨æˆ‘æƒ³åº”è¯¥ç†è§£äº†å§~</p><blockquote><p>è¡¥å……ä¸€å¥ï¼Œ å¾ˆå¤šåŸç†æ€§çš„ä¸œè¥¿æˆ‘å…¶å®ä¸ç¡®å®šï¼Œä»¥ä¸Šåªæ˜¯æˆ‘çš„æ„Ÿæ€§çš„ç†è§£ã€‚æ¯”å¦‚4çš„å€¼æ˜¯å¦‚ä½•èµ‹ç»™ræˆ‘å¹¶ä¸çŸ¥é“ã€‚æˆ‘ä»¬æ˜¯å¦æ˜¯ç›´æ¥è¶Šè¿‡bå‡½æ•°å’Œcå‡½æ•°è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä¹Ÿä¸ç¡®å®šã€‚æˆ‘ç›®å‰æ²¡æœ‰èƒ½åŠ›è¿›è¡Œæ›´æ·±å±‚æ¬¡çš„äº†è§£ã€‚</p></blockquote><p>å†å•°å—¦ä¸€ä¸‹~ã€‚ä¸Šé¢çš„ç¨‹åºæœ€åä¸‰è¡Œå°±åƒä¸€ä¸ªä¸»æ§å™¨ä¸€æ ·ï¼Œè°ƒæ§b()ï¼Œc()å‡½æ•°çš„è¿è¡Œï¼Œå¹¶ä¸”è¿œä¸æ­¢äºæ­¤ã€‚æˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¼šcï¼Œè¿è¡Œä¸€ä¼šbã€‚è¿è¡Œä¸€ä¼šd,e,f,gç­‰ç­‰ã€‚ ä½ ä¹Ÿè®¸ä¼šç–‘é—®è¿™æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</p><p>åœ¨cpuå¯†é›†å‹è¿ç®—çš„ç¨‹åºä¸­ï¼Œè¿™ä¸€ç‚¹æ„ä¹‰éƒ½æ²¡æœ‰ã€‚ ä½†æ˜¯åœ¨i/oå¯†é›†å‹è¿ç®—ä¸­ï¼Œè¿™æ ·åšçš„æ„ä¹‰æ˜¯éå‡¡çš„ã€‚</p><p>å½“æˆ‘ä»¬é‡åˆ°éœ€è¦é•¿æ—¶é—´i/oç­‰å¾…æ—¶ï¼Œå°±æŠŠçº¿ç¨‹çš„æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªå‡½æ•°æˆ–è€…è¯´httpè¯·æ±‚ï¼Œé•¿æ—¶é—´çš„i/oè¿”å›ç»“æœæ—¶ï¼Œ æˆ‘ä»¬æˆ‘ä»¬åœ¨å›åˆ°åŸæœ‰çš„ç¨‹åºã€‚</p><p>è¿™åœ¨cpuçœ¼é‡Œæ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œä½†åœ¨æˆ‘ä»¬çœ¼é‡Œç¡®æ˜¯å•ä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†ç€ä¸Šåƒä¸ªè¯·æ±‚ï¼Œå› ä¸ºcpuçš„å¤„ç†é€Ÿåº¦éå¸¸å¿«ã€‚ i/oæ“ä½œä¸æ­¢äºç½‘ç»œi/oï¼Œè¿˜æœ‰æ–‡ä»¶è¯»å†™i/oï¼Œæ•°æ®åº“è¯»å†™i/oã€‚</p><p>yieldå®ç°çš„åŠŸèƒ½å°±åƒä¸€å—è‚¥è‚‰ä¸€æ ·ï¼Œæ²¡æœ‰é‚£ç§è¯­è¨€æƒ³è¦æ”¾å¼ƒè¿™ç§åŠŸèƒ½ã€‚</p><p>pythonåœ¨yieldçš„åŸºç¡€ä¸Šå®ç°äº†asyncioæ¨¡å—ã€‚ä¸‹ä¸€èŠ‚æˆ‘æµ…è°ˆä¸€ä¸‹asyncioè¿™ä¸ªæ¨¡å—ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;yield&quot;&gt;&lt;a href=&quot;#yield&quot; class=&quot;headerlink&quot; title=&quot;yield&quot;&gt;&lt;/a&gt;yield&lt;/h2&gt;&lt;p&gt;å‡½æ•°å¯ä»¥çœ‹æˆæ˜¯ä¸€å †æŒ‡ä»¤çš„é›†åˆã€‚åœ¨å‡½æ•°ä¸­åŠ å…¥yieldå¯ä»¥æŠŠä¸€ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªgeneratorï¼Œè™½ç„¶è°ƒç”¨çš„æ–¹å¼ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯å…¶å®ç°çš„åŠŸèƒ½å’ŒåŸæ¥çš„å‡½æ•°åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="http://beian.miit.gov.cn/categories/python/"/>
    
    
      <category term="asyncio yield" scheme="http://beian.miit.gov.cn/tags/asyncio-yield/"/>
    
  </entry>
  
  <entry>
    <title>çº¿ç¨‹ä¸åç¨‹</title>
    <link href="http://beian.miit.gov.cn/posts/thread-and-collaboration.html"/>
    <id>http://beian.miit.gov.cn/posts/thread-and-collaboration.html</id>
    <published>2017-10-24T13:36:09.000Z</published>
    <updated>2019-12-09T04:32:11.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="å¤šçº¿ç¨‹æ¨¡å‹"><a href="#å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="å¤šçº¿ç¨‹æ¨¡å‹"></a>å¤šçº¿ç¨‹æ¨¡å‹</h3><p>å¤šçº¿ç¨‹æ¨¡å‹ä¸­<strong>å†…æ ¸</strong>å®ç°çº¿ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦ï¼Œé€šå¸¸ä¸€ä¸ªçº¿ç¨‹æ˜¯æ— æ³•ä»å¤´åˆ°å°¾å ç”¨ç€cpuçš„ï¼Œå°¤å…¶æ˜¯è¿›è¡Œi/oæ“ä½œæ—¶ï¼Œè®¸å¤šçš„ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯é˜»å¡çš„ï¼Œæ­¤æ—¶å†…æ ¸ä¿å­˜è¯¥çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åæŒ‚èµ·è¯¥çº¿ç¨‹ã€‚å½“ç„¶æ›´å¤šæ—¶å€™æ˜¯ç”±äºè¯¥çº¿ç¨‹çš„æœ¬æ¬¡è¿è¡Œæ—¶é—´è€—å°½ï¼Œåªå¾—è¢«æŒ‚èµ·ç­‰å¾…cpuçš„ä¸‹ä¸€æ¬¡ä¸´å¹¸</p><p>ä½†æ˜¯å¤šçº¿ç¨‹å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨çº¿ç¨‹æ•°é‡è¿‡å¤šæ—¶ï¼Œé—®é¢˜è¢«æ”¾å¤§çš„å°¤ä¸ºæ˜æ˜¾</p><ul><li>çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢é€ æˆçš„å¼€é”€ã€‚    </li><li>çº¿ç¨‹ä¹‹é—´å¯¹èµ„æºçš„ç«äº‰é—®é¢˜ã€‚</li></ul><h3 id="ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ä»¥è®¤ä¸ºæ˜¯å†…æ ¸ï¼ˆæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒï¼‰åœ¨ CPU ä¸Šå¯¹äºè¿›ç¨‹ï¼ˆåŒ…æ‹¬çº¿ç¨‹ï¼‰è¿›è¡Œä»¥ä¸‹çš„æ´»åŠ¨ï¼š</p><ol><li>æŒ‚èµ·ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†è¿™ä¸ªè¿›ç¨‹åœ¨ CPU ä¸­çš„çŠ¶æ€ï¼ˆä¸Šä¸‹æ–‡ï¼‰å­˜å‚¨äºå†…å­˜ä¸­çš„æŸå¤„ï¼Œ</li><li>åœ¨å†…å­˜ä¸­æ£€ç´¢ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡å¹¶å°†å…¶åœ¨ CPU çš„å¯„å­˜å™¨ä¸­æ¢å¤</li><li>è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡å‘çš„ä½ç½®ï¼ˆå³è·³è½¬åˆ°è¿›ç¨‹è¢«ä¸­æ–­æ—¶çš„ä»£ç è¡Œï¼‰ï¼Œä»¥æ¢å¤è¯¥è¿›ç¨‹ã€‚</li></ol><p>è¿™é‡Œçš„åˆ‡æ¢æœ‰ä¸€ä¸ªæ—¶é—´ç‰‡çš„æ¦‚å¿µ</p><p>æ—¶é—´ç‰‡å³CPUåˆ†é…ç»™å„ä¸ªç¨‹åºçš„æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ï¼Œå³è¯¥è¿›ç¨‹å…è®¸è¿è¡Œçš„æ—¶é—´ï¼Œä½¿å„ä¸ªç¨‹åºä»è¡¨é¢ä¸Šçœ‹æ˜¯åŒæ—¶è¿›è¡Œçš„ã€‚å¦‚æœåœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œåˆ™CPUå°†è¢«å‰¥å¤ºå¹¶åˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚å¦‚æœè¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™CPUå½“å³è¿›è¡Œåˆ‡æ¢ã€‚è€Œä¸ä¼šé€ æˆCPUèµ„æºæµªè´¹ã€‚åœ¨å®è§‚ä¸Šï¼šæˆ‘ä»¬å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªç¨‹åºå¹¶è¡Œä¸æ‚–ï¼ŒåŒæ—¶è¿è¡Œã€‚ä½†åœ¨å¾®è§‚ä¸Šï¼šç”±äºåªæœ‰ä¸€ä¸ªCPUï¼Œä¸€æ¬¡åªèƒ½å¤„ç†ç¨‹åºè¦æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ä½•å¤„ç†<strong>å…¬å¹³</strong>ï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯å¼•å…¥æ—¶é—´ç‰‡ï¼Œæ¯ä¸ªç¨‹åºè½®æµæ‰§è¡Œã€‚</p><blockquote><p>åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™å°±å·²ç»ç¡®å®šè¯¥å‡½æ•°æ˜¯å¦ä¼šé€ æˆé˜»å¡</p></blockquote><p>åœ¨I/Oå¯†é›†å‹è¿ç®—ä¸­ï¼Œå°¤å…¶æ˜¯é«˜å¹¶å‘æ—¶ã€‚ä¸ºäº†ä¿è¯å…¬å¹³ï¼Œæ—¶é—´ç‰‡çš„åˆ†é…ä¼šè¶Šæ¥è¶Šå°ï¼Œåˆ‡æ¢è¶Šå‘é¢‘ç¹ã€‚èµ„æºä¹Ÿå°±è¢«æµªè´¹åœ¨äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸­</p><p>è€Œcpuå¯†é›†å‹è¿ç®—ä¸­ï¼Œä¸éœ€è¦é¢‘ç¹çš„åˆ‡æ¢çº¿ç¨‹ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©</p><h3 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h3><p>ä¸ºäº†è§£å†³I/Oå¯†é›†å‹è¿ç®—å†…æ ¸åœ¨èµ„æºè°ƒåº¦ä¸Šçš„ç¼ºé™·ï¼Œæ‰€ä»¥å¼•å…¥äº†åç¨‹ï¼ˆcoroutineï¼‰çš„æ¦‚å¿µã€‚åç¨‹ä¹Ÿè¢«ç§°ä¸ºç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œå†…æ ¸æ€çš„çº¿ç¨‹è°ƒåº¦ç”±å†…æ ¸æ¥å®Œæˆã€‚è€Œç”¨æˆ·æ€çš„çº¿ç¨‹çš„è°ƒåº¦åˆ™äº¤ç»™ç”¨æˆ·æ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®ç°è‡ªå·±çš„è°ƒåº¦ç®—æ³•ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬æœ‰æˆåƒä¸Šä¸‡çš„çº¿ç¨‹ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒçº¿ç¨‹åˆ‡æ¢æµªè´¹çš„èµ„æºé—®é¢˜äº†ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°è¦å®ç°çº¿ç¨‹çš„è°ƒåº¦çš„å…³é”®å°±æ˜¯ä¸Šä¸‹æ–‡çŠ¶æ€çš„ä¿å­˜ã€‚phpä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>Generator</code>å¯¹è±¡æ¥å®ç°ç¨‹åºçš„ä¸­æ–­ä¸æ¢å¤ã€‚<code>Generator</code> å¯¹è±¡åœ¨ç¨‹åºä¸­æ–­æ—¶ä¼šä¸ºæˆ‘ä»¬ä¿å­˜ä¸­æ–­å‰çš„ç°åœºã€‚åªè¦æœ‰è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥è‡ªå·±å®ç°åç¨‹äº†ã€‚è¿™é‡ŒGeneratorå¦‚ä½•ä¿å­˜ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæ˜¯å¦åƒçº¿ç¨‹åˆ‡æ¢ä¸€æ ·æµªè´¹èµ„æºè¿˜éœ€è¦è¿‘ä¸€æ­¥äº†è§£ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨åç¨‹å®ç°ä¸€ä¸ªæ”¯æŒé«˜å¹¶å‘çš„webæœåŠ¡å™¨ï¼Œå¦‚å›¾</p><p><img src="http://asset.eienao.com/17-10-24/25490956.jpg" alt></p><p>æˆ‘ä»¬å°†åœ¨å•ä¸ªè¿›ç¨‹ä¸­åŒæ—¶å¤„ç†è¿™äº›å¹¶å‘çš„è¯·æ±‚ï¼Œä»httpè¯·æ±‚å¼€å§‹æ¥æ‰‹ï¼Œä¸€ç‚¹ä¸€ç‚¹æ¨è¿›ï¼Œç›´åˆ°responseã€‚å›¾ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹å…¶å®å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åç¨‹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å®ç°ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œæ¥åˆ†é…ä¸Šé¢æ¯ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œæ—¶é—´ã€‚</p><p>å…·ä½“çš„å®ç°å°±å‚è§ é¸Ÿå“¥ç¿»è¯‘çš„è¿™ç¯‡æ–‡ç«  <a href="http://www.laruence.com/2015/05/28/3038.html" target="_blank" rel="noopener">åœ¨PHPä¸­ä½¿ç”¨åç¨‹å®ç°å¤šä»»åŠ¡è°ƒåº¦</a></p><p>è¯»å®Œæ–‡ç« æˆ‘ä¾æ—§æœ‰ä¸¤ä¸ªé—®é¢˜</p><ul><li>ç³»ç»Ÿè°ƒç”¨ä¸€å®šè¦ä½¿ç”¨éé˜»å¡ç‰ˆæœ¬ï¼Œå¦åˆ™ä¼šæŠŠæ§åˆ¶æƒäº¤è¿˜ç»™å†…æ ¸ï¼Œç„¶åé˜»å¡æ•´ä¸ªè¿›ç¨‹ï¼Œæœ‰è§£å†³åŠæ³•å—ï¼Ÿ</li><li>å¯¹mysqlçš„æ“ä½œæ˜¯å¦å±äºI/Oæ“ä½œï¼Œæ˜¯å¦ä¼šé€ æˆé˜»å¡ï¼Ÿ</li></ul><p>å•°å—¦ä¸€ä¸‹nginxé‡‡ç”¨çš„æ˜¯å¼‚æ­¥I/Oæ¨¡å‹æ¥å®ç°I/Oï¼Œå¦å¤–ä¸€ä¸ªè¯´æ³•æ˜¯ï¼Œåç¨‹è§£å†³äº†å¼‚æ­¥I/Oå™©æ¢¦èˆ¬çš„å›è°ƒã€‚å¦å¤–è¯»å®Œé¸Ÿå“¥çš„é‚£ç¯‡æ–‡ç« ç„¶åè·Ÿç€æ•²äº†ä¸€ä¸‹ä»£ç å‘ç°å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;å¤šçº¿ç¨‹æ¨¡å‹&quot;&gt;&lt;a href=&quot;#å¤šçº¿ç¨‹æ¨¡å‹&quot; class=&quot;headerlink&quot; title=&quot;å¤šçº¿ç¨‹æ¨¡å‹&quot;&gt;&lt;/a&gt;å¤šçº¿ç¨‹æ¨¡å‹&lt;/h3&gt;&lt;p&gt;å¤šçº¿ç¨‹æ¨¡å‹ä¸­&lt;strong&gt;å†…æ ¸&lt;/strong&gt;å®ç°çº¿ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦ï¼Œé€šå¸¸
      
    
    </summary>
    
    
  </entry>
  
</feed>
