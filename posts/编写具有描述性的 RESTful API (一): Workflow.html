<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 编写具有描述性的 RESTful API (一): Workflow · weiwenhao</title><meta name="description" content="编写具有描述性的 RESTful API (一): Workflow - 粤ICP备18153286"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://beian.miit.gov.cn/atom.xml" title="weiwenhao"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/weiwenhao" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">编写具有描述性的 RESTful API (一): Workflow</h1><div class="post-info">2019年3月12日</div><div class="post-content"><p>这是个系列,将会以结构较为简单明了的 <a href="https://www.jianshu.com/" target="_blank" rel="noopener">简书</a> 为参考,编写一套简洁,<strong>可读</strong>的社区类型的 <strong>RESTful</strong> API.</p>
<blockquote>
<p>我使用的laravel版本是5.7, 且使用 <a href="https://github.com/weiwenhao/tree-ql" target="_blank" rel="noopener">tree-ql</a> 作为api开发基础工具.</p>
<p>该系列并不会一步一步来教你怎么实现,只会阐明一些基本点,以及一些关键的地方</p>
<p>相关的代码我会放在 <a href="https://github.com/weiwenhao/community-api" target="_blank" rel="noopener">weiwenhao/community-api</a> 你可以随时参阅一些细节部分</p>
</blockquote>
<h2 id="开始咯"><a href="#开始咯" class="headerlink" title="开始咯"></a>开始咯</h2><h4 id="建表"><a href="#建表" class="headerlink" title="建表"></a><a href="https://learnku.com/docs/laravel/5.7/migrations/2291" target="_blank" rel="noopener">建表</a></h4><p>先来看看<strong><a href="https://www.jianshu.com/p/aff99d1d194b" target="_blank" rel="noopener">设计稿</a></strong>,根据设计稿可以设计出基础的帖子表结构. 当然这不会是最终的表结构,后面会根据实际情况来一点点完善该表.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'code'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;string(<span class="string">'title'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'description'</span>);</span><br><span class="line">    $table-&gt;text(<span class="string">'content'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;string(<span class="string">'cover'</span>)-&gt;nullable();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'comment_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'评论数量'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'like_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'点赞数量'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'read_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'阅读数量'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'word_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'字数'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'give_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">'赞赏数量'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'user_id'</span>)-&gt;index();</span><br><span class="line"></span><br><span class="line">    $table-&gt;timestamp(<span class="string">'published_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'发布时间'</span>);</span><br><span class="line">    $table-&gt;timestamp(<span class="string">'selected_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'是否精选/精选时间'</span>);</span><br><span class="line">	$table-&gt;timestamp(<span class="string">'edited_at'</span>)-&gt;nullable()-&gt;comment(<span class="string">'内容编辑时间'</span>);</span><br><span class="line">    </span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后看看评论表.简书的评论并不是无限级的,而是分为两层,结构简单.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'comments'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;text(<span class="string">'content'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'user_id'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'post_id'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'like_count'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'reply_count'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'floor'</span>)-&gt;comment(<span class="string">'楼层'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'selected'</span>)-&gt;comment(<span class="string">'是否精选'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Schema::create(<span class="string">'comment_replies'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'comment_id'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'user_id'</span>)-&gt;index();</span><br><span class="line">    $table-&gt;text(<span class="string">'content'</span>);</span><br><span class="line">    $table-&gt;json(<span class="string">'call_user'</span>)-&gt;nullable()-&gt;comment(<span class="string">'@用户,&#123;id: null, nickname: null&#125;'</span>);</span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后是用户表</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'users'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint $table)</span> </span>&#123;</span><br><span class="line">    $table-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'nickname'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'avatar'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'email'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'phone_number'</span>);</span><br><span class="line">    $table-&gt;string(<span class="string">'password'</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'follow_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">"关注了多少个用户"</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'fans_count'</span>)-&gt;default(<span class="number">0</span>)-&gt;comment(<span class="string">"拥有多少个粉丝"</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'post_count'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'word_count'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line">    $table-&gt;unsignedInteger(<span class="string">'like_count'</span>)-&gt;default(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;json(<span class="string">'oauth'</span>)-&gt;nullable()-&gt;comment(<span class="string">"第三方登录"</span>);</span><br><span class="line"></span><br><span class="line">    $table-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为什么从数据库上开始设计? </p>
<p>从软件开发的角度来说,<strong>数据是固有存在的,不会随着交互与设计的变化而变化</strong>. 所以对于后端来说有了产品文档,就可以设计出接近完整的数据结构和80%左右的API了.</p>
</blockquote>
<h4 id="建模"><a href="#建模" class="headerlink" title="建模"></a>建模</h4><p>建立相关的<a href="https://learnku.com/docs/laravel/5.7/eloquent/2294" target="_blank" rel="noopener">Model</a> 及 <a href="https://learnku.com/docs/laravel/5.7/eloquent-relationships/2295" target="_blank" rel="noopener">关联关系</a></p>
<blockquote>
<p>这里需要多做一步,建立一个<strong><a href="https://learnku.com/docs/laravel-specification/5.5/data-model/503" target="_blank" rel="noopener">Model基类</a></strong>,其他的如 Post,Comment 继承自该 Model . 当然 我们不是要让 Model 成为一个 Super 类,只是通过该 Model 获得对其他 Model 的统一配置权. </p>
</blockquote>
<p>已 Comment 为例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(User::class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">replies</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(CommentReply::class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(Post::class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他的 Model 参考源码即可</p>
<h4 id="填充-Seeder"><a href="#填充-Seeder" class="headerlink" title="填充 Seeder"></a>填充 Seeder</h4><p>为了让前端更加顺畅的调试 api,seeder 是必不可少的一步. 接下来我们需要为上面建的几张表添加相应的 <a href="https://learnku.com/docs/laravel/5.7/database-testing/2304" target="_blank" rel="noopener">factory</a> 和 <a href="https://learnku.com/docs/laravel/5.7/seeding/2292" target="_blank" rel="noopener">seeder</a></p>
<p>以 CommentFactory 为例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CommentFactory.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Faker</span>\<span class="title">Generator</span> <span class="title">as</span> <span class="title">Faker</span>;</span><br><span class="line"></span><br><span class="line">$factory-&gt;define(\App\Models\Comment::class, <span class="function"><span class="keyword">function</span> <span class="params">(Faker $faker)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> $i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'post_id'</span> =&gt; mt_rand(<span class="number">1</span>, \App\Models\Post::count()),</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; mt_rand(<span class="number">1</span>, \App\Models\User::count()),</span><br><span class="line">        <span class="string">'content'</span> =&gt; $faker-&gt;sentence,</span><br><span class="line">        <span class="string">'like_count'</span> =&gt; mt_rand(<span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">        <span class="string">'reply_count'</span> =&gt; mt_rand(<span class="number">0</span>, <span class="number">10</span>),</span><br><span class="line">        <span class="string">'floor'</span> =&gt; $i++,</span><br><span class="line">        <span class="string">'selected'</span> =&gt; mt_rand(<span class="number">1</span>, <span class="number">10</span>) &gt; <span class="number">2</span> ? <span class="number">0</span> : <span class="number">1</span></span><br><span class="line">    ];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>相应的 CommentSeeder</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CommentSeeder.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Seeder</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentSeeder</span> <span class="keyword">extends</span> <span class="title">Seeder</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Run the database seeds.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        factory(\App\Models\Comment::class, <span class="number">1000</span>)-&gt;create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他的 factory 和 seeder 参考源码呀</p>
<blockquote>
<p>Seeder 的规范命名应该是  CommentsTableSeeder.php ,请不要学我!</p>
</blockquote>
<h2 id="发射"><a href="#发射" class="headerlink" title="发射"></a>发射</h2><h4 id="确定-API"><a href="#确定-API" class="headerlink" title="确定 API"></a>确定 API</h4><p>还是先来看看 <a href="https://www.jianshu.com/p/aff99d1d194b" target="_blank" rel="noopener">设计稿</a> , 来建立第一批 API</p>
<p>初步来看文章详情页分为三部分. 文章内容部分,评论回复部分,和推荐阅读部分.由于我们目前只建了几张基本表,所以先忽略推荐阅读部分.</p>
<p>API 设计的一个原则是同一个页面不要请求太多次 API ,否则会给服务器带来很大的压力.但也不能是一条非常聚合的api包含一个页面所有的数据. 这样则失去了 API 的灵活与独立性. 也不符合 RESTFul API 的设计思路</p>
<blockquote>
<p><strong>RESTFul API 是面向资源/数据的,是对资源的增删改查. 而不是面向界面/具体的业务逻辑</strong></p>
<p>所以上面说从设计稿切入实际是有些误导的,原则上是不需要设计稿的.这里的目的是为了推动文章向下进行,且能够更快的看到成果</p>
</blockquote>
<p>按照 <a href="https://github.com/weiwenhao/tree-ql" target="_blank" rel="noopener">tree-ql</a> 的风格,我设计了这样两条 API</p>
<p><a href="http://community.eienao.com/api/posts/1?include=content,user.description,selected_comments" target="_blank" rel="noopener">test.com/api/posts/{post}?include=content,user.description,selected_comments </a></p>
<p><a href="http://community.eienao.com/api/posts/1/comments?include=user,replies(limit:3" target="_blank" rel="noopener">test.com/api/posts/{post}/comments?include=user,replies(limit:3).user</a>.user)</p>
<blockquote>
<p>上面的api是真实可以点击测试的,你可以随意修改include中的字段,来观察API的变化</p>
<p>执行请求的详细信息可以通过 <a href="http://community.eienao.com/telescope" target="_blank" rel="noopener">telescope</a> 查看</p>
</blockquote>
<p>我们来解读一下上面两条 API</p>
<ol>
<li>取出帖子 <code>{post}</code>,并且包含该帖子的详情,用户(用户需要包含描述)和这篇帖子的所有精选评论</li>
<li>取出帖子 <code>{post}</code>下的评论,并且每条评论需要包含相关用户和<strong>回复/限制三条</strong>(回复需要包含相关用户)</li>
</ol>
<p>毫不知羞耻的说,上面的API是极其富于可读性的,并且有了 include 的存在,可控性也达到了非常高的地步</p>
<h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># api.php</span></span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'posts/&#123;post&#125;'</span>, <span class="string">'PostController@show'</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">'posts/&#123;post&#125;/comments'</span>, <span class="string">'CommentController@index'</span>);</span><br></pre></td></tr></table></figure>
<p>还要为<code>{post}</code>进行 <a href="https://learnku.com/docs/laravel/5.7/routing/2253#2f0069" target="_blank" rel="noopener">路由模型绑定</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RouteServiceProvider.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">parent</span>::boot();</span><br><span class="line">    </span><br><span class="line">    Route::bind(<span class="string">'post'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// columns的作用稍后会解释</span></span><br><span class="line">        <span class="keyword">return</span> Post::columns()-&gt;where(<span class="string">'id'</span>, $value)-&gt;first();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p>由于没有做版本控制,所以没有添加类似<code>Api/V1</code>这样的目录. 以第二条 API 对应的控制器为例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/Http/Controllers/Api/CommentController</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Api</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Comment</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Resources</span>\<span class="title">CommentResource</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Response</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null $parent</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Weiwenhao\TreeQL\Resource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($parent = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 1.</span></span><br><span class="line">        $query = $parent ? $parent-&gt;comments() : Comment::query();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.</span></span><br><span class="line">        $comments = $query-&gt;columns()-&gt;latest()-&gt;paginate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.</span></span><br><span class="line">        <span class="keyword">return</span> CommentResource::make($comments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此我们构成了 <a href="http://community.eienao.com/api/posts/1/comments" target="_blank" rel="noopener">test.com/api/posts/{post}/comments</a> 这条路由的访问控制器,但此时还不能include任何东西.在说明如何定义include之前,我们先对控制器中的三处标注进行讲解.</p>
<ol>
<li>进行了路由模型绑定的兼容处理,使得一个控制器可以兼容多条路由. 具体可以参考 <a href="https://learnku.com/articles/17476" target="_blank" rel="noopener">优雅的使用路由模型绑定</a></li>
<li>这是常见的 Builder 查询构造器,不严格讨论的话 <code>get() ∈ paginate()</code>, 因此使用适用范围更广的 paginate 作为结果输出.  columns 是一个查询作用域,由 tree-ql 提供,其赋予了精确查询数据库字段的能力.</li>
<li>将查询的结果集交付给 Resource, 此 Resource 并非 laravel 原生的 <a href="https://learnku.com/docs/laravel/5.7/eloquent-resources/2298" target="_blank" rel="noopener">Resource</a>,而是 <strong>tree-ql 提供的 Resource</strong> ,其会赋予我们 include 的能力,下面介绍一下该 Resource.</li>
</ol>
<blockquote>
<p>在阅读下面的内容之前你需要阅读一下 tree-ql 的文档</p>
</blockquote>
<h4 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h4><p>已 CommentResource 为例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CommentResource.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Resources</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Weiwenhao</span>\<span class="title">TreeQL</span>\<span class="title">Resource</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentResource</span> <span class="keyword">extends</span> <span class="title">Resource</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $default = [</span><br><span class="line">        <span class="string">'id'</span>, </span><br><span class="line">        <span class="string">'content'</span>, </span><br><span class="line">        <span class="string">'user_id'</span>, </span><br><span class="line">        <span class="string">'like_count'</span>,</span><br><span class="line">        <span class="string">'reply_count'</span>,</span><br><span class="line">        <span class="string">'floor'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $columns = [</span><br><span class="line">        <span class="string">'id'</span>, </span><br><span class="line">        <span class="string">'content'</span>, </span><br><span class="line">        <span class="string">'user_id'</span>, </span><br><span class="line">        <span class="string">'post_id'</span>, </span><br><span class="line">        <span class="string">'like_count'</span>,</span><br><span class="line">        <span class="string">'reply_count'</span>, </span><br><span class="line">        <span class="string">'floor'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $relations = [</span><br><span class="line">        <span class="string">'user'</span>,</span><br><span class="line">        <span class="string">'replies'</span> =&gt; [</span><br><span class="line">            <span class="string">'resource'</span> =&gt; CommentReplyResource::class,</span><br><span class="line">        ]</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 columns 代表着 comments 表的字段, relations 定义的内容为 代表 comment 模型中已经定义的关联关系.</p>
<p>API 请求中有些数据每次都需要加载,因此 <strong>default 中定义的字段会被默认 include</strong> ,而不需要在 url 中显式的定义.</p>
<p>由于 CommentResource 的 relations 部分还依赖了 user 和 replies ,按照 tree-ql 的规则我们需要分别定义 UserResource 和 RepliesResource.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># UserResource.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Resources</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Weiwenhao</span>\<span class="title">TreeQL</span>\<span class="title">Resource</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserResource</span> <span class="keyword">extends</span> <span class="title">Resource</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $default = [<span class="string">'id'</span>, <span class="string">'nickname'</span>, <span class="string">'avatar'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $columns = [<span class="string">'id'</span>, <span class="string">'nickname'</span>, <span class="string">'avatar'</span>, <span class="string">'password'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CommentReplyResource.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Resources</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Weiwenhao</span>\<span class="title">TreeQL</span>\<span class="title">Resource</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentReplyResource</span> <span class="keyword">extends</span> <span class="title">Resource</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $default = [<span class="string">'id'</span>, <span class="string">'comment_id'</span>, <span class="string">'user_id'</span>, <span class="string">'content'</span>, <span class="string">'call_user'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $columns = [<span class="string">'id'</span>, <span class="string">'comment_id'</span>, <span class="string">'user_id'</span>, <span class="string">'content'</span>, <span class="string">'call_user'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $relations = [<span class="string">'user'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ...&#123;post&#125;/comments?include=...replies(limit:3)...</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ↓ ↓ ↓</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * $comments-&gt;load(['replies' =&gt; function ($builder) &#123;</span></span><br><span class="line"><span class="comment">     *      $this-&gt;loadConstraint($builder, ['limit' =&gt; 3])</span></span><br><span class="line"><span class="comment">     * &#125;);</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ↓ ↓ ↓</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadConstraint</span><span class="params">($builder, array $params)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">isset</span>($params[<span class="string">'limit'</span>]) &amp;&amp; $builder-&gt;limit($params[<span class="string">'limit'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>wo~, 我们已经完成了代码编写,客户端可以请求API了 …… 吗?</p>
<p>再来品味一下第二条api, <strong>取出帖子 <code>{post}</code>下的评论,且每条评论携带3条回复,  ORM(MySQL) 可以做到这样的事情吗?</strong> </p>
<p><a href="https://learnku.com/articles/24787" target="_blank" rel="noopener">点我看答案</a></p>
<p>这里我选择了 PLAN C ,至此我们才算完成第二条api的编写,愉快的 <a href="http://community.eienao.com/api/posts/1/comments?include=user,replies(limit:3" target="_blank" rel="noopener">request</a>.user) 吧</p>
<h4 id="但是"><a href="#但是" class="headerlink" title="但是"></a>但是</h4><p>上面的API这么花里胡哨,会不会有性能问题?</p>
<p>来看看这条 API 的实际 SQL 表现,可以看到 SQL 符合预期,并没有任何的 n+1 问题,在速度方面可以说是有保障的. 实际上只要按照 tree-ql 的规范,无论多么花里胡哨的 include ,都不会有性能问题.</p>
<p><img src="https://cdn.learnku.com/uploads/images/201903/12/10960/H9uZKWjav8.png!large" alt></p>
<blockquote>
<p>调试工具 <a href="https://github.com/laravel/telescope" target="_blank" rel="noopener">laravel/telescope</a></p>
</blockquote>
<h4 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h4><p>走完了一套流程,稍微总结一下↓</p>
<p><img src="https://cdn.learnku.com/uploads/images/201903/12/10960/QGYs8Eoz6m.png!large" alt></p>
<blockquote>
<p>Workflow 中去掉了确定 API 这一步,因为我们只要按照 RESTful 编写路由,按照 tree-ql 编写 Resource , API 自然而然的就出来啦~</p>
</blockquote>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h4 id="文章详情API"><a href="#文章详情API" class="headerlink" title="文章详情API"></a>文章详情API</h4><p><a href="http://community.eienao.com/api/posts/1?include=content,user.description,selected_comments" target="_blank" rel="noopener">api.test.com/api/posts/{post}?include=content,user.description,selected_comments </a></p>
<p>这里的 selected_comment 意为精选的评论,简书此处使用了单独的 api 来请求精选的评论.但是考虑到一篇帖子的精选评论通常不会太多.因此我采用 include 的方式 将精选评论与帖子一种返回.</p>
<p><strong>帖子和精选评论之间的的关系就是 data 和 meta 的关系</strong>. 来看看相关的配置代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CommentResource.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Resources</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Weiwenhao</span>\<span class="title">TreeQL</span>\<span class="title">Resource</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostResource</span> <span class="keyword">extends</span> <span class="title">Resource</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $default = [</span><br><span class="line">        <span class="string">'id'</span>,</span><br><span class="line">        <span class="string">'title'</span>,</span><br><span class="line">        <span class="string">'description'</span>,</span><br><span class="line">        <span class="string">'cover'</span>,</span><br><span class="line">        <span class="string">'comment_count'</span>,</span><br><span class="line">        <span class="string">'like_count'</span>,</span><br><span class="line">        <span class="string">'user_id'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $columns = [</span><br><span class="line">        <span class="string">'id'</span>,</span><br><span class="line">        <span class="string">'title'</span>,</span><br><span class="line">        <span class="string">'description'</span>,</span><br><span class="line">        <span class="string">'cover'</span>,</span><br><span class="line">        <span class="string">'read_count'</span>,</span><br><span class="line">        <span class="string">'word_count'</span>,</span><br><span class="line">        <span class="string">'give_count'</span>,</span><br><span class="line">        <span class="string">'comment_count'</span>,</span><br><span class="line">        <span class="string">'like_count'</span>,</span><br><span class="line">        <span class="string">'user_id'</span>,</span><br><span class="line">        <span class="string">'content'</span>,</span><br><span class="line">        <span class="string">'selected_at'</span>,</span><br><span class="line">        <span class="string">'published_at'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $meta = [</span><br><span class="line">        <span class="string">'selected_comments'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">selectedComments</span><span class="params">($params)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $post = <span class="keyword">$this</span>-&gt;getModel();</span><br><span class="line"></span><br><span class="line">        $comments = $post-&gt;selectedComments;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里的操作类似于 $comments-&gt;load(['user', 'replies.user'])</span></span><br><span class="line">        <span class="comment">// 但是load可不会帮你管理Column. 因此我们使用Resource来构造</span></span><br><span class="line">        $commentResource = CommentResource::make($comments, <span class="string">'user,replies.user'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// getResponseData既获取CommentResource解析后并构造后的结构数组</span></span><br><span class="line">        <span class="keyword">return</span> $commentResource-&gt;getResponseData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h4><p><a href="https://www.jianshu.com/p/aff99d1d194b" target="_blank" rel="noopener">设计稿</a> 的最后一部分,分为两个小点. 分别是专题收录和推荐阅读.专题和帖子之间是多对多的关系.</p>
<p>推荐的做法比较丰富,简单且推荐的做法就是通过标签来推荐.但是这里我们有了专题这个概念后,其就充当了标签的概念.</p>
<p>下一篇会介绍专题与推荐阅读的一些需要注意的细节.</p>
</div></article></div></main><footer><div class="paginator"><a href="/posts/编写具有描述性的 RESTful API (二): 推荐与 Observer.html" class="prev">PREV</a><a href="/posts/orm陷阱.html" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'maxwei';
var disqus_identifier = 'posts/编写具有描述性的 RESTful API (一): Workflow.html';
var disqus_title = '编写具有描述性的 RESTful API (一): Workflow';
var disqus_url = 'http://beian.miit.gov.cn/posts/编写具有描述性的 RESTful API (一): Workflow.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//maxwei.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2020 <a href="http://beian.miit.gov.cn">粤ICP备18153286</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-113144905-1",'auto');ga('send','pageview');</script></body></html>