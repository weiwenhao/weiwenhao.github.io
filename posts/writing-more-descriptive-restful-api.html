<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ç¼–å†™æ›´å…·æœ‰æè¿°æ€§çš„ RESTful API Â· weiwenhao</title><meta name="description" content="ç¼–å†™æ›´å…·æœ‰æè¿°æ€§çš„ RESTful API - ç²¤ICPå¤‡18153286"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://beian.miit.gov.cn/atom.xml" title="weiwenhao"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/weiwenhao" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ç¼–å†™æ›´å…·æœ‰æè¿°æ€§çš„ RESTful API</h1><div class="post-info">2018å¹´4æœˆ1æ—¥</div><div class="post-content"><p>æˆ‘æ—¶å¸¸è§‰å¾—åç«¯åº”è¯¥å…³å¿ƒçš„æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡ã€‚<br>å› æ­¤æˆ‘å¸Œæœ›èƒ½å¤Ÿåœ¨æ•°æ®çš„åŸºç¡€ä¸Šç¼–å†™ä¸€å¥—æ¥å£ èƒ½å¤Ÿæ»¡è¶³h5ç«¯ã€pcç«¯ã€ios/androidç«¯ã€åŒ…æ‹¬å°ç¨‹åºç«¯ç­‰ç­‰80%çš„éœ€æ±‚</p>
<a id="more"></a>
<p>laravel + dingo/api å¯¹äºapiå¼€å‘æ¥è¯´å·²ç»è¶³å¤Ÿå‹å¥½äº†ï¼Œå› æ­¤é€‰æ‹©åœ¨å®ƒçš„åŸºç¡€ä¸Šæ„å»ºã€‚</p>
<p>é¢„å¤‡çš„çŸ¥è¯†</p>
<ul>
<li>laravel</li>
<li>RESTful</li>
<li>dingo/api</li>
</ul>
<h2 id="æŸ¥è¯¢Filter"><a href="#æŸ¥è¯¢Filter" class="headerlink" title="æŸ¥è¯¢Filter"></a>æŸ¥è¯¢Filter</h2><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p>æ’åºå­—æ®µçš„é€‰æ‹©åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šç§</p>
<ol>
<li><code>?sort_field=created_at&amp;sort_order=asc</code> </li>
<li><code>?order=+created</code></li>
<li><p><code>?sort_by=created_at&amp;order=asc</code><br>â€¦</p>
<p>è¿™é‡Œé€‰æ‹©åœ¨ç¬¬ä¸‰ç§æ–¹å¼,åœ¨å¯è¯»æ€§å’Œæ•°æ®å¤„ç†ä¸Šæ›´åŠ æ–¹ä¾¿</p>
</li>
</ol>
<p><strong>urlï¼š</strong> <code>http://api.test/api/posts?sort_by=created_at&amp;order=desc</code></p>
<p><strong>laravelï¼š</strong> <code>$query-&gt;orderBy(request()-&gt;get(&#39;sort_by&#39;, &#39;id&#39;), request()-&gt;get(&#39;order&#39;, &#39;desc&#39;))</code></p>
<h3 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h3><p>å¯¹äºåˆ†é¡µæ¥è¯´ <code>offset/limit</code>å’Œ<code>page/per_page</code> åˆæ˜¯ä¸¤ä¸ªçº ç»“çš„é€‰æ‹©<br>å¸¸è§çš„åˆ†é¡µéœ€æ±‚æœ‰ä¸¤ç§ï¼Œä¸€ç§æ—¶æ™®é€šçš„ajaxåˆ†é¡µï¼Œå¦å¤–ä¸€ç§æ˜¯ä¸‹æ‹‰åŠ è½½æ›´å¤šåˆ†é¡µ<br>ajaxåˆ†é¡µç›¸æ¯”äºåŠ è½½æ›´å¤š é€šå¸¸éœ€è¦ä¸€ä¸ªtotal</p>
<p>å› æ­¤é€‰æ‹©èƒ½åŒæ—¶é€‚åº”ä¸¤ç§åˆ†é¡µéœ€æ±‚çš„ <code>page/per_page</code>ï¼Œlaravelå’Œdingo/apiå¯¹è¯¥æ–¹å¼çš„æ”¯æŒä¹Ÿè¶³å¤Ÿå¥½</p>
<p><strong>urlï¼š</strong> <code>http://maxwei.me/api/posts?per_page=3&amp;page=2</code></p>
<p><strong>laravelï¼š</strong> <code>$query-&gt;paginate(request()-&gt;get(&#39;per_page&#39;, 15))-&gt;appends(request()-&gt;except(&#39;page&#39;))</code></p>
<p><strong>è¿”å›ç»“æœä¸­çš„linksç¤ºä¾‹ï¼š</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;links&quot;: &#123;</span><br><span class="line">        &quot;next&quot;: &quot;http://api.test/api/posts?order=asc&amp;page=3&quot;,</span><br><span class="line">        &quot;previous&quot;: &quot;http://mp.test/api/diaries?order=asc&amp;page=1&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="å­—æ®µç­›é€‰"><a href="#å­—æ®µç­›é€‰" class="headerlink" title="å­—æ®µç­›é€‰"></a>å­—æ®µç­›é€‰</h3><p><strong>apiï¼š</strong> <code>api.test/users?fields=id,nickname,avatar</code> å¯¹äºuserè¡¨ä¸­çš„phoneï¼Œpasswordå­—æ®µæ¨èä½¿ç”¨Modelçš„hiddenå±æ€§éšè—ã€‚<br><strong>laravelï¼š</strong> <code>!is_null(request()-&gt;get(&#39;fields&#39;)) &amp;&amp; $query-&gt;addSelect(explode(&#39;,&#39;, request()-&gt;get(&#39;fields&#39;)));</code></p>
<p>transform()çš„å¸¸ç”¨å†™æ³•å’Œfieldsæœ‰ä¸€å®šçš„å†²çªï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="whereç­›é€‰"><a href="#whereç­›é€‰" class="headerlink" title="whereç­›é€‰"></a>whereç­›é€‰</h3><p>å½“æˆ‘ä»¬åªæƒ³è¦çŠ¶æ€ä¸º1çš„æ–‡ç« æ—¶ æˆ‘å¸Œæœ›å¯ä»¥è¿™ä¹ˆåš<br><strong>urlï¼š</strong> <code>http://api.test/api/posts?status=1</code></p>
<p>å½“æˆ‘æƒ³è¦æ ‡ç­¾idä¸º1, 2çš„æ–‡ç« æ—¶åˆ™è¿™æ ·<br><strong>urlï¼š</strong> <code>http://api.test/api/posts?tag_id=1,2</code></p>
<p>å½“æˆ‘â€¦ å¤Ÿäº†ï¼Œç®€å•ç‚¹æ˜¯æˆ‘æ‰€è¿½æ±‚çš„ï¼Œæˆ‘ä¸å¸Œæœ›å»åˆ›å»ºä¸€äº›è§„åˆ™æ»¡è¶³æ¨¡ç³ŠæŸ¥è¯¢ã€notInã€orWhereã€åµŒå¥—whereç­‰ç­‰ã€‚è¿™ä¸å…·æœ‰é€šç”¨æ€§ï¼Œå¦‚æœéœ€è¦å¯ä»¥åˆ›å»ºä¸€äº›ç‰¹å®šçš„è·¯ç”±å»æ»¡è¶³è¿™äº›æ¡ä»¶å³å¯ã€‚</p>
<p><strong>laravel:</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$where = [<span class="string">'status'</span>, <span class="string">'tag_id'</span>] <span class="comment">//è¿™æ˜¯æˆ‘å¸Œæœ›èƒ½å¤Ÿè¢«ç­›é€‰çš„å­—æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($where <span class="keyword">as</span> $item) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_null($value = request()-&gt;get($item))) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (str_contains($value, <span class="string">','</span>)) &#123;</span><br><span class="line">        $query-&gt;whereIn($item, explode(<span class="string">','</span>, $value));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $query-&gt;where($item, <span class="string">'='</span>, $value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="èµ„æºåµŒå¥—"><a href="#èµ„æºåµŒå¥—" class="headerlink" title="èµ„æºåµŒå¥—"></a>èµ„æºåµŒå¥—</h2><p>æœ‰å¦‚ä¸‹ä¸¤ç§éœ€æ±‚åœºæ™¯</p>
<ul>
<li>è·å–æŸä¸ªç”¨æˆ·/æˆ–æ ‡ç­¾ä¸‹çš„æ‰€æœ‰æ–‡ç« </li>
<li>è·å–é¦–é¡µçš„ç²¾é€‰æ–‡ç« </li>
</ul>
<p>æˆ‘å¸Œæœ›è¿™ä¸¤ç§æƒ…å†µéƒ½èƒ½é€šè¿‡ä¸€ä¸ªindex()æ–¹æ³•å¾—åˆ°è§£å†³ï¼Œå› æ­¤æˆ‘è¿™æ ·åš</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#api.php</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// ä¸»èµ„æºè·¯ç”± </span></span><br><span class="line"> $api-&gt;resource(<span class="string">'posts'</span>, <span class="string">'PostController'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// å¤šå¯¹å¤šå…³ç³»åµŒå¥—è·¯ç”±</span></span><br><span class="line"> $api-&gt;get(<span class="string">'tags/&#123;tag&#125;/posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">     $tags = \App\Models\Tag::findOrFail($id);</span><br><span class="line">     <span class="keyword">return</span> app()-&gt;call(<span class="string">'App\Http\Controllers\Api\PostController@index'</span>, [<span class="string">'query'</span> =&gt; $tags-&gt;posts()]);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment">// ä¸€å¯¹å¤šå…³ç³»åµŒå¥—è·¯ç”±</span></span><br><span class="line"> $api-&gt;get(<span class="string">'users/&#123;user&#125;/posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">     $user = \App\Models\User::findOrFail($id);</span><br><span class="line">     <span class="keyword">return</span> app()-&gt;call(<span class="string">'App\Http\Controllers\Api\PostController@index'</span>, [<span class="string">'query'</span> =&gt; $user-&gt;posts()]);</span><br><span class="line"> &#125;)</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// ä¸Šé¢çš„ä»£ç éå¸¸çš„æœ‰è§„å¾‹ï¼Œå¯ä»¥è¿›è¡Œä¸€æ¬¡å°è£…ï¼Œè€Œä¸æ˜¯è¿™æ ·ä¸è¡Œçš„é‡å¤è§£æã€‚laravel5.6æ”¯æŒçš„è·¯ç”±æ¨¡å‹æ³¨å…¥æ˜¯ä¸ªä¸é”™çš„æ³¨æ„ï¼Œä½†æ˜¯dingo/apiç›®å‰è¿˜ä¸æ”¯æŒ</span></span><br><span class="line"> <span class="comment">// åˆ«å¿˜äº†åœ¨ä½ æ¨¡å‹ä¸­å®šä¹‰ç›¸åº”çš„å…³è”å…³ç³»</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># PostController.php</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($query = null)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="comment">// parseFilteræ˜¯æˆ‘å°è£…çš„ä¸€ä¸ªç”¨æ¥è§£æé€šç”¨å‚æ•°çš„æ–¹æ³•</span></span><br><span class="line">     $paginator = <span class="keyword">$this</span>-&gt;parseFilter($query ?? Post::query());</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;paginator($paginator, <span class="keyword">new</span> PostTransformer());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="èµ„æºå…³è”"><a href="#èµ„æºå…³è”" class="headerlink" title="èµ„æºå…³è”"></a>èµ„æºå…³è”</h2><p>dingo/api + Fractal å¯¹èµ„æºå…³è”å¤„ç†éå¸¸ä¼˜é›…ï¼Œå¹¶ä¸”å¾ˆå¥½çš„è§£å†³äº†n+1 é—®é¢˜ã€‚</p>
<p>å‡è®¾ä¸¤ä¸ªéœ€æ±‚</p>
<ul>
<li>å½“æˆ‘å–å‡ºå¤šä¸ªæ–‡ç« èµ„æºæ—¶æˆ‘å¸Œæœ›èƒ½å¤Ÿå…³è”å®ƒä»¬çš„ä½œè€…ã€‚</li>
</ul>
<p><strong>urlï¼š</strong> <code>http://api.test/posts?include=user:field(id|name|avatar)</code></p>
<ul>
<li>å–å‡ºä¸€ä¸ªç¤¾åŒºèµ„æºå¹¶é™„å¸¦å‡ åæ´»è·ƒçš„ç”¨æˆ·èµ„æºï¼Œä»¥åŠè¿™äº›æ´»è·ƒç”¨æˆ·æœ€è¿‘å‘è¡¨è¿‡çš„3ç¯‡æ–‡ç« æ—¶<br><strong>urlï¼š</strong> <code>http://api.test/hubs/1?include=hot_users:limit(3).posts:fields(id|title):limit(3)</code></li>
</ul>
<p>è¿™å¤§æ¦‚å°±æ˜¯æˆ‘éå¸¸å–œæ¬¢fractalè€Œè¿Ÿè¿Ÿä¸è‚¯ä½¿ç”¨laravel5.5çš„resourcesçš„åŸå› ï¼Œ å› ä¸ºå®ƒåˆ¶å®šå‡ºäº†ä¸€å¥—includeçš„è§„åˆ™å’Œç›¸åº”çš„ä»£ç å¤„ç†ï¼Œä½¿å¾—ä»£ç çš„å¶åˆæ€§éå¸¸ä½ã€‚</p>
<blockquote>
<p>includeå‚æ•°çš„è¯¦ç»†ä½¿ç”¨æ–¹å¼ è¯·å‚è€ƒdingo/apiæ–‡æ¡£ å’Œ fractalæ–‡æ¡£ <a href="https://fractal.thephpleague.com/" target="_blank" rel="noopener">https://fractal.thephpleague.com/</a></p>
</blockquote>
<p>å¯¹äºä¸Šé¢çš„éœ€æ±‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PostTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includeUser</span><span class="params">(Post $post, ParamBag $params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// fractalä¼šå¸®æˆ‘ä»¬è§£æincludeä¸­çš„å‚æ•°ï¼Œå¹¶æ³¨å…¥åˆ° $paramsä¸­ã€‚å› æ­¤æˆ‘ä»¬ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">    $user = $post-&gt;user()-&gt;select($params[fields] ?? <span class="string">'*'</span>)-&gt;firstOrFail();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;item($user, <span class="keyword">new</span> UserTransformer());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># HubTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includeHotUsers</span><span class="params">(Hub $hub, ParamBag $params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $users = $hub-&gt;hot_users()</span><br><span class="line">        -&gt;limit($params[<span class="string">'limit'</span>][<span class="number">0</span>] ?? <span class="number">5</span>)</span><br><span class="line">        -&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;collection($users, <span class="keyword">new</span> UserTransformer());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includePosts</span><span class="params">(User $user, ParamBag $params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $post = $user-&gt;posts()</span><br><span class="line">        -&gt;select($params[fields] ?? [<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'description'</span>, <span class="string">'like_count'</span>])</span><br><span class="line">        -&gt;limit($params[<span class="string">'limit'</span>][<span class="number">0</span>] ?? <span class="number">5</span>)</span><br><span class="line">        -&gt;get();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;collection($posts, <span class="keyword">new</span> PostTransformer());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¡¥å……ä¸€ä¸‹ï¼Œ å¯¹äºä½¿ç”¨äº† <code>$this-&gt;response()-&gt;collection()</code>å’Œ<code>$this-&gt;response-&gt;paginator()</code> æ–¹æ³•çš„èµ„æºã€‚ dingo/api ä¼šå»è§£æurlä¸­çš„includeå‚æ•°ï¼Œç„¶åå»è°ƒç”¨æ¨¡å‹çš„ç›¸åº”çš„å…³è”æ–¹æ³•æ¥è¿›è¡Œé¢„åŠ è½½ï¼Œä»è€Œè§£å†³æŸ¥è¯¢çš„n+1é—®é¢˜</p>
<p>ä¸Šé¢çš„ç¬¬äºŒä¸ªéœ€æ±‚ï¼Œè¦æ±‚Hubæ¨¡å‹ä¸­å¿…é¡»å®šä¹‰ hot_userså’Œposts è¿™ä¸¤ä¸ªå…³è”æ–¹æ³•ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºå¼‚å¸¸</p>
<blockquote>
<p>è¿™é‡Œæ¨¡å‹å®šä¹‰çš„å…³è”æ–¹æ³•çš„åç§°å¿…é¡»ä¸urlä¸€è‡´ æ—¢ hot_users()ã€‚éå¸¸éš¾å—å‘€ï¼Œå› ä¸ºurlæ¨èå°å†™ï¼Œæ–¹æ³•åæ¨èå°é©¼å³°ï¼ï¼</p>
</blockquote>
<h3 id="å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™"><a href="#å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™" class="headerlink" title="å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™"></a>å…³è”èµ„æºçš„å‚æ•°è¿‡æ»¤è§„åˆ™</h3><p><code>:å‚æ•°åç§°(å€¼1|å€¼2|å€¼N)</code><br>â€˜:â€™ å†’å·æ ‡å¿—ç€ä¸€ä¸ªå‚æ•°çš„å¼€å§‹<br>ç´§è·Ÿç€æ˜¯å‚æ•°åç§°<br>ç„¶åæ¥ä¸Šå‚æ•°å€¼ å…¶ä¸­å‚æ•°çš„å€¼éœ€è¦è¢«æ‹¬å·æ‹¬èµ·<br>å¤šä¸ªå‚æ•°å€¼æ—¶ä½¿ç”¨ â€˜|â€™ åˆ†éš”</p>
<blockquote>
<p>å…³è”èµ„æºæˆ‘å¹¶ä¸æ¨èæä¾›åˆ†é¡µå‚æ•°ï¼Œå› ä¸ºå…¶ä¼šé€ æˆæ•°æ®çš„é‡å¤è¯»å–ï¼Œå¦‚æœéœ€è¦å–å‡ºçš„å…³è”èµ„æºæ•°æ®é‡å¾ˆå¤šã€‚æ¨èé€šè¿‡å•ç‹¬çš„apiè¯·æ±‚è·å–è¯¥èµ„æºï¼Œè€Œä¸æ˜¯é€šè¿‡includeæ–¹å¼åŠ è½½è¿›æ¥ã€‚</p>
</blockquote>
<h2 id="èµ„æºä¸­çš„åŠ¨ä½œ"><a href="#èµ„æºä¸­çš„åŠ¨ä½œ" class="headerlink" title="èµ„æºä¸­çš„åŠ¨ä½œ"></a>èµ„æºä¸­çš„åŠ¨ä½œ</h2><p>æˆ‘ä»¬å¯¹èµ„æºå­˜åœ¨ä¸€äº›åŠ¨ä½œè¡Œä¸ºï¼Œå¦‚å¯¹å¸–å­çš„ç‚¹èµæ”¶è—ç­‰ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©æ¨¡ä»¿githubçš„åšæ³•ï¼Œå°†åŠ¨ä½œè½¬æ¢ä¸ºèµ„æºã€‚</p>
<h3 id="åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº"><a href="#åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº" class="headerlink" title="åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº"></a>åˆ›å»ºä¸åˆ é™¤åŠ¨ä½œèµ„æº</h3><ul>
<li>ç‚¹èµæ–‡ç« </li>
</ul>
<p><strong>url:</strong> <code>http://mp.test/posts/1/likes</code><br><strong>method:</strong> <code>POST</code></p>
<ul>
<li>å–æ¶ˆç‚¹èµæ–‡ç« </li>
</ul>
<p><strong>url:</strong> <code>http://mp.test/posts/1/likes</code><br><strong>method:</strong> <code>DELETE</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PostLikeController.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(Request $request, $id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DB::table(<span class="string">'user_like_post'</span>)-&gt;insert([</span><br><span class="line">        <span class="string">'user_id'</span> =&gt; \Auth::id(),</span><br><span class="line">        <span class="string">'post_id'</span> =&gt; $id</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;created();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DB::table(<span class="string">'user_like_post'</span>)-&gt;where(<span class="string">'user_id'</span>, \Auth::id())-&gt;where(<span class="string">'post'</span>, $id)-&gt;delete();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;noContent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="éªŒè¯åŠ¨ä½œèµ„æº"><a href="#éªŒè¯åŠ¨ä½œèµ„æº" class="headerlink" title="éªŒè¯åŠ¨ä½œèµ„æº"></a>éªŒè¯åŠ¨ä½œèµ„æº</h3><p>è¿™æ˜¯ä¸€ä¸ªæˆ‘ç ”ç©¶/çº ç»“äº†å¾ˆä¹…çš„é—®é¢˜ï¼Œå°è¯•è¿‡å¾ˆå¤šç§å†™æ³•ï¼Œè¿™é‡Œå†³å®šæ¨¡ä»¿çŸ¥ä¹çš„apiå†™æ³•</p>
<p>éªŒè¯ç”¨æˆ·æ˜¯å¦ç‚¹èµäº†æŸä¸€ç¯‡å¸–å­</p>
<p><strong>urlï¼š</strong> <code>http://api.test/posts/1?include=is_like</code></p>
<p>å¯¹äºä¸Šé¢çš„urlï¼Œdingo/api ä¼šè‡ªåŠ¨è°ƒç”¨PostTransformerçš„includeIsLikeæ–¹æ³•ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨è¯¥æ–¹æ³•ä¸­è¿›è¡ŒéªŒè¯å³å¯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PostTransformer.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">includeIsLike</span><span class="params">(Post $post)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™è¡Œä»£ç å¯ä»¥æ ¹æ®Auth::id Cacheä¸€ä¸‹</span></span><br><span class="line">    $likePostIds = DB::table(<span class="string">'user_like_post'</span>)-&gt;where(<span class="string">'user_id'</span>, Auth::id())-&gt;pluck(<span class="string">'post_id'</span>)-&gt;toArray();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;primitive(in_array($diary-&gt;id, $likePostIds));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åæ§½ä¸€ä¸‹ includeIsLikeå¦‚ä½•è¿”å›æ ‡é‡èµ„æºï¼Œæ–‡æ¡£ä¸Šæ²¡æœ‰ä»»ä½•æè¿°ã€‚<br>çœ‹äº†æºç æ‰å‘ç°primitiveè¿™ä¸ªå…³é”®è¯ã€‚ğŸ˜£</p>
<p>å¯¹äºå•ä¸ªèµ„æºå¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆä¸Šé¢çš„éœ€æ±‚ï¼Œä½†å¯¹äºèµ„æºé›†åˆæˆ‘é‡åˆ°äº†å¾ˆå¤§çš„é—®é¢˜</p>
<p><strong>urlï¼š</strong> <code>http://api.test/posts?include=is_like</code></p>
<p>é›†åˆæˆ‘ç»Ÿä¸€ä½¿ç”¨äº†<code>$this-&gt;response-&gt;paginator()</code>ï¼Œ å‰é¢æåˆ° paginatorå’Œcollectionæ–¹æ³•ï¼Œä¼šå»æ£€æµ‹includeå‚æ•°å¹¶è°ƒç”¨æ¨¡å‹çš„ç›¸åº”çš„å…³è”æ–¹æ³•æ¥è¿›è¡Œé¢„åŠ è½½ã€‚ æ‰€ä»¥ä¼šå»postsæ¨¡å‹å»æ‰¾is_likeæ–¹æ³•ï¼Œå¯æ˜¯æˆ‘çœŸçš„å®šä¹‰ä¸å‡ºä¸€ä¸ªis_likeå…³è”å…³ç³»å‘¢ã€‚<br>è€Œä¸”è¿™ä¸ªè¡Œä¸ºæ˜¯æ²¡æ³•ä¼˜é›…çš„ç¦æ­¢æ‰çš„ï¼Œæƒ³è¦ç¦æ­¢ï¼Ÿokå•Šï¼Œé‚£å°±å…¨å…³äº†ï¼Œåˆ«æƒ³æˆ‘å†ç»™ä½ è§£å†³n+1é—®é¢˜äº†</p>
<p>è¿™æ˜æ˜æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è§£å†³çš„é—®é¢˜ï¼Œåœ¨dingo/apiçš„issueä¸­ä¹Ÿæåˆ°äº†å¤šæ¬¡ã€‚ä½†æ˜¯éƒ½æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚</p>
<blockquote>
<p>äºæ˜¯æˆ‘forkä¸‹äº†dingo/apiçš„ä»£ç å‡†å¤‡è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘ç»ˆäºæ˜ç™½æ˜¯ä¸ºä»€ä¹ˆäº†~<br>dingo/apiå’ŒFractalæ˜¯ä¸åŒä½œè€…çš„é¡¹ç›®ã€‚dingo/apiæ˜¯ä¸ºlaravelé‡èº«æ‰“é€ çš„ã€‚å…¶ä¾èµ–çš„transformä½¿ç”¨çš„æ˜¯Fractalã€‚ è€ŒFractalå¹¶ä¸ä¸“å±äºlaravel.<br>åœ¨dingo/apiä¸­åšå¾ˆå®¹æ˜“ï¼Œä½†æ˜¯åœ¨Fractalä¸­æ·»åŠ ä¸€ä¸ªä¸ºlaravelæœåŠ¡çš„æ‰©å±•å°±æœ‰äº›ä¸åˆ‡å®é™…äº†</p>
</blockquote>
<p>æ—¢ç„¶å¦‚æ­¤å°±åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ç¨å¾®è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªæ ¹Transformers.php æ‰€æœ‰çš„Transformeréƒ½ç»§æ‰¿è‡ªè¯¥Transformer</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Transformers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">League</span>\<span class="title">Fractal</span>\<span class="title">TransformerAbstract</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transformer</span> <span class="keyword">extends</span> <span class="title">TransformerAbstract</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $disableEagerLoadedIncludes = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getDisableEagerLoadedIncludes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;disableEagerLoadedIncludes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ª Fractal.php å¹¶ç»§æ‰¿äºåŸæœ‰Fractal</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fractal</span> <span class="keyword">extends</span> \<span class="title">Dingo</span>\<span class="title">Api</span>\<span class="title">Transformer</span>\<span class="title">Adapter</span>\<span class="title">Fractal</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">mergeEagerLoads</span><span class="params">($transformer, $requestedIncludes)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $includes = array_merge($requestedIncludes, $transformer-&gt;getDefaultIncludes());</span><br><span class="line">        $includes = array_diff($includes, $transformer-&gt;getDisableEagerLoadedIncludes());</span><br><span class="line">        $eagerLoads = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($includes <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            $eagerLoads[] = is_string($key) ? $key : $value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $eagerLoads;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ dingo/apiçš„é…ç½®æ–‡ä»¶api.php å°†åŸæœ‰çš„Fractalæ›´æ”¹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„</span></span><br><span class="line"></span><br><span class="line"><span class="string">'transformer'</span> =&gt; env(<span class="string">'API_TRANSFORMER'</span>, \App\Services\Fractal::class),</span><br></pre></td></tr></table></figure>
<p>å¤§åŠŸå‘Šæˆ~ æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦åœ¨PostTransformerä¸­å®šä¹‰ä¸€ä¸ª disableEagerLoadedIncludeså±æ€§æ¥æ·»åŠ ä¸éœ€è¦æ€¥åˆ‡åŠ è½½çš„å±æ€§äº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $disableEagerLoadedIncludes = [<span class="string">'is_like'</span>];</span><br></pre></td></tr></table></figure>
<p>ç»ˆäºå¯ä»¥  <code>?include=is_like,like_count,is_author,balala...</code> é¢å‘includeçš„ç¼–ç¨‹äº†</p>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>ä¸Šé¢è¯´çš„éƒ½æ˜¯å·²æŸ¥è¯¢ä¸ºä¸»ï¼Œä½†å¢åˆ æ”¹ä¹Ÿæœ‰ä¸€äº›å°æŠ€å·§ å¦‚åˆ›å»ºèµ„æºé™¤äº†ä½¿ç”¨ dingo/apiå°è£…çš„<code>$this-&gt;response-&gt;created()</code>å¤–ï¼Œ ä½¿ç”¨<code>$this-&gt;response-&gt;item($post, new PostTransformer())-&gt;setStatusCode(201);</code>ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>ä½¿ç”¨ requestè¿›è¡Œè¡¨å•éªŒè¯ã€ä½¿ç”¨ Policiyè¿›è¡Œæƒé™éªŒè¯ã€ä½¿ç”¨Observerè¿›è¡Œå‰¯ä½œç”¨çš„å¤„ç†ç­‰ç­‰ï¼Œä»è€Œä¿è¯å¢åˆ æ”¹çš„ä»£ç æ›´å…·æœ‰å¯è¯»æ€§å’Œè§£è€¦æ€§ã€‚</p>
<p>å¦å¤–è¿˜æœ‰å¾ˆå¤šå¾…è§£å†³çš„é—®é¢˜</p>
<ul>
<li>å¦‚åµŒå¥—èµ„æºä¸­ï¼Œç›´æ¥åœ¨è·¯ç”±æ–‡ä»¶ä¸­å¤„ç†é€»è¾‘å¹¶ä¸ä¼˜é›…</li>
<li>fields ç­›é€‰å­—æ®µå¯¹ Transformçš„ä¼ ç»Ÿå†™æ³•å¹¶ä¸å‹å¥½ æœ‰å¾…æ”¹è¿›</li>
<li>fieldsæ–¹æ³•åœ¨laravelä¸­æ˜¾å¾—å’Œincludeæœ‰äº›å†²çªï¼Œæ˜¯å¦å¯ä»¥ç›´æ¥åœ¨includeä¸­ç¼–å†™éœ€è¦è·å–çš„fieldså‘¢<ul>
<li>è¿™é‡Œæˆ‘è§‰å¾—å¯èƒ½éœ€è¦æŠ›å¼ƒåŸæœ‰transform()çš„å†™æ³•ï¼Œæ•°æ®å¤„ç†åº”è¯¥é€šè¿‡ormæä¾›çš„ä¸€äº›ä¿®æ”¹å™¨æ¥è¿›è¡Œã€‚æ›´å¤šçš„æ•°æ®å¤„ç†åˆ™äº¤ç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æä¾›ä¸€äº›æ›´åŠ rawçš„æ•°æ®ã€‚</li>
</ul>
</li>
<li><p>å½“ä¸€ä¸ªç•Œé¢è¿‡äºå¤æ‚æ—¶ï¼Œéœ€è¦è¯·æ±‚å¤šæ¬¡apiï¼Œè¶…è¿‡3æ¬¡ä»¥ä¸Šæˆ‘å°±æœ‰äº›éš¾ä»¥æ¥å—äº†ï¼Œgetè¯·æ±‚urlè¿‡é•¿é—®é¢˜ï¼Œæ¥ä¸‹æ¥ä¼šå°è¯•è¿›è¡Œè·¯ç”±çš„æ˜ å°„ ç»„è£…æ“ä½œç­‰æ“ä½œè§£å†³è¿™ä¸ªé—®é¢˜</p>
</li>
<li><p>èµ„æºæš´éœ²æ˜¯å¦ä¼šå¸¦æ¥å®‰å…¨é—®é¢˜ï¼Ÿè¿™ä¸€ç‚¹æˆ‘è§‰ä¸ä¼šã€‚å¦‚ä½•è®¤è¯å’Œé™æµå‚è€ƒdingo/apiæ–‡æ¡£å³å¯</p>
</li>
<li>å¯¹äºä¸€äº›ä¸ç¬¦åˆRESTfulèµ„æºçš„éœ€æ±‚å¦‚ä½•å¤„ç†ï¼Œå¦‚æœç´¢éœ€æ±‚ã€‚å¯ä»¥å°è¯•åˆ›å»ºäº›é¢å¤–çš„è·¯ç”±æ¥å¤„ç†è¿™äº›é¢å¤–çš„éœ€æ±‚ã€‚è¿™äº›éœ€æ±‚å¯ä»¥å åˆ°ä¸€ä¸ªé¡¹ç›®çš„20%å·¦å³</li>
<li>èµ„æºæ§åˆ¶å™¨çš„indexæ–¹æ³•ä½¿ç”¨çš„pageæ¯æ¬¡éƒ½ä¼šå¤šæŸ¥è¯¢ä¸€æ¡æ€»è®°å½•æ•°çš„sqlã€‚</li>
<li><p>èµ„æºæ§åˆ¶å™¨çš„indexæ–¹æ³•å¦‚æœä¸å­˜åœ¨ç­›é€‰æ¡ä»¶æ—¶å¦‚ä½•åšèµ„æºé™åˆ¶ï¼Œæ€»ä¸èƒ½ä¸€æ¬¡å–å‡ºæ‰€æœ‰çš„èµ„æº</p>
<ul>
<li><p>çªå‘å¥‡æƒ³é‡‡ç”¨äº†ä¸€ä¸ªsqlé»‘åå•çš„æœºåˆ¶</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">isBlacklist</span><span class="params">($query)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        $limit = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (request(<span class="string">'per_page'</span>) &amp;&amp; request(<span class="string">'per_page'</span>) &lt; $limit) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $key = <span class="string">'sql:'</span>. $query-&gt;toSql();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Cache::has($key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($query-&gt;count() &gt; $limit) &#123;</span><br><span class="line">                Cache::forever($key, date(<span class="string">'Y-m-d H:i:s'</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>â€¦</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å†æ¬¡è¯´æ˜ä¸€ä¸‹æˆ‘åœ¨åšä»€ä¹ˆï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿåœ¨æ•°æ®çš„åŸºç¡€ä¸Šç¼–å†™ä¸€å¥—æ¥å£èƒ½å¤Ÿæ»¡è¶³h5ç«¯ã€pcç«¯ã€ios/androidç«¯ã€åŒ…æ‹¬å°ç¨‹åºç«¯ç­‰ç­‰80%çš„éœ€æ±‚ã€‚<br>æˆ‘ä¸å¸Œæœ›æˆ‘çš„æ¥å£è¦è·Ÿç€æ¯ä¸€æ¬¡çš„ä¸šåŠ¡å˜åŠ¨è€Œå»ä¿®æ”¹ï¼Œæˆ‘å¸Œæœ›è‡ªå·±å…³å¿ƒçš„æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡ã€‚<br>æˆ‘å¸Œæœ›åªè¦çŸ¥é“äº§å“çš„åŸå‹ï¼Œå°±èƒ½å®Œæˆåç«¯80%çš„å¼€å‘ï¼Œ è€Œä¸æ˜¯ç­‰è®¾è®¡å®šç¨¿/ç­‰å‰ç«¯å¼€å‘ç­‰ç­‰</p>
<p>ç°åœ¨å‰ç«¯çš„å¼€å‘æ˜¯æ¨¡å—åŒ–çš„ï¼Œåœ¨æˆ‘çœ‹æ¥å°±æ˜¯é¢å‘importçš„å¼€å‘ã€‚<br>ä¼ ç»Ÿçš„RESTfulæ¥å£æ²¡æ³•é€‚åº”äºå‰ç«¯çš„æ¨¡å—åŒ–å¼€å‘ã€‚å­˜åœ¨ç€å¤§é‡çš„å­—æ®µå†—ä½™å’Œhttpè¯·æ±‚ï¼Œè¿™æ˜¯æˆ‘åœ¨å­¦ä¹ graphQLçš„æ—¶çœ‹åˆ°çš„ä¸€å¥è¯ã€‚</p>
<p>ä½†æ—¢ç„¶å‰ç«¯çš„å¼€å‘æ˜¯æ¨¡å—åŒ–çš„ã€é¢å‘importçš„ï¼Œåç«¯çš„apiæ¥å£ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯é¢å‘includeçš„å‘¢ ğŸ˜†</p>
<blockquote>
<p>æŒç»­å…³æ³¨ä¸­ - å¸Œæœ›ä½ èƒ½åˆ†äº«åœ¨RESTful APIã€dingo/apiã€laravel apiç­‰å¼€å‘æ—¶çš„ç»éªŒã€æƒ³æ³•å’ŒæŠ€å·§~<br>æˆ‘å°†ä¼šæ€»ç»“å‡ºä¸€ä»½ä»£ç demoå¹¶åˆ†äº«å‡ºæ¥</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/posts/do-you-really-know-git.html" class="prev">PREV</a><a href="/posts/a-deep-understanding-of-the-tcp-protocol-1.html" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'maxwei';
var disqus_identifier = 'posts/writing-more-descriptive-restful-api.html';
var disqus_title = 'ç¼–å†™æ›´å…·æœ‰æè¿°æ€§çš„ RESTful API';
var disqus_url = 'http://beian.miit.gov.cn/posts/writing-more-descriptive-restful-api.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//maxwei.disqus.com/count.js" async></script><div class="copyright"><p>Â© 2017 - 2020 <a href="http://beian.miit.gov.cn">ç²¤ICPå¤‡18153286</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-113144905-1",'auto');ga('send','pageview');</script></body></html>